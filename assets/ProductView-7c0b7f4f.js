import{S as w,a as M,N as I,P as B}from"./pagination.min-4c192961.js";import{k as P,n as C,j as g,l as N}from"./runtime-dom.esm-bundler-eb0e3820.js";import{m as V}from"./axios-0c483e9a.js";import{c as E}from"./carts-41c0fb67.js";import{b6 as U,av as v,aj as n,l as h,m as t,t as _,b1 as m,aJ as i,k as x,a3 as c,s as d,b3 as u,F as p,at as b,j as y}from"./_plugin-vue_export-helper-68081c38.js";import"./vue-router-99ebe252.js";import"./_commonjsHelpers-042e6b4d.js";const{VITE_PATH:f}={VITE_PATH:"https://vue-final-dbjson-889xxtffg-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},z={components:{Swiper:w,SwiperSlide:M},data(){return{product:{},recipes:[],relevantRecipesInfo:[],userId:"",token:"",nickName:"",fullStar:"./src/assets/images/icon-star-filled.png",star:"./src/assets/images/icon-star.png",score:"",productRates:[],rateMessage:"",averageRate:0,modules:[I,B],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",bookMark:[],qty:1}},methods:{...V(E,["addCart","handleKeyDown"]),getProduct(){const{id:o}=this.$route.params;console.log("我是id",o),this.$http.get(`${f}/products/${o}`).then(s=>{console.log(s.data),this.product=s.data,this.mainImg=this.product.imgUrl,this.getRecipes()}).catch(s=>{console.log(s)})},getRecipes(){this.$http.get(`${f}/recipes`).then(o=>{console.log(o.data),this.recipes=o.data,this.recipes.forEach(s=>{this.product.relevantRecipes.forEach(a=>{s.title===a&&this.relevantRecipesInfo.push(s)})})}).catch(o=>{console.log(o)})},mouseoverStar(o){o===1&&!this.score?this.$refs.rate1.src=this.fullStar:o===2&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar):o===3&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar):o===4&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar):o===5&&!this.score&&(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.fullStar)},mouseoutStar(o){o===1&&!this.score?this.$refs.rate1.src=this.star:o===2&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star):o===3&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star):o===4&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star):o===5&&!this.score&&(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star)},getProductRates(){const{id:o}=this.$route.params;this.$http.get(`${f}/product/${o}/productRates?_expand=user`).then(s=>{console.log(s.data),this.productRates=s.data,this.averageRate=0,this.productRates.forEach(a=>{this.averageRate+=a.score}),this.averageRate=Number((this.averageRate/this.productRates.length).toFixed(1))}).catch(s=>{console.log(s)})},addProductRate(){if(!this.score){alert("不會不小心按到吧，請輸入評分");return}const{id:o}=this.$route.params;this.$http.post(`${f}/600/product/${o}/productRates`,{userId:this.userId,productId:o,message:this.rateMessage,createAt:new Date().getTime(),score:Number(this.score)},{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{console.log(s.data),this.getProductRates(),this.score=null,this.rateMessage="",this.$refs.form.reset()}).catch(s=>{console.log(s),alert("驗證過期，請重新登入"),this.$router.push("/loginSignup/login")})},getBookmark(){const{id:o}=this.$route.params,s=`${f}/600/users/${this.userId}/productBookmarks?productId=${o}&_expand=product`;this.$http.get(s,{headers:{authorization:`Bearer ${this.token}`}}).then(a=>{console.log(a.data),this.bookMark=a.data}).catch(a=>{console.log(a)})},addBookmark(o){const s={userId:this.userId,productId:o};this.$http.post(`${f}/600/users/${this.userId}/productBookmarks?_expand=product`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(a=>{console.log(a.data),this.getBookmark(),console.log("收藏成功!")}).catch(a=>{console.log(a)})},deleteBookmark(){let o="";this.bookMark.forEach(s=>{o=s.id}),this.$http.delete(`${f}/600/productBookmarks/${Number(o)}`,{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{console.log(s.data),this.getBookmark(),console.log("刪除收藏")}).catch(s=>{console.log(s)})}},mounted(){this.token=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),this.getProduct(),this.userId=localStorage.getItem("userId"),this.userId=Number(this.userId),this.nickName=localStorage.getItem("nickName"),this.getProductRates(),this.getBookmark()},watch:{score(){this.score==="1"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="2"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="3"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="4"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.star):this.score==="5"&&(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.fullStar)}}},j={class:"py-100-sm-40"},G={class:"container"},T={"aria-label":"breadcrumb"},D={class:"breadcrumb"},A={class:"breadcrumb-item fs-5"},q={class:"breadcrumb-item active fs-5 d-none d-lg-block","aria-current":"page"},F={class:"container d-flex justify-content-center mt-5"},L={class:"col-8"},H={class:"row gy-3"},O={class:"col-6"},J={class:"row g-3"},K={class:"col-12 d-flex"},Y=["src"],Q={class:"col-6 d-flex flex-column"},W={class:"d-flex align-items-center"},X={class:"me-3"},Z={key:0,style:{"pointer-events":"none","font-size":"14px"},class:"badge rounded-pill text-orange px-3 py-2 bg-brown border-0"},$={class:"h3 mb-0"},ee={class:"ms-auto"},te=t("i",{class:"bi bi-heart"},null,-1),se=[te],re=t("i",{class:"bi bi-heart-fill"},null,-1),oe=[re],ie={class:"mb-5"},le={class:"row align-items-center mt-auto mb-2"},ae={class:"col-5 h5 mb-0"},ce=t("br",null,null,-1),ne={class:"col-7 d-flex align-items-center mt-4"},he=["value"],ue={class:"col-12 productSwiper d-flex"},fe=["src"],de=["src"],ge={class:"bg-lightYellow my-5"},me={class:"container py-5"},pe=t("h3",null,[t("span",{class:"material-icons-outlined fs-3"},"menu_book"),d(" 相關食譜 ")],-1),be={class:"row my-5"},ve=["src"],_e={class:"fw-bold mt-2 text-center"},ke={class:"container py-5"},Re=t("i",{class:"bi bi-stars"},null,-1),xe={class:"my-5"},ye={class:"mb-0 fw-bold d-flex align-items-center"},Se=t("i",{class:"bi bi-person-circle fs-1 me-3"},null,-1),we={class:"d-flex rates mb-3"},Me={class:"form-check px-1"},Ie=["src"],Be={class:"form-check px-1"},Pe=["src"],Ce={class:"form-check px-1"},Ne=["src"],Ve={class:"form-check px-1"},Ee=["src"],Ue={class:"form-check px-1"},ze=["src"],je=t("div",{class:"d-flex"},[t("button",{type:"submit",class:"ms-auto btn btn-brown mt-3"},"送出")],-1),Ge={class:"row gy-5"},Te={class:"mb-0 fw-bold d-flex align-items-center"},De=t("i",{class:"bi bi-person-circle fs-1 me-3"},null,-1),Ae={class:"mb-0"};function qe(o,s,a,Fe,e,l){const k=v("RouterLink"),R=v("swiper-slide"),S=v("swiper");return n(),h("div",j,[t("div",G,[t("nav",T,[t("ol",D,[t("li",A,[_(k,{to:"/products",class:"link-orange d-none d-lg-block"},{default:m(()=>[d("材料購買")]),_:1})]),t("li",q,i(e.product.title),1)])])]),t("section",F,[t("div",L,[t("div",H,[t("div",O,[t("div",J,[t("div",K,[t("img",{src:e.mainImg,width:"400",height:"300",style:{"object-fit":"cover"},class:"mx-auto",alt:""},null,8,Y)])])]),t("div",Q,[t("div",W,[t("div",X,[e.product.isCheaper?(n(),h("span",Z,i((100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0))%10===0?(100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0)).toString().charAt(0):100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0))+" 折 ",1)):x("",!0)]),t("h1",$,i(e.product.title),1),t("div",ee,[e.bookMark.length===0?(n(),h("button",{key:0,type:"button",class:"border-0 bg-transparent text-brown fs-4",onClick:s[0]||(s[0]=()=>l.addBookmark(e.product.id))},se)):e.bookMark.length!==0?(n(),h("button",{key:1,type:"button",class:"border-0 bg-transparent fs-4",onClick:s[1]||(s[1]=(...r)=>l.deleteBookmark&&l.deleteBookmark(...r)),style:{color:"#fa6e42"}},oe)):x("",!0)])]),t("p",ie,i(e.product.description),1),t("div",le,[t("p",ae,[t("del",{class:c(["me-2 text-muted",{"d-none":!e.product.isCheaper}])},"NT$ "+i(e.product.originalPrice),3),ce,t("span",null,[t("span",{class:c({"text-danger":e.product.isCheaper,"fw-bold":e.product.isCheaper})},"NT$ "+i(e.product.price),3),d(" / "+i(e.product.num)+i(e.product.unit),1)])]),t("div",ne,[t("button",{class:c(["btn btn-sm btn-brown rounded-circle",{disabled:e.qty===1}]),style:{width:"30px",height:"30px"},type:"button",id:"button-addon2",onClick:s[2]||(s[2]=()=>e.qty-=1)},"-",2),u(t("select",{name:"",id:"",class:"form-select border-0 text-center","onUpdate:modelValue":s[3]||(s[3]=r=>e.qty=r),style:{width:"70px"}},[(n(),h(p,null,b(30,r=>t("option",{value:r,key:r+4596945},i(r),9,he)),64))],512),[[P,e.qty]]),t("button",{class:"btn btn-sm btn-brown rounded-circle",style:{width:"30px",height:"30px"},type:"button",id:"button-addon2",onClick:s[4]||(s[4]=()=>e.qty+=1)},"+"),t("button",{class:"ms-4 btn btn-brown",type:"button",id:"button-addon2",onClick:s[5]||(s[5]=()=>o.addCart(e.product,e.qty))},"購買")])])]),t("div",ue,[_(S,{"slides-per-view":3,"space-between":15,modules:e.modules,navigation:"",pagination:{clickable:!0}},{default:m(()=>[_(R,{style:{cursor:"pointer"},onClick:s[6]||(s[6]=()=>e.mainImg=e.product.imgUrl)},{default:m(()=>[t("img",{src:e.product.imgUrl,alt:"",style:{"object-fit":"cover"}},null,8,fe)]),_:1}),(n(!0),h(p,null,b(e.product.imgsUrl,r=>(n(),y(R,{key:r+45345,style:{cursor:"pointer"},onClick:()=>e.mainImg=r},{default:m(()=>[t("img",{src:r,alt:"",style:{"object-fit":"cover"}},null,8,de)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])])])])]),t("section",ge,[t("div",me,[pe,t("div",be,[(n(!0),h(p,null,b(e.relevantRecipesInfo,r=>(n(),y(k,{to:`/recipes/${r.id}`,class:"col-2 link-brown",key:r.id+456456},{default:m(()=>[t("img",{src:r.image,alt:"",width:"200",height:"100",style:{"object-fit":"cover"}},null,8,ve),t("h5",_e,i(r.title),1)]),_:2},1032,["to"]))),128))])])]),t("section",ke,[t("h3",null,[Re,d(" 顧客評價（"+i(e.productRates.length)+" 則） ",1)]),t("p",null,[d("平均評價 "),t("span",null,i(`${e.averageRate?e.averageRate:"尚未評分"}`),1),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===0&&e.averageRate!==0,"text-orange":e.averageRate>1||Math.floor(e.averageRate)===0&&e.averageRate!==0||e.averageRate===1,"text-lightGray":e.averageRate<1&&Math.floor(e.averageRate)<0||!e.averageRate||e.averageRate===0}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===1&&e.averageRate!==1,"text-orange":e.averageRate>2||Math.floor(e.averageRate)===1&&e.averageRate!==1||e.averageRate===2,"text-lightGray":e.averageRate<2&&Math.floor(e.averageRate)<1||!e.averageRate||e.averageRate===1}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===2&&e.averageRate!==2,"text-orange":e.averageRate>3||Math.floor(e.averageRate)===2&&e.averageRate!==2||e.averageRate===3,"text-lightGray":e.averageRate<3&&Math.floor(e.averageRate)<2||!e.averageRate||e.averageRate===2}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===3&&e.averageRate!==3,"text-orange":e.averageRate>4||Math.floor(e.averageRate)===3&&e.averageRate!==3||e.averageRate===4,"text-lightGray":e.averageRate<4&&Math.floor(e.averageRate)<3||!e.averageRate||e.averageRate===3}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===4&&e.averageRate!==4,"text-orange":e.averageRate>5||Math.floor(e.averageRate)===4&&e.averageRate!==4||e.averageRate===5,"text-lightGray":e.averageRate<5&&Math.floor(e.averageRate)<4||!e.averageRate||e.averageRate===4}])},null,2)]),t("div",xe,[t("h5",ye,[Se,d(" "+i(e.nickName),1)]),t("form",{ref:"form",onSubmit:s[23]||(s[23]=C((...r)=>l.addProductRate&&l.addProductRate(...r),["prevent"])),class:"mt-2"},[t("div",we,[t("div",Me,[u(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star1",value:"1","onUpdate:modelValue":s[7]||(s[7]=r=>e.score=r)},null,512),[[g,e.score]]),t("label",{class:"form-check-label labelRate1",for:"star1",onMouseover:s[8]||(s[8]=()=>l.mouseoverStar(1)),onMouseout:s[9]||(s[9]=()=>l.mouseoutStar(1))},[t("img",{ref:"rate1",src:e.star,width:"25"},null,8,Ie)],32)]),t("div",Be,[u(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star2",value:"2","onUpdate:modelValue":s[10]||(s[10]=r=>e.score=r)},null,512),[[g,e.score]]),t("label",{class:"form-check-label labelRate2",for:"star2",onMouseover:s[11]||(s[11]=()=>l.mouseoverStar(2)),onMouseout:s[12]||(s[12]=()=>l.mouseoutStar(2))},[t("img",{ref:"rate2",src:e.star,width:"25"},null,8,Pe)],32)]),t("div",Ce,[u(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star3",value:"3","onUpdate:modelValue":s[13]||(s[13]=r=>e.score=r)},null,512),[[g,e.score]]),t("label",{class:"form-check-label labelRate3",for:"star3",onMouseover:s[14]||(s[14]=()=>l.mouseoverStar(3)),onMouseout:s[15]||(s[15]=()=>l.mouseoutStar(3))},[t("img",{ref:"rate3",src:e.star,width:"25"},null,8,Ne)],32)]),t("div",Ve,[u(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star4",value:"4","onUpdate:modelValue":s[16]||(s[16]=r=>e.score=r)},null,512),[[g,e.score]]),t("label",{class:"form-check-label labelRate4",for:"star4",onMouseover:s[17]||(s[17]=()=>l.mouseoverStar(4)),onMouseout:s[18]||(s[18]=()=>l.mouseoutStar(4))},[t("img",{ref:"rate4",src:e.star,width:"25"},null,8,Ee)],32)]),t("div",Ue,[u(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star5",value:"5","onUpdate:modelValue":s[19]||(s[19]=r=>e.score=r)},null,512),[[g,e.score]]),t("label",{class:"form-check-label labelRate5",for:"star5",onMouseover:s[20]||(s[20]=()=>l.mouseoverStar(5)),onMouseout:s[21]||(s[21]=()=>l.mouseoutStar(5))},[t("img",{ref:"rate5",src:e.star,width:"25"},null,8,ze)],32)])]),u(t("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":s[22]||(s[22]=r=>e.rateMessage=r)},null,512),[[N,e.rateMessage]]),je],544),t("div",Ge,[(n(!0),h(p,null,b(e.productRates,r=>(n(),h("div",{class:"col-12 border-bottom",key:r.id},[t("h5",Te,[De,d(" "+i(r.user.nickName),1)]),t("p",Ae,i(`${new Date(r.createAt).toLocaleDateString()}`),1),t("p",null,[t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=1,"text-lightGray":r.score<1}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=2,"text-lightGray":r.score<2}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=3,"text-lightGray":r.score<3}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=4,"text-lightGray":r.score<4}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=5,"text-lightGray":r.score<5}])},null,2)]),t("p",null,i(r.message),1)]))),128))])])])])}const We=U(z,[["render",qe]]);export{We as default};
