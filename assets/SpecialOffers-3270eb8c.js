import{l as R}from"./loadingStore-73c40ae8.js";import{f as k}from"./index-9f8e1fb0.js";import{r as f,b as v,o as z,u as x,d as b,s as D,c as L,a as M}from"./carts-18eb5781.js";import{n as T}from"./numberCommaMixin-e0aac39c.js";import{s as E}from"./publicData-f4e8600e.js";import{B as S}from"./BannerComponent-882e3d71.js";import{n as P}from"./runtime-dom.esm-bundler-eb0e3820.js";import{_ as O}from"./icon-speaker-fd89918c.js";import{b6 as V,av as N,aj as o,l as i,t as A,m as t,F as _,at as p,a3 as h,s as w,aJ as l,k as u,r as q,b1 as H}from"./_plugin-vue_export-helper-68081c38.js";const F="/finalEasyBuyEasyMake/assets/title4-ab3fed47.png",G={mixins:[T],data(){return{selections:E,coupons:{},lottery:{},lotteryResult:{},drewProducts:{},drewArr:{},user:{},uid:"",getPrize:{},tabName:"優惠折扣"}},components:{BannerComponent:S},methods:{...k(R,["startLoading","endLoading"]),...k(L,["toastMessage","goToTop","getCoupons"]),getLottery(){return new Promise((c,r)=>{const n=f(b,"lotteries/");v(n,y=>{c(y.val())})})},getLotteryResult(){z(M,c=>{if(c){this.uid=c.uid;const r=f(b,"users/"+c.uid);v(r,n=>{this.user=n.val();const y=f(b,`lotteryResults/${this.uid}`);v(y,e=>{this.lotteryResult=e.val(),this.lotteryResult?(this.drewArr=this.lotteryResult.drewArr,this.getPrize=this.lotteryResult.getPrize):(this.drewArr=[],this.getPrize={})})})}else this.uid=null,this.user={},this.drewArr=[],this.getPrize={}})},addtLotteryResult(){if(!this.uid){this.toastMessage("登入即可抽獎","error");return}if(this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2,000</b> 即可獲得一張抽獎券</p><p>單筆金額滿  <b>NT$5,000</b> 即可獲得三張抽獎券</p><p>單筆金額滿  <b>NT$10,000</b> 即可獲得七張抽獎券</p><a href="/finalEasyBuyEasyMake/#/products" class="link-primary">前往選購商品</a>',showConfirmButton:!0,confirmButtonColor:"#4572c2",confirmButtonText:"確定"});return}x(f(b),{[`users/${this.uid}/lotteryTicket/`]:this.user.lotteryTicket-1});const c=Math.floor(Math.random()*Object.keys(this.drewProducts).length),r=Object.keys(this.drewProducts)[c],n=Math.floor(Math.random()*this.drewProducts[r].length);if(!this.drewArr[r])this.drewArr[r]=[];else if(this.drewArr[r]&&this.drewArr[r].some(g=>g.title===this.drewProducts[r][n].title)){this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80" alt="非常sorry">',customClass:{icon:"border-0"},showConfirmButton:!1});return}if(this.drewArr[r].push(this.drewProducts[r][n]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[r][n].title}`,iconHtml:`<img src="${this.drewProducts[r][n].imgUrl}" width="100">`,customClass:{icon:"border-0"},showConfirmButton:!1}),Object.values(this.drewArr).reduce((e,g)=>e+g.length,0)===1){const e=f(b,`lotteryResults/${this.uid}`);D(e,{drewArr:this.drewArr})}else{x(f(b),{[`lotteryResults/${this.uid}/drewArr/`]:this.drewArr});let e=0;for(const g in this.drewArr)this.drewArr[g].length===this.drewProducts[g].length&&(e+=1);e&&x(f(b),{[`lotteryResults/${this.uid}/getPrize/`]:this.lottery.prizes[e===1?2:e===2?1:0]})}},async getData(){this.coupons=await this.getCoupons();const c=await this.getLottery();this.coupons=Object.values(this.coupons).filter(r=>r.isEnabled),Object.keys(c).forEach(r=>{c[r].id=r}),this.lottery=Object.values(c).filter(r=>r.isEnabled),this.lottery=this.lottery[0],this.lottery.recipes.forEach(r=>{this.drewProducts[r.title]||(this.drewProducts[r.title]=[]),r.relativeProducts.forEach(n=>{n.category!=="組合包"&&this.drewProducts[r.title].push(n)})}),this.endLoading()}},mounted(){this.startLoading(),this.goToTop(),this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.getLotteryResult(),this.getData()}},I={class:"container","data-aos":"fade-up"},J={class:"pt-lg-4 pt-3 position-relative"},U={class:"category-selector row row-cols-2 list-unstyled border-bottom"},W=["onClick"],Y={class:"fs-12 fs-md-5 d-block pb-2"},K={key:0,class:"list-unstyled row row-cols-lg-2 g-3 py-5 text-darkBrown"},Q={class:"card card-coupon mb-3"},X={class:"row g-0"},Z={class:"col-md-4"},$=["src","alt"],tt={class:"col-md-8"},et={class:"card-body h-100 d-flex flex-column"},st={class:"mb-2"},rt={class:"card-title fw-bold"},ot={class:"card-text text-truncate"},it={class:"text-end mt-auto"},lt={key:1},ct=t("i",{class:"bi bi-clock-fill me-1"},null,-1),nt=t("i",{class:"bi bi-ticket-perforated-fill me-1"},null,-1),at={key:1},dt=t("h4",{class:"mb-0 text-center fw-bold"},"本月指定抽獎食譜",-1),ht={class:"row row-cols-lg-3 row-cols-1 g-3 mt-lg-4 mt-1"},ut={class:"row g-0"},mt={class:"col-md-5"},gt=["src","alt"],_t={class:"col-md-7"},ft={class:"card-body d-flex flex-column justify-content-center align-items-center h-100"},bt={key:1,class:"mb-0"},pt=["src","alt"],wt={key:0,class:"position-absolute bg-trans-dark-8 d-flex"},yt=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),vt=[yt],xt={class:"text-center"},kt=t("p",{class:"text-end mt-3"},"抽一次消耗一張抽獎券",-1),Pt={key:2,class:"text-center mt-lg-120 mt-5"},Nt={class:"fs-md-3 fs-5 text-white fw-bold bg-primary-purple py-3 mb-0 d-flex align-items-center justify-content-center letter-spacing-5-sm-0"},At=t("span",{class:"material-icons-outlined me-md-3 me-2"}," celebration ",-1),Ct=t("span",{class:"material-icons-outlined fs-2"}," arrow_drop_down ",-1),jt={class:"bg-secondary-light-purple px-3"},Bt={class:"col-lg-4 col-12 mx-auto pt-4"},Rt={class:"card bg-transparent"},zt={class:"card-header bg-transparent"},Dt={class:"fs-4 fw-bold text-center"},Lt=["src","alt"],Mt={class:"card-footer bg-transparent"},Tt={class:"fw-bold"},Et={class:"text-end"},St=t("p",{class:"lh-lg pb-5 text-start text-md-center"},[w("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到 "),t("a",{href:"mailto:@EasyMakeEasyBuy.gmail.com"},"@EasyMakeEasyBuy.gmail.com"),w("，感謝您的支持!"),t("br"),w("下期好禮更精彩，千萬別錯過!")],-1),Ot={class:"py-96","data-aos":"fade-up"},Vt=q('<div class="d-lg-flex mb-2"><h2 class="d-flex align-items-center justify-content-center justify-content-lg-start fw-bold"><img src="'+F+'" class="me-lg-3 me-4 img-lg-64-md-36" alt="熱"><span class="fs-lg-1 fs-4 letter-spacing-20">月獎品</span></h2><span class="d-flex align-items-center justify-content-center fs-lg-6 fs-12"><img src="'+O+'" class="me-2" style="width:30px;" alt="大聲公圖示"> 超值大獎一次帶回! </span></div>',1),qt={class:"row row-cols-lg-3 row-cols-1 gy-4 mb-4"},Ht={class:"card card-prize"},Ft={class:"card-header bg-white"},Gt={class:"fs-4 fw-bold text-center"},It={class:"card-body p-0 position-relative"},Jt=["src","alt"],Ut=t("div",{class:"question-mark position-absolute w-100 text-center top-0 img-lg-220-md-200 bg-gradient-purple"},[t("i",{class:"bi bi-question-lg mx-auto text-white fs-150"})],-1),Wt={class:"card-footer bg-transparent"},Yt={class:"fw-bold"},Kt={class:"text-end"},Qt=t("h3",{class:"fw-bold"},"規則：",-1);function Xt(c,r,n,y,e,g){const C=N("BannerComponent"),j=N("RouterLink");return o(),i("div",null,[A(C),t("section",I,[t("div",J,[t("ul",U,[(o(!0),i(_,null,p(e.selections.specialOfferCategory,s=>(o(),i("li",{key:s.icon,class:h(["col text-center",{"pointer-events-none":e.tabName===s.title}])},[t("a",{href:"#",onClick:P(()=>e.tabName=s.title,["prevent"]),class:h(["text-decoration-none d-inline-block",{"fw-bold":e.tabName===s.title,"link-primary":e.tabName===s.title}])},[e.tabName!==s.title?(o(),i("i",{key:0,class:h([s.icon,"text-gray"])},null,2)):u("",!0),e.tabName===s.title?(o(),i("i",{key:1,class:h([s.iconSelected,"text-primary"])},null,2)):u("",!0),t("span",Y,l(s.title),1)],10,W)],2))),128))]),t("div",{class:h(["blue-line bg-primary position-absolute",{"active-discount":e.tabName==="優惠折扣","active-gift":e.tabName==="抽獎回饋"}])},null,2)]),e.tabName==="優惠折扣"?(o(),i("ul",K,[(o(!0),i(_,null,p(e.coupons,s=>(o(),i("li",{class:"col hvr-hang",key:s.id},[t("div",Q,[t("div",X,[t("div",Z,[t("img",{src:s.image,class:"w-100 object-fit-cover rounded-start",style:{height:"200px"},alt:s.title},null,8,$)]),t("div",tt,[t("div",et,[t("p",st,l(new Date(s.startDate).toLocaleDateString())+" - "+l(new Date(s.dueDate).toLocaleDateString()),1),t("h4",rt,l(s.title),1),t("p",ot,l(s.description),1),t("div",it,[A(j,{to:`/discounts/${s.id}`,href:"#",class:"stretched-link btn btn-outline-primary"},{default:H(()=>[w("查看完整優惠資訊")]),_:2},1032,["to"])])])])])])]))),128))])):e.tabName==="抽獎回饋"?(o(),i("div",lt,[t("p",null,[ct,w("活動時間："+l(new Date(e.lottery.startDate).toLocaleDateString())+" ~ "+l(new Date(e.lottery.dueDate).toLocaleDateString()),1)]),e.uid?(o(),i("p",{key:0,class:h({"text-danger":e.user.lotteryTicket===0})},[nt,w("剩餘抽獎券："+l(e.user.lotteryTicket)+" 張",1)],2)):u("",!0),!e.getPrize||e.getPrize&&e.getPrize.id!==1?(o(),i("div",at,[dt,t("div",ht,[(o(!0),i(_,null,p(e.drewProducts,(s,m,a)=>(o(),i("div",{key:s,class:"col"},[t("div",{class:h([{"border-primary":a===0||a===2,"border-purple":a===1},"card border mb-md-3"])},[t("div",ut,[t("div",mt,[(o(!0),i(_,null,p(e.lottery.recipes,(d,B)=>(o(),i("div",{key:d.id},[B===a?(o(),i("img",{key:0,src:d.image,alt:d.title,class:"w-100 object-fit-cover",style:{height:"150px"}},null,8,gt)):u("",!0)]))),128))]),t("div",_t,[t("div",ft,[t("h5",{class:h([{"text-primary":a===0||a===2,"text-purple":a===1},"card-title fw-bold"])},l(m),3),e.drewArr[m]&&e.drewArr[m].length?(o(),i("p",{key:0,class:h(["mb-0",{"text-danger":e.drewArr[m].length/s.length===1}])},"完成度： "+l(Math.round(e.drewArr[m].length/s.length*100)===0?0:Math.round(e.drewArr[m].length/s.length*100))+" %",3)):e.drewArr[m]?u("",!0):(o(),i("p",bt,"完成度：0 %"))])])])],2),t("ul",{class:h(["h-80 row row-cols-xl-3 row-cols-lg-2 row-cols-3 pt-3 g-0 list-unstyled",{"bg-secondary":a===0||a===2,"bg-lightPurple":a===1}])},[(o(!0),i(_,null,p(s,d=>(o(),i("li",{class:"d-flex flex-column align-items-center position-relative col",key:d.id},[d.category==="單一產品"?(o(),i(_,{key:0},[t("img",{src:d.imgUrl,alt:d.title,height:"100",width:"100",class:"object-fit-cover mb-1"},null,8,pt),t("p",null,l(d.title),1),!e.drewArr[m]||!JSON.stringify(this.drewArr[m]).includes(d.title)?(o(),i("div",wt,vt)):u("",!0)],64)):u("",!0)]))),128))],2)]))),128))]),t("div",xt,[t("button",{type:"button",class:"hvr-sweep-to-right mt-xl-5 mt-3 btn btn-primary",onClick:r[0]||(r[0]=P(()=>g.addtLotteryResult(),["prevent"]))},"立即抽獎")]),kt])):u("",!0),e.lotteryResult&&e.getPrize&&e.getPrize.id?(o(),i("div",Pt,[t("h5",Nt,[At,w("恭喜您完成 "+l(e.getPrize.id===1?"全部":e.getPrize.id===2?"2份":"1份")+"食譜，獲得 ",1),Ct]),t("div",jt,[t("div",Bt,[t("div",Rt,[t("div",zt,[t("h3",Dt,l(e.getPrize.id===1?"大獎":e.getPrize.id===2?"二獎":"三獎"),1)]),t("img",{src:e.getPrize.img,class:"card-img img-lg-220-md-200 object-fit-contain border bg-white",alt:e.getPrize.title},null,8,Lt),t("div",Mt,[t("h5",Tt,l(e.getPrize.title),1),t("p",Et,"價值：NT$ "+l(c.numberComma(e.getPrize.price)),1)])])]),St])])):u("",!0),t("div",Ot,[Vt,t("div",qt,[(o(!0),i(_,null,p(e.lottery.prizes,s=>(o(),i("div",{class:"col",key:s.id,"data-aos":"flip-right"},[t("div",Ht,[t("div",Ft,[t("h3",Gt,l(s.id===1?"大獎":s.id===2?"二獎":"三獎"),1)]),t("div",It,[t("img",{src:s.img,class:"card-img border bg-white object-fit-contain img-lg-220-md-200",alt:s.title},null,8,Jt),Ut]),t("div",Wt,[t("h5",Yt,l(s.title),1),t("p",Kt,"價值：NT$ "+l(c.numberComma(s.price)),1)])])]))),128))]),Qt,t("ol",null,[(o(!0),i(_,null,p(e.lottery.rules,s=>(o(),i("li",{key:s},l(s),1))),128))])])])):u("",!0)])])}const ce=V(G,[["render",Xt]]);export{ce as default};
