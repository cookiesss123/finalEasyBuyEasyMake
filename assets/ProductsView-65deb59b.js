import{R as B}from"./vue-router-2c21c692.js";import{m as N,a as V}from"./index-966010aa.js";import{c as O}from"./carts-f2393f2b.js";import{n as M}from"./numberCommaMixin-e0aac39c.js";import{P as T}from"./PaginationComponent-c75be064.js";import{C,_ as q}from"./icon-searchMobile-657ef2e6.js";import{r as g,b as v,o as U,d as m,s as j,c as F,a as I}from"./db-143b9a4b.js";import{L as E}from"./LoadingComponent-8a5de011.js";import{v as G,d as D,w as H,e as _}from"./runtime-dom.esm-bundler-54ced388.js";import{_ as A}from"./image5-4fc2427e.js";import{_ as K}from"./image4-1806383b.js";import{_ as z}from"./icon-cart-6dfbd1c6.js";import{_ as W}from"./undraw_Page_not_found_re_e9o6-de2ef5f7.js";import{_ as X,U as n,V as t,a4 as h,Y as u,a0 as c,$ as f,a1 as R,a2 as L,Z as b,c as Y,W as P,r as y,o as l,X as x}from"./_plugin-vue_export-helper-03b40388.js";import"./_commonjsHelpers-042e6b4d.js";import"./base-component-5a126788.js";import"./loadingLogo-3bb466c0.js";const Z={components:{RouterLink:B,PaginationComponent:T,LoadingComponent:E},data(){return{loading:!0,priceOrRateCollapse:{},highOrLowCollapse:{},products:[],priceOrRate:"價格",highOrLow:"不拘",productSearchName:"",filterProducts:[],myCollapse:{},bookMarks:[],recipes:[],pageStatus:"全部",selectPage:"全部",search:!1,uid:""}},mixins:[M],methods:{...N(O,["addCart","toastMessage"]),getProducts(){const o=g(m,"products/");v(o,s=>{this.products=s.val(),this.products=Object.entries(this.products).map(d=>(d[1].id=d[0],d[1]));const k=g(m,"productRates/");v(k,d=>{let r=d.val();r=Object.values(r).map((a,i)=>(a.id=Object.keys(r)[i],a)),console.log(r,this.products,"全部產品的評價還未分類產品"),this.products.forEach((a,i)=>{r.forEach(p=>{a.id===p.productId&&!this.products[i].scores?(this.products[i].scores=p.score,this.products[i].ratePeople=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1))):a.id===p.productId&&this.products[i].scores&&(this.products[i].scores+=p.score,this.products[i].ratePeople+=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1)))})}),this.products.forEach((a,i)=>{a.averageRate||(this.products[i].scores=0,this.products[i].ratePeople=0,this.products[i].averageRate=0)}),console.log(this.products,"加了評分的產品"),this.filterProducts=this.products,this.loading=!1,!this.$route.query.pageStatus&&this.$route.fullPath==="/products"?this.$refs.pagination.renderPage(1,this.filterProducts):this.$route.query.pageStatus&&this.searchProducts()})})},searchProducts(){this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.priceOrRate==="價格"&&this.highOrLow!=="不拘"?this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.price-s.price):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>s.price-o.price)):this.priceOrRate==="評價"&&this.highOrLow!=="不拘"&&(this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?o.averageRate-s.averageRate:o.scores-s.scores):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?s.averageRate-o.averageRate:s.scores-o.scores))),this.filterProducts=this.filterProducts.filter(o=>o.title.match(this.productSearchName)),console.log(this.filterProducts,"是什麼???"),this.search=!0,this.$refs.pagination.renderPage(1,this.filterProducts)},getBookmarks(){U(I,o=>{if(o){this.uid=o.uid,console.log(this.uid,"使用者已登入取得 uid");const s=g(m,"users/"+o.uid);v(s,k=>{this.user=k.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場");const d=g(m,`productBookmarks/${this.uid}`);v(d,r=>{this.bookMarks=r.val(),this.bookMarks&&(this.bookMarks=Object.keys(this.bookMarks)),console.log(this.bookMarks,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(o){if(!this.uid){this.toastMessage("登入才可使用收藏功能","error");return}const s=g(m,`productBookmarks/${this.uid}/${o.id}`);j(s,o),this.toastMessage("收藏成功")},deleteBookmark(o){F(g(m,`productBookmarks/${this.uid}/${o}`)),this.toastMessage("刪除收藏")}},mounted(){this.loading=!0,this.priceOrRateCollapse=new C(this.$refs.priceOrRateCollapse,{toggle:!1,parent:"#myGroup"}),this.highOrLowCollapse=new C(this.$refs.highOrLowCollapse,{toggle:!1,parent:"#myGroup"}),(this.$route.query.pageStatus||this.$route.query.searchName||this.$route.query.valueHighOrLow||this.$route.query.valuePriceOrRate)&&(this.pageStatus=this.$route.query.pageStatus,this.priceOrRate=this.$route.query.valuePriceOrRate,this.highOrLow=this.$route.query.valueHighOrLow,this.productSearchName=this.$route.query.searchName,console.log("存入了",this.pageStatus,this.priceOrRate,this.highOrLow,this.productSearchName)),this.getProducts(),this.getBookmarks()},watch:{selectPage(){this.pageStatus=this.selectPage,this.productSearchName="",this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.$refs.pagination.renderPage(1,this.filterProducts)},priceOrRate(){this.priceOrRateCollapse.hide()},highOrLow(){this.highOrLowCollapse.hide()},filterProducts(){this.priceOrRateCollapse.hide(),this.highOrLowCollapse.hide()}},computed:{...V(O,["loadingItem"])}},J={class:"my-10"},Q={class:"navTitle nav nav-tabs container d-flex justify-content-center justify-content-lg-start",id:"myTab",role:"tablist"},$={class:"nav-item",role:"presentation"},tt=t("span",{class:"material-icons-outlined fs-5 me-1"},"apps",-1),et={class:"nav-item",role:"presentation"},st=t("i",{class:"bi bi-bag-check-fill"},null,-1),ot={class:"nav-item",role:"presentation"},rt=t("i",{class:"bi bi-fire"},null,-1),it={class:"nav-item",role:"presentation"},at=t("i",{class:"bi bi-percent"},null,-1),lt={class:"d-none d-lg-block container selectProduct pt-4"},nt={class:"input-group"},ct=t("i",{class:"bi bi-caret-down-fill"},null,-1),dt={class:"ms-2 fw-bold"},ht=t("i",{class:"bi bi-caret-down-fill"},null,-1),ut={class:"ms-2 fw-bold"},pt=t("img",{src:q,style:{height:"25px"},alt:""},null,-1),gt=[pt],mt={class:"row g-0",id:"myGroup"},ft={class:"col-2"},bt={ref:"priceOrRateCollapse",class:"collapse"},_t={class:"card card-body border-0"},kt={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},vt=t("label",{class:"btn btn-outline-red",for:"selectprice"},"價格",-1),Pt=t("label",{class:"btn btn-outline-red",for:"selectRate"},"評價",-1),yt={class:"col-2"},wt={ref:"highOrLowCollapse",class:"collapse"},Ot={class:"card card-body border-0"},Ct={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},Rt=t("label",{class:"btn btn-outline-red",for:"noDifference"},"不拘",-1),Lt=t("label",{class:"btn btn-outline-red",for:"highToLow"},"高到低",-1),xt=t("label",{class:"btn btn-outline-red",for:"lowToHigh"},"低到高",-1),St={class:"container mt-4"},Bt={key:0,class:"row row-cols-lg-4 row-cols-2 gy-4"},Nt={class:"card position-relative border-0 bg-transparent",style:{"border-radius":"20px"}},Vt={class:"cardImg",style:{"border-radius":"20px"}},Mt=["src"],Tt={class:"card-text"},qt=["onClick"],Ut=t("img",{src:A},null,-1),jt=[Ut],Ft={key:0,style:{"pointer-events":"none"},class:"d-flex flex-column align-items-center text-white p-2 bg-red border position-absolute top-0 start-0 rounded"},It=["onClick"],Et=t("img",{src:K},null,-1),Gt=[Et],Dt=["disabled","onClick"],Ht=t("img",{src:z,alt:"",class:"rounded-circle shadow-sm"},null,-1),At=[Ht],Kt={class:"fw-bold cardTextTitle"},zt={class:""},Wt={class:"mt-1 d-block d-lg-inline-block"},Xt={class:"mb-0 ms-auto starRates"},Yt={class:"me-1"},Zt=t("i",{class:"bi bi-star-fill"},null,-1),Jt={key:2,class:"py-10"},Qt=t("img",{src:W,class:"mb-3",alt:"",style:{height:"250px",display:"block",margin:"auto"}},null,-1),$t=t("h2",{class:"text-center"},"查無商品，請您重新查詢",-1),te=[Qt,$t];function ee(o,s,k,d,r,a){const i=y("RouterLink"),p=y("LoadingComponent"),S=y("PaginationComponent");return l(),n("div",J,[t("ul",Q,[t("li",$,[t("button",{class:h(["nav-link px-2 px-lg-3 d-flex align-items-center",{active:r.pageStatus==="全部"}]),id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true",onClick:s[0]||(s[0]=()=>r.selectPage="全部")},[tt,u("全部")],2)]),t("li",et,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="食材組合包"}]),id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false",onClick:s[1]||(s[1]=()=>r.selectPage="食材組合包")},[st,u(" 食材組合包")],2)]),t("li",ot,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="熱銷單品"}]),id:"popularProducts-tab","data-bs-toggle":"tab","data-bs-target":"#popularProducts",type:"button",role:"tab","aria-controls":"popularProducts","aria-selected":"false",onClick:s[2]||(s[2]=()=>r.selectPage="熱銷單品")},[rt,u(" 熱銷單品")],2)]),t("li",it,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="特價商品"}]),id:"contact-tab","data-bs-toggle":"tab","data-bs-target":"#contact",type:"button",role:"tab","aria-controls":"contact","aria-selected":"false",onClick:s[3]||(s[3]=()=>r.selectPage="特價商品")},[at,u(" 特價商品")],2)])]),t("div",lt,[t("div",nt,[t("a",{class:"btn btn-outline-red px-5",onClick:s[4]||(s[4]=()=>this.priceOrRateCollapse.toggle())},[u("篩選對象 "),ct,t("span",dt,c(r.priceOrRate),1)]),t("button",{class:"btn btn-outline-red px-5",type:"button",onClick:s[5]||(s[5]=()=>this.highOrLowCollapse.toggle())},[u("篩選值 "),ht,t("span",ut,c(r.highOrLow),1)]),f(t("input",{type:"search",class:"form-control border-red border-end-0",placeholder:"請輸入食材名稱","aria-label":"Example text with two button addons","onUpdate:modelValue":s[6]||(s[6]=e=>r.productSearchName=e),onKeyup:s[7]||(s[7]=D((...e)=>a.searchProducts&&a.searchProducts(...e),["enter"]))},null,544),[[G,r.productSearchName]]),t("button",{type:"submit",class:"btn border border-red border-start-0 bg-transparent",onClick:s[8]||(s[8]=H((...e)=>a.searchProducts&&a.searchProducts(...e),["prevent"]))},gt)]),t("div",mt,[t("div",ft,[t("div",bt,[t("div",_t,[t("div",kt,[f(t("input",{type:"radio",class:"btn-check",value:"價格",name:"priceOrRate",id:"selectprice",autocomplete:"off","onUpdate:modelValue":s[9]||(s[9]=e=>r.priceOrRate=e)},null,512),[[_,r.priceOrRate]]),vt,f(t("input",{type:"radio",class:"btn-check",value:"評價",name:"priceOrRate",id:"selectRate",autocomplete:"off","onUpdate:modelValue":s[10]||(s[10]=e=>r.priceOrRate=e)},null,512),[[_,r.priceOrRate]]),Pt])])],512)]),t("div",yt,[t("div",wt,[t("div",Ot,[t("div",Ct,[f(t("input",{type:"radio",class:"btn-check",value:"不拘",name:"highOrLow",id:"noDifference",autocomplete:"off",checked:"","onUpdate:modelValue":s[11]||(s[11]=e=>r.highOrLow=e)},null,512),[[_,r.highOrLow]]),Rt,f(t("input",{type:"radio",class:"btn-check",value:"高到低",name:"highOrLow",id:"highToLow",autocomplete:"off","onUpdate:modelValue":s[12]||(s[12]=e=>r.highOrLow=e)},null,512),[[_,r.highOrLow]]),Lt,f(t("input",{type:"radio",class:"btn-check",value:"低到高",name:"highOrLow",id:"lowToHigh",autocomplete:"off","onUpdate:modelValue":s[13]||(s[13]=e=>r.highOrLow=e)},null,512),[[_,r.highOrLow]]),xt])])],512)])])]),t("div",St,[r.filterProducts.length&&!r.loading?(l(),n("div",Bt,[(l(!0),n(R,null,L(this.$refs.pagination.pageProducts,e=>(l(),n("div",{class:"col text-decoration-none",key:e.id},[t("div",Nt,[t("div",Vt,[P(i,{to:`/products/${e.id}`,class:"enlargeImg"},{default:x(()=>[t("img",{src:e.imgUrl,class:"card-img",height:"220",style:{"border-radius":"20px","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Mt)]),_:2},1032,["to"])]),t("h5",Tt,[t("button",{type:"button",class:"position-absolute bookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.addBookmark(e)},jt,8,qt),e.isCheaper?(l(),n("span",Ft,c((100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))%10===0?(100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0)).toString().charAt(0):100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))+" 折 ",1)):b("",!0),(l(!0),n(R,null,L(r.bookMarks,w=>(l(),n("div",{key:w},[w===e.id?(l(),n("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.deleteBookmark(e.id)},Gt,8,It)):b("",!0)]))),128)),t("button",{disabled:o.loadingItem==="loading",onClick:()=>o.addCart(e),type:"button",class:"buyBtn border-0 bg-transparent me-lg-2 me-1 position-absolute end-0"},At,8,Dt)]),P(i,{to:`/products/${e.id}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:x(()=>[t("h5",Kt,c(e.title),1),t("div",{class:h(["d-flex align-items-lg-center cardTextPrice",{"align-items-end":e.isCheaper,"align-items-center":!e.isCheaper}])},[t("div",zt,[e.originalPrice?(l(),n("del",{key:0,class:h(["me-2 text-muted mt-1",{"d-none":!e.isCheaper}])},"NT$ "+c(o.numberComma(e.originalPrice)),3)):b("",!0),t("span",Wt,[e.price?(l(),n("span",{key:0,class:h({"text-danger":e.isCheaper,"fw-bold":e.isCheaper})}," NT$ "+c(o.numberComma(e.price)),3)):b("",!0),u(" / "+c(e.num)+c(e.unit),1)])]),t("h5",Xt,[t("div",{class:h(["badge border rounded-pill bg-white",{"text-orange":e.averageRate,"border-orange":e.averageRate,"text-lightBrownGray":!e.averageRate,"border-lightBrownGray":!e.averageRate}])},[t("span",Yt,c(e.averageRate),1),Zt],2)])],2)]),_:2},1032,["to"])])]))),128))])):b("",!0),r.loading?(l(),Y(p,{key:1})):!r.filterProducts.length&&r.search&&!r.loading?(l(),n("div",Jt,te)):b("",!0)]),P(S,{ref:"pagination","price-or-rate":r.priceOrRate,"filter-products":r.filterProducts},null,8,["price-or-rate","filter-products"])])}const ke=X(Z,[["render",ee]]);export{ke as default};
