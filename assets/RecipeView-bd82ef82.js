import{S,a as V,N as A,P as L}from"./pagination.min-cc566d53.js";import{b as U,v as z,w as D}from"./runtime-dom.esm-bundler-54ced388.js";import{m as q}from"./index-c6d50911.js";import{c as E}from"./carts-3e98ce4a.js";import{n as Y}from"./numberCommaMixin-e0aac39c.js";import{L as G}from"./LoadingModal-16ab9486.js";import{c as M,r as a,o as f,d,s as v,a as I,p as O,b as N}from"./db-64e704f5.js";import{_ as F,U as r,W as w,V as e,X as b,a0 as c,Z as p,a1 as _,a2 as g,Y as u,$ as B,a4 as T,c as k,r as x,o}from"./_plugin-vue_export-helper-03b40388.js";import"./vue-router-2c21c692.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";import"./loadingLogo-3bb466c0.js";const W={components:{Swiper:S,SwiperSlide:V,LoadingModal:G},mixins:[Y],data(){return{recipe:{},modules:[A,L],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",bookMark:{},allThumbNum:0,myThumb:{},recipeComments:[],recipeMessage:"",qty:1,groupProduct:{},user:{},uid:""}},methods:{...q(E,["addCart","toastMessage"]),getMyThumb(){M(N,l=>{if(l){this.uid=l.uid;const{id:i}=this.$route.params,h=a(d,`recipePersonalThumbs/${this.uid}/${i}`);f(h,m=>{this.myThumb=m.val(),console.log(this.myThumb,"個人按讚")})}else console.log("並未登入"),this.uid=null,this.user={}})},getAllThumbs(){const{id:l}=this.$route.params,i=a(d,`recipeThumbs/${l}`);f(i,h=>{this.allThumbNum=h.val(),this.allThumbNum?this.allThumbNum=this.allThumbNum.thumbs:this.allThumbNum=0,console.log(this.allThumbNum,!this.allThumbNum,"所有讚")})},addThumb(){const l=a(d,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`);v(l,this.recipe);const i=a(d,`recipeThumbs/${this.recipe.id}`);v(i,{thumbs:this.allThumbNum+1}),this.toastMessage("按讚成功")},deleteThumb(){I(a(d,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`));const l=a(d,`recipeThumbs/${this.recipe.id}`);v(l,{thumbs:this.allThumbNum-1}),this.toastMessage("取消按讚")},getRecipe(){const{id:l}=this.$route.params,i=a(d,`recipes/${l}`);f(i,h=>{this.recipe=h.val(),this.recipe.id=l,console.log(this.recipe,"讀取的資料"),this.mainImg=this.recipe.image,this.groupProduct=this.recipe.relativeProducts.filter(m=>m.category==="組合包"),this.groupProduct=this.groupProduct[0]})},getAllComments(){const{id:l}=this.$route.params,i=a(d,"recipeComments/");f(i,h=>{let m=h.val();m=Object.values(m).map((s,n)=>(s.id=Object.keys(s)[n],s)),console.log(m,"全部食譜的留言"),this.recipeComments=m.filter(s=>s.recipeId===l),console.log(this.recipeComments,"個別留言")})},addComments(){const l=a(d,"recipeComments"),i=O(l);v(i,{recipeId:this.recipe.id,createAt:new Date().getTime(),message:this.recipeMessage,username:this.user.nickName,userImg:this.user.headshotImg}),this.recipeMessage=""},getBookmark(){M(N,l=>{if(l){this.uid=l.uid,console.log(this.uid,"使用者已登入取得 uid");const i=a(d,"users/"+l.uid);f(i,h=>{this.user=h.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場"),console.log(this.uid,"存在嗎?");const{id:m}=this.$route.params,s=a(d,`recipeBookmarks/${this.uid}/${m}`);f(s,n=>{this.bookMark=n.val(),console.log(this.bookMark,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(){this.uid||this.toastMessage("登入才可使用收藏功能","error");const l=a(d,`recipeBookmarks/${this.uid}/${this.recipe.id}`);v(l,this.recipe),this.toastMessage("收藏成功")},deleteBookmark(){I(a(d,`recipeBookmarks/${this.uid}/${this.recipe.id}`)),this.toastMessage("刪除收藏")}},mounted(){this.loading=!0,this.getAllThumbs(),this.getMyThumb(),this.getBookmark(),this.getRecipe(),this.getAllComments()}},X={class:"mt-10",style:{"overflow-x":"hidden"}},Z={class:"container"},H={"aria-label":"breadcrumb"},J={class:"breadcrumb"},K={class:"breadcrumb-item"},Q={class:"breadcrumb-item active","aria-current":"page"},$={class:"container mt-lg-5"},ee={class:"row row-cols-lg-2 row-cols-1 gx-5"},se={class:"col"},te={class:"d-flex recipeMainImg mb-4"},ie=["src"],oe={class:"recipeSwiper position-relative"},le=["src"],re=["src"],ce={class:"col d-flex flex-column"},ne={class:"d-flex align-items-center mb-3"},ae={class:"me-2 mb-0"},de={class:"badge rounded-pill bg-red"},me={class:"mb-0 mainTitle"},ue={class:"d-flex align-items-center ms-auto"},he=e("i",{class:"bi bi-heart"},null,-1),pe=[he],be=e("i",{class:"bi bi-heart-fill"},null,-1),_e=[be],ge={class:"mb-0 ms-3"},fe=e("i",{class:"bi bi-hand-thumbs-up"},null,-1),ye=[fe],ve=e("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),ke=[ve],we={class:"mb-3"},xe={class:"mb-3"},Te={class:"mt-auto"},Ce=e("h5",null,"甜點介紹：",-1),Me={class:"mb-5"},Ie={class:"bg-lightYellow my-5",style:{"overflow-x":"hidden"}},Ne={class:"container py-5"},Be={class:"row row-cols-lg-2 row-cols-1 g-5"},Pe={class:"col"},Re=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons"},"egg"),u(" 準備材料")],-1),je={class:"me-3"},Se={class:"row mb-6"},Ve=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons-outlined"},"soup_kitchen"),u(" 製作步驟")],-1),Ae={key:0},Le=e("h3",{class:"mt-6 mb-3 fw-bold"},[e("i",{class:"bi bi-youtube"}),u(" 教學影片")],-1),Ue=["src"],ze={class:"col"},De=e("h3",{class:"mb-4 fw-bold"},[e("i",{class:"bi bi-bag-check-fill"}),u(" 相關產品")],-1),qe={class:"row"},Ee={class:"col-12 relativeProducts"},Ye={class:"enlargeImg",style:{width:"50% !important"}},Ge=["src"],Oe={class:"fw-bold mt-2"},Fe={class:"d-flex justify-content-between align-items-end"},We={class:"h5 mb-0 d-flex flex-column"},Xe={class:"text-secondary me-3",style:{"font-size":"16px"}},Ze={class:"text-danger fw-bold"},He=e("span",{class:"text-darkBrown"}," / 組",-1),Je={class:"input-group w-50"},Ke=["value"],Qe={class:"row mt-5 row-cols-lg-3 row-cols-2 relativeProducts"},$e={class:"enlargeImg"},es=["src"],ss={class:"fw-bold mt-2"},ts={class:"container py-5"},is={class:"d-flex align-items-center"},os=e("i",{class:"bi bi-stars"},null,-1),ls={class:"d-flex"},rs={class:"my-5"},cs={key:0,action:""},ns={class:"mb-3 fw-bold d-flex align-items-center"},as=["src"],ds={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},ms={class:"d-flex"},us={class:"row gy-5"},hs={class:"mb-2 fw-bold d-flex align-items-center"},ps=["src"],bs={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},_s={class:"mb-0"};function gs(l,i,h,m,s,n){const P=x("LoadingModal"),y=x("RouterLink"),C=x("swiper-slide"),R=x("swiper");return o(),r("div",X,[w(P,{ref:"loadingModal"},null,512),e("div",Z,[e("nav",H,[e("ol",J,[e("li",K,[w(y,{to:"/recipes",class:"link-red"},{default:b(()=>[u("甜點食譜")]),_:1})]),e("li",Q,c(s.recipe.title),1)])])]),e("section",$,[e("div",ee,[e("div",se,[e("div",te,[e("img",{src:s.mainImg,style:{"object-fit":"cover","max-height":"300px"},class:"w-100",alt:""},null,8,ie)]),e("div",oe,[w(R,{"slides-per-view":3,"space-between":15,modules:s.modules,navigation:"",style:{height:"160px"},class:"w-100"},{default:b(()=>[w(C,{style:{cursor:"pointer"},onClick:i[0]||(i[0]=()=>s.mainImg=s.recipe.image)},{default:b(()=>[e("div",null,[e("img",{src:s.recipe.image,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:T({border:s.mainImg===s.recipe.image,"border-3":s.mainImg===s.recipe.image,"border-red":s.mainImg===s.recipe.image})},null,10,le)])]),_:1}),(o(!0),r(_,null,g(s.recipe.imgsUrl,t=>(o(),k(C,{key:t+45345,style:{cursor:"pointer"},onClick:()=>s.mainImg=t},{default:b(()=>[e("div",null,[e("img",{src:t,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:T({border:s.mainImg===t,"border-3":s.mainImg===t,"border-red":s.mainImg===t})},null,10,re)])]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])])]),e("div",ce,[e("div",ne,[e("h5",ae,[e("span",de,c(s.recipe.category),1)]),e("h1",me,c(s.recipe.title),1),e("div",ue,[s.bookMark?s.bookMark?(o(),r("button",{key:1,type:"button",class:"border-0 bg-transparent fs-4",onClick:i[2]||(i[2]=(...t)=>n.deleteBookmark&&n.deleteBookmark(...t)),style:{color:"#fa6e42"}},_e)):p("",!0):(o(),r("button",{key:0,type:"button",class:"border-0 bg-transparent text-red fs-4",onClick:i[1]||(i[1]=()=>n.addBookmark(s.recipe.id))},pe)),e("span",ge,c(s.allThumbNum),1),s.myThumb?s.myThumb?(o(),r("button",{key:3,type:"button",class:"border-0 bg-transparent text-red fs-4",onClick:i[4]||(i[4]=(...t)=>n.deleteThumb&&n.deleteThumb(...t))},ke)):p("",!0):(o(),r("button",{key:2,type:"button",class:"border-0 bg-transparent text-red fs-4",onClick:i[3]||(i[3]=(...t)=>n.addThumb&&n.addThumb(...t))},ye))])]),e("h5",we,"食譜作者："+c(s.recipe.author),1),e("h5",xe,"份量："+c(s.recipe.content),1),e("div",Te,[Ce,e("p",Me,c(s.recipe.description),1)])])])]),e("section",Ie,[e("div",Ne,[e("div",Be,[e("div",Pe,[Re,e("h5",je,"成本：NT$ "+c(s.recipe.total),1),e("div",Se,[(o(!0),r(_,null,g(s.recipe.ingredients,(t,j)=>(o(),r("div",{class:"col-12",key:t+367657},c(j+1)+". "+c(t.name)+" "+c(t.num)+" "+c(t.unit),1))),128))]),Ve,s.recipe.instructions?(o(),r("div",Ae,[(o(!0),r(_,null,g(s.recipe.instructions.split("/"),t=>(o(),r("p",{class:"me-3",key:t+346346},c(t),1))),128))])):p("",!0),Le,e("iframe",{width:"560",height:"315",src:s.recipe.video,title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""},null,8,Ue)]),e("div",ze,[De,e("div",qe,[e("div",Ee,[(o(!0),r(_,null,g(s.recipe.relativeProducts,t=>(o(),r("div",{key:t.id+456496},[t.category==="組合包"?(o(),k(y,{key:0,to:`/products/${t.id}`,class:"link-red d-flex flex-column align-items-center cardImg"},{default:b(()=>[e("div",Ye,[e("img",{src:t.imgUrl,alt:"",class:"w-100",height:"150",style:{"object-fit":"cover"}},null,8,Ge)]),e("p",Oe,c(t.title),1)]),_:2},1032,["to"])):p("",!0)]))),128))])]),e("div",Fe,[e("p",We,[e("del",Xe,"NT$ "+c(l.numberComma(s.recipe.total)),1),e("span",Ze,[u("NT$ "+c(l.numberComma(s.recipe.price))+" ",1),He])]),e("div",Je,[B(e("select",{name:"",id:"",class:"form-select text-center","onUpdate:modelValue":i[5]||(i[5]=t=>s.qty=t),style:{width:"70px"}},[(o(),r(_,null,g(30,t=>e("option",{value:t,key:t+4596945},c(t),9,Ke)),64))],512),[[U,s.qty]]),e("button",{class:"btn btn-red",type:"button",id:"button-addon2",onClick:i[6]||(i[6]=()=>l.addCart(s.groupProduct,s.qty))},"一鍵買齊")])]),e("div",Qe,[(o(!0),r(_,null,g(s.recipe.relativeProducts,t=>(o(),r("div",{class:"col",key:t.id+456496},[t.category==="單一產品"?(o(),k(y,{key:0,to:`/products/${t.id}`,class:"link-red d-flex flex-column align-items-center cardImg"},{default:b(()=>[e("div",$e,[e("img",{src:t.imgUrl,alt:"",height:"150",style:{"object-fit":"cover"},class:"w-100"},null,8,es)]),e("p",ss,c(t.title),1)]),_:2},1032,["to"])):p("",!0)]))),128))])])])])]),e("section",ts,[e("h3",is,[os,u(" 顧客評價 "),e("div",{class:T(["ms-2 badge border rounded-pill bg-white",{"text-orange":s.recipeComments.length,"text-lightBrownGray":!s.recipeComments.length,"border-orange":s.recipeComments.length,"border-lightBrownGray":!s.recipeComments.length}]),style:{"font-size":"16px"}},c(s.recipeComments.length)+" 則 ",3),s.uid?p("",!0):(o(),k(y,{key:0,to:"/login",class:"ms-3 btn btn-red d-none d-lg-block"},{default:b(()=>[u("我要登入寫評價")]),_:1}))]),e("div",ls,[s.uid?p("",!0):(o(),k(y,{key:0,to:"/login",class:"btn btn-red d-lg-none ms-auto"},{default:b(()=>[u("我要登入寫評價")]),_:1}))]),e("div",rs,[s.uid?(o(),r("form",cs,[e("h5",ns,[s.user.headshotImg?(o(),r("img",{key:0,src:s.user.headshotImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,as)):s.user.headshotImg?p("",!0):(o(),r("i",ds)),u(" "+c(s.user.nickName),1)]),B(e("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":i[7]||(i[7]=t=>s.recipeMessage=t)},null,512),[[z,s.recipeMessage]]),e("div",ms,[e("button",{type:"submit",class:"ms-auto btn btn-red mt-3",onClick:i[8]||(i[8]=D((...t)=>n.addComments&&n.addComments(...t),["prevent"]))},"送出")])])):p("",!0),e("div",us,[(o(!0),r(_,null,g(s.recipeComments,t=>(o(),r("div",{class:"col-12 border-bottom",key:t+3657},[e("h5",hs,[t.userImg?(o(),r("img",{key:0,src:t.userImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,ps)):t.userImg?p("",!0):(o(),r("i",bs)),u(" "+c(t.username),1)]),e("p",_s,c(`${new Date(t.createAt).toLocaleDateString()}`),1),e("p",null,c(t.message),1)]))),128))])])])])}const Ps=F(W,[["render",gs]]);export{Ps as default};
