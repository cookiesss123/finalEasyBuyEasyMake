import{m as B}from"./index-5ef868e0.js";import{c as z}from"./carts-7b25326f.js";import{n as C}from"./numberCommaMixin-e0aac39c.js";import{r as u,b as p,o as D,u as y,d as m,s as R,a as M}from"./db-143b9a4b.js";import{L as E}from"./index-fde5e204.js";import{w as v}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as S}from"./loadingLogo-ea15f612.js";import{_ as T,a as j}from"./discount3-e2e49eb3.js";import{_ as H}from"./icon-speaker-fd89918c.js";import{_ as V,a7 as l,F as k,a9 as P,a8 as t,af as g,ab as d,N as f,ae as b,aa as w,ad as c,ag as q,r as A,o as n}from"./_plugin-vue_export-helper-d28549df.js";import"./vue-router-46224dd8.js";import"./_commonjsHelpers-042e6b4d.js";const O="/finalEasyBuyEasyMake/assets/giftBox1-5e717a45.png",I="/finalEasyBuyEasyMake/assets/giftBox3-08045f41.png",G="/finalEasyBuyEasyMake/assets/title4-ab3fed47.png";const U={mixins:[C],data(){return{coupons:{},lottery:{},lotteryResult:{},drewProducts:[],drewArr:[],user:{},uid:"",getPrize:{},tabName:"優惠折扣",articles:[],isLoading:!1,fullPage:!0}},components:{Loading:E},methods:{...B(z,["checkLogin","toastMessage"]),getCoupons(){const s=u(m,"coupons/");p(s,r=>{this.coupons=r.val(),console.log(this.coupons,"折價券"),this.isLoading=!1})},getLottery(){const s=u(m,"lotteries/");p(s,r=>{let a=r.val();a=Object.entries(a).map(i=>(i[1].id=i[0],i[1])),this.lottery=Object.values(a).filter(i=>i.isEnabled===!0),this.lottery=this.lottery[0],this.lottery.recipes.forEach(i=>{this.drewProducts[i.title]||(this.drewProducts[i.title]=[]),i.relativeProducts.forEach(e=>{e.category!=="組合包"&&(e.recipeName=`抽獎食譜${i.title}`,this.drewProducts[i.title].push(e))})}),this.drewProducts=Object.entries(this.drewProducts),console.log(this.drewProducts,this.lottery.prizes,"抽獎標的")})},getLotteryResult(){D(M,s=>{if(s){this.uid=s.uid,console.log(this.uid,"使用者已登入取得 uid");const r=u(m,"users/"+s.uid);p(r,a=>{this.user=a.val(),console.log(this.user,"使用者資料");const i=u(m,`lotteryResults/${this.uid}`);p(i,e=>{this.lotteryResult=e.val(),this.lotteryResult?(this.drewArr=this.lotteryResult.drewArr,this.getPrize=this.lotteryResult.getPrize):(this.drewArr=[],this.getPrize={})})})}else console.log("並未登入"),this.uid=null,this.user={},this.drewArr=[],this.getPrize={}})},addtLotteryResult(){if(!this.uid){this.toastMessage("登入即可抽獎","error");return}if(this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2,000</b> 即可獲得一張抽獎券</p><p>單筆金額滿  <b>NT$5,000</b> 即可獲得三張抽獎券</p><p>單筆金額滿  <b>NT$10,000</b> 即可獲得七張抽獎券</p><a href="/finalEasyBuyEasyMake/#/products" class="link-blue">前往選購商品</a>',showConfirmButton:!0,confirmButtonColor:"#4572c2",confirmButtonText:"確定"});return}y(u(m),{[`users/${this.uid}/lotteryTicket/`]:this.user.lotteryTicket-1});const s=Math.floor(Math.random()*this.drewProducts.length),r=Math.floor(Math.random()*this.drewProducts[s][1].length);if(console.log(this.drewProducts,s,r,"抽獎資料"),this.drewArr.length){if(this.drewArr.length){this.drewProducts.forEach((i,e)=>{this.drewArr[e][1]||(this.drewArr[e][1]=[])});let a=!1;if(this.drewArr[s][1]&&this.drewArr[s][1].forEach(i=>{i.title===this.drewProducts[s][1][r].title&&(a=!0,console.log(this.drewProducts[s][0],i.title,"這個重複了"))}),console.log(a,"有重複嗎"),a)this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80">',customClass:{icon:"no-border"},showConfirmButton:!1});else if(!a){this.drewArr[s][1].push(this.drewProducts[s][1][r]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[s][1][r].title}`,iconHtml:`<img src="${this.drewProducts[s][1][r].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1}),y(u(m),{[`lotteryResults/${this.uid}/drewArr/`]:this.drewArr});let i="";if(!this.drewArr[0][1]||!this.drewArr[1][1]||!this.drewArr[2][1]){console.log("不用看了沒中獎");return}this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length&&this.drewArr[2][1].length===this.drewProducts[2][1].length?i=0:this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length?i=1:(this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length)&&(i=2),(i||i===0)&&y(u(m),{[`lotteryResults/${this.uid}/getPrize/`]:this.lottery.prizes[i]})}}}else{this.drewProducts.forEach((i,e)=>{this.drewArr[e]=[i[0],[]]}),this.drewArr[s][1].push(this.drewProducts[s][1][r]),console.log(this.drewArr,s,this.drewArr[s][0],"放入什麼"),this.$swal({title:`恭喜您抽中 ${this.drewProducts[s][1][r].title}`,iconHtml:`<img src="${this.drewProducts[s][1][r].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1});const a=u(m,`lotteryResults/${this.uid}`);R(a,{drewArr:this.drewArr,getPrize:{}}),console.log("首次抽獎")}}},mounted(){this.isLoading=!0,this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.getCoupons(),this.getLottery(),this.getLotteryResult()},computed:{},watch:{}},F={class:"",style:{"overflow-x":"hidden"}},W=t("div",{class:"d-flex flex-column align-items-center py-10"},[t("img",{src:S,class:"loadingLogo mb-3",style:{width:"150px"},alt:""}),t("h1",{class:"text-center fw-bold text-blue"},[t("span",{class:"me-1 animate-text"},"L"),t("span",{class:"mx-1 animate-text"},"o"),t("span",{class:"mx-1 animate-text"},"a"),t("span",{class:"mx-1 animate-text"},"d"),t("span",{class:"mx-1 animate-text"},"i"),t("span",{class:"mx-1 animate-text"},"n"),t("span",{class:"mx-1 animate-text"},"g"),t("span",{class:"mx-2 animate-text"},"."),t("span",{class:"me-2 animate-text"},"."),t("span",{class:"animate-text"},".")])],-1),Y=t("section",{class:"bannerBg",style:{"background-image":"url('https://images.unsplash.com/photo-1678465952975-85cc1a08b2d7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1169&q=80')"}},[t("div",{class:"mask"},[t("div",{class:"text",style:{background:"linear-gradient(to bottom, white 50% , #4572c2 50%)","-webkit-background-clip":"text"}}," 優惠特報 ")])],-1),J={class:"container mt-4"},X={class:"position-relative categorySelector row row-cols-2 gy-2 list-unstyled border-bottom"},K={key:0,class:"discountImg1",src:T,alt:""},Q={key:1,src:j,alt:""},Z=t("span",{class:"titleSize"},"優惠折扣",-1),$={key:0,class:"discountImg2",src:O,alt:""},tt={key:1,src:I,alt:""},et=t("span",{class:"titleSize"},"抽獎回饋",-1),st={key:0,class:"text-blue"},it={class:"container"},rt={key:0,class:"row row-cols-lg-4 g-4 py-3 text-darkBrown"},ot={class:"card"},lt={class:"enlargeImg w-100 rounded"},nt={class:"cardImg"},ct=["src"],at={class:"card-body"},dt={class:""},ht={class:"card-title h4 fw-bold"},ut={class:"card-text text-truncate"},mt=t("p",{class:"detail d-none d-lg-block position-absolute fw-bold",style:{top:"30%",left:"50%",transform:"translateX(-50%)","letter-spacing":"5px"}},"查看優惠資訊",-1),gt={class:"d-flex"},ft={key:1},_t={class:"container"},bt={class:"py-3 text-darkBrown d-flex flex-column"},wt={class:""},pt=t("i",{class:"bi bi-clock-fill me-1"},null,-1),yt=t("i",{class:"bi bi-ticket-perforated-fill me-1"},null,-1),xt={key:1,class:"col-lg-12 align-self-center"},vt=t("h4",{class:"mb-0 text-center fw-bold"},"本月指定抽獎食譜",-1),kt={class:"row row-cols-lg-3 row-cols-1 mt-4"},Pt={class:"text-center fw-bold my-3"},At={class:"row"},Nt=["src"],Lt={key:0,class:"position-absolute bg-notObtained d-flex"},Bt=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),zt=[Bt],Ct={class:"d-flex"},Dt=t("p",{class:"text-end"},"抽一次消耗一張抽獎券",-1),Rt={key:2,class:"d-flex flex-column align-items-center"},Mt={class:"h3 text-center text-blue fw-bold"},Et={class:"col-lg-4 col-12"},St={class:"card position-relative",style:{"border-radius":"0px",border:"none !important"}},Tt={class:"card-header h4 fw-bold text-center mb-3 bg-white border-0"},jt=["src"],Ht={class:"card-footer bg-transparent border-0",style:{"background-color":"white !important"}},Vt={class:"fw-bold"},qt={class:"text-end"},Ot=t("p",null,[w("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到@EasyMakeEasyBuy.gmail.com，感謝您的支持!"),t("br"),w("下期好禮更精彩，千萬別錯過!")],-1),It={class:"py-10","data-aos":"zoom-in"},Gt=q('<div class="container"><h2 class="display-6 fw-bold d-flex align-items-center mb-4 d-flex flex-column-reverse flex-lg-row align-items-center mb-4 justify-content-center justify-content-lg-start"><div class="d-flex align-items-center"><img src="'+G+'" class="me-lg-4 me-2 titleImg" alt=""><span class="recipeTitle">月獎品</span></div><span class="light-blue mb-lg-0 mb-2 h6 ms-2 speakerText d-flex align-items-center"><img src="'+H+'" class="speaker" alt=""> 超值大獎一次帶回! </span></h2></div>',1),Ut={class:"container"},Ft={class:"prizes row row-cols-lg-3 row-cols-1 gy-4"},Wt={class:"card position-relative",style:{"border-radius":"0",border:"1px transparent solid"}},Yt={class:"card-header border-0 h4 fw-bold text-center mb-3 bg-white"},Jt=t("div",{class:"questionMark position-absolute d-flex",style:{top:"60px",width:"100%",height:"220px",background:"linear-gradient(90deg, #6ea3fe ,#cab8ff)"}},[t("i",{class:"bi bi-question-lg mx-auto text-white",style:{"font-size":"150px"}})],-1),Xt=["src"],Kt={class:"card-footer bg-transparent border-0"},Qt={class:"fw-bold"},Zt={class:"text-end"},$t=t("h5",null,"規則：",-1);function te(s,r,a,i,e,x){const N=A("loading"),L=A("RouterLink");return n(),l("div",F,[k(N,{active:e.isLoading,"onUpdate:active":r[0]||(r[0]=o=>e.isLoading=o),"can-cancel":!1,"is-full-page":e.fullPage,"lock-scroll":!0},{default:P(()=>[W]),_:1},8,["active","is-full-page"]),Y,t("section",J,[t("ul",X,[t("li",{class:g(["col d-flex align-items-center justify-content-center",{liDisabled:e.tabName==="優惠折扣"}])},[t("a",{href:"#",onClick:r[1]||(r[1]=v(()=>e.tabName="優惠折扣",["prevent"])),class:g(["text-decoration-none d-flex flex-column align-items-center link-secondary",{"fw-bold":e.tabName==="優惠折扣","link-blue":e.tabName==="優惠折扣"}])},[e.tabName!=="優惠折扣"?(n(),l("img",K)):e.tabName==="優惠折扣"?(n(),l("img",Q)):d("",!0),Z],2)],2),t("li",{class:g(["col d-flex align-items-center justify-content-center",{liDisabled:e.tabName==="抽獎回饋"}])},[t("a",{href:"#",onClick:r[2]||(r[2]=v(()=>e.tabName="抽獎回饋",["prevent"])),class:g(["text-decoration-none d-flex flex-column align-items-center link-secondary",{"fw-bold":e.tabName==="抽獎回饋","link-blue":e.tabName==="抽獎回饋"}])},[e.tabName!=="抽獎回饋"?(n(),l("img",$)):e.tabName==="抽獎回饋"?(n(),l("img",tt)):d("",!0),et],2)],2),t("li",{class:g(["redLine bg-blue position-absolute",{activeDiscount:e.tabName==="優惠折扣",activeGift:e.tabName==="抽獎回饋"}]),style:{height:"2px",bottom:"0px",left:"5.5%"}},null,2)])]),e.tabName==="優惠折扣"?(n(),l("section",st,[t("div",it,[e.isLoading?d("",!0):(n(),l("div",rt,[(n(!0),l(f,null,b(e.coupons,(o,h)=>(n(),l("div",{class:"col hvr-hang",key:h},[t("div",ot,[t("div",lt,[t("div",nt,[t("img",{src:o.image,class:"card-img-top",alt:"...",height:"200",style:{"object-fit":"cover"}},null,8,ct)]),t("div",at,[t("p",dt,c(new Date(o.startDate).toLocaleDateString())+" - "+c(new Date(o.dueDate).toLocaleDateString()),1),t("h5",ht,c(o.title),1),t("p",ut,c(o.description),1),mt,t("div",gt,[k(L,{to:`/discounts/${h}`,href:"#",class:"stretched-link btn btn-outline-blue rounded-0 ms-auto"},{default:P(()=>[w("查看完整優惠資訊")]),_:2},1032,["to"])])])])])]))),128))]))])])):e.tabName==="抽獎回饋"?(n(),l("section",ft,[t("div",_t,[t("div",bt,[t("p",wt,[pt,w("活動時間："+c(new Date(e.lottery.startDate).toLocaleDateString().split(" ")[0])+" ~ "+c(new Date(e.lottery.dueDate).toLocaleString().split(" ")[0]),1)]),e.uid?(n(),l("p",{key:0,class:g({"text-danger":e.user.lotteryTicket===0})},[yt,w("剩餘抽獎券："+c(e.user.lotteryTicket)+"張",1)],2)):d("",!0),!e.getPrize||e.getPrize&&e.getPrize.id!==1?(n(),l("div",xt,[vt,t("div",kt,[(n(!0),l(f,null,b(e.drewProducts,(o,h)=>(n(),l("div",{key:o,class:"border border-blue bg-lightBlue col"},[t("h4",Pt,c(o[0]),1),t("div",At,[(n(!0),l(f,null,b(o[1],_=>(n(),l("div",{class:"d-flex flex-column align-items-center position-relative col-4",key:_.id},[_.category==="單一產品"?(n(),l(f,{key:0},[t("img",{src:_.imgUrl,alt:"",height:"100",width:"100",style:{"object-fit":"cover"}},null,8,Nt),t("p",null,c(_.title),1),!e.drewArr[h]||!e.drewArr[h][1]||e.drewArr[h]&&e.drewArr[h][1]&&!JSON.stringify(this.drewArr[h][1]).includes(_.title)?(n(),l("div",Lt,zt)):d("",!0)],64)):d("",!0)]))),128))])]))),128))]),t("div",Ct,[t("button",{type:"button",class:"hvr-sweep-to-right mx-auto mt-3 btn btn-blue",onClick:r[3]||(r[3]=(...o)=>x.addtLotteryResult&&x.addtLotteryResult(...o)),style:{"border-radius":"0px"}},"立即抽獎")]),Dt])):d("",!0),e.lotteryResult&&this.getPrize&&this.getPrize.id?(n(),l("div",Rt,[t("h5",Mt,"恭喜您完成"+c(e.getPrize.id===1?"全部":e.getPrize.id===2?"2份":"1份")+"食譜，獲得：",1),t("div",Et,[t("div",St,[t("div",Tt,c(e.getPrize.id===1?"大獎":e.getPrize.id===2?"二獎":"三獎"),1),t("img",{src:e.getPrize.img,class:"card-img border",style:{"border-radius":"0px",height:"300px","object-fit":"contain"},alt:""},null,8,jt),t("div",Ht,[t("h5",Vt,c(e.getPrize.title),1),t("p",qt,"價值：NT$ "+c(s.numberComma(e.getPrize.price)),1)])]),Ot])])):d("",!0),t("section",It,[Gt,t("div",Ut,[t("div",Ft,[(n(!0),l(f,null,b(e.lottery.prizes,o=>(n(),l("div",{class:"col",key:o.id,"data-aos":"flip-right"},[t("div",Wt,[t("div",Yt,c(o.id===1?"大獎":o.id===2?"二獎":"三獎"),1),Jt,t("img",{src:o.img,class:"card-img border bg-white",style:{height:"220px","object-fit":"contain","border-radius":"0"},alt:""},null,8,Xt),t("div",Kt,[t("h5",Qt,c(o.title),1),t("p",Zt,"價值：NT$ "+c(s.numberComma(o.price)),1)])])]))),128))])])]),$t,t("ol",null,[(n(!0),l(f,null,b(e.lottery.rules,o=>(n(),l("li",{key:o+20},c(o),1))),128))])])])])):d("",!0)])}const me=V(U,[["render",te]]);export{me as default};
