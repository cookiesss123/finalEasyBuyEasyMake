import{m as k}from"./modalMixin-86852431.js";import{u as I,r as b,p as P,s as L,d as R,b as U,c as V,e as N}from"./carts-ee6b7a03.js";import{m as C}from"./index-399fd004.js";import{v as m,b as T}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as x,o,a7 as l,a8 as e,ab as y,ac as r,N as h,ae as _,ad as d,aa as f,F as w,r as M}from"./_plugin-vue_export-helper-d28549df.js";import"./base-component-7e4a8e9c.js";const B={data(){return{tempRecipe:{imgsUrl:[]},status:"edit",recipeType:["法式甜點","義式甜點","美式甜點","日式甜點","台式甜點"],total:0,recipeId:""}},mixins:[k],props:["id","openModal","products"],methods:{...C(V,["toastMessage"]),updateRecipe(){if(!this.tempRecipe.author||!this.tempRecipe.category||!this.tempRecipe.content||!this.tempRecipe.description||!this.tempRecipe.image||!this.tempRecipe.imgsUrl||!this.tempRecipe.ingredients||!this.tempRecipe.instructions||!this.tempRecipe.title||!this.tempRecipe.video){this.toastMessage("資料沒寫完","error");return}if(this.status==="edit"){if(!this.tempRecipe.price){this.toastMessage("還沒填寫組合價","error");return}I(b(R),{[`recipes/${this.recipeId}/`]:{author:this.tempRecipe.author,category:this.tempRecipe.category,content:this.tempRecipe.content,description:this.tempRecipe.description,image:this.tempRecipe.image,imgsUrl:this.tempRecipe.imgsUrl,ingredients:this.tempRecipe.ingredients,instructions:this.tempRecipe.instructions,price:this.tempRecipe.price,relativeProducts:this.tempRecipe.relativeProducts,title:this.tempRecipe.title,total:this.total,video:this.tempRecipe.video}}),this.toastMessage("更改成功","success")}else if(this.status==="new"){const a=b(R,"recipes/"),s=P(a);this.tempRecipe.price=0,this.total=0,this.tempRecipe.relativeProducts=[],L(s,{author:this.tempRecipe.author,category:this.tempRecipe.category,content:this.tempRecipe.content,description:this.tempRecipe.description,image:this.tempRecipe.image,imgsUrl:this.tempRecipe.imgsUrl,ingredients:this.tempRecipe.ingredients,instructions:this.tempRecipe.instructions,price:this.tempRecipe.price,relativeProducts:this.tempRecipe.relativeProducts,title:this.tempRecipe.title,total:this.total,video:this.tempRecipe.video}),this.toastMessage("新增成功","success")}this.hide()}},watch:{id(){if(this.id!=="new"&&this.id!==""){const a=b(R,`recipes/${this.id}`);U(a,s=>{this.tempRecipe=s.val(),this.id&&(this.tempRecipe.id=this.id),this.tempRecipe.imgsUrl||(this.tempRecipe.imgsUrl=[]),this.tempRecipe.ingredients||(this.tempRecipe.ingredients=[]),this.tempRecipe.relativeProducts=[],this.total=0,this.products.forEach(p=>{p.relevantRecipes.forEach(g=>{g===this.tempRecipe.title&&p.category==="單一產品"?(this.tempRecipe.relativeProducts.push(p),this.total+=p.price):g===this.tempRecipe.title&&p.category==="組合包"&&this.tempRecipe.relativeProducts.push(p)})}),this.show(),this.status="edit",this.recipeId=this.id,this.openModal("")})}else this.id==="new"&&(this.tempRecipe={ingredients:[],imgsUrl:[]},this.relativeProducts=[],this.show(),this.status="new",this.openModal(""))}}},E={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},S={class:"modal-dialog modal-xl"},j={class:"modal-content"},A={class:"modal-header bg-dark"},F={class:"modal-title text-white",id:"exampleModalLabel"},O={key:0},q={key:1},z=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},H={class:"row"},J={class:"col-4"},K={class:"row"},Q={class:"col-12"},W=e("label",{for:"imgUrl",class:"form-label"},"圖片網址",-1),X=["src"],Y=e("hr",null,null,-1),Z=e("label",{for:"subPic",class:"form-label"},"副圖網址",-1),$=["onUpdate:modelValue"],ee=["src"],te={class:"d-flex"},se=["onClick"],ie={key:0,class:"d-flex mt-4"},oe={class:"col-12"},le=e("label",{for:"videoUrl",class:"form-label"},"影片網址",-1),ne={class:"col-12"},ce=e("label",{for:"ingredients",class:"form-label"},"材料",-1),pe={class:"input-group-text"},de=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ae=["onUpdate:modelValue"],me=["onClick"],ue={key:0,class:"d-flex"},he={class:"col-8"},_e={class:"row gy-3"},be={class:"col-4"},Re=e("label",{for:"title",class:"form-label"},"食譜編號（id）",-1),ge={class:"col-3"},fe=e("label",{for:"category",class:"form-label"},"食譜類別",-1),ve=["value"],ye={class:"col-5"},Ue=e("label",{for:"title",class:"form-label"},"食譜名稱",-1),xe={class:"col-4"},we=e("label",{for:"content",class:"form-label"},"作者",-1),Me={class:"col-3"},ke=e("label",{for:"content",class:"form-label"},"食譜內容",-1),Ve={class:"col-3"},Ce=e("label",{for:"costs",class:"form-label"},"成本",-1),De={class:"d-flex align-items-center"},Ie={class:"col-2"},Pe=e("label",{for:"costs",class:"form-label"},"組合價",-1),Le={class:"d-flex align-items-center"},Ne={class:"col-12"},Te=e("label",{for:"description",class:"form-label"},"食譜描述",-1),Be={class:"col-12"},Ee=e("label",{for:"instructions",class:"form-label"},"製作步驟",-1),Se={class:"col-12"},je=e("label",{for:"product",class:"form-label text-primary"},"所需產品",-1),Ae=["for"],Fe={class:"text-end text-primary"},Oe={class:"modal-footer"},qe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),ze={key:0},Ge={key:1};function He(a,s,p,g,t,u){return o(),l("div",E,[e("div",S,[e("div",j,[e("div",A,[e("h5",F,[t.status==="edit"?(o(),l("span",O,"編輯產品內容")):t.status==="new"?(o(),l("span",q,"新增產品內容")):y("",!0)]),z]),e("div",G,[e("div",H,[e("div",J,[e("div",K,[e("div",Q,[W,r(e("input",{type:"text",id:"imgUrl",class:"form-control mb-3","onUpdate:modelValue":s[0]||(s[0]=i=>t.tempRecipe.image=i)},null,512),[[m,t.tempRecipe.image]]),e("img",{src:t.tempRecipe.image,alt:"",width:"300"},null,8,X),Y,(o(!0),l(h,null,_(t.tempRecipe.imgsUrl,(i,c)=>(o(),l("div",{key:i+3453},[Z,r(e("input",{type:"text",id:"subPic",class:"form-control mb-3","onUpdate:modelValue":n=>t.tempRecipe.imgsUrl[c]=n},null,8,$),[[m,t.tempRecipe.imgsUrl[c]]]),e("img",{src:t.tempRecipe.imgsUrl[c],alt:"",width:"300"},null,8,ee),e("div",te,[e("button",{type:"button",class:"ms-auto btn btn-danger",onClick:()=>t.tempRecipe.imgsUrl.splice(c,1)},"刪除圖片",8,se)])]))),128)),t.tempRecipe.imgsUrl[t.tempRecipe.imgsUrl.length-1]!==""?(o(),l("div",ie,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[1]||(s[1]=()=>t.tempRecipe.imgsUrl.push(""))},"新增圖片")])):y("",!0)]),e("div",oe,[le,r(e("input",{type:"text",id:"videoUrl",class:"form-control mb-3","onUpdate:modelValue":s[2]||(s[2]=i=>t.tempRecipe.video=i)},null,512),[[m,t.tempRecipe.video]])]),e("div",ne,[ce,(o(!0),l(h,null,_(t.tempRecipe.ingredients,(i,c)=>(o(),l("div",{class:"input-group mb-3",key:i+342},[e("div",pe,d(c+1),1),r(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":n=>t.tempRecipe.ingredients[c].name=n,style:{width:"150px"}},null,8,de),[[m,t.tempRecipe.ingredients[c].name]]),r(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":n=>t.tempRecipe.ingredients[c].num=n},null,8,re),[[m,t.tempRecipe.ingredients[c].num,void 0,{number:!0}]]),r(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":n=>t.tempRecipe.ingredients[c].unit=n},null,8,ae),[[m,t.tempRecipe.ingredients[c].unit]]),e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:()=>t.tempRecipe.ingredients.splice(c,1)},"x",8,me)]))),128))]),t.tempRecipe.ingredients&&t.tempRecipe.ingredients[t.tempRecipe.ingredients.length-1]!==""||!t.tempRecipe.ingredients?(o(),l("div",ue,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[3]||(s[3]=()=>t.tempRecipe.ingredients.push({name:"",num:"",unit:""}))},"新增材料")])):y("",!0)])]),e("div",he,[e("div",_e,[e("div",be,[Re,r(e("input",{type:"text",id:"title",class:"form-control",disabled:"","onUpdate:modelValue":s[4]||(s[4]=i=>t.tempRecipe.id=i)},null,512),[[m,t.tempRecipe.id]])]),e("div",ge,[fe,r(e("select",{name:"",id:"category",class:"form-select","onUpdate:modelValue":s[5]||(s[5]=i=>t.tempRecipe.category=i)},[(o(!0),l(h,null,_(t.recipeType,i=>(o(),l("option",{key:i,value:i},d(i),9,ve))),128))],512),[[T,t.tempRecipe.category]])]),e("div",ye,[Ue,r(e("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=i=>t.tempRecipe.title=i)},null,512),[[m,t.tempRecipe.title]])]),e("div",xe,[we,r(e("input",{type:"text",id:"content",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=i=>t.tempRecipe.author=i)},null,512),[[m,t.tempRecipe.author]])]),e("div",Me,[ke,r(e("input",{type:"text",id:"content",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=i=>t.tempRecipe.content=i)},null,512),[[m,t.tempRecipe.content]])]),e("div",Ve,[Ce,e("div",De,[r(e("input",{type:"text",id:"costs",class:"form-control me-2","onUpdate:modelValue":s[9]||(s[9]=i=>t.tempRecipe.total=i)},null,512),[[m,t.tempRecipe.total]]),f("元 ")])]),e("div",Ie,[Pe,e("div",Le,[r(e("input",{type:"text",id:"costs",class:"form-control me-2","onUpdate:modelValue":s[10]||(s[10]=i=>t.tempRecipe.price=i)},null,512),[[m,t.tempRecipe.price,void 0,{number:!0}]]),f("元 ")])]),e("div",Ne,[Te,r(e("textarea",{name:"",id:"description",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=i=>t.tempRecipe.description=i)},null,512),[[m,t.tempRecipe.description]])]),e("div",Be,[Ee,r(e("textarea",{name:"",id:"instructions",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":s[12]||(s[12]=i=>t.tempRecipe.instructions=i)},null,512),[[m,t.tempRecipe.instructions]])]),e("div",Se,[je,e("ol",null,[(o(!0),l(h,null,_(t.tempRecipe.relativeProducts,(i,c)=>(o(),l("li",{key:i.id,class:"row mb-5"},[e("label",{for:i+c,class:"col-8 mb-0"},d(c+1)+". "+d(i.title)+" ： "+d(i.num)+d(i.unit)+" / "+d(i.price)+" 元",9,Ae)]))),128))]),e("h5",Fe," 總計： "+d(t.tempRecipe.total)+" 元 ",1)])])])])]),e("div",Oe,[qe,e("button",{type:"button",class:"btn btn-primary",onClick:s[13]||(s[13]=(...i)=>u.updateRecipe&&u.updateRecipe(...i))},[t.status==="edit"?(o(),l("span",ze,"確認編輯")):t.status==="new"?(o(),l("span",Ge,"確認新增")):y("",!0)])])])])],512)}const Je=x(B,[["render",He]]),Ke={data(){return{deleteId:"",tempRecipe:{}}},mixins:[k],props:["id","item","openDeleteModal"],methods:{...C(V,["toastMessage"]),deleteRecipe(){N(b(R,`recipes/${this.deleteId}/`)),this.toastMessage("刪除食譜"),this.hide()}},watch:{id(){this.id&&(this.show(),this.tempRecipe=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}}},Qe={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},We={class:"modal-dialog"},Xe={class:"modal-content"},Ye=e("div",{class:"modal-header bg-dark"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除產品 "),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ze={class:"modal-body"},$e={class:"text-danger fw-bold"},et={class:"modal-footer"},tt=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function st(a,s,p,g,t,u){return o(),l("div",Qe,[e("div",We,[e("div",Xe,[Ye,e("div",Ze,[e("p",null,[f("確定要刪除食譜 "),e("span",$e," 【"+d(t.tempRecipe.title)+"】 ",1),f(" 嗎? ")])]),e("div",et,[tt,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...i)=>u.deleteRecipe&&u.deleteRecipe(...i))}," 確認刪除 ")])])])],512)}const it=x(Ke,[["render",st]]),ot={components:{RecipeModal:Je,DeleteRecipeModal:it},data(){return{recipes:[],products:[],recipeId:"",recipeDeleteId:"",recipeDeleteItem:{}}},methods:{getRecipes(){const a=b(R,"recipes/");U(a,s=>{this.recipes=s.val(),this.recipes=Object.entries(this.recipes).map(p=>(p[1].id=p[0],p[1])),console.log(this.recipes,"後台食譜")})},getProducts(){const a=b(R,"products/");U(a,s=>{this.products=s.val(),this.products=Object.entries(this.products).map(p=>(p[1].id=p[0],p[1])),console.log(this.products,"產品")})},openModal(a){this.recipeId=a},openDeleteModal(a,s){this.recipeDeleteId=a,this.recipeDeleteItem=s}},mounted(){this.getRecipes(),this.getProducts()}},lt={class:"container"},nt={class:"d-flex my-4"},ct={class:"table text-center"},pt=e("thead",null,[e("tr",null,[e("th",null,"食譜編號"),e("th",null,"分類"),e("th",null,"食譜名稱"),e("th",null,"內容"),e("th",null,"產品"),e("th",null,"成本"),e("th",null,"組合價"),e("th",null,"編輯")])],-1),dt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","max-width":"400px"}},rt={class:"btn-group"},at=["onClick"],mt=["onClick"];function ut(a,s,p,g,t,u){const i=M("RecipeModal"),c=M("DeleteRecipeModal");return o(),l("div",lt,[e("div",nt,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[0]||(s[0]=n=>u.openModal("new"))},"建立新食譜")]),e("table",ct,[pt,(o(!0),l(h,null,_(t.recipes,n=>(o(),l("tbody",{key:n.id},[e("tr",null,[e("td",null,d(n.id),1),e("td",null,d(n.category),1),e("td",null,d(n.title),1),e("td",null,d(n.content),1),e("td",dt,[(o(!0),l(h,null,_(n.relativeProducts,(v,D)=>(o(),l(h,{key:v.id},[f(d(`${D+1}${v.title} `),1)],64))),128))]),e("td",null,d(n.total),1),e("td",null,d(n.price),1),e("td",null,[e("div",rt,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:v=>u.openModal(n.id)},"編輯",8,at),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:v=>u.openDeleteModal(n.id,n)},"刪除",8,mt)])])])]))),128))]),w(i,{id:t.recipeId,"open-modal":u.openModal,products:t.products},null,8,["id","open-modal","products"]),w(c,{ref:"deleteRecipeModal",id:t.recipeDeleteId,item:t.recipeDeleteItem,"open-delete-modal":u.openDeleteModal},null,8,["id","item","open-delete-modal"])])}const vt=x(ot,[["render",ut]]);export{vt as default};
