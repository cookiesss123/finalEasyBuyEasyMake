import{m as A}from"./index-c6d50911.js";import{c as U}from"./carts-3e98ce4a.js";import{P as L}from"./PaginationComponent-8d29b0f7.js";import{L as S}from"./LoadingModal-16ab9486.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{c as x,u as g,r as u,b as _,f as T,d as h,o as y}from"./db-64e704f5.js";import{v as k}from"./runtime-dom.esm-bundler-54ced388.js";import{_ as R}from"./loadingLogo-3bb466c0.js";import{_ as j,U as o,W as f,V as e,Z as a,a0 as c,a4 as r,$ as v,Y as I,a1 as N,a2 as C,r as w,o as i,X as z,a5 as B}from"./_plugin-vue_export-helper-03b40388.js";import"./vue-router-2c21c692.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";const D={components:{PaginationComponent:L,LoadingModal:S},mixins:[V],data(){return{user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",nickName:"",pageOrders:[],loading:!0}},methods:{...A(U,["toastMessage"]),getUserInformation(){x(_,n=>{if(n){this.uid=n.uid,console.log(this.uid,"使用者已登入取得 uid 有在作用嗎");const s=u(h,"users/"+n.uid);y(s,d=>{this.user=d.val(),console.log(this.user,"讀取的資料")})}else console.log("並未登入"),this.uid=null,this.user={},this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/login")})},getOrders(){x(_,n=>{if(n){this.uid=n.uid;const s=u(h,`orders/${this.uid}`);y(s,d=>{const p=d.val();if(!p){this.loading=!1;return}this.orders=Object.entries(p).map(t=>(t[1].id=t[0],t[1])),this.filterOrders=this.orders,console.log(this.filterOrders,"我的訂單"),this.orderArrived=this.orders.filter(t=>t.deliveryStatus==="待取貨"),this.filterOrders&&this.$refs.pagination.renderPage(1,this.filterOrders),this.loading=!1})}else console.log("並未登入"),this.uid=null,this.user={},this.uid||(this.toastMessage("請先登入","error"),this.$router.push("/login"))})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}g(u(h),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const n=_.currentUser;T(n,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/login")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:n}=await this.$swal({title:"選擇圖片",input:"file",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(n){const s=new FileReader;s.onload=d=>{this.$swal({title:"圖片上傳成功!",imageUrl:d.target.result,imageAlt:"The uploaded picture",imageHeight:300}),console.log(d.target.result,"印出什麼"),g(u(h),{[`users/${this.uid}/headshotImg/`]:d.target.result})},s.readAsDataURL(n)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:n}=await this.$swal({title:"選擇圖片",input:"text",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});n?(console.log(n,"檔案"),this.$swal({title:"圖片上傳成功",imageUrl:n,imageHeight:300,imageAlt:"Custom image"}),g(u(h),{[`users/${this.uid}/headshotImg/`]:n})):this.toastMessage("請勿輸入空值","error")}},mounted(){this.getUserInformation(),this.getOrders()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(n=>n.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},F={class:"mt-10"},q={class:"bg-lightYellow py-5"},H={class:"container"},Y=e("h2",{class:"h3 fw-bold"},"會員資料",-1),W={class:"row gy-5 my-4 row-cols-1 row-cols-lg-2 align-items-center"},X={class:"col d-flex flex-column align-items-center"},Z={key:0,class:"d-flex mb-4",style:{width:"300px",height:"300px",border:"5px solid #ef6b5a"}},G=e("i",{class:"bi bi-person-fill m-auto text-red",style:{"font-size":"200px"}},null,-1),J=[G],K=["src"],Q={class:""},$={class:"col-12 col-lg-4"},tt={class:"border-start border-red d-flex align-items-center"},et=e("label",{for:"nickName",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},"暱稱",-1),st={key:0,class:"ms-4"},ot={class:"ms-auto"},it=e("span",null,"修改暱稱",-1),nt=[it],lt={class:"border-start border-red d-flex align-items-center mt-3 mt-lg-5"},rt=e("label",{for:"email",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},"信箱",-1),at={class:"ms-4"},ct={class:"border-start border-red d-flex align-items-center mt-3 mt-lg-5"},dt=e("label",{for:"password",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},"密碼",-1),mt={key:0,class:"ms-4"},ut={class:"ms-auto"},ht=e("span",null,"變更密碼",-1),bt=[ht],pt={class:"border-start border-red d-flex align-items-center mt-3 mt-lg-5"},gt=e("label",{for:"ticket",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},"我的抽獎券",-1),_t={class:"ms-4"},ft={class:"py-5 container"},wt=e("h2",{class:"h3 fw-bold"},"訂單狀況",-1),xt={class:"selectOrderStatus py-3 d-flex justify-content-between justify-content-lg-start"},yt={class:"d-lg-none"},kt={key:0,class:"text-white ms-2"},vt={class:"d-lg-none"},It={key:0,class:"text-white ms-2"},Nt={class:"d-lg-none"},Ct={key:0,class:"text-white ms-2"},Pt={key:0,class:"badge bg-danger",style:{"font-size":"12px"}},Et={class:"d-lg-none"},Mt={key:0,class:"text-white ms-2"},Ot={key:1,class:"badge bg-danger ms-2",style:{"font-size":"12px"}},At={class:"d-lg-none"},Ut={key:0,class:"text-white ms-2"},Lt={class:"row row-cols-1 py-3"},St={class:"mb-3"},Vt={key:0},Tt={class:"ms-4"},Rt={class:"row row-cols-lg-6 row-cols-2 align-items-center mt-2 position-relative"},jt={key:0},zt=["src"],Bt={class:"mb-0"},Dt={class:"mb-0"},Ft={key:0,class:"col position-absolute",style:{bottom:"20px",right:"200px"}},qt=e("p",{class:"fw-bold",style:{"font-size":"100px"}},". . .",-1),Ht=[qt],Yt={class:"d-flex"},Wt={class:"ms-auto d-flex align-items-center"},Xt={class:"me-3 fw-bold"},Zt=e("hr",null,null,-1),Gt={key:0,class:"d-flex flex-column align-items-center"},Jt=B('<img src="'+R+'" class="loadingLogo mb-3" style="width:150px;" alt=""><h1 class="text-center fw-bold text-lightBrown"><span class="me-1 animate-text">L</span><span class="mx-1 animate-text">o</span><span class="mx-1 animate-text">a</span><span class="mx-1 animate-text">d</span><span class="mx-1 animate-text">i</span><span class="mx-1 animate-text">n</span><span class="mx-1 animate-text">g</span><span class="mx-2 animate-text">.</span><span class="me-2 animate-text">.</span><span class="animate-text">.</span></h1>',2),Kt=[Jt];function Qt(n,s,d,p,t,m){const P=w("LoadingModal"),E=w("RouterLink"),M=w("PaginationComponent");return i(),o("div",F,[f(P,{ref:"loadingModal"},null,512),e("section",q,[e("div",H,[Y,e("div",W,[e("div",X,[t.user.headshotImg?t.user.headshotImg?(i(),o("img",{key:1,src:t.user.headshotImg,width:"300",height:"300",style:{"object-fit":"cover",border:"5px solid #ef6b5a"},class:"mb-4",alt:""},null,8,K)):a("",!0):(i(),o("div",Z,J)),e("div",Q,[e("button",{type:"button",class:"btn btn-red text-white me-4",onClick:s[0]||(s[0]=(...l)=>m.selectImgUrl&&m.selectImgUrl(...l))},"上傳圖片網址"),e("button",{type:"button",class:"btn btn-red",onClick:s[1]||(s[1]=(...l)=>m.selectFile&&m.selectFile(...l))},"上傳本地圖片")])]),e("div",$,[e("div",tt,[et,t.nickNameEdit?(i(),o("span",st,c(t.user.nickName),1)):a("",!0),e("div",ot,[t.nickNameEdit?(i(),o("button",{key:0,type:"button",class:"btn btn-sm btn-red",onClick:s[2]||(s[2]=()=>t.nickNameEdit=!t.nickNameEdit)},nt)):a("",!0),e("div",{class:r(["input-group",{"d-none":t.nickNameEdit}])},[v(e("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":s[3]||(s[3]=l=>t.newNickName=l)},null,512),[[k,t.newNickName]]),e("button",{onClick:s[4]||(s[4]=()=>t.nickNameEdit=!0),class:"btn btn-outline-secondary btn-sm",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[5]||(s[5]=()=>m.changeEmail()),class:"btn btn-sm btn-outline-red",type:"button",id:"button-addon2"},"確定")],2)])]),e("div",lt,[rt,e("span",at,c(t.user.email),1)]),e("div",ct,[dt,t.passwordEdit?(i(),o("span",mt,"* * * * * * * *")):a("",!0),e("div",ut,[t.passwordEdit?(i(),o("button",{key:0,type:"button",class:"btn btn-sm btn-red",onClick:s[6]||(s[6]=()=>t.passwordEdit=!t.passwordEdit)},bt)):a("",!0),e("div",{class:r(["input-group",{"d-none":t.passwordEdit}])},[v(e("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":s[7]||(s[7]=l=>t.newPassword=l)},null,512),[[k,t.newPassword]]),e("button",{onClick:s[8]||(s[8]=()=>t.passwordEdit=!0),class:"btn btn-sm btn-outline-secondary",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[9]||(s[9]=()=>m.changePassword()),class:"btn btn-sm btn-outline-red",type:"button",id:"button-addon2"},"確定")],2)])]),e("div",pt,[gt,e("span",_t,c(t.user.lotteryTicket)+" 張",1),e("button",{type:"button",class:"btn btn-sm btn-red ms-auto",onClick:s[10]||(s[10]=(...l)=>m.linkToLottery&&m.linkToLottery(...l))},"立即抽獎")])])])])]),e("section",ft,[wt,e("div",xt,[e("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="全部"}]),onClick:s[11]||(s[11]=()=>t.selectItem="全部")},[e("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])}," 全部 ",2),e("div",yt,[e("i",{class:r(["bi bi-border-all",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])},null,2),t.selectItem==="全部"?(i(),o("span",kt,"全部")):a("",!0)])],2),e("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待出貨"}]),onClick:s[12]||(s[12]=()=>t.selectItem="待出貨")},[e("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])},"待出貨",2),e("div",vt,[e("i",{class:r(["bi bi-box-seam",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])},null,2),t.selectItem==="待出貨"?(i(),o("span",It,"待出貨")):a("",!0)])],2),e("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="運送中"}]),onClick:s[13]||(s[13]=()=>t.selectItem="運送中")},[e("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])},"運送中",2),e("div",Nt,[e("i",{class:r(["bi bi-truck",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])},null,2),t.selectItem==="運送中"?(i(),o("span",Ct,"運送中")):a("",!0)])],2),e("button",{type:"button",class:r(["btn border-0 me-lg-5 position-relative hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待取貨"}]),onClick:s[14]||(s[14]=()=>t.selectItem="待取貨")},[e("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])},[I("待取貨 "),t.orderArrived.length?(i(),o("span",Pt,c(t.orderArrived.length),1)):a("",!0)],2),e("div",Et,[e("i",{class:r(["bi bi-house-check",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])},null,2),t.selectItem==="待取貨"?(i(),o("span",Mt,"待取貨")):a("",!0),t.orderArrived.length?(i(),o("span",Ot,c(t.orderArrived.length),1)):a("",!0)])],2),e("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="訂單完成"}]),onClick:s[15]||(s[15]=()=>t.selectItem="訂單完成")},[e("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])},"訂單完成",2),e("div",At,[e("i",{class:r(["bi bi-clipboard-check",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])},null,2),t.selectItem==="訂單完成"?(i(),o("span",Ut,"訂單完成")):a("",!0)])],2)]),e("div",Lt,[e("h4",St," 總共有 "+c(t.filterOrders.length)+" 筆 ",1),t.filterOrders.length?(i(),o("div",Vt,[(i(!0),o(N,null,C(this.$refs.pagination.pageProducts,l=>(i(),o("div",{class:"col",key:l.creatAt},[e("span",null,"訂單建立時間："+c(new Date(l.creatAt).toLocaleDateString()),1),e("span",Tt,"訂單編號："+c(l.id),1),e("div",Rt,[(i(!0),o(N,null,C(l.cart.items,(b,O)=>(i(),o("div",{class:"col",key:b+6603},[O<4?(i(),o("div",jt,[e("img",{src:b.product.imgUrl,alt:"",height:"100",width:"150",style:{"object-fit":"cover"}},null,8,zt),e("p",Bt,c(b.product.title),1),e("p",Dt,"x "+c(n.numberComma(b.qty)),1)])):a("",!0)]))),128)),l.cart.items.length>4?(i(),o("div",Ft,Ht)):a("",!0)]),e("div",Yt,[e("div",Wt,[e("span",Xt,"運送狀態："+c(l.deliveryStatus),1),e("span",null,"總付款金額：NT$ "+c(n.numberComma(l.cart.finalTotal)),1),f(E,{to:`/orders/${l.id}`,class:"btn btn-red ms-3"},{default:z(()=>[I("查看詳細訂單狀況")]),_:2},1032,["to"])])]),Zt]))),128))])):a("",!0)]),f(M,{ref:"pagination","filter-orders":t.filterOrders},null,8,["filter-orders"])]),t.loading?(i(),o("div",Gt,Kt)):a("",!0)])}const me=j(D,[["render",Qt]]);export{me as default};
