import{R as T}from"./vue-router-99ebe252.js";import{m as w}from"./modalMixin-f99c1c1a.js";import{b6 as B,aj as d,l as a,m as s,s as n,k as c,aJ as l,av as y,F as R,at as F,t as x,b1 as k,a3 as u,j as v}from"./_plugin-vue_export-helper-68081c38.js";import{_ as M}from"./image4-1806383b.js";import{_ as S}from"./icon-cart-09916409.js";import{_}from"./icon-star-c15bacb9.js";import"./_commonjsHelpers-042e6b4d.js";import"./base-component-5a126788.js";const{VITE_PATH:f}={VITE_PATH:"https://vue-final-dbjson-889xxtffg-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},m={data(){return{bookMark:{}}},mixins:[w],props:["id","pageStatus","openDeleteModal","getBookmarks"],methods:{deleteBookmark(r){let o=`${f}/600/recipeBookmarks/${r}`;this.pageStatus==="product"&&(o=`${f}/600/productBookmarks/${r}`),this.$http.delete(o,{headers:{authorization:`Bearer ${this.token}`}}).then(i=>{console.log(i.data),this.hide(),this.pageStatus==="recipe"?this.getBookmarks(this.userId,"recipeBookmarks",this.pageStatus):this.pageStatus==="product"&&this.getBookmarks(this.userId,"productBookmarks",this.pageStatus)}).catch(i=>{console.log(i)})}},watch:{id(){if(this.id){console.log("id變了");let r=`${f}/600/recipeBookmarks/${this.id}?_expand=recipe`;this.pageStatus==="product"&&(r=`${f}/600/productBookmarks/${this.id}?_expand=product`),this.$http.get(r,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log(o.data),this.bookMark=o.data,this.show(),this.openDeleteModal("")}).catch(o=>{console.log(o)})}}},mounted(){this.userId=localStorage.getItem("userId"),this.userId=Number(this.userId),console.log(this.userId),this.token=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1")}},E={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},P={class:"modal-dialog modal-dialog-centered"},j={class:"modal-content"},C=s("div",{class:"modal-header bg-dark"},[s("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除收藏 "),s("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),D={class:"modal-body"},A={key:0},O={key:1},N={key:2,class:"text-danger fw-bold"},V={key:3,class:"text-danger fw-bold"},L={class:"modal-footer"},z=s("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function G(r,o,i,h,e,b){return d(),a("div",E,[s("div",P,[s("div",j,[C,s("div",D,[s("p",null,[n("確定要刪除"),e.bookMark.recipe?(d(),a("span",A,"食譜")):e.bookMark.product?(d(),a("span",O,"產品")):c("",!0),n("收藏 "),e.bookMark.recipe?(d(),a("span",N," 【"+l(e.bookMark.recipe.title)+"】 ",1)):e.bookMark.product?(d(),a("span",V," 【"+l(e.bookMark.product.title)+"】 ",1)):c("",!0),n(" 嗎? ")])]),s("div",L,[z,s("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=()=>b.deleteBookmark(e.bookMark.id))},"確認刪除")])])])],512)}const H=B(m,[["render",G]]);const{VITE_PATH:p}={VITE_PATH:"https://vue-final-dbjson-889xxtffg-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},U={components:{RouterLink:T,DeleteBookmarksModal:H},data(){return{userId:"",token:"",bookMarks:[],pageStatus:"recipe",deleteId:"",AllproductRates:[],averageRate:[],rates:{},products:[],recipeThumbs:[],thumbs:{},myThumbs:[],myThumbObj:{},recipes:[]}},methods:{getBookmarks(r,o,i){const h=`${p}/600/users/${r}/${o}?_expand=${i}`;this.$http.get(h,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{console.log(e.data),this.bookMarks=e.data}).catch(e=>{console.log(e),alert("驗證過期，請重新登入"),this.$router.push("/loginSignup/login")})},addBookmark(r){let o=`${p}/600/users/${this.userId}/recipeBookmarks?_expand=recipe`,i={userId:this.userId,recipeId:r};this.pageStatus==="product"&&(o=`${p}/600/users/${this.userId}/productBookmarks?_expand=product`,i={userId:this.userId,productId:r}),this.$http.post(o,i,{headers:{authorization:`Bearer ${this.token}`}}).then(h=>{console.log(h.data),this.pageStatus==="recipe"?this.getBookmarks(this.userId,"recipeBookmarks",this.pageStatus):this.pageStatus==="product"&&this.getBookmarks(this.userId,"productBookmarks",this.pageStatus)}).catch(h=>{console.log(h)})},openDeleteModal(r){this.deleteId=r},getAllProductRates(){this.$http.get(`${p}/productRates?_expand=product`).then(r=>{console.log("所有產品評價",r.data),this.AllproductRates=r.data,this.AllproductRates.forEach(o=>{this.rates[o.product.id]===void 0?this.rates[o.product.id]={totalRates:o.score,people:1,averageRate:o.score/1,product:o.product}:(this.rates[o.product.id].totalRates+=o.score,this.rates[o.product.id].people+=1,this.rates[o.product.id].averageRate=Number((this.rates[o.product.id].totalRates/this.rates[o.product.id].people).toFixed(1)))}),this.products.forEach(o=>{Object.keys(this.rates).forEach(i=>{this.rates[o.id]===void 0&&(this.rates[o.id]={totalRates:0,people:0,averageRate:0,product:o})})}),console.log("所有評價分類",this.rates)}).catch(r=>{console.log(r)})},getProducts(){let r=`${p}/products`;this.pageStatus==="食材組合包"?r=`${p}/products?category=組合包`:this.pageStatus==="熱銷單品"?r=`${p}/products?category=單一產品`:this.pageStatus==="特價商品"&&(r=`${p}/products?isCheaper=true`),this.$http.get(`${r}`).then(o=>{console.log("產品",o.data),this.products=o.data}).catch(o=>{console.log(o)})},getAllRecipeThumbs(){const r=`${p}/recipeThumbs?_expand=recipe`;this.$http.get(r).then(o=>{console.log("所有食譜讚",o.data),this.recipeThumbs=o.data,this.recipeThumbs.forEach(i=>{this.thumbs[i.recipe.id]===void 0?this.thumbs[i.recipe.id]={people:1,recipe:i.recipe}:this.thumbs[i.recipe.id].people+=1}),this.getRecipes(),this.recipes.forEach(i=>{Object.keys(this.thumbs).forEach(h=>{this.thumbs[i.id]===void 0&&(this.thumbs[i.id]={people:0,recipe:i})})}),console.log("分類好的讚",this.thumbs)}).catch(o=>{console.log(o)})},getMyThumb(){const r=`${p}/600/users/${this.userId}/recipeThumbs`;this.$http.get(r,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("我按了哪些食譜讚?",o.data),this.myThumbs=o.data,this.myThumbs.forEach(i=>{this.myThumbObj[i.recipeId]===void 0&&(this.myThumbObj[i.recipeId]={thumb:!0})}),console.log("我讚過的食譜",this.myThumbObj)}).catch(o=>{console.log(o)})},getRecipes(){this.$http.get(`${p}/recipes`).then(r=>{console.log(r.data),this.recipes=r.data}).catch(r=>{console.log(r)})}},mounted(){this.userId=localStorage.getItem("userId"),this.userId=Number(this.userId),console.log(this.userId),this.token=document.cookie.replace(/(?:(?:^|.*;\s*)myToken\s*=\s*([^;]*).*$)|^.*$/,"$1"),this.getBookmarks(this.userId,"recipeBookmarks",this.pageStatus),this.getProducts(),this.getAllProductRates(),this.getAllRecipeThumbs(),this.getMyThumb()},watch:{pageStatus(){console.log(this.pageStatus,"有變化"),this.pageStatus==="product"?this.getBookmarks(this.userId,"productBookmarks",this.pageStatus):this.pageStatus==="recipe"&&this.getBookmarks(this.userId,"recipeBookmarks",this.pageStatus)}}},J={class:"py-100-sm-40"},q={class:""},K={class:"nav nav-tabs container",id:"myTab",role:"tablist"},Q=s("button",{class:"nav-link active",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true"},[s("i",{class:"bi bi-book-half"}),n(" 食譜收藏")],-1),W=[Q],X=s("button",{class:"nav-link",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false"},[s("i",{class:"bi bi-bag-check-fill"}),n(" 產品收藏")],-1),Y=[X],Z=s("button",{class:"nav-link",id:"popularProducts-tab","data-bs-toggle":"tab","data-bs-target":"#popularProducts",type:"button",role:"tab","aria-controls":"popularProducts","aria-selected":"false"},[s("i",{class:"bi bi-file-post"}),n(" 文章收藏")],-1),$=[Z],tt={class:"tab-content container",id:"myTabContent"},et={class:"tab-pane fade show active py-4",id:"home",role:"tabpanel","aria-labelledby":"home-tab"},ot={class:"row row-cols-lg-4 row-cols-1 gy-4"},st=["to"],rt={class:"card position-relative border-0 bg-transparent",style:{"border-radius":"20px"}},dt=["src"],at={class:"card-text"},it=["onClick"],ct=s("img",{src:M},null,-1),lt=[ct],pt={key:0,style:{"pointer-events":"none"},class:"badge rounded-pill bg-brown mt-4 border-0 me-3 position-absolute top-50 end-0"},ut={key:0,class:"h5 d-flex justify-content-between fw-bold"},nt={key:1,class:"col-12 d-flex justify-content-end"},ht={class:"mt-1"},bt={key:2,class:"d-flex align-items-center justify-content-end"},_t={key:0,class:"mb-0 ms-3"},gt={key:1,type:"button",class:"border-0 bg-transparent text-brown fs-5"},kt=s("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),ft=[kt],xt={key:2,type:"button",class:"border-0 bg-transparent text-brown fs-5"},yt=s("i",{class:"bi bi-hand-thumbs-up"},null,-1),Rt=[yt],Ft={class:"tab-pane fade py-4",id:"profile",role:"tabpanel","aria-labelledby":"profile-tab"},vt={class:"row row-cols-lg-4 row-cols-1 gy-4"},Bt={class:"card position-relative border-0 bg-transparent",style:{"border-radius":"20px"}},Mt=["src"],It={class:"card-text"},Tt=["onClick"],wt=s("img",{src:M},null,-1),St=[wt],mt={key:0,style:{"pointer-events":"none","font-size":"14px"},class:"d-flex flex-column align-items-center text-orange p-2 bg-brown border-0 me-3 position-absolute top-0 end-0"},Et={class:"mb-1"},Pt=s("button",{type:"button",class:"buyBtn border-0 bg-transparent me-3 position-absolute top-50 end-0"},[s("img",{src:S,style:{height:"48px"},alt:"",class:"rounded-circle shadow-sm"})],-1),jt={key:0,class:"h5 d-flex justify-content-between fw-bold"},Ct={key:1,class:"col"},Dt={key:0,class:"me-1"},At={key:2,class:"col-12"},Ot=s("span",{class:"me-1 text-muted"},"未有評價",-1),Nt=s("img",{src:_,class:"mb-1 me-1",width:"17",height:"17",alt:""},null,-1),Vt=s("img",{src:_,class:"mb-1 me-1",width:"17",height:"17",alt:""},null,-1),Lt=s("img",{src:_,class:"mb-1 me-1",width:"17",height:"17",alt:""},null,-1),zt=s("img",{src:_,class:"mb-1 me-1",width:"17",height:"17",alt:""},null,-1),Gt=s("img",{src:_,class:"mb-1 me-1",width:"17",height:"17",alt:""},null,-1),Ht=[Ot,Nt,Vt,Lt,zt,Gt],Ut={class:"d-flex justify-content-end"},Jt={key:1,class:"mt-1"},qt=s("div",{class:"tab-pane fade py-4",id:"popularProducts",role:"tabpanel","aria-labelledby":"contact-tab"},"熱銷單品：單個商品 不是一組的",-1);function Kt(r,o,i,h,e,b){const g=y("RouterLink"),I=y("DeleteBookmarksModal");return d(),a("div",J,[s("section",q,[s("ul",K,[s("li",{class:"nav-item",role:"presentation",onClick:o[0]||(o[0]=()=>e.pageStatus="recipe")},W),s("li",{class:"nav-item",role:"presentation",onClick:o[1]||(o[1]=()=>e.pageStatus="product")},Y),s("li",{class:"nav-item",role:"presentation",onClick:o[2]||(o[2]=()=>e.pageStatus="article")},$)])]),s("div",tt,[s("div",et,[s("div",ot,[(d(!0),a(R,null,F(e.bookMarks,t=>(d(),a("div",{to:`/recipes/${t.recipeId}`,class:"col text-decoration-none",key:t.id},[s("div",rt,[x(g,{to:`/recipes/${t.recipeId}`},{default:k(()=>[t.recipe?(d(),a("img",{key:0,src:t.recipe.image,class:"card-img",height:"220",style:{"border-radius":"20px","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,dt)):c("",!0)]),_:2},1032,["to"]),s("h5",at,[s("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent me-auto top-0 m-3",onClick:()=>b.openDeleteModal(t.id)},lt,8,it),t.recipe?(d(),a("span",pt,l(t.recipe.category),1)):c("",!0)]),x(g,{to:`/recipes/${t.recipeId}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:k(()=>[t.recipe?(d(),a("h5",ut,l(t.recipe.title),1)):c("",!0),t.recipe?(d(),a("div",nt,[s("del",{class:u(["me-2 text-muted mt-1",{"d-none":t.recipe.price===t.recipe.total}])},"NT$ "+l(t.recipe.total),3),s("span",ht,[s("span",{class:u({"text-danger":t.recipe.price!==t.recipe.total,"fw-bold":t.recipe.price!==t.recipe.total})},"NT$ "+l(t.recipe.price),3),n(" / "+l(t.recipe.content),1)])])):c("",!0),t.recipe?(d(),a("div",bt,[e.thumbs[t.recipe.id]?(d(),a("span",_t,l(e.thumbs[t.recipe.id].people),1)):c("",!0),e.myThumbObj[t.recipe.id]?(d(),a("button",gt,ft)):e.myThumbObj[t.recipe.id]?c("",!0):(d(),a("button",xt,Rt))])):c("",!0)]),_:2},1032,["to"])])],8,st))),128))])]),s("div",Ft,[s("div",vt,[(d(!0),a(R,null,F(e.bookMarks,t=>(d(),a("div",{class:"col text-decoration-none",key:t.id},[s("div",Bt,[t.product?(d(),v(g,{key:0,to:`/products/${t.product.id}`},{default:k(()=>[t.product?(d(),a("img",{key:0,src:t.product.imgUrl,class:"card-img",height:"220",style:{"border-radius":"20px","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Mt)):c("",!0)]),_:2},1032,["to"])):c("",!0),s("h5",It,[s("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent me-auto top-0 m-3",onClick:()=>b.openDeleteModal(t.id)},St,8,Tt),t.product&&t.product.isCheaper?(d(),a("span",mt,[s("p",Et,l((100-((t.product.originalPrice-t.product.price)/t.product.originalPrice*100).toFixed(0))%10===0?(100-((t.product.originalPrice-t.product.price)/t.product.originalPrice*100).toFixed(0)).toString().charAt(0):100-((t.product.originalPrice-t.product.price)/t.product.originalPrice*100).toFixed(0)),1),n("折")])):c("",!0),Pt]),t.product?(d(),v(g,{key:1,to:`/products/${t.product.id}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:k(()=>[t.product?(d(),a("h5",jt,l(t.product.title),1)):c("",!0),e.rates[t.product.id]&&e.rates[t.product.id].totalRates!==0?(d(),a("div",Ct,[e.rates[t.product.id]?(d(),a("span",Dt,l((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)%1===0?e.rates[t.product.id].totalRates/e.rates[t.product.id].people:(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)),1)):c("",!0),e.rates[t.product.id]?(d(),a("i",{key:1,class:u(["bi bi-star-fill me-1",{"bi-star-half":Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))===0&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=0,"text-orange":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)>1||Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))==0&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=0||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==1,"text-lightGray":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)<1&&Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))<0||!(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==0}])},null,2)):c("",!0),e.rates[t.product.id]?(d(),a("i",{key:2,class:u(["bi bi-star-fill me-1",{"bi-star-half":Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))===1&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=1,"text-orange":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)>2||Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))==1&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=1||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==2,"text-lightGray":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)<2&&Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))<1||!(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==1}])},null,2)):c("",!0),e.rates[t.product.id]?(d(),a("i",{key:3,class:u(["bi bi-star-fill me-1",{"bi-star-half":Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))===2&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=2,"text-orange":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)>3||Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))==2&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=2||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==3,"text-lightGray":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)<3&&Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))<2||!(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==2}])},null,2)):c("",!0),e.rates[t.product.id]?(d(),a("i",{key:4,class:u(["bi bi-star-fill me-1",{"bi-star-half":Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))===3&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=3,"text-orange":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)>4||Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))==3&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=3||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==4,"text-lightGray":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)<4&&Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))<3||!(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==3}])},null,2)):c("",!0),e.rates[t.product.id]?(d(),a("i",{key:5,class:u(["bi bi-star-fill me-1",{"bi-star-half":Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))===4&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=4,"text-orange":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)>5||Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))==4&&(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)!=4||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==5,"text-lightGray":(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)<5&&Math.floor((e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1))<4||!(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)||(e.rates[t.product.id].totalRates/e.rates[t.product.id].people).toFixed(1)==4}])},null,2)):c("",!0)])):e.rates[t.product.id]&&e.rates[t.product.id].totalRates===0?(d(),a("div",At,Ht)):c("",!0),s("div",Ut,[t.product?(d(),a("del",{key:0,class:u(["me-2 text-muted mt-1",{"d-none":!t.product.isCheaper}])},"NT$ "+l(t.product.originalPrice),3)):c("",!0),t.product?(d(),a("span",Jt,[s("span",{class:u({"text-danger":t.product.isCheaper,"fw-bold":t.product.isCheaper})},"NT$ "+l(t.product.price),3),n(" / "+l(t.product.num)+l(t.product.unit),1)])):c("",!0)])]),_:2},1032,["to"])):c("",!0)])]))),128))])]),qt]),x(I,{"get-bookmarks":b.getBookmarks,id:e.deleteId,"page-status":e.pageStatus,"open-delete-modal":b.openDeleteModal},null,8,["get-bookmarks","id","page-status","open-delete-modal"])])}const oe=B(U,[["render",Kt]]);export{oe as default};
