import{m as f,b as w}from"./axios-199d4453.js";import{c as y}from"./carts-07168e92.js";import{b6 as x,l as i,m as t,F as p,at as g,av as v,aj as l,aJ as c,t as k,b1 as z,s as b,a3 as R,k as _,r as N}from"./_plugin-vue_export-helper-31c7975b.js";import"./vue-router-495964e8.js";import"./_commonjsHelpers-042e6b4d.js";const{VITE_PATH:d}={VITE_PATH:"https://vue-final-dbjson-hywq4ete1-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},P={data(){return{coupons:[],lotteries:[],lotteryResult:[],drewArr:[],drewProducts:[],user:{},getPrizePersonNum:0,ticketNum:0}},methods:{...f(y,["checkLogin","toastMessage"]),getCoupons(){this.$http.get(`${d}/coupons`).then(e=>{console.log("優惠券資訊",e.data),this.coupons=e.data}).catch(e=>{console.log(e)})},getLotteries(){this.$http.get(`${d}/lotteries?_expand=recipe`).then(e=>{console.log("抽獎資訊",e.data),this.lotteries=e.data,this.drewProducts=this.lotteries[0].recipe.relativeProducts.filter(a=>a.category==="單一產品")}).catch(e=>{console.log(e)})},getLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}/lotteryResults`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{console.log("個人抽獎結果",e.data),this.lotteryResult=e.data,this.lotteryResult.length&&(this.drewArr=this.lotteryResult[0].drewArr),console.log(this.lotteryResult[0].drewArr.length===this.drewProducts.length,"長度一至嗎?")}).catch(e=>{console.log(e)})},getUserInfo(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{this.user=e.data,console.log("使用者資料，抽獎券",e.data)}).catch(e=>{console.log(e)})},addtLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{if(console.log("使用者資料",e.data),this.user=e.data,console.log(this.user.lotteryTicket,"張數"),this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2000</b> 即可獲得一張抽獎券</p><a href="/finalEasyMakeEasyBuy/#/products" class="link-orange">前往選購商品</a>',showConfirmButton:!0});return}this.ticketNum=this.user.lotteryTicket;const a={lotteryTicket:this.user.lotteryTicket-1};return this.$http.patch(`${d}/600/users/${this.userId}`,a,{headers:{authorization:`Bearer ${this.token}`}})}).then(e=>(console.log(e,"扣掉了抽獎券"),this.getUserInfo(),this.$http.get(`${d}/lotteries?_expand=recipe`))).then(e=>{if(console.log(this.ticketNum,"更新前的張數",this.user.lotteryTicket,"更新後的張數"),this.ticketNum===0)return;this.ticketNum-=1,console.log("抽獎資訊",e.data),this.lotteries=e.data;const a=Math.floor(Math.random()*this.drewProducts.length),m=this.drewArr.filter(h=>h.title===this.drewProducts[a].title);if(m.length){this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80">',customClass:{icon:"no-border"},showConfirmButton:!1});return}else m.length||(console.log(this.drewProducts[a].imgUrl,"網址"),this.drewArr.push(this.drewProducts[a]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[a].title}`,iconHtml:`<img src="${this.drewProducts[a].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1}));console.log("抽中的數字 1 ~ 7",a,this.drewArr);let u=`${d}/600/lotteryResults`,s="post",n={userId:this.userId,drewArr:this.drewArr};if(this.lotteryResult.length&&this.drewArr.length!==this.drewProducts.length)u=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,s="patch",n={drewArr:this.drewArr};else if(this.lotteryResult.length&&this.drewArr.length===this.drewProducts.length){this.$http.get(`${d}/lotteryResults`).then(h=>{console.log(h),this.getPrizePersonNum=h.data.filter(o=>o.getPrize===!0),console.log(this.getPrizePersonNum.length,"組合成功食譜人數"),u=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,s="patch",n={drewArr:this.drewArr,getPrize:!0,prizeNum:this.getPrizePersonNum.length+1},this.$swal({title:`恭喜您完成食譜，獲得${n.prizeNum===1?this.lotteries[0].prizes[0].title:n.prizeNum===2||n.prizeNum===3?this.lotteries[0].prizes[1].title:this.lotteries[0].prizes[2].title}`,iconHtml:`<img src="${n.prizeNum===1?this.lotteries[0].prizes[0].img:n.prizeNum===2||n.prizeNum===3?this.lotteries[0].prizes[1].img:this.lotteries[0].prizes[2].img}" width="100">`,customClass:{icon:"no-border"}}),console.log(u,s,n),this.$http[s](u,n,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("開始抽獎",o.data),this.getLotteryResult()}).catch(o=>{console.log(o)})});return}this.$http[s](u,n,{headers:{authorization:`Bearer ${this.token}`}}).then(h=>{console.log("開始抽獎",h.data),this.getLotteryResult(),console.log("有執行")}).catch(h=>{console.log(h)})}).catch(e=>{console.log(e),this.token||this.$swal({icon:"error",title:"登入即可抽獎",showConfirmButton:!1,timer:1500})})}},mounted(){this.checkLogin(),this.getUserInfo(),this.getCoupons(),this.getLotteries(),this.getLotteryResult()},computed:{...w(y,["token","userId","nickName"])}},A={class:"container my-10"},$=t("ul",{class:"nav nav-tabs",id:"myTab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true"},"優惠折扣")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false"},"抽獎回饋")])],-1),B={class:"tab-content",id:"myTabContent"},T={class:"tab-pane fade show active text-brown",id:"home",role:"tabpanel","aria-labelledby":"home-tab"},L={class:"row row-cols-lg-4 g-4 py-3 text-darkBrown"},C={class:"card"},E=["src"],j={class:"card-body"},D={class:"card-title h3"},I={class:"card-text text-truncate"},M={class:"d-flex"},S={class:"tab-pane fade",id:"profile",role:"tabpanel","aria-labelledby":"profile-tab"},V={class:""},H={key:0,class:"col-lg-6 align-self-center"},U=t("p",{class:"mb-0"},"本月指定抽獎食譜：",-1),F={class:"text-center mb-4 fw-bold"},O={class:"row pt-4 border"},q=["src"],G={key:0,class:"position-absolute bg-notObtained d-flex"},J=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),W=[J],Y={class:"d-flex"},K=t("p",{class:"text-end"},"抽一次消耗一張抽獎券",-1),Q={key:1,class:"d-flex flex-column align-items-center"},X=t("h5",{class:"h3 text-center text-orange"},"恭喜您完成食譜，獲得：",-1),Z={class:"col-6"},tt={class:"card position-relative border-0",style:{"border-radius":"20px"}},et={class:"card-header h4 fw-bold text-center mb-3 bg-white border-0"},st=["src"],ot=["src"],rt=["src"],it={class:"card-footer bg-transparent border-0"},lt={class:"fw-bold"},ct={class:"text-end"},nt=t("p",null,[b("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到@EasyMakeEasyBuy.gmail.com，感謝您的支持!"),t("br"),b("下期好禮更精彩，千萬別錯過!")],-1),at={class:"my-5"},dt=N('<div><h2 class="display-6 fw-bold mb-4"><div class="d-flex align-items-center"><div class="d-lg-block d-none me-4 rounded-circle text-center pt-2 position-relative" style="background-color:#FAE8D0;width:64px;height:64px;vertical-align:middle;font-size:45px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:25px;height:5px;top:42px;right:20px;"></div></div><div class="d-lg-none me-2 rounded-circle text-center pt-1 position-relative" style="background-color:#FAE8D0;width:36px;height:36px;font-size:24px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:12px;height:3px;top:21px;right:12px;"></div></div><span class="recipeTitle">月獎品一覽</span></div></h2></div>',1),ht={class:"d-flex align-items-center justify-content-center"},ut={class:"row row-cols-lg-4 row-cols-1 gy-4 container justify-content-center"},pt={class:"card position-relative border-0",style:{"border-radius":"20px"}},gt={class:"card-header border-0 h4 fw-bold text-center mb-3 bg-white"},mt=["src"],_t={class:"card-footer bg-transparent border-0"},bt={class:"fw-bold"},yt={class:"text-end"},ft=t("h5",null,"規則：",-1);function wt(e,a,m,u,s,n){const h=v("RouterLink");return l(),i("div",A,[$,t("div",B,[t("div",T,[t("div",L,[(l(!0),i(p,null,g(s.coupons,o=>(l(),i("div",{class:"col",key:o.id+3467},[t("div",C,[t("img",{src:o.img,class:"card-img-top",alt:"...",height:"200",style:{"object-fit":"cover"}},null,8,E),t("div",j,[t("h5",D,c(o.title),1),t("p",I,c(o.description),1),t("div",M,[k(h,{to:`/discounts/${o.id}`,href:"#",class:"btn btn-brown ms-auto"},{default:z(()=>[b("查看完整優惠資訊")]),_:2},1032,["to"])])])])]))),128))])]),t("div",S,[(l(!0),i(p,null,g(s.lotteries,o=>(l(),i("div",{class:"py-3 text-darkBrown d-flex flex-column",key:o.id+9590},[t("p",V,"活動時間："+c(new Date(o.startDate).toLocaleString().split(" ")[0])+" ~ "+c(new Date(o.dueDate).toLocaleString().split(" ")[0]),1),t("p",{class:R({"text-danger":s.user.lotteryTicket===0})},"剩餘抽獎券："+c(s.user.lotteryTicket),3),!s.lotteryResult[0]||s.lotteryResult[0].drewArr.length!==s.drewProducts.length?(l(),i("div",H,[U,t("h5",F,c(o.recipe.title),1),t("div",O,[(l(!0),i(p,null,g(o.recipe.relativeProducts,r=>(l(),i("div",{class:"col-3 d-flex flex-column align-items-center position-relative",key:r.id+95900},[r.category==="單一產品"?(l(),i(p,{key:0},[t("img",{src:r.imgUrl,alt:"",height:"100",width:"100",style:{"object-fit":"cover"}},null,8,q),t("p",null,c(r.title),1),JSON.stringify(this.drewArr).includes(r.title)?_("",!0):(l(),i("div",G,W))],64)):_("",!0)]))),128))]),t("div",Y,[t("button",{type:"button",class:"mx-auto mt-3 btn btn-brown",onClick:a[0]||(a[0]=(...r)=>n.addtLotteryResult&&n.addtLotteryResult(...r))},"立即抽獎")]),K])):s.lotteryResult[0]&&s.lotteryResult[0].drewArr.length===s.drewProducts.length?(l(),i("div",Q,[X,t("div",Z,[t("div",tt,[t("div",et,c(s.lotteryResult[0].prizeNum===1?"大獎":s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?"二獎":"三獎"),1),s.lotteryResult[0].prizeNum===1?(l(),i("img",{key:0,src:o.prizes[0].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,st)):s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?(l(),i("img",{key:1,src:o.prizes[1].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,ot)):(l(),i("img",{key:2,src:o.prizes[2].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,rt)),t("div",it,[t("h5",lt,c(s.lotteryResult[0].prizeNum===1?o.prizes[0].title:s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?o.prizes[1].title:o.prizes[2].title),1),t("p",ct,"價值：NT$ "+c(s.lotteryResult[0].prizeNum===1?o.prizes[0].price:s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?o.prizes[1].price:o.prizes[2].price),1)])]),nt])])):_("",!0),t("section",at,[dt,t("div",ht,[t("div",ut,[(l(!0),i(p,null,g(o.prizes,r=>(l(),i("div",{class:"col",key:r},[t("div",pt,[t("div",gt,c(r.id===1?"大獎":r.id===2?"二獎":"三獎")+" / "+c(r.people),1),t("img",{src:r.img,class:"card-img border",style:{"border-radius":"20px",width:"300px",height:"220px","object-fit":"cover"},alt:""},null,8,mt),t("div",_t,[t("h5",bt,c(r.title),1),t("p",yt,"價值：NT$ "+c(r.price),1)])])]))),128))])])]),ft,t("ol",null,[(l(!0),i(p,null,g(o.rules,r=>(l(),i("li",{key:r+20},c(r),1))),128))])]))),128))])])])}const Nt=x(P,[["render",wt]]);export{Nt as default};
