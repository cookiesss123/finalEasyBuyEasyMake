import{m as A}from"./index-6af516ba.js";import{c as B}from"./carts-32b42ff3.js";import{P as T}from"./PaginationComponent-828e246b.js";import{n as D}from"./numberCommaMixin-e0aac39c.js";import{o as I,u as _,r as b,a as y,f as j,d as h,b as N}from"./db-143b9a4b.js";import{L as V}from"./index-fde5e204.js";import{w as g,v as C}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as F}from"./loadingLogo-ea15f612.js";import{_ as H,a7 as r,c as P,a9 as x,ab as a,a8 as e,ad as c,af as o,ac as M,N as E,ae as S,F as L,aa as p,ag as R,r as k,o as l}from"./_plugin-vue_export-helper-d28549df.js";import"./vue-router-46224dd8.js";import"./_commonjsHelpers-042e6b4d.js";const q="/finalEasyBuyEasyMake/assets/undraw_No_data_re_kwbl-fe986f09.png";const G={components:{PaginationComponent:T,Loading:V},mixins:[D],data(){return{user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",nickName:"",pageOrders:[],isLoading:!1,fullPage:!0}},methods:{...A(B,["toastMessage"]),getUserInformation(){I(y,n=>{if(n){this.uid=n.uid;const s=b(h,"users/"+n.uid);N(s,m=>{this.user=m.val(),this.isLoading=!1})}else this.uid=null,this.user={},this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/loginSignup")})},getOrders(){I(y,n=>{if(n){this.uid=n.uid;const s=b(h,`orders/${this.uid}`);N(s,m=>{const f=m.val();f&&(this.orders=Object.entries(f).map(t=>(t[1].id=t[0],t[1])),this.filterOrders=this.orders,this.orderArrived=this.orders.filter(t=>t.deliveryStatus==="待取貨"),this.filterOrders&&this.$route.fullPath==="/member"&&this.$refs.pagination.renderPage(1,this.filterOrders))})}else this.uid=null,this.user={},this.uid||(this.toastMessage("請先登入","error"),this.$router.push("/loginSignup"))})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}_(b(h),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const n=y.currentUser;j(n,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/loginSignup")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:n}=await this.$swal({title:"選擇圖片",input:"file",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(n){const s=new FileReader;s.onload=m=>{this.$swal({title:"圖片上傳成功!",imageUrl:m.target.result,imageAlt:"The uploaded picture",imageHeight:300}),_(b(h),{[`users/${this.uid}/headshotImg/`]:m.target.result})},s.readAsDataURL(n)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:n}=await this.$swal({title:"選擇圖片",input:"text",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});n?(this.$swal({title:"圖片上傳成功",imageUrl:n,imageHeight:300,imageAlt:"Custom image"}),_(b(h),{[`users/${this.uid}/headshotImg/`]:n})):this.toastMessage("請勿輸入空值","error")}},mounted(){this.isLoading=!0,this.getUserInformation(),this.getOrders()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(n=>n.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},Y={class:"no-scroll-x","data-aos":"fade-up"},z=e("div",{class:"d-flex flex-column align-items-center py-96"},[e("img",{src:F,class:"loadingLogo mb-3",style:{width:"150px"},alt:""}),e("p",{class:"text-center fw-bold text-primary h2"},[e("span",{class:"me-1 animate-text"},"L"),e("span",{class:"mx-1 animate-text"},"o"),e("span",{class:"mx-1 animate-text"},"a"),e("span",{class:"mx-1 animate-text"},"d"),e("span",{class:"mx-1 animate-text"},"i"),e("span",{class:"mx-1 animate-text"},"n"),e("span",{class:"mx-1 animate-text"},"g"),e("span",{class:"mx-2 animate-text"},"."),e("span",{class:"me-2 animate-text"},"."),e("span",{class:"animate-text"},".")])],-1),W=e("section",{class:"text-center"},[e("div",{class:"py-lg-200 py-96 bg-img-fixed",style:{"background-image":"url('https://images.unsplash.com/photo-1678465952850-0eb0bb982835?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80')"}}),e("h2",{class:"text-primary mb-0 fs-lg-1 fs-5 letter-spacing-20 fw-bold bg-secondary-lightPurple py-2"},"會員資料")],-1),X={class:"container"},J={class:"row row-cols-1 row-cols-lg-2 g-5 py-lg-96 py-5"},K={class:"col-lg-4"},Q={class:"card"},Z={key:0,class:"border border-2 border-primary"},$=e("i",{class:"bi bi-person-fill m-auto text-primary fs-200"},null,-1),ee=[$],te=["src"],se={class:"card-body bg-secondary d-flex justify-content-between"},ie={class:"list-group list-group-flush"},le={class:"list-group-item"},oe={class:"row"},re=e("div",{class:"col-4"},[e("label",{for:"nickName",class:"form-label fw-bold"},[e("i",{class:"bi bi-person-fill"}),p(" 暱稱")])],-1),ne={class:"col-8"},ae={class:"text-end"},ce={class:"list-group-item bg-secondary"},de={class:"row"},me=e("div",{class:"col-4"},[e("label",{for:"email",class:"form-label fw-bold mb-0"},[e("i",{class:"bi bi-envelope-fill"}),p(" 信箱")])],-1),ue={class:"col-8"},pe={class:"list-group-item"},be=R('<div class="row"><div class="col-4"><label for="password" class="form-label fw-bold"><i class="bi bi-lock-fill"></i> 密碼</label></div><div class="col-8"><span>* * * * * * * *</span></div></div>',1),he={class:"text-end"},ge={class:"list-group-item d-flex justify-content-between bg-secondary"},fe=e("label",{for:"ticket",class:"form-label mb-0 fw-bold"},[e("i",{class:"bi bi-ticket-perforated-fill"}),p(" 我的抽獎券")],-1),we={class:"col-lg-8 d-flex flex-column"},_e=e("h3",{class:"d-flex align-items-center mb-4 fw-bold text-purple border-bottom pb-1 border-purple"},[e("span",{class:"material-icons me-2"}," auto_awesome "),p(" 訂單狀況 ")],-1),ye={class:"selectOrderStatus d-flex justify-content-between justify-content-lg-start"},xe={class:"row row-cols-1 py-3"},ke={class:"mb-3"},ve={key:0},Ie={class:"orderSelect p-3"},Ne=e("i",{class:"bi bi-clock"},null,-1),Ce={class:"row row-cols-lg-4 row-cols-2 align-items-center mt-2"},Pe={key:0,class:""},Me=["src"],Ee={class:"mb-0 mt-2 text-center"},Se={class:"subTitle me-1"},Le={class:"text-primary fw-bold"},Oe={key:1,class:"position-relative",style:{top:"-16px","background-color":"rgba(0, 0, 0, .4)"}},Ue=["src"],Ae={class:"mb-0 text-center position-absolute fs-1 text-white",style:{top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)","text-shadow":"2px 2px 2px rgb(71, 71, 71)"}},Be={class:"d-flex mt-4"},Te={class:"ms-auto d-flex align-items-center"},De={class:"me-3 fw-bold"},je={key:0,class:"bi bi-box-seam me-1"},Ve={key:1,class:"bi bi-truck me-1"},Fe={key:2,class:"bi bi-house-check me-1"},He={key:3,class:"bi bi-clipboard-check me-1"},Re={class:"text-primary fw-bold"},qe=e("i",{class:"bi bi-search text-primary"},null,-1),Ge=e("hr",null,null,-1),Ye={key:1,class:"d-flex flex-column align-items-center justify-content-center"},ze=e("img",{src:q,style:{width:"300px"},alt:""},null,-1),We=e("h3",null,"無訂單",-1),Xe=[ze,We];function Je(n,s,m,f,t,d){const O=k("loading"),v=k("RouterLink"),U=k("PaginationComponent");return l(),r("div",Y,[t.uid?(l(),P(O,{key:0,active:t.isLoading,"onUpdate:active":s[0]||(s[0]=i=>t.isLoading=i),"can-cancel":!1,"is-full-page":t.fullPage,"lock-scroll":!0},{default:x(()=>[z]),_:1},8,["active","is-full-page"])):a("",!0),W,e("div",X,[e("section",J,[e("div",K,[e("div",Q,[t.user.headshotImg?t.user.headshotImg?(l(),r("img",{key:1,src:t.user.headshotImg,class:"object-fit-cover w-100 border border-2 border-primary",style:{height:"300px"},alt:"大頭貼"},null,8,te)):a("",!0):(l(),r("div",Z,ee)),e("div",se,[e("a",{href:"#",class:"card-link fw-bold",onClick:s[1]||(s[1]=g((...i)=>d.selectImgUrl&&d.selectImgUrl(...i),["prevent"]))},"上傳圖片網址"),e("a",{href:"#",class:"card-link fw-bold",onClick:s[2]||(s[2]=g((...i)=>d.selectFile&&d.selectFile(...i),["prevent"]))},"上傳本地圖片")]),e("ul",ie,[e("li",le,[e("div",oe,[re,e("div",ne,[e("span",null,c(t.user.nickName),1)])]),e("div",ae,[t.nickNameEdit?(l(),r("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:s[3]||(s[3]=g(()=>t.nickNameEdit=!t.nickNameEdit,["prevent"]))},"修改暱稱")):a("",!0),e("div",{class:o(["input-group",{"d-none":t.nickNameEdit}])},[M(e("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":s[4]||(s[4]=i=>t.newNickName=i),style:{width:"180px"}},null,512),[[C,t.newNickName]]),e("button",{onClick:s[5]||(s[5]=()=>t.nickNameEdit=!0),class:"btn btn-outline-gray btn-sm",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[6]||(s[6]=()=>d.changeEmail()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),e("li",ce,[e("div",de,[me,e("div",ue,[e("span",null,c(t.user.email),1)])])]),e("li",pe,[be,e("div",he,[t.passwordEdit?(l(),r("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:s[7]||(s[7]=g(()=>t.passwordEdit=!t.passwordEdit,["prevent"]))},"變更密碼")):a("",!0),e("div",{class:o(["input-group",{"d-none":t.passwordEdit}])},[M(e("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":s[8]||(s[8]=i=>t.newPassword=i),style:{width:"180px"}},null,512),[[C,t.newPassword]]),e("button",{onClick:s[9]||(s[9]=()=>t.passwordEdit=!0),class:"btn btn-sm btn-outline-gray",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[10]||(s[10]=()=>d.changePassword()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),e("li",ge,[fe,e("span",null,c(t.user.lotteryTicket)+" 張",1),e("a",{href:"#",class:"link-primary fw-bold",onClick:s[11]||(s[11]=g((...i)=>d.linkToLottery&&d.linkToLottery(...i),["prevent"]))},"立即抽獎")])])])]),e("div",we,[_e,e("div",ye,[e("button",{type:"button",class:o(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="全部"}]),onClick:s[12]||(s[12]=()=>t.selectItem="全部")},[e("i",{class:o(["bi bi-border-all",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])},null,2),e("span",{class:o(["text-gray d-none d-lg-block ms-2",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])}," 全部 ",2),t.selectItem==="全部"?(l(),r("span",{key:0,class:o(["text-gray d-lg-none ms-2",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])}," 全部 ",2)):a("",!0)],2),e("button",{type:"button",class:o(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待出貨"}]),onClick:s[13]||(s[13]=()=>t.selectItem="待出貨")},[e("i",{class:o(["bi bi-box-seam",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])},null,2),e("span",{class:o(["text-gray d-none d-lg-block ms-2",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])}," 待出貨 ",2),t.selectItem==="待出貨"?(l(),r("span",{key:0,class:o(["text-gray d-lg-none ms-2",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])}," 待出貨 ",2)):a("",!0)],2),e("button",{type:"button",class:o(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="運送中"}]),onClick:s[14]||(s[14]=()=>t.selectItem="運送中")},[e("i",{class:o(["bi bi-truck",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])},null,2),e("span",{class:o(["text-gray d-none d-lg-block ms-2",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])}," 運送中 ",2),t.selectItem==="運送中"?(l(),r("span",{key:0,class:o(["text-gray d-lg-none ms-2",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])}," 運送中 ",2)):a("",!0)],2),e("button",{type:"button",class:o(["d-flex btn border-0 me-lg-5 position-relative hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待取貨"}]),onClick:s[15]||(s[15]=()=>t.selectItem="待取貨")},[e("i",{class:o(["bi bi-house-check",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])},null,2),e("span",{class:o(["text-gray d-none d-lg-block ms-2",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])}," 待取貨 ",2),t.selectItem==="待取貨"?(l(),r("span",{key:0,class:o(["text-gray d-lg-none ms-2",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])}," 待取貨 ",2)):a("",!0)],2),e("button",{type:"button",class:o(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="訂單完成"}]),onClick:s[16]||(s[16]=()=>t.selectItem="訂單完成")},[e("i",{class:o(["bi bi-clipboard-check",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])},null,2),e("span",{class:o(["text-gray d-none d-lg-block ms-2",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])}," 訂單完成 ",2),t.selectItem==="訂單完成"?(l(),r("span",{key:0,class:o(["text-gray d-lg-none ms-2",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])}," 訂單完成 ",2)):a("",!0)],2)]),e("div",xe,[e("h4",ke," 總共有 "+c(t.filterOrders.length)+" 筆 ",1),t.filterOrders.length?(l(),r("div",ve,[(l(!0),r(E,null,S(this.$refs.pagination.pageProducts,i=>(l(),P(v,{to:`/orders/${i.id}`,class:"col text-decoration-none link-dark",key:i.creatAt},{default:x(()=>[e("div",Ie,[e("span",null,[Ne,p(" "+c(new Date(i.creatAt).toLocaleDateString())+" "+c(new Date(i.creatAt).getHours())+":"+c(new Date(i.creatAt).getMinutes()),1)]),e("div",Ce,[(l(!0),r(E,null,S(i.cart.items,(u,w)=>(l(),r("div",{class:"col",key:u+6603},[w<7||i.cart.items.length===8&&w===7?(l(),r("div",Pe,[e("img",{src:u.product.imgUrl,alt:"",height:"100",class:"w-100",style:{"object-fit":"cover"}},null,8,Me),e("p",Ee,[e("span",Se,c(u.product.title.length>9?u.product.title.slice(0,8)+"...":u.product.title),1),e("span",Le,"x"+c(n.numberComma(u.qty)),1)])])):a("",!0),w===7&&i.cart.items.length!==8?(l(),r("div",Oe,[e("img",{src:u.product.imgUrl,alt:"",height:"100",class:"w-100",style:{"object-fit":"cover",opacity:".4"}},null,8,Ue),e("p",Ae,c(i.cart.items.length-7)+" + ",1)])):a("",!0)]))),128))]),e("div",Be,[e("div",Te,[e("span",De,[i.deliveryStatus==="待出貨"?(l(),r("i",je)):a("",!0),i.deliveryStatus==="運送中"?(l(),r("i",Ve)):a("",!0),i.deliveryStatus==="待取貨"?(l(),r("i",Fe)):a("",!0),i.deliveryStatus==="訂單完成"?(l(),r("i",He)):a("",!0),p(c(i.deliveryStatus),1)]),e("span",Re,"NT$ "+c(n.numberComma(i.cart.finalTotal)),1),L(v,{to:`/orders/${i.id}`,class:"ms-3"},{default:x(()=>[qe]),_:2},1032,["to"])])])]),Ge]),_:2},1032,["to"]))),128))])):t.filterOrders.length?a("",!0):(l(),r("div",Ye,Xe))]),L(U,{ref:"pagination","filter-orders":t.filterOrders,class:"mt-auto"},null,8,["filter-orders"])])])])])}const nt=H(G,[["render",Je]]);export{nt as default};
