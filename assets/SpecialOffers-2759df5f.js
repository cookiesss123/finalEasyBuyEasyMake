import{m as M}from"./index-399fd004.js";import{r as g,b,o as C,u as y,d as f,s as E,c as R,a as z}from"./carts-ee6b7a03.js";import{n as j}from"./numberCommaMixin-e0aac39c.js";import{L as D}from"./index-e07660aa.js";import{w as x}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as T}from"./loadingLogo-ea15f612.js";import{_ as S,a as H}from"./discount3-e2e49eb3.js";import{_ as O}from"./icon-speaker-fd89918c.js";import{_ as V,a7 as i,F as k,a9 as P,a8 as t,af as u,ab as m,N as _,ae as w,aa as p,ad as n,ag as q,r as A,o}from"./_plugin-vue_export-helper-d28549df.js";const G="/finalEasyBuyEasyMake/assets/giftBox1-5e717a45.png",I="/finalEasyBuyEasyMake/assets/giftBox3-08045f41.png",U="/finalEasyBuyEasyMake/assets/title4-ab3fed47.png",F={mixins:[j],data(){return{coupons:{},lottery:{},lotteryResult:{},drewProducts:[],drewArr:[],user:{},uid:"",getPrize:{},tabName:"優惠折扣",articles:[],isLoading:!1,fullPage:!0,couponIds:[]}},components:{Loading:D},methods:{...M(R,["checkLogin","toastMessage","goToTop"]),getCoupons(){const l=g(f,"coupons/");b(l,c=>{this.coupons=c.val(),Object.values(this.coupons).forEach((d,r)=>{d.id=Object.keys(this.coupons)[r]}),this.coupons=Object.values(this.coupons).filter(d=>d.isEnabled),this.isLoading=!1})},getLottery(){const l=g(f,"lotteries/");b(l,c=>{let d=c.val();d=Object.entries(d).map(r=>(r[1].id=r[0],r[1])),this.lottery=Object.values(d).filter(r=>r.isEnabled===!0),this.lottery=this.lottery[0],this.lottery.recipes.forEach(r=>{this.drewProducts[r.title]||(this.drewProducts[r.title]=[]),r.relativeProducts.forEach(s=>{s.category!=="組合包"&&(s.recipeName=`抽獎食譜${r.title}`,this.drewProducts[r.title].push(s))})}),this.drewProducts=Object.entries(this.drewProducts)})},getLotteryResult(){C(z,l=>{if(l){this.uid=l.uid;const c=g(f,"users/"+l.uid);b(c,d=>{this.user=d.val();const r=g(f,`lotteryResults/${this.uid}`);b(r,s=>{this.lotteryResult=s.val(),this.lotteryResult?(this.drewArr=this.lotteryResult.drewArr,this.getPrize=this.lotteryResult.getPrize):(this.drewArr=[],this.getPrize={})})})}else this.uid=null,this.user={},this.drewArr=[],this.getPrize={}})},addtLotteryResult(){if(!this.uid){this.toastMessage("登入即可抽獎","error");return}if(this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2,000</b> 即可獲得一張抽獎券</p><p>單筆金額滿  <b>NT$5,000</b> 即可獲得三張抽獎券</p><p>單筆金額滿  <b>NT$10,000</b> 即可獲得七張抽獎券</p><a href="/finalEasyBuyEasyMake/#/products" class="link-primary">前往選購商品</a>',showConfirmButton:!0,confirmButtonColor:"#4572c2",confirmButtonText:"確定"});return}y(g(f),{[`users/${this.uid}/lotteryTicket/`]:this.user.lotteryTicket-1});const l=Math.floor(Math.random()*this.drewProducts.length),c=Math.floor(Math.random()*this.drewProducts[l][1].length);if(this.drewArr.length){if(this.drewArr.length){this.drewProducts.forEach((r,s)=>{this.drewArr[s][1]||(this.drewArr[s][1]=[])});let d=!1;if(this.drewArr[l][1]&&this.drewArr[l][1].forEach(r=>{r.title===this.drewProducts[l][1][c].title&&(d=!0)}),d)this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80" alt="非常sorry">',customClass:{icon:"border-0"},showConfirmButton:!1});else if(!d){this.drewArr[l][1].push(this.drewProducts[l][1][c]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[l][1][c].title}`,iconHtml:`<img src="${this.drewProducts[l][1][c].imgUrl}" width="100">`,customClass:{icon:"border-0"},showConfirmButton:!1}),y(g(f),{[`lotteryResults/${this.uid}/drewArr/`]:this.drewArr});let r="";if(!this.drewArr[0][1]||!this.drewArr[1][1]||!this.drewArr[2][1])return;this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length&&this.drewArr[2][1].length===this.drewProducts[2][1].length?r=0:this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length?r=1:(this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length)&&(r=2),(r||r===0)&&y(g(f),{[`lotteryResults/${this.uid}/getPrize/`]:this.lottery.prizes[r]})}}}else{this.drewProducts.forEach((r,s)=>{this.drewArr[s]=[r[0],[]]}),this.drewArr[l][1].push(this.drewProducts[l][1][c]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[l][1][c].title}`,iconHtml:`<img src="${this.drewProducts[l][1][c].imgUrl}" width="100">`,customClass:{icon:"border-0"},showConfirmButton:!1});const d=g(f,`lotteryResults/${this.uid}`);E(d,{drewArr:this.drewArr,getPrize:{}})}}},mounted(){this.goToTop(),this.isLoading=!0,this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.getCoupons(),this.getLottery(),this.getLotteryResult()}},W=t("div",{class:"d-flex flex-column align-items-center py-96"},[t("img",{src:T,class:"loading-logo mb-3",alt:"logo"}),t("p",{class:"text-center fw-bold text-purple fs-md-2 fs-5"},[t("span",{class:"me-1 animate-text"},"L"),t("span",{class:"mx-1 animate-text"},"o"),t("span",{class:"mx-1 animate-text"},"a"),t("span",{class:"mx-1 animate-text"},"d"),t("span",{class:"mx-1 animate-text"},"i"),t("span",{class:"mx-1 animate-text"},"n"),t("span",{class:"mx-1 animate-text"},"g"),t("span",{class:"mx-2 animate-text"},"."),t("span",{class:"me-2 animate-text"},"."),t("span",{class:"animate-text"},".")])],-1),Y=t("section",{class:"text-center","data-aos":"fade-up"},[t("div",{class:"py-lg-200 py-96 bg-cover-center",style:{"background-image":"url('https://images.unsplash.com/photo-1678465952975-85cc1a08b2d7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1169&q=80')"}}),t("h2",{class:"bg-secondary-light-purple-horizontal text-purple mb-0 fs-lg-1 fs-5 letter-spacing-20 ps-3 fw-bold py-2"},"優惠特報")],-1),J={class:"container","data-aos":"fade-up"},K={class:"pt-lg-4 pt-3 position-relative"},Q={class:"category-selector row row-cols-2 list-unstyled border-bottom"},X={key:0,class:"discountImg1 d-block mx-auto",src:S,alt:"優惠折扣灰色圖示"},Z={key:1,class:"d-block mx-auto",src:H,alt:"優惠折扣藍色圖示"},$=t("span",{class:"fs-12 fs-md-5 d-block py-2"},"優惠折扣",-1),tt={key:0,class:"discountImg2 d-block mx-auto",src:G,alt:"抽獎回饋灰色圖示"},st={key:1,class:"d-block mx-auto",src:I,alt:"抽獎回饋藍色圖示"},et=t("span",{class:"fs-12 fs-md-5 d-block py-2"},"抽獎回饋",-1),rt={key:0,class:"list-unstyled row row-cols-lg-2 g-3 py-5 text-darkBrown"},it={class:"card card-coupon mb-3"},ot={class:"row g-0"},lt={class:"col-md-4"},ct=["src","alt"],at={class:"col-md-8"},nt={class:"card-body h-100 d-flex flex-column"},dt={class:"mb-2"},ht={class:"card-title fw-bold"},ut={class:"card-text text-truncate"},mt={class:"text-end mt-auto"},gt={key:1},ft=t("i",{class:"bi bi-clock-fill me-1"},null,-1),_t=t("i",{class:"bi bi-ticket-perforated-fill me-1"},null,-1),pt={key:1},wt=t("h4",{class:"mb-0 text-center fw-bold"},"本月指定抽獎食譜",-1),bt={class:"row row-cols-lg-3 row-cols-1 g-3 mt-lg-4 mt-1"},yt={class:"row g-0"},xt={class:"col-md-5"},vt=["src","alt"],kt={class:"col-md-7"},Pt={class:"card-body d-flex flex-column justify-content-center align-items-center h-100"},At={key:1,class:"mb-0"},Nt=["src","alt"],Lt={key:0,class:"position-absolute bg-trans-dark-8 d-flex"},Bt=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),Mt=[Bt],Ct={class:"text-center"},Et=t("p",{class:"text-end mt-3"},"抽一次消耗一張抽獎券",-1),Rt={key:2,class:"text-center mt-lg-120 mt-5"},zt={class:"fs-md-3 fs-5 text-white fw-bold bg-primary-purple py-3 mb-0 d-flex align-items-center justify-content-center letter-spacing-5-sm-0"},jt=t("span",{class:"material-icons-outlined me-md-3 me-2"}," celebration ",-1),Dt=t("span",{class:"material-icons-outlined fs-2"}," arrow_drop_down ",-1),Tt={class:"bg-secondary-light-purple px-3"},St={class:"col-lg-4 col-12 mx-auto pt-4"},Ht={class:"card bg-transparent"},Ot={class:"card-header bg-transparent"},Vt={class:"fs-4 fw-bold text-center"},qt=["src","alt"],Gt={class:"card-footer bg-transparent"},It={class:"fw-bold"},Ut={class:"text-end"},Ft=t("p",{class:"lh-lg pb-5 text-start text-md-center"},[p("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到 "),t("a",{href:"mailto:@EasyMakeEasyBuy.gmail.com"},"@EasyMakeEasyBuy.gmail.com"),p("，感謝您的支持!"),t("br"),p("下期好禮更精彩，千萬別錯過!")],-1),Wt={class:"py-96","data-aos":"fade-up"},Yt=q('<div class="d-lg-flex mb-2"><h2 class="d-flex align-items-center justify-content-center justify-content-lg-start fw-bold"><img src="'+U+'" class="me-lg-3 me-4 img-lg-64-md-36" alt="熱"><span class="fs-lg-1 fs-4 letter-spacing-20">月獎品</span></h2><span class="d-flex align-items-center justify-content-center fs-lg-6 fs-12"><img src="'+O+'" class="me-2" style="width:30px;" alt="大聲公圖示"> 超值大獎一次帶回! </span></div>',1),Jt={class:"row row-cols-lg-3 row-cols-1 gy-4 mb-4"},Kt={class:"card card-prize"},Qt={class:"card-header bg-white"},Xt={class:"fs-4 fw-bold text-center"},Zt={class:"card-body p-0 position-relative"},$t=["src","alt"],ts=t("div",{class:"question-mark position-absolute w-100 text-center top-0 img-lg-220-md-200 bg-gradient-purple"},[t("i",{class:"bi bi-question-lg mx-auto text-white fs-150"})],-1),ss={class:"card-footer bg-transparent"},es={class:"fw-bold"},rs={class:"text-end"},is=t("h3",{class:"fw-bold"},"規則：",-1);function os(l,c,d,r,s,v){const N=A("loading"),L=A("RouterLink");return o(),i("div",null,[k(N,{active:s.isLoading,"onUpdate:active":c[0]||(c[0]=e=>s.isLoading=e),"can-cancel":!1,"is-full-page":s.fullPage,"lock-scroll":!0},{default:P(()=>[W]),_:1},8,["active","is-full-page"]),Y,t("section",J,[t("div",K,[t("ul",Q,[t("li",{class:u(["col text-center",{"pointer-events-none":s.tabName==="優惠折扣"}])},[t("a",{href:"#",onClick:c[1]||(c[1]=x(()=>s.tabName="優惠折扣",["prevent"])),class:u(["text-decoration-none d-inline-block",{"fw-bold":s.tabName==="優惠折扣","link-primary":s.tabName==="優惠折扣"}])},[s.tabName!=="優惠折扣"?(o(),i("img",X)):s.tabName==="優惠折扣"?(o(),i("img",Z)):m("",!0),$],2)],2),t("li",{class:u(["col text-center",{"pointer-events-none":s.tabName==="抽獎回饋"}])},[t("a",{href:"#",onClick:c[2]||(c[2]=x(()=>s.tabName="抽獎回饋",["prevent"])),class:u(["text-decoration-none d-inline-block",{"fw-bold":s.tabName==="抽獎回饋","link-primary":s.tabName==="抽獎回饋"}])},[s.tabName!=="抽獎回饋"?(o(),i("img",tt)):s.tabName==="抽獎回饋"?(o(),i("img",st)):m("",!0),et],2)],2)]),t("div",{class:u(["blue-line bg-primary position-absolute",{"active-discount":s.tabName==="優惠折扣","active-gift":s.tabName==="抽獎回饋"}])},null,2)]),s.tabName==="優惠折扣"?(o(),i("ul",rt,[(o(!0),i(_,null,w(s.coupons,e=>(o(),i("li",{class:"col hvr-hang",key:e.id},[t("div",it,[t("div",ot,[t("div",lt,[t("img",{src:e.image,class:"w-100 object-fit-cover rounded-start",style:{height:"200px"},alt:e.title},null,8,ct)]),t("div",at,[t("div",nt,[t("p",dt,n(new Date(e.startDate).toLocaleDateString())+" - "+n(new Date(e.dueDate).toLocaleDateString()),1),t("h4",ht,n(e.title),1),t("p",ut,n(e.description),1),t("div",mt,[k(L,{to:`/discounts/${e.id}`,href:"#",class:"stretched-link btn btn-outline-primary"},{default:P(()=>[p("查看完整優惠資訊")]),_:2},1032,["to"])])])])])])]))),128))])):s.tabName==="抽獎回饋"?(o(),i("div",gt,[t("p",null,[ft,p("活動時間："+n(new Date(s.lottery.startDate).toLocaleDateString().split(" ")[0])+" ~ "+n(new Date(s.lottery.dueDate).toLocaleString().split(" ")[0]),1)]),s.uid?(o(),i("p",{key:0,class:u({"text-danger":s.user.lotteryTicket===0})},[_t,p("剩餘抽獎券："+n(s.user.lotteryTicket)+" 張",1)],2)):m("",!0),!s.getPrize||s.getPrize&&s.getPrize.id!==1?(o(),i("div",pt,[wt,t("div",bt,[(o(!0),i(_,null,w(s.drewProducts,(e,a)=>(o(),i("div",{key:e,class:"col"},[t("div",{class:u(["card border mb-md-3",{"border-primary":a===0||a===2,"border-purple":a===1}])},[t("div",yt,[t("div",xt,[(o(!0),i(_,null,w(s.lottery.recipes,(h,B)=>(o(),i("div",{key:h.id},[B===a?(o(),i("img",{key:0,src:h.image,alt:h.title,class:"w-100 object-fit-cover",style:{height:"150px"}},null,8,vt)):m("",!0)]))),128))]),t("div",kt,[t("div",Pt,[t("h5",{class:u(["card-title fw-bold",{"text-primary":a===0||a===2,"text-purple":a===1}])},n(e[0]),3),s.drewArr[a]&&s.drewArr[a][1]?(o(),i("p",{key:0,class:u(["mb-0",{"text-danger":s.drewArr[a][1].length/e[1].length===1}])},"完成度： "+n(Math.round(s.drewArr[a][1].length/e[1].length*100)===0?"0":Math.round(s.drewArr[a][1].length/e[1].length*100))+" %",3)):!s.drewArr[a]||!s.drewArr[a][1]?(o(),i("p",At,"完成度：0 %")):m("",!0)])])])],2),t("ul",{class:u(["h-80 row row-cols-xl-3 row-cols-lg-2 row-cols-3 pt-3 g-0 list-unstyled",{"bg-secondary":a===0||a===2,"bg-lightPurple":a===1}])},[(o(!0),i(_,null,w(e[1],h=>(o(),i("li",{class:"d-flex flex-column align-items-center position-relative col",key:h.id},[h.category==="單一產品"?(o(),i(_,{key:0},[t("img",{src:h.imgUrl,alt:h.title,height:"100",width:"100",class:"object-fit-cover mb-1"},null,8,Nt),t("p",null,n(h.title),1),!s.drewArr[a]||!s.drewArr[a][1]||s.drewArr[a]&&s.drewArr[a][1]&&!JSON.stringify(this.drewArr[a][1]).includes(h.title)?(o(),i("div",Lt,Mt)):m("",!0)],64)):m("",!0)]))),128))],2)]))),128))]),t("div",Ct,[t("button",{type:"button",class:"hvr-sweep-to-right mt-xl-5 mt-3 btn btn-primary",onClick:c[3]||(c[3]=x((...e)=>v.addtLotteryResult&&v.addtLotteryResult(...e),["prevent"]))},"立即抽獎")]),Et])):m("",!0),s.lotteryResult&&this.getPrize&&this.getPrize.id?(o(),i("div",Rt,[t("h5",zt,[jt,p("恭喜您完成 "+n(s.getPrize.id===1?"全部":s.getPrize.id===2?"2份":"1份")+"食譜，獲得 ",1),Dt]),t("div",Tt,[t("div",St,[t("div",Ht,[t("div",Ot,[t("h3",Vt,n(s.getPrize.id===1?"大獎":s.getPrize.id===2?"二獎":"三獎"),1)]),t("img",{src:s.getPrize.img,class:"card-img img-lg-220-md-200 object-fit-contain border bg-white",alt:s.getPrize.title},null,8,qt),t("div",Gt,[t("h5",It,n(s.getPrize.title),1),t("p",Ut,"價值：NT$ "+n(l.numberComma(s.getPrize.price)),1)])])]),Ft])])):m("",!0),t("div",Wt,[Yt,t("div",Jt,[(o(!0),i(_,null,w(s.lottery.prizes,e=>(o(),i("div",{class:"col",key:e.id,"data-aos":"flip-right"},[t("div",Kt,[t("div",Qt,[t("h3",Xt,n(e.id===1?"大獎":e.id===2?"二獎":"三獎"),1)]),t("div",Zt,[t("img",{src:e.img,class:"card-img border bg-white object-fit-contain img-lg-220-md-200",alt:e.title},null,8,$t),ts]),t("div",ss,[t("h5",es,n(e.title),1),t("p",rs,"價值：NT$ "+n(l.numberComma(e.price)),1)])])]))),128))]),is,t("ol",null,[(o(!0),i(_,null,w(s.lottery.rules,e=>(o(),i("li",{key:e+20},n(e),1))),128))])])])):m("",!0)])])}const fs=V(F,[["render",os]]);export{fs as default};
