import{R as B}from"./vue-router-2c21c692.js";import{m as M,a as N}from"./index-8f8f2e41.js";import{c as O}from"./carts-ab612c1d.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{P as T}from"./PaginationComponent-c75be064.js";import{L as q}from"./LoadingModal-16ab9486.js";import{C as R,_ as U}from"./icon-searchMobile-fef2a013.js";import{r as g,b as k,o as j,d as m,s as F,c as I,a as E}from"./db-143b9a4b.js";import{v as G,d as D,w as H,e as b}from"./runtime-dom.esm-bundler-54ced388.js";import{_ as A}from"./image5-4fc2427e.js";import{_ as z}from"./image4-1806383b.js";import{_ as K}from"./icon-cart-6dfbd1c6.js";import{_ as W}from"./undraw_Page_not_found_re_e9o6-de2ef5f7.js";import{_ as X,U as l,W as P,V as t,a4 as h,Y as p,a0 as c,$ as f,a1 as C,a2 as L,Z as _,r as y,o as n,X as x}from"./_plugin-vue_export-helper-03b40388.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";import"./loadingLogo-3bb466c0.js";const Y={components:{RouterLink:B,PaginationComponent:T,LoadingModal:q},data(){return{priceOrRateCollapse:{},highOrLowCollapse:{},products:[],priceOrRate:"價格",highOrLow:"不拘",productSearchName:"",filterProducts:[],myCollapse:{},bookMarks:[],recipes:[],pageStatus:"全部",selectPage:"全部",search:!1,uid:""}},mixins:[V],methods:{...M(O,["addCart","toastMessage"]),getProducts(){const o=g(m,"products/");k(o,s=>{this.products=s.val(),this.products=Object.entries(this.products).map(d=>(d[1].id=d[0],d[1]));const v=g(m,"productRates/");k(v,d=>{let r=d.val();r=Object.values(r).map((a,i)=>(a.id=Object.keys(r)[i],a)),console.log(r,this.products,"全部產品的評價還未分類產品"),this.products.forEach((a,i)=>{r.forEach(u=>{a.id===u.productId&&!this.products[i].scores?(this.products[i].scores=u.score,this.products[i].ratePeople=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1))):a.id===u.productId&&this.products[i].scores&&(this.products[i].scores+=u.score,this.products[i].ratePeople+=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1)))})}),this.products.forEach((a,i)=>{a.averageRate||(this.products[i].scores=0,this.products[i].ratePeople=0,this.products[i].averageRate=0)}),console.log(this.products,"加了評分的產品"),this.filterProducts=this.products,!this.$route.query.pageStatus&&this.$route.fullPath==="/products"?this.$refs.pagination.renderPage(1,this.filterProducts):this.$route.query.pageStatus&&this.searchProducts()})})},searchProducts(){this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.priceOrRate==="價格"&&this.highOrLow!=="不拘"?this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.price-s.price):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>s.price-o.price)):this.priceOrRate==="評價"&&this.highOrLow!=="不拘"&&(this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?o.averageRate-s.averageRate:o.scores-s.scores):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?s.averageRate-o.averageRate:s.scores-o.scores))),this.filterProducts=this.filterProducts.filter(o=>o.title.match(this.productSearchName)),console.log(this.filterProducts,"是什麼???"),this.search=!0,this.$refs.pagination.renderPage(1,this.filterProducts)},getBookmarks(){j(E,o=>{if(o){this.uid=o.uid,console.log(this.uid,"使用者已登入取得 uid");const s=g(m,"users/"+o.uid);k(s,v=>{this.user=v.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場");const d=g(m,`productBookmarks/${this.uid}`);k(d,r=>{this.bookMarks=r.val(),this.bookMarks&&(this.bookMarks=Object.keys(this.bookMarks)),console.log(this.bookMarks,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(o){if(!this.uid){this.toastMessage("登入才可使用收藏功能","error");return}const s=g(m,`productBookmarks/${this.uid}/${o.id}`);F(s,o),this.toastMessage("收藏成功")},deleteBookmark(o){I(g(m,`productBookmarks/${this.uid}/${o}`)),this.toastMessage("刪除收藏")}},mounted(){this.priceOrRateCollapse=new R(this.$refs.priceOrRateCollapse,{toggle:!1,parent:"#myGroup"}),this.highOrLowCollapse=new R(this.$refs.highOrLowCollapse,{toggle:!1,parent:"#myGroup"}),(this.$route.query.pageStatus||this.$route.query.searchName||this.$route.query.valueHighOrLow||this.$route.query.valuePriceOrRate)&&(this.pageStatus=this.$route.query.pageStatus,this.priceOrRate=this.$route.query.valuePriceOrRate,this.highOrLow=this.$route.query.valueHighOrLow,this.productSearchName=this.$route.query.searchName,console.log("存入了",this.pageStatus,this.priceOrRate,this.highOrLow,this.productSearchName)),this.getProducts(),this.getBookmarks()},watch:{selectPage(){this.pageStatus=this.selectPage,this.productSearchName="",this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.$refs.pagination.renderPage(1,this.filterProducts)},priceOrRate(){this.priceOrRateCollapse.hide()},highOrLow(){this.highOrLowCollapse.hide()},filterProducts(){this.priceOrRateCollapse.hide(),this.highOrLowCollapse.hide()}},computed:{...N(O,["loadingItem"])}},Z={class:"my-10"},J={class:"navTitle nav nav-tabs container d-flex justify-content-center justify-content-lg-start",id:"myTab",role:"tablist"},Q={class:"nav-item",role:"presentation"},$=t("span",{class:"material-icons-outlined fs-5 me-1"},"apps",-1),tt={class:"nav-item",role:"presentation"},et=t("i",{class:"bi bi-bag-check-fill"},null,-1),st={class:"nav-item",role:"presentation"},ot=t("i",{class:"bi bi-fire"},null,-1),rt={class:"nav-item",role:"presentation"},it=t("i",{class:"bi bi-percent"},null,-1),at={class:"d-none d-lg-block container selectProduct pt-4"},lt={class:"input-group"},nt=t("i",{class:"bi bi-caret-down-fill"},null,-1),ct={class:"ms-2 fw-bold"},dt=t("i",{class:"bi bi-caret-down-fill"},null,-1),ht={class:"ms-2 fw-bold"},ut=t("img",{src:U,style:{height:"25px"},alt:""},null,-1),pt=[ut],gt={class:"row g-0",id:"myGroup"},mt={class:"col-2"},ft={ref:"priceOrRateCollapse",class:"collapse"},bt={class:"card card-body border-0"},_t={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},vt=t("label",{class:"btn btn-outline-red",for:"selectprice"},"價格",-1),kt=t("label",{class:"btn btn-outline-red",for:"selectRate"},"評價",-1),Pt={class:"col-2"},yt={ref:"highOrLowCollapse",class:"collapse"},wt={class:"card card-body border-0"},Ot={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},Rt=t("label",{class:"btn btn-outline-red",for:"noDifference"},"不拘",-1),Ct=t("label",{class:"btn btn-outline-red",for:"highToLow"},"高到低",-1),Lt=t("label",{class:"btn btn-outline-red",for:"lowToHigh"},"低到高",-1),xt={class:"container mt-4"},St={key:0,class:"row row-cols-lg-4 row-cols-2 gy-4"},Bt={class:"card position-relative border-0 bg-transparent",style:{"border-radius":"20px"}},Mt={class:"cardImg",style:{"border-radius":"20px"}},Nt=["src"],Vt={class:"card-text"},Tt=["onClick"],qt=t("img",{src:A},null,-1),Ut=[qt],jt={key:0,style:{"pointer-events":"none"},class:"d-flex flex-column align-items-center text-white p-2 bg-red border position-absolute top-0 start-0 rounded"},Ft=["onClick"],It=t("img",{src:z},null,-1),Et=[It],Gt=["disabled","onClick"],Dt=t("img",{src:K,alt:"",class:"rounded-circle shadow-sm"},null,-1),Ht=[Dt],At={class:"fw-bold cardTextTitle"},zt={class:""},Kt={class:"mt-1 d-block d-lg-inline-block"},Wt={class:"mb-0 ms-auto starRates"},Xt={class:"me-1"},Yt=t("i",{class:"bi bi-star-fill"},null,-1),Zt={key:1,class:"py-10"},Jt=t("img",{src:W,class:"mb-3",alt:"",style:{height:"250px",display:"block",margin:"auto"}},null,-1),Qt=t("h2",{class:"text-center"},"查無商品，請您重新查詢",-1),$t=[Jt,Qt];function te(o,s,v,d,r,a){const i=y("LoadingModal"),u=y("RouterLink"),S=y("PaginationComponent");return n(),l("div",Z,[P(i,{ref:"loadingModal",style:{"z-index":"2001"}},null,512),t("ul",J,[t("li",Q,[t("button",{class:h(["nav-link px-2 px-lg-3 d-flex align-items-center",{active:r.pageStatus==="全部"}]),id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true",onClick:s[0]||(s[0]=()=>r.selectPage="全部")},[$,p("全部")],2)]),t("li",tt,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="食材組合包"}]),id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false",onClick:s[1]||(s[1]=()=>r.selectPage="食材組合包")},[et,p(" 食材組合包")],2)]),t("li",st,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="熱銷單品"}]),id:"popularProducts-tab","data-bs-toggle":"tab","data-bs-target":"#popularProducts",type:"button",role:"tab","aria-controls":"popularProducts","aria-selected":"false",onClick:s[2]||(s[2]=()=>r.selectPage="熱銷單品")},[ot,p(" 熱銷單品")],2)]),t("li",rt,[t("button",{class:h(["nav-link px-2 px-lg-3",{active:r.pageStatus==="特價商品"}]),id:"contact-tab","data-bs-toggle":"tab","data-bs-target":"#contact",type:"button",role:"tab","aria-controls":"contact","aria-selected":"false",onClick:s[3]||(s[3]=()=>r.selectPage="特價商品")},[it,p(" 特價商品")],2)])]),t("div",at,[t("div",lt,[t("a",{class:"btn btn-outline-red px-5",onClick:s[4]||(s[4]=()=>this.priceOrRateCollapse.toggle())},[p("篩選對象 "),nt,t("span",ct,c(r.priceOrRate),1)]),t("button",{class:"btn btn-outline-red px-5",type:"button",onClick:s[5]||(s[5]=()=>this.highOrLowCollapse.toggle())},[p("篩選值 "),dt,t("span",ht,c(r.highOrLow),1)]),f(t("input",{type:"search",class:"form-control border-red border-end-0",placeholder:"請輸入食材名稱","aria-label":"Example text with two button addons","onUpdate:modelValue":s[6]||(s[6]=e=>r.productSearchName=e),onKeyup:s[7]||(s[7]=D((...e)=>a.searchProducts&&a.searchProducts(...e),["enter"]))},null,544),[[G,r.productSearchName]]),t("button",{type:"submit",class:"btn border border-red border-start-0 bg-transparent",onClick:s[8]||(s[8]=H((...e)=>a.searchProducts&&a.searchProducts(...e),["prevent"]))},pt)]),t("div",gt,[t("div",mt,[t("div",ft,[t("div",bt,[t("div",_t,[f(t("input",{type:"radio",class:"btn-check",value:"價格",name:"priceOrRate",id:"selectprice",autocomplete:"off","onUpdate:modelValue":s[9]||(s[9]=e=>r.priceOrRate=e)},null,512),[[b,r.priceOrRate]]),vt,f(t("input",{type:"radio",class:"btn-check",value:"評價",name:"priceOrRate",id:"selectRate",autocomplete:"off","onUpdate:modelValue":s[10]||(s[10]=e=>r.priceOrRate=e)},null,512),[[b,r.priceOrRate]]),kt])])],512)]),t("div",Pt,[t("div",yt,[t("div",wt,[t("div",Ot,[f(t("input",{type:"radio",class:"btn-check",value:"不拘",name:"highOrLow",id:"noDifference",autocomplete:"off",checked:"","onUpdate:modelValue":s[11]||(s[11]=e=>r.highOrLow=e)},null,512),[[b,r.highOrLow]]),Rt,f(t("input",{type:"radio",class:"btn-check",value:"高到低",name:"highOrLow",id:"highToLow",autocomplete:"off","onUpdate:modelValue":s[12]||(s[12]=e=>r.highOrLow=e)},null,512),[[b,r.highOrLow]]),Ct,f(t("input",{type:"radio",class:"btn-check",value:"低到高",name:"highOrLow",id:"lowToHigh",autocomplete:"off","onUpdate:modelValue":s[13]||(s[13]=e=>r.highOrLow=e)},null,512),[[b,r.highOrLow]]),Lt])])],512)])])]),t("div",xt,[r.filterProducts.length?(n(),l("div",St,[(n(!0),l(C,null,L(this.$refs.pagination.pageProducts,e=>(n(),l("div",{class:"col text-decoration-none",key:e.id},[t("div",Bt,[t("div",Mt,[P(u,{to:`/products/${e.id}`,class:"enlargeImg"},{default:x(()=>[t("img",{src:e.imgUrl,class:"card-img",height:"220",style:{"border-radius":"20px","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Nt)]),_:2},1032,["to"])]),t("h5",Vt,[t("button",{type:"button",class:"position-absolute bookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.addBookmark(e)},Ut,8,Tt),e.isCheaper?(n(),l("span",jt,c((100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))%10===0?(100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0)).toString().charAt(0):100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))+" 折 ",1)):_("",!0),(n(!0),l(C,null,L(r.bookMarks,w=>(n(),l("div",{key:w},[w===e.id?(n(),l("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.deleteBookmark(e.id)},Et,8,Ft)):_("",!0)]))),128)),t("button",{disabled:o.loadingItem==="loading",onClick:()=>o.addCart(e),type:"button",class:"buyBtn border-0 bg-transparent me-lg-2 me-1 position-absolute end-0"},Ht,8,Gt)]),P(u,{to:`/products/${e.id}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:x(()=>[t("h5",At,c(e.title),1),t("div",{class:h(["d-flex align-items-lg-center cardTextPrice",{"align-items-end":e.isCheaper,"align-items-center":!e.isCheaper}])},[t("div",zt,[e.originalPrice?(n(),l("del",{key:0,class:h(["me-2 text-muted mt-1",{"d-none":!e.isCheaper}])},"NT$ "+c(o.numberComma(e.originalPrice)),3)):_("",!0),t("span",Kt,[e.price?(n(),l("span",{key:0,class:h({"text-danger":e.isCheaper,"fw-bold":e.isCheaper})}," NT$ "+c(o.numberComma(e.price)),3)):_("",!0),p(" / "+c(e.num)+c(e.unit),1)])]),t("h5",Wt,[t("div",{class:h(["badge border rounded-pill bg-white",{"text-orange":e.averageRate,"border-orange":e.averageRate,"text-lightBrownGray":!e.averageRate,"border-lightBrownGray":!e.averageRate}])},[t("span",Xt,c(e.averageRate),1),Yt],2)])],2)]),_:2},1032,["to"])])]))),128))])):!r.filterProducts.length&&r.search?(n(),l("div",Zt,$t)):_("",!0)]),P(S,{ref:"pagination","price-or-rate":r.priceOrRate,"filter-products":r.filterProducts},null,8,["price-or-rate","filter-products"])])}const _e=X(Y,[["render",te]]);export{_e as default};
