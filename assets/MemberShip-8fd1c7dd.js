import{l as A}from"./loadingStore-73c40ae8.js";import{f as C}from"./index-9f8e1fb0.js";import{o as I,u as w,r as b,a as y,f as L,c as U,d as g,b as S}from"./carts-18eb5781.js";import{P as B}from"./PaginationComponent-737fcd4b.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{s as j}from"./publicData-f4e8600e.js";import{B as F}from"./BannerComponent-882e3d71.js";import{n as m,l as E,m as R}from"./runtime-dom.esm-bundler-eb0e3820.js";import{b6 as D,av as k,aj as r,l,t as P,m as t,k as u,aJ as n,a3 as p,b3 as v,F as x,at as N,s as f,r as q,j as H,b1 as z}from"./_plugin-vue_export-helper-68081c38.js";const J="/finalEasyBuyEasyMake/assets/undraw_No_data_re_kwbl-fe986f09.png",G={components:{PaginationComponent:B,BannerComponent:F},mixins:[V],data(){return{selections:j,user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:""}},methods:{...C(U,["toastMessage","goToTop"]),...C(A,["startLoading","endLoading"]),getUserInformation(){I(y,o=>{if(o){this.uid=o.uid;const i=b(g,"users/"+this.uid);S(i,c=>{this.user=c.val()})}else this.uid=null,this.user={},this.toastMessage("請先登入","error"),this.$router.push("/loginSignup")})},getOrders(){I(y,o=>{if(o){const i=b(g,`orders/${o.uid}`);S(i,c=>{if(this.orders=c.val(),this.endLoading(),!this.orders){this.orders=[];return}this.orders=Object.entries(this.orders).map(h=>(h[1].id=h[0],h[1])),this.filterOrders=this.orders.reverse(),this.orderArrived=this.orders.filter(h=>h.deliveryStatus==="待取貨"),this.filterOrders&&this.$route.fullPath==="/member"&&this.$refs.pagination.renderPage(1,this.filterOrders)},{onlyOnce:!0})}else this.endLoading(),this.toastMessage("請先登入","error"),this.$router.push("/loginSignup")})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}w(b(g),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const o=y.currentUser;L(o,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/loginSignup")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:o}=await this.$swal({title:"選擇圖片",input:"file",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){const i=new FileReader;i.onload=c=>{this.$swal({title:"圖片上傳成功!",imageUrl:c.target.result,imageAlt:"The uploaded picture",imageHeight:300}),w(b(g),{[`users/${this.uid}/headshotImg/`]:c.target.result})},i.readAsDataURL(o)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:o}=await this.$swal({title:"選擇圖片",input:"text",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});o?(this.$swal({title:"圖片上傳成功",imageUrl:o,imageHeight:300,imageAlt:"Custom image"}),w(b(g),{[`users/${this.uid}/headshotImg/`]:o})):this.toastMessage("請勿輸入空值","error")}},mounted(){this.startLoading(),this.goToTop(),this.getUserInformation(),this.getOrders()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(o=>o.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},K={class:"no-scroll-x"},Q={class:"container"},W={class:"row row-cols-1 row-cols-lg-2 g-5 py-lg-96 py-5"},X={class:"col-lg-4"},Y={class:"card"},Z={key:0,class:"border border-2 border-primary text-center bg-lightPurple"},$=t("i",{class:"bi bi-person-fill m-auto text-primary fs-200"},null,-1),tt=[$],st=["src"],et={class:"card-body bg-secondary d-flex justify-content-between"},it={class:"list-group list-group-flush"},ot={class:"list-group-item"},rt={class:"row"},lt=t("div",{class:"col-4"},[t("label",{for:"nickName",class:"form-label fw-bold"},[t("i",{class:"bi bi-person-fill"}),f(" 暱稱")])],-1),nt={class:"col-8"},at={class:"text-end"},ct={class:"list-group-item bg-secondary"},dt={class:"row"},ut=t("div",{class:"col-4"},[t("label",{for:"email",class:"form-label fw-bold mb-0"},[t("i",{class:"bi bi-envelope-fill"}),f(" 信箱")])],-1),ht={class:"col-8"},mt={class:"list-group-item"},pt=q('<div class="row"><div class="col-4"><label for="password" class="form-label fw-bold"><i class="bi bi-lock-fill"></i> 密碼</label></div><div class="col-8"><span>* * * * * * * *</span></div></div>',1),ft={class:"text-end"},bt={class:"list-group-item d-flex justify-content-between bg-secondary"},gt=t("label",{for:"ticket",class:"form-label mb-0 fw-bold"},[t("i",{class:"bi bi-ticket-perforated-fill"}),f(" 我的抽獎券")],-1),_t={class:"col-lg-8 d-flex flex-column"},wt=t("h3",{class:"d-flex align-items-center fw-bold text-purple border-bottom pb-1 border-purple"},[t("span",{class:"material-icons me-2"}," auto_awesome "),f(" 訂單狀況 ")],-1),yt={class:"select-order-status list-unstyled d-flex justify-content-between mb-0 py-2"},kt=["onClick"],vt={class:"row row-cols-1 py-3"},xt={class:"mb-3 fs-lg-4 fs-5 fw-bold"},Nt={key:0},Ct={class:"order-select p-3"},It=t("i",{class:"bi bi-clock me-2"},null,-1),St={class:"list-unstyled row row-cols-md-4 row-cols-2 g-3"},Et={key:0,class:"position-relative"},Pt=["src","alt"],Mt={key:0,class:"mb-0 mt-2 text-center"},Ot={class:"fs-14 me-1"},Tt={class:"text-primary fw-bold"},At={key:1,class:"position-absolute w-100 h-100 top-0 bg-trans-dark-4"},Lt={class:"text-center fs-1 text-white text-shadow lh-lg"},Ut={class:"text-end fw-bold mt-4"},Bt={class:"me-3"},Vt={class:"text-primary"},jt=t("i",{class:"bi bi-search text-primary ms-3"},null,-1),Ft=t("hr",null,null,-1),Rt={key:1,class:"py-lg-4 text-center"},Dt=t("img",{src:J,style:{},class:"mb-lg-3 mb-2 img-md-200-sm-150",alt:"無訂單圖示"},null,-1),qt=t("h3",{class:"fs-lg-3 fs-6"},"無訂單",-1),Ht=[Dt,qt];function zt(o,i,c,h,e,a){const M=k("BannerComponent"),O=k("RouterLink"),T=k("PaginationComponent");return r(),l("div",K,[P(M),t("div",Q,[t("section",W,[t("div",X,[t("div",Y,[e.user.headshotImg?e.user.headshotImg?(r(),l("img",{key:1,src:e.user.headshotImg,class:"object-fit-cover w-100 border border-2 border-primary",style:{height:"300px"},alt:"大頭貼"},null,8,st)):u("",!0):(r(),l("div",Z,tt)),t("div",et,[t("a",{href:"#",class:"card-link fw-bold",onClick:i[0]||(i[0]=m((...s)=>a.selectImgUrl&&a.selectImgUrl(...s),["prevent"]))},"上傳圖片網址"),t("a",{href:"#",class:"card-link fw-bold",onClick:i[1]||(i[1]=m((...s)=>a.selectFile&&a.selectFile(...s),["prevent"]))},"上傳本地圖片")]),t("ul",it,[t("li",ot,[t("div",rt,[lt,t("div",nt,[t("span",null,n(e.user.nickName),1)])]),t("div",at,[e.nickNameEdit?(r(),l("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:i[2]||(i[2]=m(()=>e.nickNameEdit=!e.nickNameEdit,["prevent"]))},"修改暱稱")):u("",!0),t("div",{class:p(["input-group",{"d-none":e.nickNameEdit}])},[v(t("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":i[3]||(i[3]=s=>e.newNickName=s),style:{width:"180px"}},null,512),[[E,e.newNickName]]),t("button",{onClick:i[4]||(i[4]=()=>e.nickNameEdit=!0),class:"btn btn-outline-gray btn-sm",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:i[5]||(i[5]=()=>a.changeEmail()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),t("li",ct,[t("div",dt,[ut,t("div",ht,[t("span",null,n(e.user.email),1)])])]),t("li",mt,[pt,t("div",ft,[e.passwordEdit?(r(),l("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:i[6]||(i[6]=m(()=>e.passwordEdit=!e.passwordEdit,["prevent"]))},"變更密碼")):u("",!0),t("div",{class:p(["input-group",{"d-none":e.passwordEdit}])},[v(t("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":i[7]||(i[7]=s=>e.newPassword=s),style:{width:"180px"}},null,512),[[E,e.newPassword]]),t("button",{onClick:i[8]||(i[8]=()=>e.passwordEdit=!0),class:"btn btn-sm btn-outline-gray",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:i[9]||(i[9]=()=>a.changePassword()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),t("li",bt,[gt,t("span",null,n(e.user.lotteryTicket)+" 張",1),t("a",{href:"#",class:"link-primary fw-bold",onClick:i[10]||(i[10]=m((...s)=>a.linkToLottery&&a.linkToLottery(...s),["prevent"]))},"立即抽獎")])])])]),t("div",_t,[wt,t("ul",yt,[(r(!0),l(x,null,N(e.selections.memberShip,s=>(r(),l("li",{key:s.icon},[t("a",{href:"#",class:p(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":e.selectItem===s.title,"text-white":e.selectItem===s.title,"fw-bold":e.selectItem===s.title,"position-relative":e.selectItem==="待取貨"}]),onClick:m(()=>e.selectItem=s.title,["prevent"])},[t("i",{class:p(s.icon)},null,2),t("span",{class:p(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":e.selectItem!==s.title}])},n(s.title),3),v(t("span",{class:"position-absolute top-0 start-100 translate-middle text-center rounded-circle border fw-bold border-primary text-primary fs-12 alert-num"},n(e.orderArrived.length),513),[[R,s.title==="待取貨"&&e.orderArrived.length]])],10,kt)]))),128))]),t("div",vt,[t("h4",xt,"總共有 "+n(e.filterOrders.length)+" 筆",1),e.filterOrders.length?(r(),l("div",Nt,[(r(!0),l(x,null,N(this.$refs.pagination.pageProducts,s=>(r(),H(O,{to:`/orders/${s.id}`,class:"col text-decoration-none link-dark",key:s.creatAt},{default:z(()=>[t("div",Ct,[t("p",null,[It,f(n(new Date(s.creatAt).toLocaleString().split(":")[0])+":"+n(new Date(s.creatAt).toLocaleString().split(":")[1]),1)]),t("ul",St,[(r(!0),l(x,null,N(s.cart.items,(d,_)=>(r(),l("li",{class:"col",key:d+6603},[_<8?(r(),l("div",Et,[t("img",{src:d.product.imgUrl,alt:d.product.title,height:"100",class:"w-100 object-fit-cover"},null,8,Pt),_<7||s.cart.items.length===8?(r(),l("p",Mt,[t("span",Ot,n(d.product.title.length>8?d.product.title.slice(0,5)+"...":d.product.title),1),t("span",Tt,"x"+n(o.numberComma(d.qty)),1)])):u("",!0),s.cart.items.length>8&&_===7?(r(),l("div",At,[t("p",Lt,n(s.cart.items.length-7)+" + ",1)])):u("",!0)])):u("",!0)]))),128))]),t("div",Ut,[t("span",Bt,[t("i",{class:p(["bi me-1",{"bi-box-seam":s.deliveryStatus==="待出貨","bi-truck":s.deliveryStatus==="運送中","bi-house-check":s.deliveryStatus==="待取貨","bi-clipboard-check":s.deliveryStatus==="訂單完成"}])},null,2),f(" "+n(s.deliveryStatus),1)]),t("span",Vt,"NT$ "+n(o.numberComma(s.cart.finalTotal)),1),jt])]),Ft]),_:2},1032,["to"]))),128))])):e.filterOrders.length?u("",!0):(r(),l("div",Rt,Ht))]),P(T,{ref:"pagination","filter-orders":e.filterOrders,class:"mt-auto"},null,8,["filter-orders"])])])])])}const ts=D(G,[["render",zt]]);export{ts as default};
