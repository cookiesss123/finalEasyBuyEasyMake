import{f as M}from"./index-fc788f37.js";import{o as T,r as f,d as g,b as C,u as y,a as I,f as O,c as B}from"./carts-e36b449b.js";import{P as j}from"./PaginationComponent-40338e97.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{L as D}from"./index-22b4ec11.js";import{s as F}from"./publicData-f5d39529.js";import{B as R}from"./BannerComponent-e49de957.js";import{n as u,l as E,m as H}from"./runtime-dom.esm-bundler-5f84711a.js";import{_ as q}from"./loadingLogo-ea15f612.js";import{_ as z,r as _,o as r,c as l,a as k,w as P,b as t,ak as m,b7 as n,aH as p,bk as v,F as x,aY as N,ao as h,an as Y,aj as G}from"./_plugin-vue_export-helper-f96b5234.js";const J="/finalEasyBuyEasyMake/assets/undraw_No_data_re_kwbl-fe986f09.png",K={components:{PaginationComponent:j,Loading:D,BannerComponent:R},mixins:[V],data(){return{selections:F,user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",isLoading:!1}},methods:{...M(B,["toastMessage","goToTop"]),getUserInformation(){return new Promise((o,i)=>{T(I,c=>{if(c){this.uid=c.uid;const b=f(g,"users/"+this.uid);C(b,s=>{const a=s.val();o(a)})}else this.isLoading=!1,this.uid=null,this.user={},this.toastMessage("請先登入","error"),this.$router.push("/loginSignup")})})},getOrders(){return new Promise((o,i)=>{const c=f(g,`orders/${this.uid}`);C(c,b=>{let s=b.val();s||(s={}),o(s)})})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}y(f(g),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const o=I.currentUser;O(o,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/loginSignup")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:o}=await this.$swal({title:"選擇圖片",input:"file",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){const i=new FileReader;i.onload=c=>{this.$swal({title:"圖片上傳成功!",imageUrl:c.target.result,imageAlt:"The uploaded picture",imageHeight:300}),y(f(g),{[`users/${this.uid}/headshotImg/`]:c.target.result})},i.readAsDataURL(o)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:o}=await this.$swal({title:"選擇圖片",input:"text",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});o?(this.$swal({title:"圖片上傳成功",imageUrl:o,imageHeight:300,imageAlt:"Custom image"}),y(f(g),{[`users/${this.uid}/headshotImg/`]:o})):this.toastMessage("請勿輸入空值","error")},async getAllData(){try{this.isLoading=!0,this.user=await this.getUserInformation(),this.orders=await this.getOrders(),this.orders=Object.entries(this.orders).map(o=>(o[1].id=o[0],o[1])),this.filterOrders=this.orders.reverse(),this.orderArrived=this.orders.filter(o=>o.deliveryStatus==="待取貨"),this.filterOrders&&this.$route.fullPath==="/member"&&this.$refs.pagination.renderPage(1,this.filterOrders),this.isLoading=!1}catch(o){throw new Error(o)}}},mounted(){this.goToTop(),this.getUserInformation(),this.getAllData()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(o=>o.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},Q={class:"no-scroll-x"},W=t("div",{class:"d-flex flex-column align-items-center py-96"},[t("img",{src:q,class:"loading-logo mb-3",alt:"logo"}),t("p",{class:"text-center fw-bold text-purple fs-md-2 fs-5"},[t("span",{class:"me-1 animate-text"},"L"),t("span",{class:"mx-1 animate-text"},"o"),t("span",{class:"mx-1 animate-text"},"a"),t("span",{class:"mx-1 animate-text"},"d"),t("span",{class:"mx-1 animate-text"},"i"),t("span",{class:"mx-1 animate-text"},"n"),t("span",{class:"mx-1 animate-text"},"g"),t("span",{class:"mx-2 animate-text"},"."),t("span",{class:"me-2 animate-text"},"."),t("span",{class:"animate-text"},".")])],-1),X={class:"container"},Z={class:"row row-cols-1 row-cols-lg-2 g-5 py-lg-96 py-5"},$={class:"col-lg-4"},tt={class:"card"},st={key:0,class:"border border-2 border-primary text-center bg-lightPurple"},et=t("i",{class:"bi bi-person-fill m-auto text-primary fs-200"},null,-1),it=[et],ot=["src"],rt={class:"card-body bg-secondary d-flex justify-content-between"},lt={class:"list-group list-group-flush"},nt={class:"list-group-item"},at={class:"row"},ct=t("div",{class:"col-4"},[t("label",{for:"nickName",class:"form-label fw-bold"},[t("i",{class:"bi bi-person-fill"}),h(" 暱稱")])],-1),dt={class:"col-8"},mt={class:"text-end"},ut={class:"list-group-item bg-secondary"},pt={class:"row"},ht=t("div",{class:"col-4"},[t("label",{for:"email",class:"form-label fw-bold mb-0"},[t("i",{class:"bi bi-envelope-fill"}),h(" 信箱")])],-1),ft={class:"col-8"},gt={class:"list-group-item"},bt=Y('<div class="row"><div class="col-4"><label for="password" class="form-label fw-bold"><i class="bi bi-lock-fill"></i> 密碼</label></div><div class="col-8"><span>* * * * * * * *</span></div></div>',1),_t={class:"text-end"},wt={class:"list-group-item d-flex justify-content-between bg-secondary"},yt=t("label",{for:"ticket",class:"form-label mb-0 fw-bold"},[t("i",{class:"bi bi-ticket-perforated-fill"}),h(" 我的抽獎券")],-1),kt={class:"col-lg-8 d-flex flex-column"},vt=t("h3",{class:"d-flex align-items-center fw-bold text-purple border-bottom pb-1 border-purple"},[t("span",{class:"material-icons me-2"}," auto_awesome "),h(" 訂單狀況 ")],-1),xt={class:"select-order-status list-unstyled d-flex justify-content-between mb-0 py-2"},Nt=["onClick"],Ct={class:"row row-cols-1 py-3"},It={class:"mb-3 fs-lg-4 fs-5 fw-bold"},Et={key:0},Pt={class:"order-select p-3"},Lt=t("i",{class:"bi bi-clock me-2"},null,-1),St={class:"list-unstyled row row-cols-md-4 row-cols-2 g-3"},At={key:0,class:"position-relative"},Ut=["src","alt"],Mt={key:0,class:"mb-0 mt-2 text-center"},Tt={class:"fs-14 me-1"},Ot={class:"text-primary fw-bold"},Bt={key:1,class:"position-absolute w-100 h-100 top-0 bg-trans-dark-4"},jt={class:"text-center fs-1 text-white text-shadow lh-lg"},Vt={class:"text-end fw-bold mt-4"},Dt={class:"me-3"},Ft={class:"text-primary"},Rt=t("i",{class:"bi bi-search text-primary ms-3"},null,-1),Ht=t("hr",null,null,-1),qt={key:1,class:"py-lg-4 text-center"},zt=t("img",{src:J,style:{},class:"mb-lg-3 mb-2 img-md-200-sm-150",alt:"無訂單圖示"},null,-1),Yt=t("h3",{class:"fs-lg-3 fs-6"},"無訂單",-1),Gt=[zt,Yt];function Jt(o,i,c,b,s,a){const L=_("loading"),S=_("BannerComponent"),A=_("RouterLink"),U=_("PaginationComponent");return r(),l("div",Q,[k(L,{active:s.isLoading,"onUpdate:active":i[0]||(i[0]=e=>s.isLoading=e),"lock-scroll":!0},{default:P(()=>[W]),_:1},8,["active"]),k(S),t("div",X,[t("section",Z,[t("div",$,[t("div",tt,[s.user.headshotImg?s.user.headshotImg?(r(),l("img",{key:1,src:s.user.headshotImg,class:"object-fit-cover w-100 border border-2 border-primary",style:{height:"300px"},alt:"大頭貼"},null,8,ot)):m("",!0):(r(),l("div",st,it)),t("div",rt,[t("a",{href:"#",class:"card-link fw-bold",onClick:i[1]||(i[1]=u((...e)=>a.selectImgUrl&&a.selectImgUrl(...e),["prevent"]))},"上傳圖片網址"),t("a",{href:"#",class:"card-link fw-bold",onClick:i[2]||(i[2]=u((...e)=>a.selectFile&&a.selectFile(...e),["prevent"]))},"上傳本地圖片")]),t("ul",lt,[t("li",nt,[t("div",at,[ct,t("div",dt,[t("span",null,n(s.user.nickName),1)])]),t("div",mt,[s.nickNameEdit?(r(),l("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:i[3]||(i[3]=u(()=>s.nickNameEdit=!s.nickNameEdit,["prevent"]))},"修改暱稱")):m("",!0),t("div",{class:p(["input-group",{"d-none":s.nickNameEdit}])},[v(t("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":i[4]||(i[4]=e=>s.newNickName=e),style:{width:"180px"}},null,512),[[E,s.newNickName]]),t("button",{onClick:i[5]||(i[5]=()=>s.nickNameEdit=!0),class:"btn btn-outline-gray btn-sm",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:i[6]||(i[6]=()=>a.changeEmail()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),t("li",ut,[t("div",pt,[ht,t("div",ft,[t("span",null,n(s.user.email),1)])])]),t("li",gt,[bt,t("div",_t,[s.passwordEdit?(r(),l("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:i[7]||(i[7]=u(()=>s.passwordEdit=!s.passwordEdit,["prevent"]))},"變更密碼")):m("",!0),t("div",{class:p(["input-group",{"d-none":s.passwordEdit}])},[v(t("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":i[8]||(i[8]=e=>s.newPassword=e),style:{width:"180px"}},null,512),[[E,s.newPassword]]),t("button",{onClick:i[9]||(i[9]=()=>s.passwordEdit=!0),class:"btn btn-sm btn-outline-gray",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:i[10]||(i[10]=()=>a.changePassword()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),t("li",wt,[yt,t("span",null,n(s.user.lotteryTicket)+" 張",1),t("a",{href:"#",class:"link-primary fw-bold",onClick:i[11]||(i[11]=u((...e)=>a.linkToLottery&&a.linkToLottery(...e),["prevent"]))},"立即抽獎")])])])]),t("div",kt,[vt,t("ul",xt,[(r(!0),l(x,null,N(s.selections.memberShip,e=>(r(),l("li",{key:e.icon},[t("a",{href:"#",class:p(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":s.selectItem===e.title,"text-white":s.selectItem===e.title,"fw-bold":s.selectItem===e.title,"position-relative":s.selectItem==="待取貨"}]),onClick:u(()=>s.selectItem=e.title,["prevent"])},[t("i",{class:p(e.icon)},null,2),t("span",{class:p(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":s.selectItem!==e.title}])},n(e.title),3),v(t("span",{class:"position-absolute top-0 start-100 translate-middle text-center rounded-circle border fw-bold border-primary text-primary fs-12 alert-num"},n(s.orderArrived.length),513),[[H,e.title==="待取貨"&&s.orderArrived.length]])],10,Nt)]))),128))]),t("div",Ct,[t("h4",It,"總共有 "+n(s.filterOrders.length)+" 筆",1),s.filterOrders.length?(r(),l("div",Et,[(r(!0),l(x,null,N(this.$refs.pagination.pageProducts,e=>(r(),G(A,{to:`/orders/${e.id}`,class:"col text-decoration-none link-dark",key:e.creatAt},{default:P(()=>[t("div",Pt,[t("p",null,[Lt,h(n(new Date(e.creatAt).toLocaleString().split(":")[0])+":"+n(new Date(e.creatAt).toLocaleString().split(":")[1]),1)]),t("ul",St,[(r(!0),l(x,null,N(e.cart.items,(d,w)=>(r(),l("li",{class:"col",key:d+6603},[w<8?(r(),l("div",At,[t("img",{src:d.product.imgUrl,alt:d.product.title,height:"100",class:"w-100 object-fit-cover"},null,8,Ut),w<7||e.cart.items.length===8?(r(),l("p",Mt,[t("span",Tt,n(d.product.title.length>8?d.product.title.slice(0,5)+"...":d.product.title),1),t("span",Ot,"x"+n(o.numberComma(d.qty)),1)])):m("",!0),e.cart.items.length>8&&w===7?(r(),l("div",Bt,[t("p",jt,n(e.cart.items.length-7)+" + ",1)])):m("",!0)])):m("",!0)]))),128))]),t("div",Vt,[t("span",Dt,[t("i",{class:p(["bi me-1",{"bi-box-seam":e.deliveryStatus==="待出貨","bi-truck":e.deliveryStatus==="運送中","bi-house-check":e.deliveryStatus==="待取貨","bi-clipboard-check":e.deliveryStatus==="訂單完成"}])},null,2),h(" "+n(e.deliveryStatus),1)]),t("span",Ft,"NT$ "+n(o.numberComma(e.cart.finalTotal)),1),Rt])]),Ht]),_:2},1032,["to"]))),128))])):s.filterOrders.length?m("",!0):(r(),l("div",qt,Gt))]),k(U,{ref:"pagination","filter-orders":s.filterOrders,class:"mt-auto"},null,8,["filter-orders"])])])])])}const os=z(K,[["render",Jt]]);export{os as default};
