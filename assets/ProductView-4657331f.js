import{l as j}from"./loadingStore-630f991d.js";import{S as E,a as N,N as z,P as L}from"./pagination.min-b78d274c.js";import{k as V,n as G,j as w,l as H}from"./runtime-dom.esm-bundler-5f84711a.js";import{f as y,m as B,h as W}from"./index-ef229fde.js";import{r as C,b as M,p as P,s as Q,d as x,c as U}from"./carts-683259c2.js";import{m as Y}from"./bookmark-1572e7be.js";import{d as T}from"./mainData-57ceacaf.js";import{n as O}from"./numberCommaMixin-e0aac39c.js";import{_ as D,r as I,o as i,c as n,b as e,a as u,w as c,b7 as l,ak as m,aH as g,ao as d,bk as p,F as h,aY as b,aj as R}from"./_plugin-vue_export-helper-f96b5234.js";const Z="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIYSURBVHgBvZZPetMwEMXf6HNIS9zi3MCcAHoC0n34sCmsk9yAnqDlBJQT5GPFAkq8CGt8hHICcgPcpiVAbA9S2kBSW26lhvwW+TOW/TTP0owIlnA/8C62p11AJNOzcdTsxYnJ/Q4smXhpn5gCOQXUH7gdGdo1uZ9gweR94Of19Nti7PfpedMkawELsntZ63qsvt3owgArYUHcKQSJnsEAY6vLbJ5jYrdxxmU2zzGx21i41OY5BnYbWV1l85zb2v1XWBWEnx487cg09TOBIyI8QjUnIsM+HGekG7CRIJkJX3xsB9L0AdaIuPo8wJqZCcu0jers6oTJ6RF4hHXB+Lq0qsfH7UNB/9d2zvHWfTF8VdhOZ3KhOYLfMMjHaknyDOHWy2Gs/pTu48kg8JnTPgMtrAApEqvXuRlGo4WYnpVYz3jd2BseojiZan58an+xzVxlev/5sPSAcGOtznI6hSVENNJdu1FYCH4CS3Lm4Hu/5RkLjz+0W/LLgz3ehus+hqmwbAhd3JGMEMBY+A42/3sGOkbClzaTr32gXLGyIOwyOTvSmQh6vMnlK1tCe66uspmZ9xt7n48WQmHVnr+yO16MaTMus1k1EpWhuyw6Y0sWCUHOw7JmU2b3rc9cqrhvUm3HDaMT3RhVEn/JMbLgvMPyhAttV2s1Uy0UPB2w+s2qoxSzLKMZRkqke378NBaUH8hmk+RU610f9wdJf7//Z5uxDAAAAABJRU5ErkJggg==",q="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAdCAYAAAC9pNwMAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAIRSURBVHgBvZZBjtMwFIb/57QSC5DCDWb2lCFSi8SK+gS0J2jnBnACygmYngBxAnqDRGyQYCSGAYnl9AgBDRKSUz/sKUGdJE6xp9NvUTUvtv/4t9+zCYFcfE7jnwWmxMjvdbE4TGTu07+DQC5X0RtBPALZ/zQxIenTnxDA9w/pQdEVF5uxu5G+7zNrgQBUhGE19svYDg+ChIWIJtUYU/QMHnhb3WRziY/d3jNusrnEx25v4SabS3zs9rK6zeaS/7X7n7AtCPlvxK6GnQ4OQHRiuhyhfcAzZv2iKLB0tYnvIL8SPj9NRwTxDntErH/ES+yZv5uLvOrszoSVWh0bz5fYG/zl2q7++imdgW7bdj3v9eXzWjrZjWbW/DXD7OLdkoP1uDeQmX2oFZCHfblQSksCZdgRBM4KpZNSdB1rYRfWa9avjgZyhtrHbOHb6fuUwUMEwVmvP2y8IGyt1Zr5BwIhcmfK9kOC8BSBMNPIlmL4Cps1Hpq1iBFOfFngEXyFmcQUN4Uwgq+weRls88YoE8fYzVib24qIzU1TEGShdWKeFnAT27GqQee92trsyjUy5+2DgTzZCI1bc35td7YZcs64yWabHnaGFdErTFWamep02HzY1O32uHPpuRI6SR7LM1eL5IlcqkgnDP0W1z+4duw6rVZaj7vC3krYJuS8aZaN4uv71vT8Y5oJYa3nXK34uNruDwvLxkeiALrnAAAAAElFTkSuQmCC",J={components:{Swiper:E,SwiperSlide:N},mixins:[O],data(){return{productId:"",product:{},recipes:[],relevantRecipesInfo:[],fullStar:Z,star:q,score:"",productRates:[],rateMessage:"",averageRate:0,modules:[z,L],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",qty:1}},methods:{...y(U,["addCart","toastMessage","goToTop"]),...y(Y,["addBookmark","deleteBookmark","getBookmark"]),...y(j,["startLoading"]),...y(T,["getRecipes","getRates"]),getAllRateComment(){const r=C(x,"productRates/");M(r,t=>{const _=t.val();this.productRates=Object.values(_).filter(s=>s.productId===this.productId);let f=0;this.productRates.forEach(s=>{f+=s.score}),this.averageRate=Number((f/this.productRates.length).toFixed(1))})},mouseoverStar(r){if(!this.score)for(let t=1;t<=r;t++)this.$refs[`rate${t}`].src=this.fullStar},mouseoutStar(r){if(!this.score)for(let t=1;t<=r;t++)this.$refs[`rate${t}`].src=this.star},addProductRate(){if(!this.score){this.toastMessage("您尚未給予星級評價","error");return}const r=C(x,"productRates/"),t=P(r);Q(t,{productId:this.product.id,createAt:new Date().getTime(),score:Number(this.score),message:this.rateMessage,username:this.user.nickName,userImg:this.user.headshotImg}),this.score=null,this.rateMessage="",this.$refs.form.reset(),this.toastMessage("評價成功")},getProduct(){return new Promise((r,t)=>{const _=C(x,`products/${this.productId}`);M(_,f=>{const s=f.val();r(s)})})},async getData(){this.product=await this.getProduct(),this.product.id=this.productId,this.mainImg=this.product.imgUrl,this.recipes=await this.getRecipes(),this.relevantRecipesInfo=Object.values(this.recipes).filter(r=>this.product.relevantRecipes.includes(r.title)),this.getBookmark("productBookmarks",this.productId)}},mounted(){this.startLoading();const{id:r}=this.$route.params;this.productId=r,this.goToTop(),this.getAllRateComment(),this.getData()},watch:{score(){for(let r=1;r<=5;r++)this.$refs[`rate${r}`].src=this.score>=r?this.fullStar:this.star}},computed:{...B(U,["loadingItem"]),...W(T,["discount"]),...B(Y,["productBookmark","uid","user"])}},X={class:"no-scroll-x"},F={class:"container py-md-96 py-60"},K={"aria-label":"breadcrumb"},$={class:"breadcrumb"},ee={class:"breadcrumb-item"},se={class:"breadcrumb-item active","aria-current":"page"},te={class:"row row-cols-lg-2 row-cols-1 g-5"},oe={class:"col"},re=["src","alt"],ie={class:"sub-picture-swiper position-relative"},le=["src"],ne=["src","alt","onClick"],ae={class:"col d-flex flex-column"},ce={class:"d-flex align-items-center mb-3"},de={key:0,class:"badge rounded-pill bg-primary fs-6 me-2"},ue={class:"mb-0 fs-lg-4 fs-5 fw-bold"},me={class:"d-flex align-items-center ms-auto"},pe=e("i",{class:"bi bi-heart fs-4"},null,-1),ge=[pe],he=e("i",{class:"bi bi-heart-fill fs-4"},null,-1),be=[he],fe=e("i",{class:"bi bi-star-fill"},null,-1),ve={class:"mb-5 lh-lg"},Ae={class:"d-flex justify-content-between align-items-center mt-auto mb-md-5"},we={key:0,class:"me-2 text-muted fs-6"},_e=e("br",null,null,-1),ke={class:"fs-5"},ye={class:"input-group w-50"},Re=["value"],Se=["disabled"],Ce={class:"bg-light-purple-secondary"},xe={class:"container py-lg-96 py-5"},Ie=e("h3",{class:"d-flex align-items-center mb-4 fw-bold text-purple border-bottom pb-1 border-purple"},[e("span",{class:"material-icons me-2"}," auto_awesome "),d(" 相關食譜 ")],-1),Be={class:"swiper-relative-recipes d-none d-lg-block position-relative"},Me={class:"card bg-transparent"},Ue=["src","alt"],Ye=e("p",{class:"detail position-absolute top-50 start-50 translate-middle fw-bold link-darkBrown letter-spacing-5 text-center"},[d("查看"),e("br"),d("詳細食譜")],-1),Te={class:"fs-6"},je={class:"swiper-relative-recipes d-lg-none position-relative",style:{height:"220px"}},Ee=["src","alt"],Ne={class:"fw-bold mt-2 text-center fs-14"},ze={class:"container py-lg-96 py-5"},Le={class:"d-flex align-items-center fw-bold text-purple border-bottom pb-1 border-purple mb-4"},Ve=e("span",{class:"material-icons me-2"}," auto_awesome ",-1),Ge={class:"mb-2 fw-bold d-flex align-items-center"},He=["src"],We={key:1,class:"bi bi-person-circle me-3 fs-45"},Pe={class:"d-flex mb-3"},Qe={class:"form-check px-1"},Oe=["src"],De={class:"form-check px-1"},Ze=["src"],qe={class:"form-check px-1"},Je=["src"],Xe={class:"form-check px-1"},Fe=["src"],Ke={class:"form-check px-1"},$e=["src"],es=e("div",{class:"d-flex"},[e("button",{type:"submit",class:"ms-auto btn btn-primary my-3"},"送出")],-1),ss={class:"row gy-5"},ts={class:"d-flex align-items-center mb-2"},os=["src"],rs={key:1,class:"bi bi-person-circle me-3 mb-auto fs-45 lh-1"},is={class:"fs-6 mb-0"},ls={class:"mb-0"},ns={class:"mb-2"};function as(r,t,_,f,s,a){const v=I("RouterLink"),k=I("swiper-slide"),S=I("swiper");return i(),n("div",X,[e("section",F,[e("nav",K,[e("ol",$,[e("li",ee,[u(v,{to:"/products",class:"link-primary"},{default:c(()=>[d("材料購買")]),_:1})]),e("li",se,l(s.product.title),1)])]),e("div",te,[e("div",oe,[e("img",{src:s.mainImg,style:{height:"300px"},class:"w-100 object-fit-cover mb-4",alt:s.product.title},null,8,re),e("div",ie,[u(S,{"slides-per-view":3,"space-between":15,modules:s.modules,navigation:"",style:{height:"160px"}},{default:c(()=>[u(k,null,{default:c(()=>[e("img",{src:s.product.imgUrl,alt:"產品主圖片",class:g(["cursor-pointer object-fit-cover w-100",{border:s.mainImg===s.product.imgUrl,"border-3":s.mainImg===s.product.imgUrl,"border-primary":s.mainImg===s.product.imgUrl}]),style:{height:"100px"},onClick:t[0]||(t[0]=()=>s.mainImg=s.product.imgUrl)},null,10,le)]),_:1}),(i(!0),n(h,null,b(s.product.imgsUrl,(o,A)=>(i(),R(k,{key:o},{default:c(()=>[e("img",{src:o,alt:`產品副圖片${A+1}`,class:g(["cursor-pointer object-fit-cover w-100",{border:s.mainImg===o,"border-3":s.mainImg===o,"border-primary":s.mainImg===o}]),style:{height:"100px"},onClick:()=>s.mainImg=o},null,10,ne)]),_:2},1024))),128))]),_:1},8,["modules"])])]),e("div",ae,[e("div",ce,[s.product.isCheaper?(i(),n("span",de,l(r.discount(s.product))+" 折 ",1)):m("",!0),e("h2",ue,l(s.product.title),1),e("div",me,[r.productBookmark?r.productBookmark?(i(),n("button",{key:1,type:"button",class:"border-0 bg-transparent text-tomato p-0 mt-1",onClick:t[2]||(t[2]=o=>r.deleteBookmark("productBookmarks",s.product.id))},be)):m("",!0):(i(),n("button",{key:0,type:"button",class:"border-0 bg-transparent text-tomato p-0 mt-1",onClick:t[1]||(t[1]=()=>r.addBookmark("productBookmarks",s.product))},ge)),e("div",{class:g(["badge border rounded-pill ms-4 fs-6",{"text-yellow":s.averageRate,"text-gray":!s.averageRate,"border-yellow":s.averageRate,"border-gray":!s.averageRate,"bg-lightYellow":s.averageRate,"bg-whiteGray":!s.averageRate}])},[d(l(s.averageRate?s.averageRate:0)+" ",1),fe],2)])]),e("p",ve,l(s.product.description),1),e("div",Ae,[e("p",null,[s.product.isCheaper?(i(),n("del",we,"NT$ "+l(r.numberComma(s.product.originalPrice)),1)):m("",!0),_e,e("span",ke,[e("span",{class:g({"text-danger":s.product.isCheaper,"fw-bold":s.product.isCheaper})},"NT$ "+l(r.numberComma(s.product.price)),3),d(" / "+l(s.product.num)+l(s.product.unit),1)])]),e("div",ye,[p(e("select",{name:"",id:"",class:"form-select text-center","onUpdate:modelValue":t[3]||(t[3]=o=>s.qty=o)},[(i(),n(h,null,b(30,o=>e("option",{value:o,key:o+4596945},l(o),9,Re)),64))],512),[[V,s.qty]]),e("button",{disabled:r.loadingItem==="loading",class:"btn btn-primary",type:"button",onClick:t[4]||(t[4]=()=>r.addCart(s.product,s.qty))}," 購買 ",8,Se)])])])])]),e("section",Ce,[e("div",xe,[Ie,e("div",Be,[u(S,{"slides-per-view":5,"space-between":15,style:{height:"250px"},modules:s.modules,navigation:""},{default:c(()=>[(i(!0),n(h,null,b(s.relevantRecipesInfo,o=>(i(),R(k,{key:o.id},{default:c(()=>[e("div",Me,[u(v,{to:`/recipes/${o.id}`,class:"card-img-hover position-relative mb-2"},{default:c(()=>[e("img",{src:o.image,alt:o.title,class:"object-fit-cover card-img",style:{height:"150px !important"}},null,8,Ue),Ye]),_:2},1032,["to"]),u(v,{to:`/recipes/${o.id}`,class:"text-center"},{default:c(()=>[e("h5",Te,l(o.title),1)]),_:2},1032,["to"])])]),_:2},1024))),128))]),_:1},8,["modules"])]),e("div",je,[u(S,{"slides-per-view":2,"space-between":15,class:"w-100 h-100",modules:s.modules,navigation:""},{default:c(()=>[(i(!0),n(h,null,b(s.relevantRecipesInfo,o=>(i(),R(k,{key:o.id},{default:c(()=>[u(v,{to:`/recipes/${o.id}`,class:"link-primary"},{default:c(()=>[e("img",{src:o.image,alt:o.title,class:"object-fit-cover w-100",style:{height:"130px"}},null,8,Ee),e("h5",Ne,l(o.title),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1},8,["modules"])])])]),e("section",ze,[e("h3",Le,[Ve,d(" 顧客評價 "),e("div",{class:g(["ms-3 badge border rounded-pill fs-6",{"text-yellow":s.productRates.length,"text-gray":!s.productRates.length,"border-yellow":s.productRates.length,"border-gray":!s.productRates.length,"bg-lightYellow":s.productRates.length,"bg-whiteGray":!s.productRates.length}])},l(s.productRates.length)+" 則 ",3),r.uid?m("",!0):(i(),R(v,{key:0,to:"/loginSignup",class:"ms-auto mb-1 btn btn-outline-gradient rounded-pill"},{default:c(()=>[d("我要登入寫評價")]),_:1}))]),e("h5",Ge,[r.user.headshotImg?(i(),n("img",{key:0,src:r.user.headshotImg,alt:"大頭貼",width:"50",height:"50",class:"rounded-circle me-3 object-fit-cover"},null,8,He)):r.user.headshotImg?m("",!0):(i(),n("i",We)),d(" "+l(r.user.nickName),1)]),r.uid?(i(),n("form",{key:0,ref:"form",onSubmit:t[21]||(t[21]=G((...o)=>a.addProductRate&&a.addProductRate(...o),["prevent"])),class:"mt-2"},[e("div",Pe,[e("div",Qe,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"rate",id:"star1",value:"1","onUpdate:modelValue":t[5]||(t[5]=o=>s.score=o)},null,512),[[w,s.score]]),e("label",{class:"form-check-label cursor-pointer",for:"star1",onMouseover:t[6]||(t[6]=()=>a.mouseoverStar(1)),onMouseout:t[7]||(t[7]=()=>a.mouseoutStar(1))},[e("img",{ref:"rate1",src:s.star,width:"25"},null,8,Oe)],32)]),e("div",De,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"rate",id:"star2",value:"2","onUpdate:modelValue":t[8]||(t[8]=o=>s.score=o)},null,512),[[w,s.score]]),e("label",{class:"form-check-label cursor-pointer",for:"star2",onMouseover:t[9]||(t[9]=()=>a.mouseoverStar(2)),onMouseout:t[10]||(t[10]=()=>a.mouseoutStar(2))},[e("img",{ref:"rate2",src:s.star,width:"25"},null,8,Ze)],32)]),e("div",qe,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"rate",id:"star3",value:"3","onUpdate:modelValue":t[11]||(t[11]=o=>s.score=o)},null,512),[[w,s.score]]),e("label",{class:"form-check-label cursor-pointer",for:"star3",onMouseover:t[12]||(t[12]=()=>a.mouseoverStar(3)),onMouseout:t[13]||(t[13]=()=>a.mouseoutStar(3))},[e("img",{ref:"rate3",src:s.star,width:"25"},null,8,Je)],32)]),e("div",Xe,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"rate",id:"star4",value:"4","onUpdate:modelValue":t[14]||(t[14]=o=>s.score=o)},null,512),[[w,s.score]]),e("label",{class:"form-check-label cursor-pointer",for:"star4",onMouseover:t[15]||(t[15]=()=>a.mouseoverStar(4)),onMouseout:t[16]||(t[16]=()=>a.mouseoutStar(4))},[e("img",{ref:"rate4",src:s.star,width:"25"},null,8,Fe)],32)]),e("div",Ke,[p(e("input",{class:"form-check-input d-none",type:"radio",name:"rate",id:"star5",value:"5","onUpdate:modelValue":t[17]||(t[17]=o=>s.score=o)},null,512),[[w,s.score]]),e("label",{class:"form-check-label cursor-pointer",for:"star5",onMouseover:t[18]||(t[18]=()=>a.mouseoverStar(5)),onMouseout:t[19]||(t[19]=()=>a.mouseoutStar(5))},[e("img",{ref:"rate5",src:s.star,width:"25"},null,8,$e)],32)])]),p(e("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":t[20]||(t[20]=o=>s.rateMessage=o)},null,512),[[H,s.rateMessage]]),es],544)):m("",!0),e("div",ss,[(i(!0),n(h,null,b(s.productRates,o=>(i(),n("div",{class:"col-12 border-bottom",key:o.id},[e("div",ts,[o.userImg?(i(),n("img",{key:0,src:o.userImg,alt:"大頭貼",width:"50",height:"50",class:"rounded-circle me-3 object-fit-cover mb-auto"},null,8,os)):o.userImg?m("",!0):(i(),n("i",rs)),e("div",null,[e("h5",is,l(o.username),1),e("p",ls,[(i(),n(h,null,b(5,A=>e("i",{key:A+400,class:g(["bi bi-star-fill me-1",{"text-yellow":o.score>=A,"text-lightGray":o.score<A}])},null,2)),64))]),e("p",null,l(new Date(o.createAt).toLocaleString().split(":")[0])+":"+l(new Date(o.createAt).toLocaleString().split(":")[1]),1),e("p",ns,l(o.message),1)])])]))),128))])])])}const vs=D(J,[["render",as]]);export{vs as default};
