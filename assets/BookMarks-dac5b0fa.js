import{R as E}from"./vue-router-2c21c692.js";import{m as j}from"./modalMixin-c1848f69.js";import{c as D,r as _,d as p,o as N,s as O,b as M,a as L}from"./db-143b9a4b.js";import{m as T,a as V}from"./index-17d9ec8c.js";import{c as S}from"./carts-1342d558.js";import{_ as P,o,U as a,V as t,Y as h,Z as c,a0 as d,a4 as u,a1 as B,a2 as w,c as I,X as y,W as x,r as R,a5 as F}from"./_plugin-vue_export-helper-03b40388.js";import{n as A}from"./numberCommaMixin-e0aac39c.js";import{_ as C}from"./image4-1806383b.js";import{_ as $}from"./icon-cart-6dfbd1c6.js";import{_ as G}from"./loadingLogo-3bb466c0.js";import"./modal-838a1639.js";import"./_commonjsHelpers-042e6b4d.js";import"./base-component-5a126788.js";const U={data(){return{bookMark:{},deleteId:""}},mixins:[j],props:["id","item","pageStatus","openDeleteModal"],methods:{...T(S,["toastMessage"]),deleteBookmark(){let n="recipeBookmarks";this.pageStatus==="product"&&(n="productBookmarks"),D(_(p,`${n}/${this.uid}/${this.deleteId}`)),this.toastMessage("刪除收藏"),this.hide()}},watch:{id(){this.id&&(this.show(),this.bookMark=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}},computed:{...V(S,["uid"])},mounted(){}},z={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},W={class:"modal-dialog modal-dialog-centered"},X={class:"modal-content"},Y=t("div",{class:"modal-header bg-dark"},[t("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除收藏 "),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Z={class:"modal-body"},q={key:0},H={key:1},J={class:"text-danger fw-bold"},K={class:"modal-footer"},Q=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function ss(n,r,g,m,e,k){return o(),a("div",z,[t("div",W,[t("div",X,[Y,t("div",Z,[t("p",null,[h("確定要刪除"),this.pageStatus==="recipe"?(o(),a("span",q,"食譜")):this.pageStatus==="product"?(o(),a("span",H,"產品")):c("",!0),h("收藏 "),t("span",J," 【"+d(this.bookMark.title)+"】 ",1),h(" 嗎? ")])]),t("div",K,[Q,t("button",{type:"button",class:"btn btn-danger",onClick:r[0]||(r[0]=()=>k.deleteBookmark())},"確認刪除")])])])],512)}const ts=P(U,[["render",ss]]),es="/finalEasyBuyEasyMake/assets/undraw_Appreciation_r2a1-a5682803.png";const os={components:{RouterLink:E,DeleteBookmarksModal:ts},mixins:[A],data(){return{bookMarks:[],pageStatus:"recipe",deleteId:"",deleteItem:{},AllproductRates:[],averageRate:[],rates:{},recipeThumbs:[],thumbs:{},loadingItem:!0}},methods:{...T(S,["addCart","toastMessage"]),getBookmarks(n){this.loadingItem=!0,N(L,r=>{if(r){this.uid=r.uid,console.log(this.uid,"使用者已登入取得 uid");const g=_(p,"users/"+r.uid);M(g,m=>{this.user=m.val();const e=_(p,`${n}/${this.uid}`);M(e,k=>{if(this.bookMarks=k.val(),!this.bookMarks){this.loadingItem=!1;return}if(this.bookMarks=Object.values(this.bookMarks),console.log(this.bookMarks,"書籤"),this.pageStatus==="recipe"){const b=_(p,"recipeThumbs");M(b,v=>{const s=v.val();Object.keys(s).forEach(i=>{this.thumbs[i]=Object.values(s[i]).length}),console.log(this.thumbs,"所有讚"),this.bookMarks.forEach((i,l)=>{Object.keys(this.thumbs).forEach(f=>{i.id===f&&(this.bookMarks[l].thumbs=this.thumbs[i.id])})}),this.bookMarks.forEach((i,l)=>{i.thumbs||(this.bookMarks[l].thumbs=0)}),console.log(this.bookMarks,"食譜")})}else if(this.pageStatus==="product"){const b=_(p,"productRates/");M(b,v=>{let s=v.val();s=Object.values(s).map(i=>Object.values(i)),s=s.flat(),console.log(s,"全部產品的評價還未分類產品"),this.bookMarks.forEach((i,l)=>{s.forEach(f=>{i.id===f.productId&&!this.bookMarks[l].scores?(this.bookMarks[l].scores=f.score,this.bookMarks[l].ratePeople=1,this.bookMarks[l].averageRate=Number((this.bookMarks[l].scores/this.bookMarks[l].ratePeople).toFixed(1))):i.id===f.productId&&this.bookMarks[l].scores&&(this.bookMarks[l].scores+=f.score,this.bookMarks[l].ratePeople+=1,this.bookMarks[l].averageRate=Number((this.bookMarks[l].scores/this.bookMarks[l].ratePeople).toFixed(1)))})}),this.bookMarks.forEach((i,l)=>{i.averageRate||(this.bookMarks[l].scores=0,this.bookMarks[l].ratePeople=0,this.bookMarks[l].averageRate=0)}),console.log(this.bookMarks,"加了評分的產品")})}this.loadingItem=!1})})}else console.log("並未登入"),this.uid=null,this.user={},this.uid||(this.toastMessage("登入才可使用收藏功能","error"),this.$router.push("/login")),console.log("並未登入")})},addBookmark(n,r){this.uid||this.toastMessage("登入才可使用收藏功能","error");const g=_(p,`${n}/${this.uid}/${r.id}`);O(g,r),this.toastMessage("收藏成功")},openDeleteModal(n,r){this.deleteId=n,this.deleteItem=r},getRecipeThumbs(){const n=_(p,"recipeThumbs");M(n,r=>{const g=r.val();Object.keys(g).forEach(m=>{this.thumbs[m]=Object.values(g[m]).length}),console.log(this.thumbs,"所有讚"),this.recipes.forEach((m,e)=>{Object.keys(this.thumbs).forEach(k=>{m.id===k&&(this.recipes[e].thumbs=this.thumbs[m.id])})}),this.recipes.forEach((m,e)=>{m.thumbs||(this.recipes[e].thumbs=0)}),console.log(this.recipes,"食譜")})}},mounted(){this.getBookmarks("recipeBookmarks")},watch:{pageStatus(){console.log(this.pageStatus,"有變化"),this.pageStatus==="product"?this.getBookmarks("productBookmarks"):this.pageStatus==="recipe"&&this.getBookmarks("recipeBookmarks")}}},as={class:"my-7"},is=t("div",{class:"bg-lightPink py-5 mb-3",style:{}},[t("h3",{class:"text-center fw-bold text-red"},[t("i",{class:"bi bi-heart-fill fs-4 link-red"}),h(" 我的收藏")])],-1),ls={class:""},ns={class:"nav nav-tabs container"},rs=["disabled"],ds=t("i",{class:"bi bi-book-half"},null,-1),cs=["disabled"],hs=t("i",{class:"bi bi-bag-check-fill"},null,-1),ms={class:"container py-4"},bs={key:0,class:"row row-cols-lg-4 row-cols-2 gy-4"},ks={class:"card position-relative bg-transparent",style:{"border-radius":"0",border:"1px solid transparent"}},us={class:"cardImg",style:{}},gs=["src"],_s={class:"card-text mb-0"},ps=["onClick"],fs=t("img",{src:C},null,-1),ys=[fs],vs=["onClick"],Ms=t("img",{src:C},null,-1),xs=[Ms],Bs={style:{"pointer-events":"none"},class:"cardTextCategory badge rounded-pill bg-red mt-4 border-0 m-3 position-absolute start-0"},ws={class:"d-flex justify-content-between align-items-center fw-bold"},Cs={class:"cardTextTitle"},Ss={class:"cardTextPrice d-flex align-items-lg-center align-items-end"},Is={class:""},Rs={class:"starRates mb-0 ms-auto"},Ts={class:"me-1"},Ps=t("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),Es={key:1,class:"row row-cols-lg-4 row-cols-2 gy-4"},js={class:"card position-relative bg-transparent",style:{"border-radius":"0",border:"1px solid transparent"}},Ds={class:"cardImg",style:{}},Ns=["src"],Os={class:"card-text mb-0"},Ls=["onClick"],Vs=t("img",{src:C},null,-1),Fs=[Vs],As={key:0,style:{"pointer-events":"none"},class:"d-flex flex-column align-items-center text-white p-2 bg-red position-absolute top-0 start-0"},$s=["onClick"],Gs=t("img",{src:C},null,-1),Us=[Gs],zs=["disabled","onClick"],Ws=t("img",{src:$,alt:"",class:"rounded-circle shadow-sm"},null,-1),Xs=[Ws],Ys={class:"fw-bold cardTextTitle"},Zs={class:""},qs={class:"mt-1 d-block d-lg-inline-block"},Hs={class:"mb-0 ms-auto starRates"},Js={class:"me-1"},Ks=t("i",{class:"bi bi-star-fill"},null,-1),Qs={key:2,class:"d-flex flex-column align-items-center py-10"},st=F('<img src="'+G+'" class="loadingLogo mb-3" style="width:150px;" alt=""><h1 class="text-center fw-bold text-lightBrown"><span class="me-1 animate-text">L</span><span class="mx-1 animate-text">o</span><span class="mx-1 animate-text">a</span><span class="mx-1 animate-text">d</span><span class="mx-1 animate-text">i</span><span class="mx-1 animate-text">n</span><span class="mx-1 animate-text">g</span><span class="mx-2 animate-text">.</span><span class="me-2 animate-text">.</span><span class="animate-text">.</span></h1>',2),tt=[st],et={key:3,class:"py-5 d-flex flex-column align-items-center"},ot=t("img",{src:es,class:"",alt:"",style:{height:"250px"}},null,-1),at={key:0},it={key:1};function lt(n,r,g,m,e,k){const b=R("RouterLink"),v=R("DeleteBookmarksModal");return o(),a("div",as,[is,t("section",ls,[t("ul",ns,[t("li",{class:"nav-item",onClick:r[0]||(r[0]=()=>e.pageStatus="recipe")},[t("button",{class:u(["nav-link",{"link-red":e.pageStatus==="recipe",active:e.pageStatus==="recipe"}]),type:"button",disabled:e.loadingItem},[ds,h(" 食譜收藏")],10,rs)]),t("li",{class:"nav-item",onClick:r[1]||(r[1]=()=>e.pageStatus="product")},[t("button",{class:u(["nav-link",{"link-red":e.pageStatus==="product",active:e.pageStatus==="product"}]),type:"button",disabled:e.loadingItem},[hs,h(" 材料收藏")],10,cs)])])]),t("div",ms,[e.pageStatus==="recipe"&&e.bookMarks&&!e.loadingItem?(o(),a("div",bs,[(o(!0),a(B,null,w(e.bookMarks,s=>(o(),a("div",{class:"col text-decoration-none",key:s.id},[t("div",ks,[t("div",us,[x(b,{to:`/recipes/${s.id}`,class:"enlargeImg"},{default:y(()=>[t("img",{src:s.image,class:"card-img",style:{"border-radius":"0","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,gs)]),_:2},1032,["to"])]),t("h5",_s,[t("div",null,[t("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>k.openDeleteModal(s.id,s)},ys,8,ps)]),(o(!0),a(B,null,w(e.bookMarks,i=>(o(),a("div",{key:i+4567},[i===s.id?(o(),a("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>n.deleteBookmark(s.id)},xs,8,vs)):c("",!0)]))),128)),t("span",Bs,d(s.category),1)]),x(b,{to:`/recipes/${s.id}`,class:"pt-lg-3 card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:y(()=>[t("h5",ws,[t("span",Cs,d(s.title),1)]),t("div",Ss,[t("div",Is,[s.total?(o(),a("del",{key:0,class:u(["me-2 text-muted d-block d-lg-inline-block",{"d-none":s.price===s.total}])},"NT$ "+d(n.numberComma(s.total)),3)):c("",!0),t("span",null,[s.price?(o(),a("span",{key:0,class:u({"text-danger":s.price!==s.total,"fw-bold":s.price!==s.total})},"NT$ "+d(n.numberComma(s.price)),3)):c("",!0),h(" / "+d(s.content),1)])]),t("h5",Rs,[t("p",{class:u(["mb-0 badge rounded-pill border d-flex align-items-center",{"border-red":s.thumbs!==0,"border-lightBrownGray":s.thumbs===0,"text-red":s.thumbs!==0,"text-lightBrownGray":s.thumbs===0}])},[t("span",Ts,d(s.thumbs),1),Ps],2)])])]),_:2},1032,["to"])])]))),128))])):e.pageStatus==="product"&&e.bookMarks&&!e.loadingItem?(o(),a("div",Es,[(o(!0),a(B,null,w(e.bookMarks,s=>(o(),a("div",{class:"col text-decoration-none",key:s.id},[t("div",js,[t("div",Ds,[x(b,{to:`/products/${s.id}`,class:"enlargeImg border-0"},{default:y(()=>[t("img",{src:s.imgUrl,class:"card-img",height:"220",style:{"border-radius":"0","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Ns)]),_:2},1032,["to"])]),t("h5",Os,[t("div",null,[t("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>k.openDeleteModal(s.id,s)},Fs,8,Ls)]),s.isCheaper?(o(),a("span",As,d((100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))%10===0?(100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0)).toString().charAt(0):100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))+" 折 ",1)):c("",!0),(o(!0),a(B,null,w(e.bookMarks,i=>(o(),a("div",{key:i},[i===s.id?(o(),a("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>n.deleteBookmark(s.id)},Us,8,$s)):c("",!0)]))),128)),t("button",{disabled:e.loadingItem==="loading",onClick:()=>n.addCart(s),type:"button",class:"buyBtn border-0 bg-transparent me-lg-2 me-1 position-absolute end-0"},Xs,8,zs)]),x(b,{to:`/products/${s.id}`,class:"pt-lg-3 card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:y(()=>[t("h5",Ys,d(s.title),1),t("div",{class:u(["d-flex align-items-lg-center cardTextPrice",{"align-items-end":s.isCheaper,"align-items-center":!s.isCheaper}])},[t("div",Zs,[s.originalPrice?(o(),a("del",{key:0,class:u(["me-2 text-muted mt-1",{"d-none":!s.isCheaper}])},"NT$ "+d(n.numberComma(s.originalPrice)),3)):c("",!0),t("span",qs,[s.price?(o(),a("span",{key:0,class:u({"text-danger":s.isCheaper,"fw-bold":s.isCheaper})}," NT$ "+d(n.numberComma(s.price)),3)):c("",!0),h(" / "+d(s.num)+d(s.unit),1)])]),t("h5",Hs,[t("div",{class:u(["badge border rounded-pill bg-white",{"text-orange":s.averageRate,"border-orange":s.averageRate,"text-lightBrownGray":!s.averageRate,"border-lightBrownGray":!s.averageRate}])},[t("span",Js,d(s.averageRate),1),Ks],2)])],2)]),_:2},1032,["to"])])]))),128))])):e.loadingItem?(o(),a("div",Qs,tt)):c("",!0),!e.loadingItem&&!e.bookMarks?(o(),a("div",et,[ot,t("h2",null,[h("您尚無任何"),e.pageStatus==="recipe"?(o(),a("span",at,"食譜")):e.pageStatus==="product"?(o(),a("span",it,"材料")):c("",!0),h("收藏")]),e.pageStatus==="recipe"?(o(),I(b,{key:0,to:"/recipes",class:"link-red h5"},{default:y(()=>[h("前往瀏覽食譜")]),_:1})):e.pageStatus==="product"?(o(),I(b,{key:1,to:"/products",class:"link-red h5"},{default:y(()=>[h("前往瀏覽食譜材料")]),_:1})):c("",!0)])):c("",!0)]),x(v,{id:e.deleteId,item:e.deleteItem,"page-status":e.pageStatus,"open-delete-modal":k.openDeleteModal},null,8,["id","item","page-status","open-delete-modal"])])}const yt=P(os,[["render",lt]]);export{yt as default};
