import{m as y}from"./modalMixin-1ccdf387.js";import{u as V,r,p as E,s as U,d as m,b as M,c as w,e as S}from"./carts-e36b449b.js";import{f as x}from"./index-fc788f37.js";import{l as u,v as L}from"./runtime-dom.esm-bundler-5f84711a.js";import{_,o as d,c as a,b as t,ak as b,bk as i,ao as D,b7 as c,r as g,F as N,aY as T,a as v}from"./_plugin-vue_export-helper-f96b5234.js";import"./base-component-2499946e.js";const B={data(){return{tempCoupon:{isEnabled:!1},status:"edit",startDate:"",dueDate:"",couponId:""}},mixins:[y],props:["id","openModal"],methods:{...x(w,["toastMessage"]),updateCoupon(){if(this.tempCoupon.startDate=new Date(this.startDate).getTime(),this.tempCoupon.dueDate=new Date(this.dueDate).getTime(),!this.tempCoupon.code||!this.tempCoupon.discount||!this.tempCoupon.condition||!this.tempCoupon.description||!this.tempCoupon.image||!this.tempCoupon.startDate||!this.tempCoupon.dueDate||!this.tempCoupon.title){this.toastMessage("資料沒寫完","error");return}if(this.status==="edit")V(r(m),{[`coupons/${this.couponId}/`]:{code:this.tempCoupon.code,discount:this.tempCoupon.discount,condition:this.tempCoupon.condition,startDate:this.tempCoupon.startDate,dueDate:this.tempCoupon.dueDate,isEnabled:this.tempCoupon.isEnabled,description:this.tempCoupon.description,image:this.tempCoupon.image,title:this.tempCoupon.title}}),this.toastMessage("更改成功");else if(this.status==="new"){const n=r(m,"coupons/"),o=E(n);this.tempCoupon.isEnabled||(this.tempCoupon.isEnabled=!1),U(o,{code:this.tempCoupon.code,discount:this.tempCoupon.discount,condition:this.tempCoupon.condition,startDate:this.tempCoupon.startDate,dueDate:this.tempCoupon.dueDate,isEnabled:this.tempCoupon.isEnabled,description:this.tempCoupon.description,image:this.tempCoupon.image,title:this.tempCoupon.title}),this.toastMessage("新增成功")}this.hide()}},mounted(){},watch:{id(){if(this.id!=="new"&&this.id!==""){const n=r(m,`coupons/${this.id}`);M(n,o=>{if(this.tempCoupon=o.val(),!this.tempCoupon){this.hide();return}this.tempCoupon.id=this.id,this.dueDate=new Date(this.tempCoupon.dueDate).toISOString().split("T")[0],this.startDate=new Date(this.tempCoupon.startDate).toISOString().split("T")[0],this.show(),this.status="edit",this.couponId=this.id,this.openModal("")})}else this.id==="new"&&(this.tempCoupon={},this.show(),this.status="new",this.openModal(""))}}},R={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},A={class:"modal-dialog modal-xl"},F={key:0,class:"modal-content"},O={class:"modal-header bg-dark"},P={class:"modal-title text-white",id:"exampleModalLabel"},Y={key:0},j={key:1},q=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),z={class:"modal-body"},G={class:"row"},H={class:"col-lg-4"},J=t("label",{for:"image",class:"form-label"},"主圖網址",-1),K=["src"],Q={class:"col-lg-8"},W={class:"row gy-3"},X={class:"col-lg-4"},Z=t("label",{for:"serialNumber",class:"form-label"},"編號（id）",-1),$={class:"col-lg-6"},tt=t("label",{for:"title",class:"form-label"},"優惠券名稱",-1),ot={class:"col-lg-2"},et=t("label",{for:"price",class:"form-label"},"折扣(%)",-1),st={class:"col-lg-3"},nt=t("label",{for:"date",class:"form-label"},"起始日",-1),lt={class:"col-lg-3"},it=t("label",{for:"date",class:"form-label"},"到期日",-1),dt={class:"col-lg-3"},at=t("label",{for:"code",class:"form-label"},"優惠碼",-1),pt={class:"col-lg-3"},ut=t("label",{for:"condition",class:"form-label"},"條件 >= 金額",-1),ct={class:"col-12"},rt={class:"form-check"},mt=t("label",{class:"form-check-label",for:"isEnabled"}," 是否啟用 ",-1),ht={class:"col-12"},bt=t("label",{for:"description",class:"form-label"},"優惠券描述",-1),_t={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),ft={key:0},Dt={key:1};function gt(n,o,C,f,e,l){return d(),a("div",R,[t("div",A,[e.tempCoupon?(d(),a("div",F,[t("div",O,[t("h5",P,[e.status==="edit"?(d(),a("span",Y,"編輯優惠券內容")):e.status==="new"?(d(),a("span",j,"新增優惠券內容")):b("",!0)]),q]),t("div",z,[t("div",G,[t("div",H,[J,i(t("input",{type:"text",id:"image",class:"form-control mb-3","onUpdate:modelValue":o[0]||(o[0]=s=>e.tempCoupon.image=s)},null,512),[[u,e.tempCoupon.image]]),t("img",{src:e.tempCoupon.image,alt:"優惠券照片",width:"300"},null,8,K)]),t("div",Q,[t("div",W,[t("div",X,[Z,i(t("input",{type:"text",id:"serialNumber",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>e.tempCoupon.id=s),disabled:""},null,512),[[u,e.tempCoupon.id]])]),t("div",$,[tt,i(t("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>e.tempCoupon.title=s)},null,512),[[u,e.tempCoupon.title]])]),t("div",ot,[et,i(t("input",{type:"text",id:"price",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>e.tempCoupon.discount=s)},null,512),[[u,e.tempCoupon.discount,void 0,{number:!0}]])]),t("div",st,[nt,i(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>e.startDate=s)},null,512),[[u,e.startDate]])]),t("div",lt,[it,i(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>e.dueDate=s)},null,512),[[u,e.dueDate]])]),t("div",dt,[at,i(t("input",{type:"text",id:"code",class:"form-control","onUpdate:modelValue":o[6]||(o[6]=s=>e.tempCoupon.code=s)},null,512),[[u,e.tempCoupon.code]])]),t("div",pt,[ut,i(t("input",{type:"text",id:"condition",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=s=>e.tempCoupon.condition=s)},null,512),[[u,e.tempCoupon.condition,void 0,{number:!0}]])]),t("div",ct,[t("div",rt,[i(t("input",{class:"form-check-input",type:"checkbox","v-true":1,"v-false":0,id:"isEnabled","onUpdate:modelValue":o[8]||(o[8]=s=>e.tempCoupon.isEnabled=s)},null,512),[[L,e.tempCoupon.isEnabled]]),mt])]),t("div",ht,[bt,i(t("textarea",{name:"",id:"description",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":o[9]||(o[9]=s=>e.tempCoupon.description=s)},null,512),[[u,e.tempCoupon.description]])])])])])]),t("div",_t,[Ct,t("button",{type:"button",class:"btn btn-primary",onClick:o[10]||(o[10]=(...s)=>l.updateCoupon&&l.updateCoupon(...s))},[e.status==="edit"?(d(),a("span",ft,"確認編輯")):e.status==="new"?(d(),a("span",Dt,"確認新增")):b("",!0)])])])):b("",!0)])],512)}const vt=_(B,[["render",gt]]),yt={data(){return{tempCoupon:{},deleteId:""}},mixins:[y],props:["id","openDeleteModal","item"],methods:{...x(w,["toastMessage"]),deleteCoupon(){S(r(m,`coupons/${this.deleteId}`)),this.toastMessage("刪除優惠券"),this.hide()}},watch:{id(){this.id&&(this.show(),this.tempCoupon=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}}},Mt={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},wt={class:"modal-dialog"},xt={class:"modal-content"},kt=t("div",{class:"modal-header bg-dark"},[t("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除優惠券 "),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),It={class:"modal-body"},Vt={class:"text-danger fw-bold"},Et={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function St(n,o,C,f,e,l){return d(),a("div",Mt,[t("div",wt,[t("div",xt,[kt,t("div",It,[t("p",null,[D("確定要刪除優惠券 "),t("span",Vt," 【"+c(e.tempCoupon.title)+"】 ",1),D(" 嗎? ")])]),t("div",Et,[Ut,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...s)=>l.deleteCoupon&&l.deleteCoupon(...s))}," 確認刪除 ")])])])],512)}const Lt=_(yt,[["render",St]]),Nt={components:{CouponModal:vt,DeleteCouponModal:Lt},data(){return{coupons:{},couponId:"",couponDeleteId:"",couponDeleteItem:{}}},methods:{getCoupons(){const n=r(m,"coupons/");M(n,o=>{this.coupons=o.val(),console.log(this.coupons,"折價券")})},openModal(n){this.couponId=n},openDeleteModal(n,o){this.couponDeleteId=n,this.couponDeleteItem=o}},mounted(){this.getCoupons()}},Tt={class:"container"},Bt={class:"d-flex my-4"},Rt={class:"table text-center",style:{"vertical-align":"middle"}},At=t("thead",null,[t("tr",null,[t("th",null,"編號"),t("th",null,"名稱"),t("th",null,"優惠碼"),t("th",null,"折扣百分比"),t("th",null,"詳細內容"),t("th",null,"起始日"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Ft={class:"btn-group"},Ot=["onClick"],Pt=["onClick"];function Yt(n,o,C,f,e,l){const s=g("CouponModal"),k=g("DeleteCouponModal");return d(),a("div",Tt,[t("div",Bt,[t("button",{type:"button",class:"ms-auto btn btn-primary",onClick:o[0]||(o[0]=p=>l.openModal("new"))},"建立新優惠券")]),t("table",Rt,[At,t("tbody",null,[(d(!0),a(N,null,T(e.coupons,(p,h)=>(d(),a("tr",{key:h},[t("td",null,c(h),1),t("td",null,c(p.title),1),t("td",null,c(p.code),1),t("td",null,c(p.discount)+" %",1),t("td",null,c(p.description),1),t("td",null,c(new Date(p.startDate).toLocaleString().split(" ")[0]),1),t("td",null,c(new Date(p.dueDate).toLocaleString().split(" ")[0]),1),t("td",null,c(p.isEnabled?"是":"否"),1),t("td",null,[t("div",Ft,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:I=>l.openModal(h)},"編輯",8,Ot),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:I=>l.openDeleteModal(h,p)},"刪除",8,Pt)])])]))),128))])]),v(s,{ref:"productModal",id:e.couponId,"open-modal":l.openModal},null,8,["id","open-modal"]),v(k,{ref:"deleteProductModal",id:e.couponDeleteId,item:e.couponDeleteItem,"open-delete-modal":l.openDeleteModal},null,8,["id","item","open-delete-modal"])])}const Kt=_(Nt,[["render",Yt]]);export{Kt as default};
