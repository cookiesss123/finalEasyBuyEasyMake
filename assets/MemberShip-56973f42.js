import{m as U}from"./index-313a8faa.js";import{o as k,u as w,r as g,a as y,f as A,c as O,d as f,b as v}from"./carts-f8d5f90d.js";import{P as B}from"./PaginationComponent-de446aef.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{L as D}from"./index-4a756bbe.js";import{w as c,v as I}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as j}from"./loadingLogo-ea15f612.js";import{_ as F,a7 as r,c as N,a9 as C,ab as u,a8 as e,ad as a,af as n,ac as E,N as P,ae as M,F as R,aa as h,ag as H,r as x,o}from"./_plugin-vue_export-helper-d28549df.js";const q="/finalEasyBuyEasyMake/assets/undraw_No_data_re_kwbl-fe986f09.png",z={components:{PaginationComponent:B,Loading:D},mixins:[V],data(){return{user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",isLoading:!1,fullPage:!0}},methods:{...U(O,["toastMessage","goToTop"]),getUserInformation(){k(y,l=>{if(l){this.uid=l.uid;const s=g(f,"users/"+l.uid);v(s,m=>{this.user=m.val(),this.isLoading=!1})}else this.uid=null,this.user={},this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/loginSignup")})},getOrders(){k(y,l=>{if(l){this.uid=l.uid;const s=g(f,`orders/${this.uid}`);v(s,m=>{const b=m.val();b&&(this.orders=Object.entries(b).map(t=>(t[1].id=t[0],t[1])),this.filterOrders=this.orders.reverse(),this.orderArrived=this.orders.filter(t=>t.deliveryStatus==="待取貨"),this.filterOrders&&this.$route.fullPath==="/member"&&this.$refs.pagination.renderPage(1,this.filterOrders))})}else this.uid=null,this.user={},this.uid||(this.toastMessage("請先登入","error"),this.$router.push("/loginSignup"))})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}w(g(f),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const l=y.currentUser;A(l,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/loginSignup")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:l}=await this.$swal({title:"選擇圖片",input:"file",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(l){const s=new FileReader;s.onload=m=>{this.$swal({title:"圖片上傳成功!",imageUrl:m.target.result,imageAlt:"The uploaded picture",imageHeight:300}),w(g(f),{[`users/${this.uid}/headshotImg/`]:m.target.result})},s.readAsDataURL(l)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:l}=await this.$swal({title:"選擇圖片",input:"text",confirmButtonColor:"#4572c2",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});l?(this.$swal({title:"圖片上傳成功",imageUrl:l,imageHeight:300,imageAlt:"Custom image"}),w(g(f),{[`users/${this.uid}/headshotImg/`]:l})):this.toastMessage("請勿輸入空值","error")}},mounted(){this.goToTop(),this.isLoading=!0,this.getUserInformation(),this.getOrders()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(l=>l.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},G={class:"no-scroll-x"},W=e("div",{class:"d-flex flex-column align-items-center py-96"},[e("img",{src:j,class:"loading-logo mb-3",alt:"logo"}),e("p",{class:"text-center fw-bold text-purple fs-md-2 fs-md-2 fs-5"},[e("span",{class:"me-1 animate-text"},"L"),e("span",{class:"mx-1 animate-text"},"o"),e("span",{class:"mx-1 animate-text"},"a"),e("span",{class:"mx-1 animate-text"},"d"),e("span",{class:"mx-1 animate-text"},"i"),e("span",{class:"mx-1 animate-text"},"n"),e("span",{class:"mx-1 animate-text"},"g"),e("span",{class:"mx-2 animate-text"},"."),e("span",{class:"me-2 animate-text"},"."),e("span",{class:"animate-text"},".")])],-1),Y=e("section",{class:"text-center"},[e("div",{class:"py-lg-200 py-96 bg-cover-center",style:{"background-image":"url('https://images.unsplash.com/photo-1678465952850-0eb0bb982835?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1170&q=80')"}}),e("h2",{class:"bg-secondary-light-purple-horizontal text-purple mb-0 fs-lg-1 fs-5 letter-spacing-20 ps-3 fw-bold py-2"},"會員資料")],-1),J={class:"container"},K={class:"row row-cols-1 row-cols-lg-2 g-5 py-lg-96 py-5"},Q={class:"col-lg-4"},X={class:"card"},Z={key:0,class:"border border-2 border-primary text-center bg-lightPurple"},$=e("i",{class:"bi bi-person-fill m-auto text-primary fs-200"},null,-1),ee=[$],te=["src"],se={class:"card-body bg-secondary d-flex justify-content-between"},ie={class:"list-group list-group-flush"},le={class:"list-group-item"},oe={class:"row"},re=e("div",{class:"col-4"},[e("label",{for:"nickName",class:"form-label fw-bold"},[e("i",{class:"bi bi-person-fill"}),h(" 暱稱")])],-1),ne={class:"col-8"},ae={class:"text-end"},ce={class:"list-group-item bg-secondary"},de={class:"row"},ue=e("div",{class:"col-4"},[e("label",{for:"email",class:"form-label fw-bold mb-0"},[e("i",{class:"bi bi-envelope-fill"}),h(" 信箱")])],-1),me={class:"col-8"},pe={class:"list-group-item"},he=H('<div class="row"><div class="col-4"><label for="password" class="form-label fw-bold"><i class="bi bi-lock-fill"></i> 密碼</label></div><div class="col-8"><span>* * * * * * * *</span></div></div>',1),ge={class:"text-end"},fe={class:"list-group-item d-flex justify-content-between bg-secondary"},be=e("label",{for:"ticket",class:"form-label mb-0 fw-bold"},[e("i",{class:"bi bi-ticket-perforated-fill"}),h(" 我的抽獎券")],-1),_e={class:"col-lg-8 d-flex flex-column"},we=e("h3",{class:"d-flex align-items-center fw-bold text-purple border-bottom pb-1 border-purple"},[e("span",{class:"material-icons me-2"}," auto_awesome "),h(" 訂單狀況 ")],-1),ye={class:"select-order-status list-unstyled d-flex justify-content-between mb-0 py-2"},xe=e("i",{class:"bi bi-border-all"},null,-1),ke=e("i",{class:"bi bi-box-seam"},null,-1),ve=e("i",{class:"bi bi-truck"},null,-1),Ie=e("i",{class:"bi bi-house-check"},null,-1),Ne=e("i",{class:"bi bi-clipboard-check"},null,-1),Ce={class:"row row-cols-1 py-3"},Ee={class:"mb-3 fs-lg-4 fs-5 fw-bold"},Pe={key:0},Me={class:"order-select p-3"},Le=e("i",{class:"bi bi-clock me-2"},null,-1),Se={class:"list-unstyled row row-cols-md-4 row-cols-2 g-3"},Te={key:0,class:"position-relative"},Ue=["src","alt"],Ae={key:0,class:"mb-0 mt-2 text-center"},Oe={class:"fs-14 me-1"},Be={class:"text-primary fw-bold"},Ve={key:1,class:"position-absolute w-100 h-100 top-0 bg-trans-dark-4"},De={class:"text-center fs-1 text-white text-shadow lh-lg"},je={class:"text-end fw-bold mt-4"},Fe={class:"me-3"},Re={class:"text-primary"},He=e("i",{class:"bi bi-search text-primary ms-3"},null,-1),qe=e("hr",null,null,-1),ze={key:1,class:"py-lg-4 text-center"},Ge=e("img",{src:q,style:{},class:"mb-lg-3 mb-2 img-md-200-sm-150",alt:"無訂單圖示"},null,-1),We=e("h3",{class:"fs-lg-3 fs-6"},"無訂單",-1),Ye=[Ge,We];function Je(l,s,m,b,t,d){const L=x("loading"),S=x("RouterLink"),T=x("PaginationComponent");return o(),r("div",G,[t.uid?(o(),N(L,{key:0,active:t.isLoading,"onUpdate:active":s[0]||(s[0]=i=>t.isLoading=i),"can-cancel":!1,"is-full-page":t.fullPage,"lock-scroll":!0},{default:C(()=>[W]),_:1},8,["active","is-full-page"])):u("",!0),Y,e("div",J,[e("section",K,[e("div",Q,[e("div",X,[t.user.headshotImg?t.user.headshotImg?(o(),r("img",{key:1,src:t.user.headshotImg,class:"object-fit-cover w-100 border border-2 border-primary",style:{height:"300px"},alt:"大頭貼"},null,8,te)):u("",!0):(o(),r("div",Z,ee)),e("div",se,[e("a",{href:"#",class:"card-link fw-bold",onClick:s[1]||(s[1]=c((...i)=>d.selectImgUrl&&d.selectImgUrl(...i),["prevent"]))},"上傳圖片網址"),e("a",{href:"#",class:"card-link fw-bold",onClick:s[2]||(s[2]=c((...i)=>d.selectFile&&d.selectFile(...i),["prevent"]))},"上傳本地圖片")]),e("ul",ie,[e("li",le,[e("div",oe,[re,e("div",ne,[e("span",null,a(t.user.nickName),1)])]),e("div",ae,[t.nickNameEdit?(o(),r("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:s[3]||(s[3]=c(()=>t.nickNameEdit=!t.nickNameEdit,["prevent"]))},"修改暱稱")):u("",!0),e("div",{class:n(["input-group",{"d-none":t.nickNameEdit}])},[E(e("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":s[4]||(s[4]=i=>t.newNickName=i),style:{width:"180px"}},null,512),[[I,t.newNickName]]),e("button",{onClick:s[5]||(s[5]=()=>t.nickNameEdit=!0),class:"btn btn-outline-gray btn-sm",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[6]||(s[6]=()=>d.changeEmail()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),e("li",ce,[e("div",de,[ue,e("div",me,[e("span",null,a(t.user.email),1)])])]),e("li",pe,[he,e("div",ge,[t.passwordEdit?(o(),r("a",{key:0,href:"#",class:"link-primary fw-bold",onClick:s[7]||(s[7]=c(()=>t.passwordEdit=!t.passwordEdit,["prevent"]))},"變更密碼")):u("",!0),e("div",{class:n(["input-group",{"d-none":t.passwordEdit}])},[E(e("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":s[8]||(s[8]=i=>t.newPassword=i),style:{width:"180px"}},null,512),[[I,t.newPassword]]),e("button",{onClick:s[9]||(s[9]=()=>t.passwordEdit=!0),class:"btn btn-sm btn-outline-gray",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[10]||(s[10]=()=>d.changePassword()),class:"btn btn-sm btn-outline-primary",type:"button",id:"button-addon2"},"確定")],2)])]),e("li",fe,[be,e("span",null,a(t.user.lotteryTicket)+" 張",1),e("a",{href:"#",class:"link-primary fw-bold",onClick:s[11]||(s[11]=c((...i)=>d.linkToLottery&&d.linkToLottery(...i),["prevent"]))},"立即抽獎")])])])]),e("div",_e,[we,e("ul",ye,[e("li",null,[e("a",{href:"#",class:n(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":t.selectItem==="全部","text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}]),onClick:s[12]||(s[12]=c(()=>t.selectItem="全部",["prevent"]))},[xe,e("span",{class:n(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":t.selectItem!=="全部"}])}," 全部 ",2)],2)]),e("li",null,[e("a",{href:"#",class:n(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":t.selectItem==="待出貨","text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}]),onClick:s[13]||(s[13]=c(()=>t.selectItem="待出貨",["prevent"]))},[ke,e("span",{class:n(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":t.selectItem!=="待出貨"}])}," 待出貨 ",2)],2)]),e("li",null,[e("a",{href:"#",class:n(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":t.selectItem==="運送中","text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}]),onClick:s[14]||(s[14]=c(()=>t.selectItem="運送中",["prevent"]))},[ve,e("span",{class:n(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":t.selectItem!=="運送中"}])}," 運送中 ",2)],2)]),e("li",null,[e("a",{href:"#",class:n(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":t.selectItem==="待取貨","text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}]),onClick:s[15]||(s[15]=c(()=>t.selectItem="待取貨",["prevent"]))},[Ie,e("span",{class:n(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":t.selectItem!=="待取貨"}])}," 待取貨 ",2)],2)]),e("li",null,[e("a",{href:"#",class:n(["hvr-rectangle-out bg-transparent text-decoration-none py-2 px-3 text-gray",{"active-order":t.selectItem==="訂單完成","text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}]),onClick:s[16]||(s[16]=c(()=>t.selectItem="訂單完成",["prevent"]))},[Ne,e("span",{class:n(["ms-lg-2 ms-1 d-lg-inline-block",{"d-none":t.selectItem!=="訂單完成"}])}," 訂單完成 ",2)],2)])]),e("div",Ce,[e("h4",Ee,"總共有 "+a(t.filterOrders.length)+" 筆",1),t.filterOrders.length?(o(),r("div",Pe,[(o(!0),r(P,null,M(this.$refs.pagination.pageProducts,i=>(o(),N(S,{to:`/orders/${i.id}`,class:"col text-decoration-none link-dark",key:i.creatAt},{default:C(()=>[e("div",Me,[e("p",null,[Le,h(a(new Date(i.creatAt).toLocaleString().split(":")[0])+":"+a(new Date(i.creatAt).toLocaleString().split(":")[1]),1)]),e("ul",Se,[(o(!0),r(P,null,M(i.cart.items,(p,_)=>(o(),r("li",{class:"col",key:p+6603},[_<8?(o(),r("div",Te,[e("img",{src:p.product.imgUrl,alt:p.product.title,height:"100",class:"w-100 object-fit-cover"},null,8,Ue),_<7||i.cart.items.length===8?(o(),r("p",Ae,[e("span",Oe,a(p.product.title.length>8?p.product.title.slice(0,5)+"...":p.product.title),1),e("span",Be,"x"+a(l.numberComma(p.qty)),1)])):u("",!0),i.cart.items.length>8&&_===7?(o(),r("div",Ve,[e("p",De,a(i.cart.items.length-7)+" + ",1)])):u("",!0)])):u("",!0)]))),128))]),e("div",je,[e("span",Fe,[e("i",{class:n(["bi me-1",{"bi-box-seam":i.deliveryStatus==="待出貨","bi-truck":i.deliveryStatus==="運送中","bi-house-check":i.deliveryStatus==="待取貨","bi-clipboard-check":i.deliveryStatus==="訂單完成"}])},null,2),h(" "+a(i.deliveryStatus),1)]),e("span",Re,"NT$ "+a(l.numberComma(i.cart.finalTotal)),1),He])]),qe]),_:2},1032,["to"]))),128))])):t.filterOrders.length?u("",!0):(o(),r("div",ze,Ye))]),R(T,{ref:"pagination","filter-orders":t.filterOrders,class:"mt-auto"},null,8,["filter-orders"])])])])])}const it=F(z,[["render",Je]]);export{it as default};
