import{m as A}from"./index-17d9ec8c.js";import{c as N}from"./carts-1342d558.js";import{n as C}from"./numberCommaMixin-e0aac39c.js";import{r as h,b as f,o as z,u as p,d as u,s as R,a as L}from"./db-143b9a4b.js";import{L as B}from"./LoadingComponent-8a5de011.js";import{_ as T,a as M}from"./title4-5b70ded8.js";import{_ as E,U as n,V as t,a4 as y,a1 as m,a2 as _,Z as g,c as j,a0 as c,Y as b,a5 as S,o as i,W as D,X as V,r as P}from"./_plugin-vue_export-helper-03b40388.js";import"./vue-router-2c21c692.js";import"./_commonjsHelpers-042e6b4d.js";import"./loadingLogo-3bb466c0.js";const O={mixins:[C],data(){return{coupons:{},lottery:{},lotteryResult:{},drewProducts:[],drewArr:[],user:{},uid:"",getPrize:{},tabName:"優惠折扣",articles:[],loading:!0}},components:{LoadingComponent:B},methods:{...A(N,["checkLogin","toastMessage"]),getCoupons(){const s=h(u,"coupons/");f(s,o=>{this.coupons=o.val(),console.log(this.coupons,"折價券"),this.loading=!1})},getLottery(){const s=h(u,"lotteries/");f(s,o=>{let d=o.val();d=Object.entries(d).map(r=>(r[1].id=r[0],r[1])),this.lottery=Object.values(d).filter(r=>r.isEnabled===!0),this.lottery=this.lottery[0],this.lottery.recipes.forEach(r=>{this.drewProducts[r.title]||(this.drewProducts[r.title]=[]),r.relativeProducts.forEach(e=>{e.category!=="組合包"&&(e.recipeName=`抽獎食譜${r.title}`,this.drewProducts[r.title].push(e))})}),this.drewProducts=Object.entries(this.drewProducts),console.log(this.drewProducts,this.lottery.prizes,"抽獎標的")})},getLotteryResult(){z(L,s=>{if(s){this.uid=s.uid,console.log(this.uid,"使用者已登入取得 uid");const o=h(u,"users/"+s.uid);f(o,d=>{this.user=d.val(),console.log(this.user,"使用者資料");const r=h(u,`lotteryResults/${this.uid}`);f(r,e=>{this.lotteryResult=e.val(),this.lotteryResult?(this.drewArr=this.lotteryResult.drewArr,this.getPrize=this.lotteryResult.getPrize):(this.drewArr=[],this.getPrize={})})})}else console.log("並未登入"),this.uid=null,this.user={},this.drewArr=[],this.getPrize={}})},addtLotteryResult(){if(!this.uid){this.toastMessage("登入即可抽獎","error");return}if(this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2,000</b> 即可獲得一張抽獎券</p><p>單筆金額滿  <b>NT$5,000</b> 即可獲得三張抽獎券</p><p>單筆金額滿  <b>NT$10,000</b> 即可獲得七張抽獎券</p><a href="/finalEasyMakeEasyBuy/#/products" class="link-red">前往選購商品</a>',showConfirmButton:!0});return}p(h(u),{[`users/${this.uid}/lotteryTicket/`]:this.user.lotteryTicket-1});const s=Math.floor(Math.random()*this.drewProducts.length),o=Math.floor(Math.random()*this.drewProducts[s][1].length);if(console.log(this.drewProducts,s,o,"抽獎資料"),this.drewArr.length){if(this.drewArr.length){this.drewProducts.forEach((r,e)=>{this.drewArr[e][1]||(this.drewArr[e][1]=[])});let d=!1;if(this.drewArr[s][1]&&this.drewArr[s][1].forEach(r=>{r.title===this.drewProducts[s][1][o].title&&(d=!0,console.log(this.drewProducts[s][0],r.title,"這個重複了"))}),console.log(d,"有重複嗎"),d)this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80">',customClass:{icon:"no-border"},showConfirmButton:!1});else if(!d){this.drewArr[s][1].push(this.drewProducts[s][1][o]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[s][1][o].title}`,iconHtml:`<img src="${this.drewProducts[s][1][o].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1}),p(h(u),{[`lotteryResults/${this.uid}/drewArr/`]:this.drewArr});let r="";if(!this.drewArr[0][1]||!this.drewArr[1][1]||!this.drewArr[2][1]){console.log("不用看了沒中獎");return}this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length&&this.drewArr[2][1].length===this.drewProducts[2][1].length?r=0:this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length?r=1:(this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length)&&(r=2),(r||r===0)&&p(h(u),{[`lotteryResults/${this.uid}/getPrize/`]:this.lottery.prizes[r]})}}}else{this.drewProducts.forEach((r,e)=>{this.drewArr[e]=[r[0],[]]}),this.drewArr[s][1].push(this.drewProducts[s][1][o]),console.log(this.drewArr,s,this.drewArr[s][0],"放入什麼"),this.$swal({title:`恭喜您抽中 ${this.drewProducts[s][1][o].title}`,iconHtml:`<img src="${this.drewProducts[s][1][o].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1});const d=h(u,`lotteryResults/${this.uid}`);R(d,{drewArr:this.drewArr,getPrize:{}}),console.log("首次抽獎")}}},mounted(){this.loading=!0,this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.getCoupons(),this.getLottery(),this.getLotteryResult()},computed:{},watch:{}},q={class:"my-10"},H={class:"navTitle nav nav-tabs container"},I={key:0,class:"text-red"},U=t("h3",{class:"text-center py-3 py-lg-5 fw-bold bg-lightPink mt-3"},[t("i",{class:"bi bi-currency-dollar"}),b(" 本月優惠")],-1),G={class:"container"},W={key:0,class:"row row-cols-lg-4 g-4 py-3 text-darkBrown"},Y={class:"card"},F={class:"enlargeImg w-100 rounded"},J={class:"cardImg"},X=["src"],Z={class:"card-body"},K={class:"card-title h3"},Q={class:"card-text text-truncate"},$={class:"d-flex"},tt={key:1},et={class:"container"},st={class:"py-3 text-darkBrown d-flex flex-column"},rt={class:""},ot={key:1,class:"col-lg-12 align-self-center"},it=t("p",{class:"mb-0"},"本月指定抽獎食譜：",-1),lt={class:"row row-cols-lg-3 row-cols-1 pt-4"},nt={class:"text-center fw-bold my-3"},ct={class:"row"},dt=["src"],at={key:0,class:"position-absolute bg-notObtained d-flex"},ht=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),ut=[ht],gt={class:"d-flex"},mt=t("p",{class:"text-end"},"抽一次消耗一張抽獎券",-1),wt={key:2,class:"d-flex flex-column align-items-center"},_t={class:"h3 text-center text-red fw-bold"},ft={class:"col-lg-4 col-12"},bt={class:"card position-relative",style:{"border-radius":"0px",border:"none !important"}},pt={class:"card-header h4 fw-bold text-center mb-3 bg-white border-0"},yt=["src"],vt={class:"card-footer bg-transparent border-0",style:{"background-color":"white !important"}},Pt={class:"fw-bold"},xt={class:"text-end"},kt=t("p",null,[b("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到@EasyMakeEasyBuy.gmail.com，感謝您的支持!"),t("br"),b("下期好禮更精彩，千萬別錯過!")],-1),At={class:"py-10","data-aos":"zoom-in"},Nt=S('<div class="container"><h2 class="display-6 fw-bold d-flex align-items-center mb-4 d-flex flex-column-reverse flex-lg-row align-items-center mb-4 justify-content-center justify-content-lg-start"><div class="d-flex align-items-center"><img src="'+T+'" class="me-lg-4 me-2 titleImg" alt=""><span class="recipeTitle">月獎品</span></div><span class="light-red mb-lg-0 mb-2 h6 ms-2 speakerText d-flex align-items-center"><img src="'+M+'" class="speaker" alt=""> 超值大獎一次帶回! </span></h2></div>',1),Ct={class:"container"},zt={class:"prizes row row-cols-lg-3 row-cols-1 gy-4"},Rt={class:"card position-relative",style:{"border-radius":"0",border:"1px transparent solid"}},Lt={class:"card-header border-0 h4 fw-bold text-center mb-3 bg-white"},Bt=t("div",{class:"questionMark position-absolute d-flex",style:{top:"60px",width:"100%",height:"220px",background:"linear-gradient(90deg, #ff9a9e ,#fad0c4)"}},[t("i",{class:"bi bi-question-lg mx-auto text-white",style:{"font-size":"150px"}})],-1),Tt=["src"],Mt={class:"card-footer bg-transparent border-0"},Et={class:"fw-bold"},jt={class:"text-end"},St=t("h5",null,"規則：",-1);function Dt(s,o,d,r,e,v){const x=P("RouterLink"),k=P("LoadingComponent");return i(),n("div",q,[t("ul",H,[t("li",{class:"nav-item",onClick:o[0]||(o[0]=()=>e.tabName="優惠折扣")},[t("button",{class:y(["nav-link",{active:e.tabName==="優惠折扣","link-red":e.tabName==="優惠折扣"}]),type:"button"},"優惠折扣",2)]),t("li",{class:"nav-item",onClick:o[1]||(o[1]=()=>e.tabName="抽獎回饋")},[t("button",{class:y(["nav-link",{active:e.tabName==="抽獎回饋","link-red":e.tabName==="抽獎回饋"}]),type:"button"},"抽獎回饋",2)])]),e.tabName==="優惠折扣"?(i(),n("section",I,[U,t("div",G,[e.loading?g("",!0):(i(),n("div",W,[(i(!0),n(m,null,_(e.coupons,(l,a)=>(i(),n("div",{class:"col",key:a},[t("div",Y,[t("div",F,[t("div",J,[t("img",{src:l.image,class:"card-img-top",alt:"...",height:"200",style:{"object-fit":"cover"}},null,8,X)]),t("div",Z,[t("h5",K,c(l.title),1),t("p",Q,c(l.description),1),t("div",$,[D(x,{to:`/discounts/${a}`,href:"#",class:"stretched-link btn btn-red ms-auto"},{default:V(()=>[b("查看完整優惠資訊")]),_:2},1032,["to"])])])])])]))),128))])),e.loading?(i(),j(k,{key:1})):g("",!0)])])):e.tabName==="抽獎回饋"?(i(),n("section",tt,[t("div",et,[t("div",st,[t("p",rt,"活動時間："+c(new Date(e.lottery.startDate).toLocaleDateString().split(" ")[0])+" ~ "+c(new Date(e.lottery.dueDate).toLocaleString().split(" ")[0]),1),e.uid?(i(),n("p",{key:0,class:y({"text-danger":e.user.lotteryTicket===0})},"剩餘抽獎券："+c(e.user.lotteryTicket),3)):g("",!0),!e.getPrize||e.getPrize&&e.getPrize.id!==1?(i(),n("div",ot,[it,t("div",lt,[(i(!0),n(m,null,_(e.drewProducts,(l,a)=>(i(),n("div",{key:l,class:"border border-red col"},[t("h4",nt,c(l[0]),1),t("div",ct,[(i(!0),n(m,null,_(l[1],w=>(i(),n("div",{class:"d-flex flex-column align-items-center position-relative col-4",key:w.id},[w.category==="單一產品"?(i(),n(m,{key:0},[t("img",{src:w.imgUrl,alt:"",height:"100",width:"100",style:{"object-fit":"cover"}},null,8,dt),t("p",null,c(w.title),1),!e.drewArr[a]||!e.drewArr[a][1]||e.drewArr[a]&&e.drewArr[a][1]&&!JSON.stringify(this.drewArr[a][1]).includes(w.title)?(i(),n("div",at,ut)):g("",!0)],64)):g("",!0)]))),128))])]))),128))]),t("div",gt,[t("button",{type:"button",class:"mx-auto mt-3 btn btn-red",onClick:o[2]||(o[2]=(...l)=>v.addtLotteryResult&&v.addtLotteryResult(...l))},"立即抽獎")]),mt])):g("",!0),e.lotteryResult&&this.getPrize&&this.getPrize.id?(i(),n("div",wt,[t("h5",_t,"恭喜您完成"+c(e.getPrize.id===1?"全部":e.getPrize.id===2?"2份":"1份")+"食譜，獲得：",1),t("div",ft,[t("div",bt,[t("div",pt,c(e.getPrize.id===1?"大獎":e.getPrize.id===2?"二獎":"三獎"),1),t("img",{src:e.getPrize.img,class:"card-img border",style:{"border-radius":"0px",height:"300px","object-fit":"contain"},alt:""},null,8,yt),t("div",vt,[t("h5",Pt,c(e.getPrize.title),1),t("p",xt,"價值：NT$ "+c(s.numberComma(e.getPrize.price)),1)])]),kt])])):g("",!0),t("section",At,[Nt,t("div",Ct,[t("div",zt,[(i(!0),n(m,null,_(e.lottery.prizes,l=>(i(),n("div",{class:"col",key:l.id,"data-aos":"flip-right"},[t("div",Rt,[t("div",Lt,c(l.id===1?"大獎":l.id===2?"二獎":"三獎"),1),Bt,t("img",{src:l.img,class:"card-img border bg-white",style:{height:"220px","object-fit":"contain","border-radius":"0"},alt:""},null,8,Tt),t("div",Mt,[t("h5",Et,c(l.title),1),t("p",jt,"價值：NT$ "+c(s.numberComma(l.price)),1)])])]))),128))])])]),St,t("ol",null,[(i(!0),n(m,null,_(e.lottery.rules,l=>(i(),n("li",{key:l+20},c(l),1))),128))])])])])):g("",!0)])}const Jt=E(O,[["render",Dt]]);export{Jt as default};
