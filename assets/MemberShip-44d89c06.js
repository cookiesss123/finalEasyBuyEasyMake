import{m as S}from"./index-c9654e74.js";import{c as A}from"./carts-48386189.js";import{P as B}from"./PaginationComponent-d6bbab82.js";import{n as T}from"./numberCommaMixin-e0aac39c.js";import{o as N,u as _,r as b,a as w,f as j,d as p,b as C}from"./db-143b9a4b.js";import{L as V}from"./index-cef339c7.js";import{w as g,v as P}from"./runtime-dom.esm-bundler-05da3382.js";import{_ as D}from"./loadingLogo-3bb466c0.js";import{_ as F,a7 as o,F as x,a9 as y,a8 as e,ab as c,ad as a,ag as n,ac as E,aa as u,N as L,ae as M,r as k,o as l,c as R}from"./_plugin-vue_export-helper-e5f607bc.js";import"./vue-router-8d0a8096.js";import"./_commonjsHelpers-042e6b4d.js";const H="/finalEasyBuyEasyMake/assets/undraw_No_data_re_kwbl-28c5b2d7.png";const q={components:{PaginationComponent:B,Loading:V},mixins:[T],data(){return{user:{},uid:"",orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",nickName:"",pageOrders:[],isLoading:!1,fullPage:!0}},methods:{...S(A,["toastMessage"]),getUserInformation(){N(w,r=>{if(r){this.uid=r.uid,console.log(this.uid,"使用者已登入取得 uid 有在作用嗎");const s=b(p,"users/"+r.uid);C(s,d=>{this.user=d.val(),console.log(this.user,"讀取的資料"),this.isLoading=!1})}else console.log("並未登入"),this.uid=null,this.user={},this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/login")})},getOrders(){N(w,r=>{if(r){this.uid=r.uid;const s=b(p,`orders/${this.uid}`);C(s,d=>{const f=d.val();f&&(this.orders=Object.entries(f).map(t=>(t[1].id=t[0],t[1])),this.filterOrders=this.orders,this.orderArrived=this.orders.filter(t=>t.deliveryStatus==="待取貨"),this.filterOrders&&this.$route.fullPath==="/member"&&this.$refs.pagination.renderPage(1,this.filterOrders))})}else console.log("並未登入"),this.uid=null,this.user={},this.uid||(this.toastMessage("請先登入","error"),this.$router.push("/login"))})},changeEmail(){if(this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.toastMessage("暱稱不得是空字串","error");return}_(b(p),{[`users/${this.uid}/nickName/`]:this.newNickName}),this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")},changePassword(){if(this.newPassword.length<=5){this.toastMessage("新密碼不能小於6個字元","error");return}const r=w.currentUser;j(r,this.newPassword).then(()=>{this.passwordEdit=!0,this.toastMessage("密碼變更成功")}).catch(()=>{this.toastMessage("長時間未驗證請重新登入以更改密碼","error"),this.$router.push("/login")})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:r}=await this.$swal({title:"選擇圖片",input:"file",confirmButtonColor:"#d04740",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(r){const s=new FileReader;s.onload=d=>{this.$swal({title:"圖片上傳成功!",imageUrl:d.target.result,imageAlt:"The uploaded picture",imageHeight:300}),console.log(d.target.result,"印出什麼"),_(b(p),{[`users/${this.uid}/headshotImg/`]:d.target.result})},s.readAsDataURL(r)}else this.toastMessage("沒有檔案","error")},async selectImgUrl(){const{value:r}=await this.$swal({title:"選擇圖片",input:"text",confirmButtonColor:"#d04740",confirmButtonText:"確定",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});r?(console.log(r,"檔案"),this.$swal({title:"圖片上傳成功",imageUrl:r,imageHeight:300,imageAlt:"Custom image"}),_(b(p),{[`users/${this.uid}/headshotImg/`]:r})):this.toastMessage("請勿輸入空值","error")}},mounted(){this.isLoading=!0,this.getUserInformation(),this.getOrders()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(r=>r.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)},user(){this.newNickName=this.user.nickName}}},z={class:"",style:{"overflow-x":"hidden"}},X=e("div",{class:"d-flex flex-column align-items-center py-10"},[e("img",{src:D,class:"loadingLogo mb-3",style:{width:"150px"},alt:""}),e("h1",{class:"text-center fw-bold text-lightBrown"},[e("span",{class:"me-1 animate-text"},"L"),e("span",{class:"mx-1 animate-text"},"o"),e("span",{class:"mx-1 animate-text"},"a"),e("span",{class:"mx-1 animate-text"},"d"),e("span",{class:"mx-1 animate-text"},"i"),e("span",{class:"mx-1 animate-text"},"n"),e("span",{class:"mx-1 animate-text"},"g"),e("span",{class:"mx-2 animate-text"},"."),e("span",{class:"me-2 animate-text"},"."),e("span",{class:"animate-text"},".")])],-1),Y=e("section",{class:"bannerBg"},[e("div",{class:"mask"},[e("div",{class:"text",style:{}}," 會員資料 ")])],-1),G={class:"container"},J={class:"row row-cols-1 row-cols-lg-2 gx-5"},K={class:"col-lg-4 py-5"},Q={class:"d-flex flex-column align-items-center position-relative bg-lightPink pt-5"},W={key:0,class:"d-flex",style:{height:"300px",width:"300px"}},Z=e("i",{class:"bi bi-person-fill m-auto text-red",style:{"font-size":"200px"}},null,-1),$=[Z],ee=["src"],te={class:"d-flex align-items-center justify-content-evenly py-3 position-absolute w-100",style:{bottom:"0px",background:"rgba(255, 234, 234, 0.9)"}},se=e("div",{class:"bg-red",style:{width:"2px",height:"20px"}},null,-1),ie={class:"border border-lightPink"},le={class:"py-3 d-flex align-items-center"},oe=e("label",{for:"nickName",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},[e("i",{class:"bi bi-person-circle"}),u(" 暱稱")],-1),ne={key:0,class:"ms-4"},re={class:"ms-auto"},ce={class:"bg-lightPink py-3 d-flex align-items-center"},ae=e("label",{for:"email",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},[e("i",{class:"bi bi-envelope-fill"}),u(" 信箱")],-1),de={class:"ms-4"},me={class:"py-3 d-flex align-items-center"},ue=e("label",{for:"password",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},[e("i",{class:"bi bi-lock-fill"}),u(" 密碼")],-1),he={key:0,class:"ms-4"},be={class:"ms-auto"},pe={class:"bg-lightPink py-3 d-flex align-items-center"},ge=e("label",{for:"ticket",class:"form-label mb-0 fw-bold ms-1 ms-lg-3"},[e("i",{class:"bi bi-ticket-perforated-fill"}),u(" 我的抽獎券")],-1),fe={class:"ms-4"},_e=e("i",{class:"bi bi-gift"},null,-1),we={class:"col-lg-8 py-5"},xe=e("h2",{class:"h3 fw-bold"},"訂單狀況",-1),ye={class:"selectOrderStatus py-3 d-flex justify-content-between justify-content-lg-start"},ke={class:"row row-cols-1 py-3"},ve={class:"mb-3"},Ie={key:0},Ne=e("i",{class:"bi bi-clock"},null,-1),Ce={class:"row row-cols-lg-4 row-cols-2 align-items-center mt-2"},Pe={key:0,class:""},Ee=["src"],Le={class:"mb-0 mt-2 text-center"},Me={class:"subTitle me-1"},Oe={class:"text-red fw-bold"},Ue={key:1,class:"position-relative",style:{top:"-16px"}},Se=["src"],Ae={class:"mb-0 text-center position-absolute fs-1 text-secondary",style:{top:"50%",left:"50%",transform:"translateX(-50%) translateY(-50%)"}},Be={class:"d-flex mt-4"},Te={class:"ms-auto d-flex align-items-center"},je={class:"me-3 fw-bold"},Ve={key:0,class:"bi bi-box-seam me-1"},De={key:1,class:"bi bi-truck me-1"},Fe={key:2,class:"bi bi-house-check me-1"},Re={key:3,class:"bi bi-clipboard-check me-1"},He={class:"text-red fw-bold"},qe=e("i",{class:"bi bi-search text-red"},null,-1),ze=e("hr",null,null,-1),Xe={key:1,class:"d-flex flex-column align-items-center justify-content-center"},Ye=e("img",{src:H,style:{width:"300px"},alt:""},null,-1),Ge=e("h3",null,"無訂單",-1),Je=[Ye,Ge];function Ke(r,s,d,f,t,m){const O=k("loading"),v=k("RouterLink"),U=k("PaginationComponent");return l(),o("div",z,[x(O,{active:t.isLoading,"onUpdate:active":s[0]||(s[0]=i=>t.isLoading=i),"can-cancel":!1,"is-full-page":t.fullPage,"lock-scroll":!0},{default:y(()=>[X]),_:1},8,["active","is-full-page"]),Y,e("div",G,[e("div",J,[e("section",K,[e("div",Q,[t.user.headshotImg?t.user.headshotImg?(l(),o("img",{key:1,src:t.user.headshotImg,style:{"object-fit":"cover",height:"300px",width:"300px"},class:"mb-4",alt:""},null,8,ee)):c("",!0):(l(),o("div",W,$)),e("div",te,[e("a",{href:"#",class:"link-red fw-bold",onClick:s[1]||(s[1]=g((...i)=>m.selectImgUrl&&m.selectImgUrl(...i),["prevent"]))},"上傳圖片網址"),se,e("a",{href:"#",class:"link-orange fw-bold",onClick:s[2]||(s[2]=g((...i)=>m.selectFile&&m.selectFile(...i),["prevent"]))},"上傳本地圖片")])]),e("div",ie,[e("div",le,[oe,t.nickNameEdit?(l(),o("span",ne,a(t.user.nickName),1)):c("",!0),e("div",re,[t.nickNameEdit?(l(),o("a",{key:0,href:"#",class:"link-red fw-bold me-3",onClick:s[3]||(s[3]=g(()=>t.nickNameEdit=!t.nickNameEdit,["prevent"]))},"修改暱稱")):c("",!0),e("div",{class:n(["input-group",{"d-none":t.nickNameEdit}])},[E(e("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱",id:"nickName","onUpdate:modelValue":s[4]||(s[4]=i=>t.newNickName=i),style:{width:"180px"}},null,512),[[P,t.newNickName]]),e("button",{onClick:s[5]||(s[5]=()=>t.nickNameEdit=!0),class:"btn btn-outline-secondary btn-sm",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[6]||(s[6]=()=>m.changeEmail()),class:"btn btn-sm btn-outline-red",type:"button",id:"button-addon2"},"確定")],2)])]),e("div",ce,[ae,e("span",de,a(t.user.email),1)]),e("div",me,[ue,t.passwordEdit?(l(),o("span",he,"* * * * * * * *")):c("",!0),e("div",be,[t.passwordEdit?(l(),o("a",{key:0,href:"#",class:"link-red fw-bold me-3",onClick:s[7]||(s[7]=g(()=>t.passwordEdit=!t.passwordEdit,["prevent"]))},"變更密碼")):c("",!0),e("div",{class:n(["input-group",{"d-none":t.passwordEdit}])},[E(e("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼",id:"password","onUpdate:modelValue":s[8]||(s[8]=i=>t.newPassword=i),style:{width:"180px"}},null,512),[[P,t.newPassword]]),e("button",{onClick:s[9]||(s[9]=()=>t.passwordEdit=!0),class:"btn btn-sm btn-outline-secondary",type:"button",id:"button-addon2"},"取消"),e("button",{onClick:s[10]||(s[10]=()=>m.changePassword()),class:"btn btn-sm btn-outline-red",type:"button",id:"button-addon2"},"確定")],2)])]),e("div",pe,[ge,e("span",fe,a(t.user.lotteryTicket)+" 張",1),e("button",{type:"button",class:"btn btn-sm btn-red ms-auto me-2",onClick:s[11]||(s[11]=(...i)=>m.linkToLottery&&m.linkToLottery(...i))},[_e,u(" 立即抽獎")])])])]),e("section",we,[xe,e("div",ye,[e("button",{type:"button",class:n(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="全部"}]),onClick:s[12]||(s[12]=()=>t.selectItem="全部")},[e("i",{class:n(["bi bi-border-all",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])},null,2),e("span",{class:n(["text-secondary d-none d-lg-block ms-2",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])}," 全部 ",2),t.selectItem==="全部"?(l(),o("span",{key:0,class:n(["text-secondary d-lg-none ms-2",{"text-white":t.selectItem==="全部","fw-bold":t.selectItem==="全部"}])}," 全部 ",2)):c("",!0)],2),e("button",{type:"button",class:n(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待出貨"}]),onClick:s[13]||(s[13]=()=>t.selectItem="待出貨")},[e("i",{class:n(["bi bi-box-seam",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])},null,2),e("span",{class:n(["text-secondary d-none d-lg-block ms-2",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])}," 待出貨 ",2),t.selectItem==="待出貨"?(l(),o("span",{key:0,class:n(["text-secondary d-lg-none ms-2",{"text-white":t.selectItem==="待出貨","fw-bold":t.selectItem==="待出貨"}])}," 待出貨 ",2)):c("",!0)],2),e("button",{type:"button",class:n(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="運送中"}]),onClick:s[14]||(s[14]=()=>t.selectItem="運送中")},[e("i",{class:n(["bi bi-truck",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])},null,2),e("span",{class:n(["text-secondary d-none d-lg-block ms-2",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])}," 運送中 ",2),t.selectItem==="運送中"?(l(),o("span",{key:0,class:n(["text-secondary d-lg-none ms-2",{"text-white":t.selectItem==="運送中","fw-bold":t.selectItem==="運送中"}])}," 運送中 ",2)):c("",!0)],2),e("button",{type:"button",class:n(["d-flex btn border-0 me-lg-5 position-relative hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="待取貨"}]),onClick:s[15]||(s[15]=()=>t.selectItem="待取貨")},[e("i",{class:n(["bi bi-house-check",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])},null,2),e("span",{class:n(["text-secondary d-none d-lg-block ms-2",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])}," 待取貨 ",2),t.selectItem==="待取貨"?(l(),o("span",{key:0,class:n(["text-secondary d-lg-none ms-2",{"text-white":t.selectItem==="待取貨","fw-bold":t.selectItem==="待取貨"}])}," 待取貨 ",2)):c("",!0)],2),e("button",{type:"button",class:n(["d-flex btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:t.selectItem==="訂單完成"}]),onClick:s[16]||(s[16]=()=>t.selectItem="訂單完成")},[e("i",{class:n(["bi bi-clipboard-check",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])},null,2),e("span",{class:n(["text-secondary d-none d-lg-block ms-2",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])}," 訂單完成 ",2),t.selectItem==="訂單完成"?(l(),o("span",{key:0,class:n(["text-secondary d-lg-none ms-2",{"text-white":t.selectItem==="訂單完成","fw-bold":t.selectItem==="訂單完成"}])}," 訂單完成 ",2)):c("",!0)],2)]),e("div",ke,[e("h4",ve," 總共有 "+a(t.filterOrders.length)+" 筆 ",1),t.filterOrders.length?(l(),o("div",Ie,[(l(!0),o(L,null,M(this.$refs.pagination.pageProducts,i=>(l(),R(v,{to:`/orders/${i.id}`,class:"col text-decoration-none link-dark",key:i.creatAt},{default:y(()=>[e("span",null,[Ne,u(" "+a(new Date(i.creatAt).toLocaleDateString())+" "+a(new Date(i.creatAt).getHours())+":"+a(new Date(i.creatAt).getMinutes()),1)]),e("div",Ce,[(l(!0),o(L,null,M(i.cart.items,(h,I)=>(l(),o("div",{class:"col",key:h+6603},[I<7?(l(),o("div",Pe,[e("img",{src:h.product.imgUrl,alt:"",height:"100",class:"w-100",style:{"object-fit":"cover"}},null,8,Ee),e("p",Le,[e("span",Me,a(h.product.title),1),e("span",Oe,"x"+a(r.numberComma(h.qty)),1)])])):c("",!0),I===7?(l(),o("div",Ue,[e("img",{src:h.product.imgUrl,alt:"",height:"100",class:"w-100",style:{"object-fit":"cover",opacity:".4"}},null,8,Se),e("p",Ae,a(i.cart.items.length-7)+" + ",1)])):c("",!0)]))),128))]),e("div",Be,[e("div",Te,[e("span",je,[i.deliveryStatus==="待出貨"?(l(),o("i",Ve)):c("",!0),i.deliveryStatus==="運送中"?(l(),o("i",De)):c("",!0),i.deliveryStatus==="待取貨"?(l(),o("i",Fe)):c("",!0),i.deliveryStatus==="訂單完成"?(l(),o("i",Re)):c("",!0),u(a(i.deliveryStatus),1)]),e("span",He,"NT$ "+a(r.numberComma(i.cart.finalTotal)),1),x(v,{to:`/orders/${i.id}`,class:"ms-3"},{default:y(()=>[qe]),_:2},1032,["to"])])]),ze]),_:2},1032,["to"]))),128))])):t.filterOrders.length?c("",!0):(l(),o("div",Xe,Je))]),x(U,{ref:"pagination","filter-orders":t.filterOrders},null,8,["filter-orders"])])])])])}const rt=F(q,[["render",Ke]]);export{rt as default};
