import{m as M}from"./index-6af516ba.js";import{c as C}from"./carts-32b42ff3.js";import{n as E}from"./numberCommaMixin-e0aac39c.js";import{r as g,b,o as R,u as y,d as f,s as z,a as j}from"./db-143b9a4b.js";import{L as D}from"./index-fde5e204.js";import{w as x}from"./runtime-dom.esm-bundler-e140de91.js";import{_ as T}from"./loadingLogo-ea15f612.js";import{_ as S,a as H}from"./discount3-e2e49eb3.js";import{_ as O}from"./icon-speaker-fd89918c.js";import{_ as V,a7 as i,F as k,a9 as P,a8 as t,af as u,ab as m,N as _,ae as w,aa as p,ad as n,ag as q,r as A,o}from"./_plugin-vue_export-helper-d28549df.js";import"./vue-router-46224dd8.js";import"./_commonjsHelpers-042e6b4d.js";const G="/finalEasyBuyEasyMake/assets/giftBox1-5e717a45.png",I="/finalEasyBuyEasyMake/assets/giftBox3-08045f41.png",U="/finalEasyBuyEasyMake/assets/title4-ab3fed47.png",F={mixins:[E],data(){return{coupons:{},lottery:{},lotteryResult:{},drewProducts:[],drewArr:[],user:{},uid:"",getPrize:{},tabName:"優惠折扣",articles:[],isLoading:!1,fullPage:!0,couponIds:[]}},components:{Loading:D},methods:{...M(C,["checkLogin","toastMessage"]),getCoupons(){const l=g(f,"coupons/");b(l,c=>{this.coupons=c.val(),Object.values(this.coupons).forEach((d,r)=>{d.id=Object.keys(this.coupons)[r]}),this.coupons=Object.values(this.coupons).filter(d=>d.isEnabled),this.isLoading=!1})},getLottery(){const l=g(f,"lotteries/");b(l,c=>{let d=c.val();d=Object.entries(d).map(r=>(r[1].id=r[0],r[1])),this.lottery=Object.values(d).filter(r=>r.isEnabled===!0),this.lottery=this.lottery[0],this.lottery.recipes.forEach(r=>{this.drewProducts[r.title]||(this.drewProducts[r.title]=[]),r.relativeProducts.forEach(s=>{s.category!=="組合包"&&(s.recipeName=`抽獎食譜${r.title}`,this.drewProducts[r.title].push(s))})}),this.drewProducts=Object.entries(this.drewProducts)})},getLotteryResult(){R(j,l=>{if(l){this.uid=l.uid;const c=g(f,"users/"+l.uid);b(c,d=>{this.user=d.val();const r=g(f,`lotteryResults/${this.uid}`);b(r,s=>{this.lotteryResult=s.val(),this.lotteryResult?(this.drewArr=this.lotteryResult.drewArr,this.getPrize=this.lotteryResult.getPrize):(this.drewArr=[],this.getPrize={})})})}else this.uid=null,this.user={},this.drewArr=[],this.getPrize={}})},addtLotteryResult(){if(!this.uid){this.toastMessage("登入即可抽獎","error");return}if(this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2,000</b> 即可獲得一張抽獎券</p><p>單筆金額滿  <b>NT$5,000</b> 即可獲得三張抽獎券</p><p>單筆金額滿  <b>NT$10,000</b> 即可獲得七張抽獎券</p><a href="/finalEasyBuyEasyMake/#/products" class="link-primary">前往選購商品</a>',showConfirmButton:!0,confirmButtonColor:"#4572c2",confirmButtonText:"確定"});return}y(g(f),{[`users/${this.uid}/lotteryTicket/`]:this.user.lotteryTicket-1});const l=Math.floor(Math.random()*this.drewProducts.length),c=Math.floor(Math.random()*this.drewProducts[l][1].length);if(this.drewArr.length){if(this.drewArr.length){this.drewProducts.forEach((r,s)=>{this.drewArr[s][1]||(this.drewArr[s][1]=[])});let d=!1;if(this.drewArr[l][1]&&this.drewArr[l][1].forEach(r=>{r.title===this.drewProducts[l][1][c].title&&(d=!0)}),d)this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80" alt="非常sorry">',customClass:{icon:"border-0"},showConfirmButton:!1});else if(!d){this.drewArr[l][1].push(this.drewProducts[l][1][c]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[l][1][c].title}`,iconHtml:`<img src="${this.drewProducts[l][1][c].imgUrl}" width="100">`,customClass:{icon:"border-0"},showConfirmButton:!1}),y(g(f),{[`lotteryResults/${this.uid}/drewArr/`]:this.drewArr});let r="";if(!this.drewArr[0][1]||!this.drewArr[1][1]||!this.drewArr[2][1])return;this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length&&this.drewArr[2][1].length===this.drewProducts[2][1].length?r=0:this.drewArr[0][1].length===this.drewProducts[0][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length&&this.drewArr[1][1].length===this.drewProducts[1][1].length?r=1:(this.drewArr[0][1].length===this.drewProducts[0][1].length||this.drewArr[1][1].length===this.drewProducts[1][1].length||this.drewArr[2][1].length===this.drewProducts[2][1].length)&&(r=2),(r||r===0)&&y(g(f),{[`lotteryResults/${this.uid}/getPrize/`]:this.lottery.prizes[r]})}}}else{this.drewProducts.forEach((r,s)=>{this.drewArr[s]=[r[0],[]]}),this.drewArr[l][1].push(this.drewProducts[l][1][c]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[l][1][c].title}`,iconHtml:`<img src="${this.drewProducts[l][1][c].imgUrl}" width="100">`,customClass:{icon:"border-0"},showConfirmButton:!1});const d=g(f,`lotteryResults/${this.uid}`);z(d,{drewArr:this.drewArr,getPrize:{}})}}},mounted(){window.scrollTo(0,0),this.isLoading=!0,this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.getCoupons(),this.getLottery(),this.getLotteryResult()}},W={"data-aos":"fade-up"},Y=t("div",{class:"d-flex flex-column align-items-center py-96"},[t("img",{src:T,class:"loadingLogo mb-3",style:{width:"150px"},alt:""}),t("p",{class:"text-center fw-bold text-primary h2"},[t("span",{class:"me-1 animate-text"},"L"),t("span",{class:"mx-1 animate-text"},"o"),t("span",{class:"mx-1 animate-text"},"a"),t("span",{class:"mx-1 animate-text"},"d"),t("span",{class:"mx-1 animate-text"},"i"),t("span",{class:"mx-1 animate-text"},"n"),t("span",{class:"mx-1 animate-text"},"g"),t("span",{class:"mx-2 animate-text"},"."),t("span",{class:"me-2 animate-text"},"."),t("span",{class:"animate-text"},".")])],-1),J=t("section",{class:"text-center"},[t("div",{class:"py-lg-200 py-96 bg-img-fixed",style:{"background-image":"url('https://images.unsplash.com/photo-1678465952975-85cc1a08b2d7?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1169&q=80')"}}),t("h2",{class:"text-primary mb-0 fs-lg-1 fs-5 letter-spacing-20 fw-bold bg-secondary-lightPurple py-2"},"優惠特報")],-1),K={class:"container"},Q={class:"pt-lg-4 pt-3 position-relative"},X={class:"category-selector row row-cols-2 list-unstyled border-bottom"},Z={key:0,class:"discountImg1 d-block mx-auto",src:S,alt:"優惠折扣灰色圖示"},$={key:1,class:"d-block mx-auto",src:H,alt:"優惠折扣藍色圖示"},tt=t("span",{class:"fs-12 fs-md-5 d-block py-2"},"優惠折扣",-1),st={key:0,class:"discountImg2 d-block mx-auto",src:G,alt:"抽獎回饋灰色圖示"},et={key:1,class:"d-block mx-auto",src:I,alt:"抽獎回饋藍色圖示"},rt=t("span",{class:"fs-12 fs-md-5 d-block py-2"},"抽獎回饋",-1),it={key:0,class:"list-unstyled row row-cols-lg-2 g-3 py-5 text-darkBrown"},ot={class:"card card-coupon mb-3"},lt={class:"row g-0"},ct={class:"col-md-4"},at=["src","alt"],nt={class:"col-md-8"},dt={class:"card-body h-100 d-flex flex-column"},ht={class:"mb-2"},ut={class:"card-title fw-bold"},mt={class:"card-text text-truncate"},gt={class:"text-end mt-auto"},ft={key:1},_t=t("i",{class:"bi bi-clock-fill me-1"},null,-1),pt=t("i",{class:"bi bi-ticket-perforated-fill me-1"},null,-1),wt={key:1},bt=t("h4",{class:"mb-0 text-center fw-bold"},"本月指定抽獎食譜",-1),yt={class:"row row-cols-lg-3 row-cols-1 g-3 mt-lg-4 mt-1"},xt={class:"row g-0"},vt={class:"col-md-5"},kt=["src","alt"],Pt={class:"col-md-7"},At={class:"card-body d-flex flex-column justify-content-center align-items-center h-100"},Nt={key:1,class:"mb-0"},Lt=["src","alt"],Bt={key:0,class:"position-absolute bg-not-obtained d-flex"},Mt=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),Ct=[Mt],Et={class:"text-center"},Rt=t("p",{class:"text-end mt-3"},"抽一次消耗一張抽獎券",-1),zt={key:2,class:"text-center mt-lg-120 mt-5"},jt={class:"fs-md-3 fs-5 text-white fw-bold bg-primary-purple py-3 mb-0 d-flex align-items-center justify-content-center letter-spacing-5-sm-0"},Dt=t("span",{class:"material-icons-outlined me-md-3 me-2"}," celebration ",-1),Tt=t("span",{class:"material-icons-outlined fs-2"}," arrow_drop_down ",-1),St={class:"bg-secondary-lightPurple px-3"},Ht={class:"col-lg-4 col-12 mx-auto pt-4"},Ot={class:"card bg-transparent"},Vt={class:"card-header bg-transparent"},qt={class:"fs-4 fw-bold text-center"},Gt=["src","alt"],It={class:"card-footer bg-transparent"},Ut={class:"fw-bold"},Ft={class:"text-end"},Wt=t("p",{class:"lh-lg pb-5 text-start text-md-center"},[p("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到 "),t("a",{href:"mailto:@EasyMakeEasyBuy.gmail.com"},"@EasyMakeEasyBuy.gmail.com"),p("，感謝您的支持!"),t("br"),p("下期好禮更精彩，千萬別錯過!")],-1),Yt={class:"py-96","data-aos":"zoom-in"},Jt=q('<div class="d-lg-flex mb-2"><h2 class="d-flex align-items-center justify-content-center justify-content-lg-start fw-bold"><img src="'+U+'" class="me-lg-3 me-4 title-img" alt="熱"><span class="fs-lg-1 fs-4 letter-spacing-20">月獎品</span></h2><span class="d-flex align-items-center justify-content-center fs-lg-6 fs-12"><img src="'+O+'" class="me-2" style="width:30px;" alt="大聲公圖示"> 超值大獎一次帶回! </span></div>',1),Kt={class:"row row-cols-lg-3 row-cols-1 gy-4 mb-4"},Qt={class:"card card-prize"},Xt={class:"card-header bg-white"},Zt={class:"fs-4 fw-bold text-center"},$t={class:"card-body p-0 position-relative"},ts=["src","alt"],ss=t("div",{class:"question-mark position-absolute w-100 text-center top-0 img-lg-220-md-200 bg-gradient-card"},[t("i",{class:"bi bi-question-lg mx-auto text-white fs-150"})],-1),es={class:"card-footer bg-transparent"},rs={class:"fw-bold"},is={class:"text-end"},os=t("h3",{class:"fw-bold"},"規則：",-1);function ls(l,c,d,r,s,v){const N=A("loading"),L=A("RouterLink");return o(),i("div",W,[k(N,{active:s.isLoading,"onUpdate:active":c[0]||(c[0]=e=>s.isLoading=e),"can-cancel":!1,"is-full-page":s.fullPage,"lock-scroll":!0},{default:P(()=>[Y]),_:1},8,["active","is-full-page"]),J,t("section",K,[t("div",Q,[t("ul",X,[t("li",{class:u(["col text-center",{"pointer-events-none":s.tabName==="優惠折扣"}])},[t("a",{href:"#",onClick:c[1]||(c[1]=x(()=>s.tabName="優惠折扣",["prevent"])),class:u(["text-decoration-none d-inline-block",{"fw-bold":s.tabName==="優惠折扣","link-primary":s.tabName==="優惠折扣"}])},[s.tabName!=="優惠折扣"?(o(),i("img",Z)):s.tabName==="優惠折扣"?(o(),i("img",$)):m("",!0),tt],2)],2),t("li",{class:u(["col text-center",{"pointer-events-none":s.tabName==="抽獎回饋"}])},[t("a",{href:"#",onClick:c[2]||(c[2]=x(()=>s.tabName="抽獎回饋",["prevent"])),class:u(["text-decoration-none d-inline-block",{"fw-bold":s.tabName==="抽獎回饋","link-primary":s.tabName==="抽獎回饋"}])},[s.tabName!=="抽獎回饋"?(o(),i("img",st)):s.tabName==="抽獎回饋"?(o(),i("img",et)):m("",!0),rt],2)],2)]),t("div",{class:u(["blue-line bg-primary position-absolute",{"active-discount":s.tabName==="優惠折扣","active-gift":s.tabName==="抽獎回饋"}])},null,2)]),s.tabName==="優惠折扣"?(o(),i("ul",it,[(o(!0),i(_,null,w(s.coupons,e=>(o(),i("li",{class:"col hvr-hang",key:e.id},[t("div",ot,[t("div",lt,[t("div",ct,[t("img",{src:e.image,class:"w-100 object-fit-cover rounded-start",style:{height:"200px"},alt:e.title},null,8,at)]),t("div",nt,[t("div",dt,[t("p",ht,n(new Date(e.startDate).toLocaleDateString())+" - "+n(new Date(e.dueDate).toLocaleDateString()),1),t("h4",ut,n(e.title),1),t("p",mt,n(e.description),1),t("div",gt,[k(L,{to:`/discounts/${e.id}`,href:"#",class:"stretched-link btn btn-outline-primary"},{default:P(()=>[p("查看完整優惠資訊")]),_:2},1032,["to"])])])])])])]))),128))])):s.tabName==="抽獎回饋"?(o(),i("div",ft,[t("p",null,[_t,p("活動時間："+n(new Date(s.lottery.startDate).toLocaleDateString().split(" ")[0])+" ~ "+n(new Date(s.lottery.dueDate).toLocaleString().split(" ")[0]),1)]),s.uid?(o(),i("p",{key:0,class:u({"text-danger":s.user.lotteryTicket===0})},[pt,p("剩餘抽獎券："+n(s.user.lotteryTicket)+" 張",1)],2)):m("",!0),!s.getPrize||s.getPrize&&s.getPrize.id!==1?(o(),i("div",wt,[bt,t("div",yt,[(o(!0),i(_,null,w(s.drewProducts,(e,a)=>(o(),i("div",{key:e,class:"col"},[t("div",{class:u(["card border mb-md-3",{"border-primary":a===0||a===2,"border-purple":a===1}])},[t("div",xt,[t("div",vt,[(o(!0),i(_,null,w(s.lottery.recipes,(h,B)=>(o(),i("div",{key:h.id},[B===a?(o(),i("img",{key:0,src:h.image,alt:h.title,class:"w-100 object-fit-cover",style:{height:"150px"}},null,8,kt)):m("",!0)]))),128))]),t("div",Pt,[t("div",At,[t("h5",{class:u(["card-title fw-bold",{"text-primary":a===0||a===2,"text-purple":a===1}])},n(e[0]),3),s.drewArr[a]&&s.drewArr[a][1]?(o(),i("p",{key:0,class:u(["mb-0",{"text-danger":s.drewArr[a][1].length/e[1].length===1}])},"完成度： "+n(Math.round(s.drewArr[a][1].length/e[1].length*100)===0?"0":Math.round(s.drewArr[a][1].length/e[1].length*100))+" %",3)):!s.drewArr[a]||!s.drewArr[a][1]?(o(),i("p",Nt,"完成度：0 %")):m("",!0)])])])],2),t("ul",{class:u(["row row-cols-xl-3 row-cols-lg-2 row-cols-3 pt-3 g-0 list-unstyled",{"bg-secondary":a===0||a===2,"bg-lightPurple":a===1}])},[(o(!0),i(_,null,w(e[1],h=>(o(),i("li",{class:"d-flex flex-column align-items-center position-relative col",key:h.id},[h.category==="單一產品"?(o(),i(_,{key:0},[t("img",{src:h.imgUrl,alt:h.title,height:"100",width:"100",class:"object-fit-cover mb-1"},null,8,Lt),t("p",null,n(h.title),1),!s.drewArr[a]||!s.drewArr[a][1]||s.drewArr[a]&&s.drewArr[a][1]&&!JSON.stringify(this.drewArr[a][1]).includes(h.title)?(o(),i("div",Bt,Ct)):m("",!0)],64)):m("",!0)]))),128))],2)]))),128))]),t("div",Et,[t("button",{type:"button",class:"hvr-sweep-to-right mt-3 btn btn-primary",onClick:c[3]||(c[3]=x((...e)=>v.addtLotteryResult&&v.addtLotteryResult(...e),["prevent"]))},"立即抽獎")]),Rt])):m("",!0),s.lotteryResult&&this.getPrize&&this.getPrize.id?(o(),i("div",zt,[t("h5",jt,[Dt,p("恭喜您完成 "+n(s.getPrize.id===1?"全部":s.getPrize.id===2?"2份":"1份")+"食譜，獲得 ",1),Tt]),t("div",St,[t("div",Ht,[t("div",Ot,[t("div",Vt,[t("h3",qt,n(s.getPrize.id===1?"大獎":s.getPrize.id===2?"二獎":"三獎"),1)]),t("img",{src:s.getPrize.img,class:"card-img img-lg-220-md-200 object-fit-contain border bg-white",alt:s.getPrize.title},null,8,Gt),t("div",It,[t("h5",Ut,n(s.getPrize.title),1),t("p",Ft,"價值：NT$ "+n(l.numberComma(s.getPrize.price)),1)])])]),Wt])])):m("",!0),t("div",Yt,[Jt,t("div",Kt,[(o(!0),i(_,null,w(s.lottery.prizes,e=>(o(),i("div",{class:"col",key:e.id,"data-aos":"flip-right"},[t("div",Qt,[t("div",Xt,[t("h3",Zt,n(e.id===1?"大獎":e.id===2?"二獎":"三獎"),1)]),t("div",$t,[t("img",{src:e.img,class:"card-img border bg-white object-fit-contain img-lg-220-md-200",alt:e.title},null,8,ts),ss]),t("div",es,[t("h5",rs,n(e.title),1),t("p",is,"價值：NT$ "+n(l.numberComma(e.price)),1)])])]))),128))]),os,t("ol",null,[(o(!0),i(_,null,w(s.lottery.rules,e=>(o(),i("li",{key:e+20},n(e),1))),128))])])])):m("",!0)])])}const bs=V(F,[["render",ls]]);export{bs as default};
