import{m as y}from"./modalMixin-84af034f.js";import{u as V,r as m,p as E,s as U,d as r,o as M,a as S}from"./db-64e704f5.js";import{m as w}from"./index-80b1a182.js";import{c as x}from"./carts-8c30b681.js";import{v as u,a as L}from"./runtime-dom.esm-bundler-54ced388.js";import{_,o as d,U as a,V as t,Z as b,$ as l,Y as D,a0 as c,a1 as N,a2 as T,W as v,r as g}from"./_plugin-vue_export-helper-03b40388.js";import"./modal-5929133b.js";import"./_commonjsHelpers-042e6b4d.js";import"./vue-router-2c21c692.js";const B={data(){return{tempCoupon:{isEnabled:!1},status:"edit",startDate:"",dueDate:"",couponId:""}},mixins:[y],props:["id","openModal"],methods:{...w(x,["toastMessage"]),updateCoupon(){if(this.tempCoupon.startDate=new Date(this.startDate).getTime(),this.tempCoupon.dueDate=new Date(this.dueDate).getTime(),!this.tempCoupon.code||!this.tempCoupon.discount||!this.tempCoupon.condition||!this.tempCoupon.description||!this.tempCoupon.image||!this.tempCoupon.startDate||!this.tempCoupon.dueDate||!this.tempCoupon.title){console.log(this.tempCoupon.code,this.tempCoupon.discount,this.tempCoupon.condition,this.tempCoupon.description,this.tempCoupon.image,this.tempCoupon.startDate,this.tempCoupon.dueDate,this.tempCoupon.isEnabled,this.tempCoupon.title,"哪裡沒寫"),this.toastMessage("資料沒寫完","error");return}if(this.status==="edit")V(m(r),{[`coupons/${this.couponId}/`]:{code:this.tempCoupon.code,discount:this.tempCoupon.discount,condition:this.tempCoupon.condition,startDate:this.tempCoupon.startDate,dueDate:this.tempCoupon.dueDate,isEnabled:this.tempCoupon.isEnabled,description:this.tempCoupon.description,image:this.tempCoupon.image,title:this.tempCoupon.title}}),this.toastMessage("更改成功");else if(this.status==="new"){const n=m(r,"coupons/"),o=E(n);this.tempCoupon.isEnabled||(this.tempCoupon.isEnabled=!1),U(o,{code:this.tempCoupon.code,discount:this.tempCoupon.discount,condition:this.tempCoupon.condition,startDate:this.tempCoupon.startDate,dueDate:this.tempCoupon.dueDate,isEnabled:this.tempCoupon.isEnabled,description:this.tempCoupon.description,image:this.tempCoupon.image,title:this.tempCoupon.title}),this.toastMessage("新增成功")}this.hide()}},mounted(){},watch:{id(){if(this.id!=="new"&&this.id!==""){const n=m(r,`coupons/${this.id}`);M(n,o=>{if(this.tempCoupon=o.val(),!this.tempCoupon){this.hide();return}this.tempCoupon.id=this.id,this.dueDate=new Date(this.tempCoupon.dueDate).toISOString().split("T")[0],this.startDate=new Date(this.tempCoupon.startDate).toISOString().split("T")[0],console.log(this.tempCoupon,"折價券"),this.show(),this.status="edit",this.couponId=this.id,this.openModal("")})}else this.id==="new"&&(this.tempCoupon={},this.show(),this.status="new",this.openModal(""))}}},R={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},A={class:"modal-dialog modal-xl"},O={key:0,class:"modal-content"},F={class:"modal-header bg-dark"},P={class:"modal-title text-white",id:"exampleModalLabel"},W={key:0},Y={key:1},Z=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),j={class:"modal-body"},q={class:"row"},z={class:"col-4"},G=t("label",{for:"image",class:"form-label"},"主圖網址",-1),H=["src"],J={class:"col-8"},K={class:"row gy-3"},Q={class:"col-4"},X=t("label",{for:"serialNumber",class:"form-label"},"編號（id）",-1),$={class:"col-6"},tt=t("label",{for:"title",class:"form-label"},"優惠券名稱",-1),ot={class:"col-2"},et=t("label",{for:"price",class:"form-label"},"折扣(%)",-1),st={class:"col-3"},nt=t("label",{for:"date",class:"form-label"},"起始日",-1),it={class:"col-3"},lt=t("label",{for:"date",class:"form-label"},"到期日",-1),dt={class:"col-3"},at=t("label",{for:"code",class:"form-label"},"優惠碼",-1),pt={class:"col-3"},ut=t("label",{for:"condition",class:"form-label"},"條件 >= 金額",-1),ct={class:"col-12"},mt={class:"form-check"},rt=t("label",{class:"form-check-label",for:"isEnabled"}," 是否啟用 ",-1),ht={class:"col-12"},bt=t("label",{for:"description",class:"form-label"},"優惠券描述",-1),_t={class:"modal-footer"},Ct=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),ft={key:0},Dt={key:1};function vt(n,o,C,f,e,i){return d(),a("div",R,[t("div",A,[e.tempCoupon?(d(),a("div",O,[t("div",F,[t("h5",P,[e.status==="edit"?(d(),a("span",W,"編輯優惠券內容")):e.status==="new"?(d(),a("span",Y,"新增優惠券內容")):b("",!0)]),Z]),t("div",j,[t("div",q,[t("div",z,[G,l(t("input",{type:"text",id:"image",class:"form-control mb-3","onUpdate:modelValue":o[0]||(o[0]=s=>e.tempCoupon.image=s)},null,512),[[u,e.tempCoupon.image]]),t("img",{src:e.tempCoupon.image,alt:"",width:"300"},null,8,H)]),t("div",J,[t("div",K,[t("div",Q,[X,l(t("input",{type:"text",id:"serialNumber",class:"form-control","onUpdate:modelValue":o[1]||(o[1]=s=>e.tempCoupon.id=s),disabled:""},null,512),[[u,e.tempCoupon.id]])]),t("div",$,[tt,l(t("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":o[2]||(o[2]=s=>e.tempCoupon.title=s)},null,512),[[u,e.tempCoupon.title]])]),t("div",ot,[et,l(t("input",{type:"text",id:"price",class:"form-control","onUpdate:modelValue":o[3]||(o[3]=s=>e.tempCoupon.discount=s)},null,512),[[u,e.tempCoupon.discount,void 0,{number:!0}]])]),t("div",st,[nt,l(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":o[4]||(o[4]=s=>e.startDate=s)},null,512),[[u,e.startDate]])]),t("div",it,[lt,l(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":o[5]||(o[5]=s=>e.dueDate=s)},null,512),[[u,e.dueDate]])]),t("div",dt,[at,l(t("input",{type:"text",id:"code",class:"form-control","onUpdate:modelValue":o[6]||(o[6]=s=>e.tempCoupon.code=s)},null,512),[[u,e.tempCoupon.code]])]),t("div",pt,[ut,l(t("input",{type:"text",id:"condition",class:"form-control","onUpdate:modelValue":o[7]||(o[7]=s=>e.tempCoupon.condition=s)},null,512),[[u,e.tempCoupon.condition,void 0,{number:!0}]])]),t("div",ct,[t("div",mt,[l(t("input",{class:"form-check-input",type:"checkbox","v-true":1,"v-false":0,id:"isEnabled","onUpdate:modelValue":o[8]||(o[8]=s=>e.tempCoupon.isEnabled=s)},null,512),[[L,e.tempCoupon.isEnabled]]),rt])]),t("div",ht,[bt,l(t("textarea",{name:"",id:"description",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":o[9]||(o[9]=s=>e.tempCoupon.description=s)},null,512),[[u,e.tempCoupon.description]])])])])])]),t("div",_t,[Ct,t("button",{type:"button",class:"btn btn-primary",onClick:o[10]||(o[10]=(...s)=>i.updateCoupon&&i.updateCoupon(...s))},[e.status==="edit"?(d(),a("span",ft,"確認編輯")):e.status==="new"?(d(),a("span",Dt,"確認新增")):b("",!0)])])])):b("",!0)])],512)}const gt=_(B,[["render",vt]]),yt={data(){return{tempCoupon:{},deleteId:""}},mixins:[y],props:["id","openDeleteModal","item"],methods:{...w(x,["toastMessage"]),deleteCoupon(){S(m(r,`coupons/${this.deleteId}`)),this.toastMessage("刪除優惠券"),this.hide()}},watch:{id(){this.id&&(this.show(),this.tempCoupon=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}}},Mt={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},wt={class:"modal-dialog"},xt={class:"modal-content"},kt=t("div",{class:"modal-header bg-dark"},[t("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除優惠券 "),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),It={class:"modal-body"},Vt={class:"text-danger fw-bold"},Et={class:"modal-footer"},Ut=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function St(n,o,C,f,e,i){return d(),a("div",Mt,[t("div",wt,[t("div",xt,[kt,t("div",It,[t("p",null,[D("確定要刪除優惠券 "),t("span",Vt," 【"+c(e.tempCoupon.title)+"】 ",1),D(" 嗎? ")])]),t("div",Et,[Ut,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=(...s)=>i.deleteCoupon&&i.deleteCoupon(...s))}," 確認刪除 ")])])])],512)}const Lt=_(yt,[["render",St]]),Nt={components:{CouponModal:gt,DeleteCouponModal:Lt},data(){return{coupons:{},couponId:"",couponDeleteId:"",couponDeleteItem:{}}},methods:{getCoupons(){const n=m(r,"coupons/");M(n,o=>{this.coupons=o.val(),console.log(this.coupons,"折價券")})},openModal(n){this.couponId=n},openDeleteModal(n,o){this.couponDeleteId=n,this.couponDeleteItem=o}},mounted(){this.getCoupons()}},Tt={class:"container"},Bt={class:"d-flex my-4"},Rt={class:"table text-center",style:{"vertical-align":"middle"}},At=t("thead",null,[t("tr",null,[t("th",null,"編號"),t("th",null,"名稱"),t("th",null,"優惠碼"),t("th",null,"折扣百分比"),t("th",null,"詳細內容"),t("th",null,"起始日"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Ot={class:"btn-group"},Ft=["onClick"],Pt=["onClick"];function Wt(n,o,C,f,e,i){const s=g("CouponModal"),k=g("DeleteCouponModal");return d(),a("div",Tt,[t("div",Bt,[t("button",{type:"button",class:"ms-auto btn btn-primary",onClick:o[0]||(o[0]=p=>i.openModal("new"))},"建立新優惠券")]),t("table",Rt,[At,t("tbody",null,[(d(!0),a(N,null,T(e.coupons,(p,h)=>(d(),a("tr",{key:h},[t("td",null,c(h),1),t("td",null,c(p.title),1),t("td",null,c(p.code),1),t("td",null,c(p.discount)+" %",1),t("td",null,c(p.description),1),t("td",null,c(new Date(p.startDate).toLocaleString().split(" ")[0]),1),t("td",null,c(new Date(p.dueDate).toLocaleString().split(" ")[0]),1),t("td",null,c(p.isEnabled?"是":"否"),1),t("td",null,[t("div",Ot,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:I=>i.openModal(h)},"編輯",8,Ft),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:I=>i.openDeleteModal(h,p)},"刪除",8,Pt)])])]))),128))])]),v(s,{ref:"productModal",id:e.couponId,"open-modal":i.openModal},null,8,["id","open-modal"]),v(k,{ref:"deleteProductModal",id:e.couponDeleteId,item:e.couponDeleteItem,"open-delete-modal":i.openDeleteModal},null,8,["id","item","open-delete-modal"])])}const Qt=_(Nt,[["render",Wt]]);export{Qt as default};
