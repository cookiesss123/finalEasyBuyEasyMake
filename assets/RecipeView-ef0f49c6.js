import{S,a as V,N as A,P as L}from"./pagination.min-cc566d53.js";import{b as U,v as z,w as D}from"./runtime-dom.esm-bundler-54ced388.js";import{m as G}from"./index-966010aa.js";import{c as q}from"./carts-f2393f2b.js";import{n as E}from"./numberCommaMixin-e0aac39c.js";import{o as N,r as a,b as f,d as m,s as w,c as I,p as Y,a as M}from"./db-143b9a4b.js";import{L as O}from"./LoadingComponent-8a5de011.js";import{_ as F,U as r,V as e,W as T,X as p,a0 as n,Z as u,a4 as y,a1 as _,a2 as g,Y as h,$ as B,c as v,r as x,o}from"./_plugin-vue_export-helper-03b40388.js";import"./vue-router-2c21c692.js";import"./_commonjsHelpers-042e6b4d.js";import"./loadingLogo-3bb466c0.js";const W={components:{Swiper:S,SwiperSlide:V,LoadingComponent:O},mixins:[E],data(){return{loading:!0,recipe:{},modules:[A,L],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",bookMark:{},allThumbNum:0,myThumb:{},recipeComments:[],recipeMessage:"",qty:1,groupProduct:{},user:{},uid:""}},methods:{...G(q,["addCart","toastMessage"]),getMyThumb(){N(M,l=>{if(l){this.uid=l.uid;const{id:i}=this.$route.params,b=a(m,`recipePersonalThumbs/${this.uid}/${i}`);f(b,d=>{this.myThumb=d.val(),console.log(this.myThumb,"個人按讚")})}else console.log("並未登入"),this.uid=null,this.user={},this.myThumb=null})},getAllThumbs(){const{id:l}=this.$route.params,i=a(m,`recipeThumbs/${l}`);f(i,b=>{this.allThumbNum=b.val(),this.allThumbNum?this.allThumbNum=this.allThumbNum.thumbs:this.allThumbNum=0,console.log(this.allThumbNum,!this.allThumbNum,"所有讚")})},addThumb(){if(!this.uid){this.toastMessage("登入才可按讚","error");return}const l=a(m,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`);w(l,this.recipe);const i=a(m,`recipeThumbs/${this.recipe.id}`);w(i,{thumbs:this.allThumbNum+1}),this.toastMessage("按讚成功")},deleteThumb(){I(a(m,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`));const l=a(m,`recipeThumbs/${this.recipe.id}`);w(l,{thumbs:this.allThumbNum-1}),this.toastMessage("取消按讚")},getRecipe(){const{id:l}=this.$route.params,i=a(m,`recipes/${l}`);f(i,b=>{this.recipe=b.val(),this.recipe.id=l,console.log(this.recipe,"讀取的資料"),this.mainImg=this.recipe.image,this.groupProduct=this.recipe.relativeProducts.filter(d=>d.category==="組合包"),this.groupProduct=this.groupProduct[0],this.loading=!1})},getAllComments(){const{id:l}=this.$route.params,i=a(m,"recipeComments/");f(i,b=>{let d=b.val();d=Object.values(d).map((s,c)=>(s.id=Object.keys(s)[c],s)),console.log(d,"全部食譜的留言"),this.recipeComments=d.filter(s=>s.recipeId===l),console.log(this.recipeComments,"個別留言")})},addComments(){const l=a(m,"recipeComments"),i=Y(l);w(i,{recipeId:this.recipe.id,createAt:new Date().getTime(),message:this.recipeMessage,username:this.user.nickName,userImg:this.user.headshotImg}),this.recipeMessage=""},getBookmark(){N(M,l=>{if(l){this.uid=l.uid,console.log(this.uid,"使用者已登入取得 uid");const i=a(m,"users/"+l.uid);f(i,b=>{this.user=b.val(),console.log(this.user,"讀取的資料");const{id:d}=this.$route.params,s=a(m,`recipeBookmarks/${this.uid}/${d}`);f(s,c=>{this.bookMark=c.val(),console.log(this.bookMark,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={},this.bookMark=null})},addBookmark(){if(!this.uid){this.toastMessage("登入才可使用收藏功能","error");return}const l=a(m,`recipeBookmarks/${this.uid}/${this.recipe.id}`);w(l,this.recipe),this.toastMessage("收藏成功")},deleteBookmark(){I(a(m,`recipeBookmarks/${this.uid}/${this.recipe.id}`)),this.toastMessage("刪除收藏")}},mounted(){this.loading=!0,this.getAllThumbs(),this.getMyThumb(),this.getBookmark(),this.getRecipe(),this.getAllComments()}},X={key:0,class:"mt-10",style:{"overflow-x":"hidden"}},Z={class:"container"},H={"aria-label":"breadcrumb"},J={class:"breadcrumb"},K={class:"breadcrumb-item"},Q={class:"breadcrumb-item active","aria-current":"page"},$={class:"container mt-lg-5"},ee={class:"row row-cols-lg-2 row-cols-1 gx-5"},se={class:"col"},te={class:"d-flex recipeMainImg mb-4"},ie=["src"],oe={class:"recipeSwiper position-relative"},le=["src"],re=["src"],ne={class:"col d-flex flex-column"},ce={class:"d-flex align-items-center mb-3"},ae={class:"me-2 mb-0"},me={class:"badge rounded-pill bg-red"},de={class:"mb-0 mainTitle"},ue={class:"d-flex align-items-center ms-auto"},he=e("i",{class:"bi bi-heart"},null,-1),be=[he],pe=e("i",{class:"bi bi-heart-fill"},null,-1),_e=[pe],ge=e("i",{class:"bi bi-hand-thumbs-up"},null,-1),fe=[ge],ye=e("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),ve=[ye],ke={class:"mb-3"},we={class:"mb-3"},xe={class:"mt-auto"},Te=e("h5",null,"甜點介紹：",-1),Ce={class:"mb-5"},Ne={class:"bg-lightYellow my-5",style:{"overflow-x":"hidden"}},Ie={class:"container py-5"},Me={class:"row row-cols-lg-2 row-cols-1 g-5"},Be={class:"col"},Pe=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons"},"egg"),h(" 準備材料")],-1),Re={class:"me-3"},je={class:"row mb-6"},Se=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons-outlined"},"soup_kitchen"),h(" 製作步驟")],-1),Ve={key:0},Ae=e("h3",{class:"mt-6 mb-3 fw-bold"},[e("i",{class:"bi bi-youtube"}),h(" 教學影片")],-1),Le=["src"],Ue={class:"col"},ze=e("h3",{class:"mb-4 fw-bold"},[e("i",{class:"bi bi-bag-check-fill"}),h(" 相關產品")],-1),De={class:"row"},Ge={class:"col-12 relativeProducts"},qe={class:"enlargeImg",style:{width:"50% !important"}},Ee=["src"],Ye={class:"fw-bold mt-2"},Oe={class:"d-flex justify-content-between align-items-end"},Fe={class:"h5 mb-0 d-flex flex-column"},We={class:"text-secondary me-3",style:{"font-size":"16px"}},Xe={class:"text-danger fw-bold"},Ze=e("span",{class:"text-darkBrown"}," / 組",-1),He={class:"input-group w-50"},Je=["value"],Ke={class:"row mt-5 row-cols-lg-3 row-cols-2 relativeProducts"},Qe={class:"enlargeImg"},$e=["src"],es={class:"fw-bold mt-2"},ss={class:"container py-5"},ts={class:"d-flex align-items-center"},is=e("i",{class:"bi bi-stars"},null,-1),os={class:"d-flex"},ls={class:"my-5"},rs={key:0,action:""},ns={class:"mb-3 fw-bold d-flex align-items-center"},cs=["src"],as={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},ms={class:"d-flex"},ds={class:"row gy-5"},us={class:"mb-2 fw-bold d-flex align-items-center"},hs=["src"],bs={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},ps={class:"mb-0"};function _s(l,i,b,d,s,c){const k=x("RouterLink"),C=x("swiper-slide"),P=x("swiper"),R=x("LoadingComponent");return o(),r("div",null,[s.loading?s.loading?(o(),v(R,{key:1})):u("",!0):(o(),r("div",X,[e("div",Z,[e("nav",H,[e("ol",J,[e("li",K,[T(k,{to:"/recipes",class:"link-red"},{default:p(()=>[h("甜點食譜")]),_:1})]),e("li",Q,n(s.recipe.title),1)])])]),e("section",$,[e("div",ee,[e("div",se,[e("div",te,[e("img",{src:s.mainImg,style:{"object-fit":"cover","max-height":"300px"},class:"w-100",alt:""},null,8,ie)]),e("div",oe,[T(P,{"slides-per-view":3,"space-between":15,modules:s.modules,navigation:"",style:{height:"160px"},class:"w-100"},{default:p(()=>[T(C,{style:{cursor:"pointer"},onClick:i[0]||(i[0]=()=>s.mainImg=s.recipe.image)},{default:p(()=>[e("div",null,[e("img",{src:s.recipe.image,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:y({border:s.mainImg===s.recipe.image,"border-3":s.mainImg===s.recipe.image,"border-red":s.mainImg===s.recipe.image})},null,10,le)])]),_:1}),(o(!0),r(_,null,g(s.recipe.imgsUrl,t=>(o(),v(C,{key:t+45345,style:{cursor:"pointer"},onClick:()=>s.mainImg=t},{default:p(()=>[e("div",null,[e("img",{src:t,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:y({border:s.mainImg===t,"border-3":s.mainImg===t,"border-red":s.mainImg===t})},null,10,re)])]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])])]),e("div",ne,[e("div",ce,[e("h5",ae,[e("span",me,n(s.recipe.category),1)]),e("h1",de,n(s.recipe.title),1),e("div",ue,[s.bookMark?s.bookMark?(o(),r("button",{key:1,type:"button",class:"border-0 bg-transparent fs-4",onClick:i[2]||(i[2]=(...t)=>c.deleteBookmark&&c.deleteBookmark(...t)),style:{color:"#fa6e42"}},_e)):u("",!0):(o(),r("button",{key:0,type:"button",class:"border-0 bg-transparent text-red fs-4",onClick:i[1]||(i[1]=()=>c.addBookmark(s.recipe.id))},be)),e("span",{class:y(["mb-0 ms-3",{"text-red":s.allThumbNum,"text-lightGray":!s.allThumbNum}])},n(s.allThumbNum),3),s.myThumb?s.myThumb?(o(),r("button",{key:3,type:"button",class:y(["border-0 bg-transparent fs-4",{"text-red":s.allThumbNum,"text-lightGray":!s.allThumbNum}]),onClick:i[4]||(i[4]=(...t)=>c.deleteThumb&&c.deleteThumb(...t))},ve,2)):u("",!0):(o(),r("button",{key:2,type:"button",class:y(["border-0 bg-transparent fs-4",{"text-red":s.allThumbNum,"text-lightGray":!s.allThumbNum}]),onClick:i[3]||(i[3]=(...t)=>c.addThumb&&c.addThumb(...t))},fe,2))])]),e("h5",ke,"食譜作者："+n(s.recipe.author),1),e("h5",we,"份量："+n(s.recipe.content),1),e("div",xe,[Te,e("p",Ce,n(s.recipe.description),1)])])])]),e("section",Ne,[e("div",Ie,[e("div",Me,[e("div",Be,[Pe,e("h5",Re,"成本：NT$ "+n(s.recipe.total),1),e("div",je,[(o(!0),r(_,null,g(s.recipe.ingredients,(t,j)=>(o(),r("div",{class:"col-12",key:t+367657},n(j+1)+". "+n(t.name)+" "+n(t.num)+" "+n(t.unit),1))),128))]),Se,s.recipe.instructions?(o(),r("div",Ve,[(o(!0),r(_,null,g(s.recipe.instructions.split("/"),t=>(o(),r("p",{class:"me-3",key:t+346346},n(t),1))),128))])):u("",!0),Ae,e("iframe",{width:"560",height:"315",src:s.recipe.video,title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""},null,8,Le)]),e("div",Ue,[ze,e("div",De,[e("div",Ge,[(o(!0),r(_,null,g(s.recipe.relativeProducts,t=>(o(),r("div",{key:t.id+456496},[t.category==="組合包"?(o(),v(k,{key:0,to:`/products/${t.id}`,class:"link-red d-flex flex-column align-items-center cardImg"},{default:p(()=>[e("div",qe,[e("img",{src:t.imgUrl,alt:"",class:"w-100",height:"150",style:{"object-fit":"cover"}},null,8,Ee)]),e("p",Ye,n(t.title),1)]),_:2},1032,["to"])):u("",!0)]))),128))])]),e("div",Oe,[e("p",Fe,[e("del",We,"NT$ "+n(l.numberComma(s.recipe.total)),1),e("span",Xe,[h("NT$ "+n(l.numberComma(s.recipe.price))+" ",1),Ze])]),e("div",He,[B(e("select",{name:"",id:"",class:"form-select text-center","onUpdate:modelValue":i[5]||(i[5]=t=>s.qty=t),style:{width:"70px"}},[(o(),r(_,null,g(30,t=>e("option",{value:t,key:t+4596945},n(t),9,Je)),64))],512),[[U,s.qty]]),e("button",{class:"btn btn-red",type:"button",id:"button-addon2",onClick:i[6]||(i[6]=()=>l.addCart(s.groupProduct,s.qty))},"一鍵買齊")])]),e("div",Ke,[(o(!0),r(_,null,g(s.recipe.relativeProducts,t=>(o(),r("div",{class:"col",key:t.id+456496},[t.category==="單一產品"?(o(),v(k,{key:0,to:`/products/${t.id}`,class:"link-red d-flex flex-column align-items-center cardImg"},{default:p(()=>[e("div",Qe,[e("img",{src:t.imgUrl,alt:"",height:"150",style:{"object-fit":"cover"},class:"w-100"},null,8,$e)]),e("p",es,n(t.title),1)]),_:2},1032,["to"])):u("",!0)]))),128))])])])])]),e("section",ss,[e("h3",ts,[is,h(" 顧客評價 "),e("div",{class:y(["ms-2 badge border rounded-pill bg-white",{"text-orange":s.recipeComments.length,"text-lightBrownGray":!s.recipeComments.length,"border-orange":s.recipeComments.length,"border-lightBrownGray":!s.recipeComments.length}]),style:{"font-size":"16px"}},n(s.recipeComments.length)+" 則 ",3),s.uid?u("",!0):(o(),v(k,{key:0,to:"/login",class:"ms-3 btn btn-red d-none d-lg-block"},{default:p(()=>[h("我要登入寫評價")]),_:1}))]),e("div",os,[s.uid?u("",!0):(o(),v(k,{key:0,to:"/login",class:"btn btn-red d-lg-none ms-auto"},{default:p(()=>[h("我要登入寫評價")]),_:1}))]),e("div",ls,[s.uid?(o(),r("form",rs,[e("h5",ns,[s.user.headshotImg?(o(),r("img",{key:0,src:s.user.headshotImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,cs)):s.user.headshotImg?u("",!0):(o(),r("i",as)),h(" "+n(s.user.nickName),1)]),B(e("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":i[7]||(i[7]=t=>s.recipeMessage=t)},null,512),[[z,s.recipeMessage]]),e("div",ms,[e("button",{type:"submit",class:"ms-auto btn btn-red mt-3",onClick:i[8]||(i[8]=D((...t)=>c.addComments&&c.addComments(...t),["prevent"]))},"送出")])])):u("",!0),e("div",ds,[(o(!0),r(_,null,g(s.recipeComments,t=>(o(),r("div",{class:"col-12 border-bottom",key:t+3657},[e("h5",us,[t.userImg?(o(),r("img",{key:0,src:t.userImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,hs)):t.userImg?u("",!0):(o(),r("i",bs)),h(" "+n(t.username),1)]),e("p",ps,n(`${new Date(t.createAt).toLocaleDateString()}`),1),e("p",null,n(t.message),1)]))),128))])])])]))])}const Ms=F(W,[["render",_s]]);export{Ms as default};
