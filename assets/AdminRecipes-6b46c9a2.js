import{m as k}from"./modalMixin-06b4756c.js";import{u as D,r as h,p as I,s as P,d as _,b as y,c as w,e as L}from"./carts-18eb5781.js";import{f as V}from"./index-9f8e1fb0.js";import{l as m,k as N}from"./runtime-dom.esm-bundler-eb0e3820.js";import{b6 as U,aj as l,l as n,m as e,k as f,b3 as d,F as R,at as g,aJ as r,s as v,av as x,t as M}from"./_plugin-vue_export-helper-68081c38.js";import"./base-component-9dfae801.js";const T={data(){return{tempRecipe:{imgsUrl:[]},status:"edit",recipeType:["法式甜點","義式甜點","美式甜點","日式甜點","台式甜點"],total:0,recipeId:""}},mixins:[k],props:["id","openModal","products"],methods:{...V(w,["toastMessage"]),updateRecipe(){if(!this.tempRecipe.author||!this.tempRecipe.category||!this.tempRecipe.content||!this.tempRecipe.description||!this.tempRecipe.image||!this.tempRecipe.imgsUrl||!this.tempRecipe.ingredients||!this.tempRecipe.instructions||!this.tempRecipe.title||!this.tempRecipe.video){this.toastMessage("資料沒寫完","error");return}if(this.status==="edit"){if(!this.tempRecipe.price){this.toastMessage("還沒填寫組合價","error");return}D(h(_),{[`recipes/${this.recipeId}/`]:{author:this.tempRecipe.author,category:this.tempRecipe.category,content:this.tempRecipe.content,description:this.tempRecipe.description,image:this.tempRecipe.image,imgsUrl:this.tempRecipe.imgsUrl,ingredients:this.tempRecipe.ingredients,instructions:this.tempRecipe.instructions,price:this.tempRecipe.price,relativeProducts:this.tempRecipe.relativeProducts,title:this.tempRecipe.title,total:this.total,video:this.tempRecipe.video}}),this.toastMessage("更改成功","success")}else if(this.status==="new"){const a=h(_,"recipes/"),s=I(a);this.tempRecipe.price=0,this.total=0,this.tempRecipe.relativeProducts=[],P(s,{author:this.tempRecipe.author,category:this.tempRecipe.category,content:this.tempRecipe.content,description:this.tempRecipe.description,image:this.tempRecipe.image,imgsUrl:this.tempRecipe.imgsUrl,ingredients:this.tempRecipe.ingredients,instructions:this.tempRecipe.instructions,price:this.tempRecipe.price,relativeProducts:this.tempRecipe.relativeProducts,title:this.tempRecipe.title,total:this.total,video:this.tempRecipe.video}),this.toastMessage("新增成功","success")}this.hide()}},watch:{id(){if(this.id!=="new"&&this.id!==""){const a=h(_,`recipes/${this.id}`);y(a,s=>{this.tempRecipe=s.val(),this.id&&(this.tempRecipe.id=this.id),this.tempRecipe.imgsUrl||(this.tempRecipe.imgsUrl=[]),this.tempRecipe.ingredients||(this.tempRecipe.ingredients=[]),this.tempRecipe.relativeProducts=[],this.total=0,this.products.forEach(p=>{p.relevantRecipes.forEach(b=>{b===this.tempRecipe.title&&p.category==="單一產品"?(this.tempRecipe.relativeProducts.push(p),this.total+=p.price):b===this.tempRecipe.title&&p.category==="組合包"&&this.tempRecipe.relativeProducts.push(p)})}),this.show(),this.status="edit",this.recipeId=this.id,this.openModal("")})}else this.id==="new"&&(this.tempRecipe={ingredients:[],imgsUrl:[]},this.relativeProducts=[],this.show(),this.status="new",this.openModal(""))}}},j={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},B={class:"modal-dialog modal-xl"},E={class:"modal-content"},S={class:"modal-header bg-dark"},A={class:"modal-title text-white",id:"exampleModalLabel"},F={key:0},O={key:1},J=e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),q={class:"modal-body"},z={class:"row"},G={class:"col-lg-4"},H={class:"row"},K={class:"col-12"},Q=e("label",{for:"imgUrl",class:"form-label"},"圖片網址",-1),W=["src"],X=e("hr",null,null,-1),Y=e("label",{for:"subPic",class:"form-label"},"副圖網址",-1),Z=["onUpdate:modelValue"],$=["src"],ee={class:"d-flex"},te=["onClick"],se={key:0,class:"d-flex mt-4"},ie={class:"col-12"},oe=e("label",{for:"videoUrl",class:"form-label"},"影片網址",-1),le={class:"col-12"},ne=e("label",{for:"ingredients",class:"form-label"},"材料",-1),ce={class:"input-group-text"},pe=["onUpdate:modelValue"],de=["onUpdate:modelValue"],re=["onUpdate:modelValue"],ae=["onClick"],me={key:0,class:"d-flex"},ue={class:"col-lg-8"},he={class:"row gy-3"},_e={class:"col-lg-4"},be=e("label",{for:"title",class:"form-label"},"食譜編號（id）",-1),Re={class:"col-lg-3"},ge=e("label",{for:"category",class:"form-label"},"食譜類別",-1),fe=["value"],ve={class:"col-lg-5"},ye=e("label",{for:"title",class:"form-label"},"食譜名稱",-1),Ue={class:"col-lg-4"},xe=e("label",{for:"content",class:"form-label"},"作者",-1),Me={class:"col-lg-3"},ke=e("label",{for:"content",class:"form-label"},"食譜內容",-1),we={class:"col-lg-3"},Ve=e("label",{for:"costs",class:"form-label"},"成本",-1),Ce={class:"d-flex align-items-center"},De={class:"col-lg-2"},Ie=e("label",{for:"costs",class:"form-label"},"組合價",-1),Pe={class:"d-flex align-items-center"},Le={class:"col-12"},Ne=e("label",{for:"description",class:"form-label"},"食譜描述",-1),Te={class:"col-12"},je=e("label",{for:"instructions",class:"form-label"},"製作步驟",-1),Be={class:"col-12"},Ee=e("label",{for:"product",class:"form-label text-primary"},"所需產品",-1),Se=["for"],Ae={class:"text-end text-primary"},Fe={class:"modal-footer"},Oe=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),Je={key:0},qe={key:1};function ze(a,s,p,b,t,u){return l(),n("div",j,[e("div",B,[e("div",E,[e("div",S,[e("h5",A,[t.status==="edit"?(l(),n("span",F,"編輯產品內容")):t.status==="new"?(l(),n("span",O,"新增產品內容")):f("",!0)]),J]),e("div",q,[e("div",z,[e("div",G,[e("div",H,[e("div",K,[Q,d(e("input",{type:"text",id:"imgUrl",class:"form-control mb-3","onUpdate:modelValue":s[0]||(s[0]=i=>t.tempRecipe.image=i)},null,512),[[m,t.tempRecipe.image]]),e("img",{src:t.tempRecipe.image,alt:"",width:"300"},null,8,W),X,(l(!0),n(R,null,g(t.tempRecipe.imgsUrl,(i,c)=>(l(),n("div",{key:i+3453},[Y,d(e("input",{type:"text",id:"subPic",class:"form-control mb-3","onUpdate:modelValue":o=>t.tempRecipe.imgsUrl[c]=o},null,8,Z),[[m,t.tempRecipe.imgsUrl[c]]]),e("img",{src:t.tempRecipe.imgsUrl[c],alt:"",width:"300"},null,8,$),e("div",ee,[e("button",{type:"button",class:"ms-auto btn btn-danger",onClick:()=>t.tempRecipe.imgsUrl.splice(c,1)},"刪除圖片",8,te)])]))),128)),t.tempRecipe.imgsUrl[t.tempRecipe.imgsUrl.length-1]!==""?(l(),n("div",se,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[1]||(s[1]=()=>t.tempRecipe.imgsUrl.push(""))},"新增圖片")])):f("",!0)]),e("div",ie,[oe,d(e("input",{type:"text",id:"videoUrl",class:"form-control mb-3","onUpdate:modelValue":s[2]||(s[2]=i=>t.tempRecipe.video=i)},null,512),[[m,t.tempRecipe.video]])]),e("div",le,[ne,(l(!0),n(R,null,g(t.tempRecipe.ingredients,(i,c)=>(l(),n("div",{class:"input-group mb-3",key:i+342},[e("div",ce,r(c+1),1),d(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":o=>t.tempRecipe.ingredients[c].name=o,style:{width:"150px"}},null,8,pe),[[m,t.tempRecipe.ingredients[c].name]]),d(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":o=>t.tempRecipe.ingredients[c].num=o},null,8,de),[[m,t.tempRecipe.ingredients[c].num,void 0,{number:!0}]]),d(e("input",{type:"text",id:"ingredients",class:"form-control","onUpdate:modelValue":o=>t.tempRecipe.ingredients[c].unit=o},null,8,re),[[m,t.tempRecipe.ingredients[c].unit]]),e("button",{type:"button",class:"btn btn-danger btn-sm",onClick:()=>t.tempRecipe.ingredients.splice(c,1)},"x",8,ae)]))),128))]),t.tempRecipe.ingredients&&t.tempRecipe.ingredients[t.tempRecipe.ingredients.length-1]!==""||!t.tempRecipe.ingredients?(l(),n("div",me,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[3]||(s[3]=()=>t.tempRecipe.ingredients.push({name:"",num:"",unit:""}))},"新增材料")])):f("",!0)])]),e("div",ue,[e("div",he,[e("div",_e,[be,d(e("input",{type:"text",id:"title",class:"form-control",disabled:"","onUpdate:modelValue":s[4]||(s[4]=i=>t.tempRecipe.id=i)},null,512),[[m,t.tempRecipe.id]])]),e("div",Re,[ge,d(e("select",{name:"",id:"category",class:"form-select","onUpdate:modelValue":s[5]||(s[5]=i=>t.tempRecipe.category=i)},[(l(!0),n(R,null,g(t.recipeType,i=>(l(),n("option",{key:i,value:i},r(i),9,fe))),128))],512),[[N,t.tempRecipe.category]])]),e("div",ve,[ye,d(e("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":s[6]||(s[6]=i=>t.tempRecipe.title=i)},null,512),[[m,t.tempRecipe.title]])]),e("div",Ue,[xe,d(e("input",{type:"text",id:"content",class:"form-control","onUpdate:modelValue":s[7]||(s[7]=i=>t.tempRecipe.author=i)},null,512),[[m,t.tempRecipe.author]])]),e("div",Me,[ke,d(e("input",{type:"text",id:"content",class:"form-control","onUpdate:modelValue":s[8]||(s[8]=i=>t.tempRecipe.content=i)},null,512),[[m,t.tempRecipe.content]])]),e("div",we,[Ve,e("div",Ce,[d(e("input",{type:"text",id:"costs",class:"form-control me-2","onUpdate:modelValue":s[9]||(s[9]=i=>t.tempRecipe.total=i)},null,512),[[m,t.tempRecipe.total]]),v("元 ")])]),e("div",De,[Ie,e("div",Pe,[d(e("input",{type:"text",id:"costs",class:"form-control me-2","onUpdate:modelValue":s[10]||(s[10]=i=>t.tempRecipe.price=i)},null,512),[[m,t.tempRecipe.price,void 0,{number:!0}]]),v("元 ")])]),e("div",Le,[Ne,d(e("textarea",{name:"",id:"description",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":s[11]||(s[11]=i=>t.tempRecipe.description=i)},null,512),[[m,t.tempRecipe.description]])]),e("div",Te,[je,d(e("textarea",{name:"",id:"instructions",cols:"30",rows:"10",class:"form-control","onUpdate:modelValue":s[12]||(s[12]=i=>t.tempRecipe.instructions=i)},null,512),[[m,t.tempRecipe.instructions]])]),e("div",Be,[Ee,e("ol",null,[(l(!0),n(R,null,g(t.tempRecipe.relativeProducts,(i,c)=>(l(),n("li",{key:i.id,class:"row mb-5"},[e("label",{for:i+c,class:"col-8 mb-0"},r(c+1)+". "+r(i.title)+" ： "+r(i.num)+r(i.unit)+" / "+r(i.price)+" 元",9,Se)]))),128))]),e("h5",Ae," 總計： "+r(t.tempRecipe.total)+" 元 ",1)])])])])]),e("div",Fe,[Oe,e("button",{type:"button",class:"btn btn-primary",onClick:s[13]||(s[13]=(...i)=>u.updateRecipe&&u.updateRecipe(...i))},[t.status==="edit"?(l(),n("span",Je,"確認編輯")):t.status==="new"?(l(),n("span",qe,"確認新增")):f("",!0)])])])])],512)}const Ge=U(T,[["render",ze]]),He={data(){return{deleteId:"",tempRecipe:{}}},mixins:[k],props:["id","item","openDeleteModal"],methods:{...V(w,["toastMessage"]),deleteRecipe(){L(h(_,`recipes/${this.deleteId}/`)),this.toastMessage("刪除食譜"),this.hide()}},watch:{id(){this.id&&(this.show(),this.tempRecipe=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}}},Ke={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},Qe={class:"modal-dialog"},We={class:"modal-content"},Xe=e("div",{class:"modal-header bg-dark"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除產品 "),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Ye={class:"modal-body"},Ze={class:"text-danger fw-bold"},$e={class:"modal-footer"},et=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function tt(a,s,p,b,t,u){return l(),n("div",Ke,[e("div",Qe,[e("div",We,[Xe,e("div",Ye,[e("p",null,[v("確定要刪除食譜 "),e("span",Ze," 【"+r(t.tempRecipe.title)+"】 ",1),v(" 嗎? ")])]),e("div",$e,[et,e("button",{type:"button",class:"btn btn-danger",onClick:s[0]||(s[0]=(...i)=>u.deleteRecipe&&u.deleteRecipe(...i))}," 確認刪除 ")])])])],512)}const st=U(He,[["render",tt]]),it={components:{RecipeModal:Ge,DeleteRecipeModal:st},data(){return{recipes:[],products:[],recipeId:"",recipeDeleteId:"",recipeDeleteItem:{}}},methods:{getRecipes(){const a=h(_,"recipes/");y(a,s=>{this.recipes=s.val(),this.recipes=Object.entries(this.recipes).map(p=>(p[1].id=p[0],p[1])),console.log(this.recipes,"後台食譜")})},getProducts(){const a=h(_,"products/");y(a,s=>{this.products=s.val(),this.products=Object.entries(this.products).map(p=>(p[1].id=p[0],p[1])),console.log(this.products,"產品")})},openModal(a){this.recipeId=a},openDeleteModal(a,s){this.recipeDeleteId=a,this.recipeDeleteItem=s}},mounted(){this.getRecipes(),this.getProducts()}},ot={class:"container"},lt={class:"d-flex my-4"},nt={class:"table text-center"},ct=e("thead",null,[e("tr",null,[e("th",null,"食譜編號"),e("th",null,"分類"),e("th",null,"食譜名稱"),e("th",null,"內容"),e("th",null,"成本"),e("th",null,"組合價"),e("th",null,"編輯")])],-1),pt={class:"btn-group"},dt=["onClick"],rt=["onClick"];function at(a,s,p,b,t,u){const i=x("RecipeModal"),c=x("DeleteRecipeModal");return l(),n("div",ot,[e("div",lt,[e("button",{type:"button",class:"ms-auto btn btn-primary",onClick:s[0]||(s[0]=o=>u.openModal("new"))},"建立新食譜")]),e("table",nt,[ct,(l(!0),n(R,null,g(t.recipes,o=>(l(),n("tbody",{key:o.id},[e("tr",null,[e("td",null,r(o.id),1),e("td",null,r(o.category),1),e("td",null,r(o.title),1),e("td",null,r(o.content),1),e("td",null,r(o.total),1),e("td",null,r(o.price),1),e("td",null,[e("div",pt,[e("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:C=>u.openModal(o.id)},"編輯",8,dt),e("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:C=>u.openDeleteModal(o.id,o)},"刪除",8,rt)])])])]))),128))]),M(i,{id:t.recipeId,"open-modal":u.openModal,products:t.products},null,8,["id","open-modal","products"]),M(c,{ref:"deleteRecipeModal",id:t.recipeDeleteId,item:t.recipeDeleteItem,"open-delete-modal":u.openDeleteModal},null,8,["id","item","open-delete-modal"])])}const gt=U(it,[["render",at]]);export{gt as default};
