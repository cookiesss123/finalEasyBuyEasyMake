import{m as v,b as k}from"./axios-19a62447.js";import{c as y}from"./carts-899b9ccc.js";import{L as z}from"./LoadingModal-a099e632.js";import{b6 as R,l as r,t as w,m as t,F as g,at as _,av as x,aj as l,aJ as c,b1 as N,s as f,a3 as A,k as b,r as P}from"./_plugin-vue_export-helper-31c7975b.js";import"./vue-router-495964e8.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";const{VITE_PATH:d}={VITE_PATH:"https://vue-final-dbjson-1aoj4rvyf-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},$={components:{LoadingModal:z},data(){return{coupons:[],lotteries:[],lotteryResult:[],drewArr:[],drewProducts:[],user:{},getPrizePersonNum:0,ticketNum:0}},methods:{...v(y,["checkLogin","toastMessage"]),getCoupons(){this.$http.get(`${d}/coupons`).then(e=>{console.log("優惠券資訊",e.data),this.coupons=e.data}).catch(e=>{console.log(e)})},getLotteries(){this.$http.get(`${d}/lotteries?_expand=recipe`).then(e=>{console.log("抽獎資訊",e.data),this.lotteries=e.data,this.drewProducts=this.lotteries[0].recipe.relativeProducts.filter(n=>n.category==="單一產品")}).catch(e=>{console.log(e)})},getLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}/lotteryResults`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{console.log("個人抽獎結果",e.data),this.lotteryResult=e.data,this.lotteryResult.length&&(this.drewArr=this.lotteryResult[0].drewArr)}).catch(e=>{console.log(e)})},getUserInfo(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{this.user=e.data,console.log("使用者資料，抽獎券",e.data)}).catch(e=>{console.log(e)})},addtLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{if(console.log("使用者資料",e.data),this.user=e.data,console.log(this.user.lotteryTicket,"張數"),this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2000</b> 即可獲得一張抽獎券</p><a href="/finalEasyMakeEasyBuy/#/products" class="link-orange">前往選購商品</a>',showConfirmButton:!0});return}this.ticketNum=this.user.lotteryTicket;const n={lotteryTicket:this.user.lotteryTicket-1};return this.$http.patch(`${d}/600/users/${this.userId}`,n,{headers:{authorization:`Bearer ${this.token}`}})}).then(e=>(console.log(e,"扣掉了抽獎券"),this.getUserInfo(),this.$http.get(`${d}/lotteries?_expand=recipe`))).then(e=>{if(console.log(this.ticketNum,"更新前的張數",this.user.lotteryTicket,"更新後的張數"),this.ticketNum===0)return;this.ticketNum-=1,console.log("抽獎資訊",e.data),this.lotteries=e.data;const n=Math.floor(Math.random()*this.drewProducts.length),m=this.drewArr.filter(h=>h.title===this.drewProducts[n].title);if(m.length){this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80">',customClass:{icon:"no-border"},showConfirmButton:!1});return}else m.length||(console.log(this.drewProducts[n].imgUrl,"網址"),this.drewArr.push(this.drewProducts[n]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[n].title}`,iconHtml:`<img src="${this.drewProducts[n].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1}));console.log("抽中的數字 1 ~ 7",n,this.drewArr);let p=`${d}/600/lotteryResults`,s="post",a={userId:this.userId,drewArr:this.drewArr};if(this.lotteryResult.length&&this.drewArr.length!==this.drewProducts.length)p=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,s="patch",a={drewArr:this.drewArr};else if(this.lotteryResult.length&&this.drewArr.length===this.drewProducts.length){this.$http.get(`${d}/lotteryResults`).then(h=>{console.log(h),this.getPrizePersonNum=h.data.filter(u=>u.getPrize===!0),console.log(this.getPrizePersonNum.length,"組合成功食譜人數"),p=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,s="patch",a={drewArr:this.drewArr,getPrize:!0,prizeNum:this.getPrizePersonNum.length+1},this.$swal({title:`恭喜您完成食譜，獲得${a.prizeNum===1?this.lotteries[0].prizes[0].title:a.prizeNum===2||a.prizeNum===3?this.lotteries[0].prizes[1].title:this.lotteries[0].prizes[2].title}`,iconHtml:`<img src="${a.prizeNum===1?this.lotteries[0].prizes[0].img:a.prizeNum===2||a.prizeNum===3?this.lotteries[0].prizes[1].img:this.lotteries[0].prizes[2].img}" width="100">`,customClass:{icon:"no-border"}}),console.log(p,s,a),this.$http[s](p,a,{headers:{authorization:`Bearer ${this.token}`}}).then(u=>{console.log("開始抽獎",u.data),this.getLotteryResult()}).catch(u=>{console.log(u)})});return}this.$http[s](p,a,{headers:{authorization:`Bearer ${this.token}`}}).then(h=>{console.log("開始抽獎",h.data),this.getLotteryResult(),console.log("有執行")}).catch(h=>{console.log(h)})}).catch(e=>{console.log(e),this.token||this.$swal({icon:"error",title:"登入即可抽獎",showConfirmButton:!1,timer:1500})})},async executeAsyncFunctions(){try{const n=[this.checkLogin,this.getUserInfo,this.getCoupons,this.getLotteries,this.getLotteryResult].map(m=>m.call(this));await Promise.all(n),setTimeout(()=>{this.$refs.loadingModal.hide()},500)}catch(e){console.error(e,"什麼錯誤???")}}},mounted(){this.$refs.loadingModal.show(),this.executeAsyncFunctions()},computed:{...k(y,["token","userId","nickName"])}},L={class:"container my-10"},B=t("ul",{class:"nav nav-tabs",id:"myTab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true"},"優惠折扣")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false"},"抽獎回饋")])],-1),T={class:"tab-content",id:"myTabContent"},C={class:"tab-pane fade show active text-brown",id:"home",role:"tabpanel","aria-labelledby":"home-tab"},E={class:"row row-cols-lg-4 g-4 py-3 text-darkBrown"},M={class:"card"},j=["src"],D={class:"card-body"},I={class:"card-title h3"},S={class:"card-text text-truncate"},V={class:"d-flex"},F={class:"tab-pane fade",id:"profile",role:"tabpanel","aria-labelledby":"profile-tab"},H={class:""},U={key:0,class:"col-lg-6 align-self-center"},O=t("p",{class:"mb-0"},"本月指定抽獎食譜：",-1),q={class:"text-center mb-4 fw-bold"},G={class:"row pt-4 border"},J=["src"],W={key:0,class:"position-absolute bg-notObtained d-flex"},Y=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),K=[Y],Q={class:"d-flex"},X=t("p",{class:"text-end"},"抽一次消耗一張抽獎券",-1),Z={key:1,class:"d-flex flex-column align-items-center"},tt=t("h5",{class:"h3 text-center text-orange"},"恭喜您完成食譜，獲得：",-1),et={class:"col-6"},st={class:"card position-relative border-0",style:{"border-radius":"20px"}},ot={class:"card-header h4 fw-bold text-center mb-3 bg-white border-0"},it=["src"],rt=["src"],lt=["src"],nt={class:"card-footer bg-transparent border-0"},ct={class:"fw-bold"},at={class:"text-end"},dt=t("p",null,[f("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到@EasyMakeEasyBuy.gmail.com，感謝您的支持!"),t("br"),f("下期好禮更精彩，千萬別錯過!")],-1),ht={class:"my-5"},ut=P('<div><h2 class="display-6 fw-bold mb-4"><div class="d-flex align-items-center"><div class="d-lg-block d-none me-4 rounded-circle text-center pt-2 position-relative" style="background-color:#FAE8D0;width:64px;height:64px;vertical-align:middle;font-size:45px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:25px;height:5px;top:42px;right:20px;"></div></div><div class="d-lg-none me-2 rounded-circle text-center pt-1 position-relative" style="background-color:#FAE8D0;width:36px;height:36px;font-size:24px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:12px;height:3px;top:21px;right:12px;"></div></div><span class="recipeTitle">月獎品一覽</span></div></h2></div>',1),pt={class:"d-flex align-items-center justify-content-center"},gt={class:"row row-cols-lg-4 row-cols-1 gy-4 container justify-content-center"},mt={class:"card position-relative border-0",style:{"border-radius":"20px"}},_t={class:"card-header border-0 h4 fw-bold text-center mb-3 bg-white"},bt=["src"],ft={class:"card-footer bg-transparent border-0"},yt={class:"fw-bold"},wt={class:"text-end"},xt=t("h5",null,"規則：",-1);function vt(e,n,m,p,s,a){const h=x("LoadingModal"),u=x("RouterLink");return l(),r("div",L,[w(h,{ref:"loadingModal",style:{"z-index":"2001"}},null,512),B,t("div",T,[t("div",C,[t("div",E,[(l(!0),r(g,null,_(s.coupons,o=>(l(),r("div",{class:"col",key:o.id+3467},[t("div",M,[t("img",{src:o.img,class:"card-img-top",alt:"...",height:"200",style:{"object-fit":"cover"}},null,8,j),t("div",D,[t("h5",I,c(o.title),1),t("p",S,c(o.description),1),t("div",V,[w(u,{to:`/discounts/${o.id}`,href:"#",class:"btn btn-brown ms-auto"},{default:N(()=>[f("查看完整優惠資訊")]),_:2},1032,["to"])])])])]))),128))])]),t("div",F,[(l(!0),r(g,null,_(s.lotteries,o=>(l(),r("div",{class:"py-3 text-darkBrown d-flex flex-column",key:o.id+9590},[t("p",H,"活動時間："+c(new Date(o.startDate).toLocaleString().split(" ")[0])+" ~ "+c(new Date(o.dueDate).toLocaleString().split(" ")[0]),1),t("p",{class:A({"text-danger":s.user.lotteryTicket===0})},"剩餘抽獎券："+c(s.user.lotteryTicket),3),!s.lotteryResult[0]||s.lotteryResult[0].drewArr.length!==s.drewProducts.length?(l(),r("div",U,[O,t("h5",q,c(o.recipe.title),1),t("div",G,[(l(!0),r(g,null,_(o.recipe.relativeProducts,i=>(l(),r("div",{class:"col-3 d-flex flex-column align-items-center position-relative",key:i.id+95900},[i.category==="單一產品"?(l(),r(g,{key:0},[t("img",{src:i.imgUrl,alt:"",height:"100",width:"100",style:{"object-fit":"cover"}},null,8,J),t("p",null,c(i.title),1),JSON.stringify(this.drewArr).includes(i.title)?b("",!0):(l(),r("div",W,K))],64)):b("",!0)]))),128))]),t("div",Q,[t("button",{type:"button",class:"mx-auto mt-3 btn btn-brown",onClick:n[0]||(n[0]=(...i)=>a.addtLotteryResult&&a.addtLotteryResult(...i))},"立即抽獎")]),X])):s.lotteryResult[0]&&s.lotteryResult[0].drewArr.length===s.drewProducts.length?(l(),r("div",Z,[tt,t("div",et,[t("div",st,[t("div",ot,c(s.lotteryResult[0].prizeNum===1?"大獎":s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?"二獎":"三獎"),1),s.lotteryResult[0].prizeNum===1?(l(),r("img",{key:0,src:o.prizes[0].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,it)):s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?(l(),r("img",{key:1,src:o.prizes[1].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,rt)):(l(),r("img",{key:2,src:o.prizes[2].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,lt)),t("div",nt,[t("h5",ct,c(s.lotteryResult[0].prizeNum===1?o.prizes[0].title:s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?o.prizes[1].title:o.prizes[2].title),1),t("p",at,"價值：NT$ "+c(s.lotteryResult[0].prizeNum===1?o.prizes[0].price:s.lotteryResult[0].prizeNum===2||s.lotteryResult[0].prizeNum===3?o.prizes[1].price:o.prizes[2].price),1)])]),dt])])):b("",!0),t("section",ht,[ut,t("div",pt,[t("div",gt,[(l(!0),r(g,null,_(o.prizes,i=>(l(),r("div",{class:"col",key:i},[t("div",mt,[t("div",_t,c(i.id===1?"大獎":i.id===2?"二獎":"三獎")+" / "+c(i.people),1),t("img",{src:i.img,class:"card-img border",style:{"border-radius":"20px",width:"300px",height:"220px","object-fit":"cover"},alt:""},null,8,bt),t("div",ft,[t("h5",yt,c(i.title),1),t("p",wt,"價值：NT$ "+c(i.price),1)])])]))),128))])])]),xt,t("ol",null,[(l(!0),r(g,null,_(o.rules,i=>(l(),r("li",{key:i+20},c(i),1))),128))])]))),128))])])])}const Lt=R($,[["render",vt]]);export{Lt as default};
