import{R as j}from"./vue-router-8d0a8096.js";import{m as E}from"./modalMixin-f99c1c1a.js";import{c as D,r as _,d as f,o as N,s as O,b as M,a as F}from"./db-143b9a4b.js";import{m as P,a as A}from"./index-f77dcddc.js";import{c as R}from"./carts-d5b2a762.js";import{_ as I,o as a,a7 as i,a8 as e,aa as g,ab as d,ad as r,F as x,a9 as p,ag as m,N as w,ae as B,c as L,r as C}from"./_plugin-vue_export-helper-e5f607bc.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{L as G}from"./index-cef339c7.js";import{w as T}from"./runtime-dom.esm-bundler-05da3382.js";import{_ as U}from"./loadingLogo-ccd03794.js";import{_ as S}from"./image4-1806383b.js";import{_ as X}from"./icon-cart-6dfbd1c6.js";import"./_commonjsHelpers-042e6b4d.js";import"./base-component-5a126788.js";const $={data(){return{bookMark:{},deleteId:""}},mixins:[E],props:["id","item","pageStatus","openDeleteModal"],methods:{...P(R,["toastMessage"]),deleteBookmark(){let n="recipeBookmarks";this.pageStatus==="product"&&(n="productBookmarks"),D(_(f,`${n}/${this.uid}/${this.deleteId}`)),this.toastMessage("刪除收藏"),this.hide()}},watch:{id(){this.id&&(this.show(),this.bookMark=this.item,this.deleteId=this.id,this.openDeleteModal("",""))}},computed:{...A(R,["uid"])},mounted(){}},z={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},q={class:"modal-dialog modal-dialog-centered"},H={class:"modal-content"},J=e("div",{class:"modal-header bg-dark"},[e("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除收藏 "),e("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),K={class:"modal-body"},Q={key:0},W={key:1},Y={class:"text-danger fw-bold"},Z={class:"modal-footer"},ss=e("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function es(n,l,k,c,t,u){return a(),i("div",z,[e("div",q,[e("div",H,[J,e("div",K,[e("p",null,[g("確定要刪除"),this.pageStatus==="recipe"?(a(),i("span",Q,"食譜")):this.pageStatus==="product"?(a(),i("span",W,"產品")):d("",!0),g("收藏 "),e("span",Y," 【"+r(this.bookMark.title)+"】 ",1),g(" 嗎? ")])]),e("div",Z,[ss,e("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=()=>u.deleteBookmark())},"確認刪除")])])])],512)}const ts=I($,[["render",es]]),os="/finalEasyBuyEasyMake/assets/undraw_Appreciation_r2a1-a5682803.png";const as={components:{RouterLink:j,Loading:G,DeleteBookmarksModal:ts},mixins:[V],data(){return{bookMarks:[],pageStatus:"recipe",deleteId:"",deleteItem:{},AllproductRates:[],averageRate:[],rates:{},recipeThumbs:[],thumbs:{},isLoading:!1,fullPage:!0}},methods:{...P(R,["addCart","toastMessage"]),getBookmarks(n){this.isLoading=!0,N(F,l=>{if(l){this.uid=l.uid,console.log(this.uid,"使用者已登入取得 uid");const k=_(f,"users/"+l.uid);M(k,c=>{this.user=c.val();const t=_(f,`${n}/${this.uid}`);M(t,u=>{if(this.bookMarks=u.val(),!this.bookMarks){this.isLoading=!1;return}if(this.bookMarks=Object.values(this.bookMarks),console.log(this.bookMarks,"書籤"),this.pageStatus==="recipe"){const v=_(f,"recipeThumbs");M(v,b=>{const h=b.val();Object.keys(h).forEach(s=>{this.thumbs[s]=Object.values(h[s]).length}),console.log(this.thumbs,"所有讚"),this.bookMarks.forEach((s,o)=>{Object.keys(this.thumbs).forEach(y=>{s.id===y&&(this.bookMarks[o].thumbs=this.thumbs[s.id])})}),this.bookMarks.forEach((s,o)=>{s.thumbs||(this.bookMarks[o].thumbs=0)}),console.log(this.bookMarks,"食譜")})}else if(this.pageStatus==="product"){const v=_(f,"productRates/");M(v,b=>{let h=b.val();h=Object.values(h).map(s=>Object.values(s)),h=h.flat(),console.log(h,"全部產品的評價還未分類產品"),this.bookMarks.forEach((s,o)=>{h.forEach(y=>{s.id===y.productId&&!this.bookMarks[o].scores?(this.bookMarks[o].scores=y.score,this.bookMarks[o].ratePeople=1,this.bookMarks[o].averageRate=Number((this.bookMarks[o].scores/this.bookMarks[o].ratePeople).toFixed(1))):s.id===y.productId&&this.bookMarks[o].scores&&(this.bookMarks[o].scores+=y.score,this.bookMarks[o].ratePeople+=1,this.bookMarks[o].averageRate=Number((this.bookMarks[o].scores/this.bookMarks[o].ratePeople).toFixed(1)))})}),this.bookMarks.forEach((s,o)=>{s.averageRate||(this.bookMarks[o].scores=0,this.bookMarks[o].ratePeople=0,this.bookMarks[o].averageRate=0)}),console.log(this.bookMarks,"加了評分的產品")})}this.isLoading=!1})})}else console.log("並未登入"),this.uid=null,this.user={},this.uid||(this.toastMessage("登入才可使用收藏功能","error"),this.$router.push("/login")),console.log("並未登入")})},addBookmark(n,l){this.uid||this.toastMessage("登入才可使用收藏功能","error");const k=_(f,`${n}/${this.uid}/${l.id}`);O(k,l),this.toastMessage("收藏成功")},openDeleteModal(n,l){this.deleteId=n,this.deleteItem=l},getRecipeThumbs(){const n=_(f,"recipeThumbs");M(n,l=>{const k=l.val();Object.keys(k).forEach(c=>{this.thumbs[c]=Object.values(k[c]).length}),console.log(this.thumbs,"所有讚"),this.recipes.forEach((c,t)=>{Object.keys(this.thumbs).forEach(u=>{c.id===u&&(this.recipes[t].thumbs=this.thumbs[c.id])})}),this.recipes.forEach((c,t)=>{c.thumbs||(this.recipes[t].thumbs=0)}),console.log(this.recipes,"食譜")})}},mounted(){this.getBookmarks("recipeBookmarks")},watch:{pageStatus(){console.log(this.pageStatus,"有變化"),this.pageStatus==="product"?this.getBookmarks("productBookmarks"):this.pageStatus==="recipe"&&this.getBookmarks("recipeBookmarks")}}},is={class:"",style:{"overflow-x":"hidden"}},ls=e("div",{class:"d-flex flex-column align-items-center py-10"},[e("img",{src:U,class:"loadingLogo mb-3",style:{width:"150px"},alt:""}),e("h1",{class:"text-center fw-bold text-red"},[e("span",{class:"me-1 animate-text"},"L"),e("span",{class:"mx-1 animate-text"},"o"),e("span",{class:"mx-1 animate-text"},"a"),e("span",{class:"mx-1 animate-text"},"d"),e("span",{class:"mx-1 animate-text"},"i"),e("span",{class:"mx-1 animate-text"},"n"),e("span",{class:"mx-1 animate-text"},"g"),e("span",{class:"mx-2 animate-text"},"."),e("span",{class:"me-2 animate-text"},"."),e("span",{class:"animate-text"},".")])],-1),ns=e("section",{class:"bannerBg"},[e("div",{class:"mask"},[e("div",{class:"text",style:{}}," 我的收藏 ")])],-1),rs={class:"container mt-4"},ds={class:"categorySelector row gy-4 row-cols-lg-2 row-cols-1 list-unstyled"},cs={class:"col d-flex border-end align-items-center justify-content-center"},hs=e("i",{class:"bi bi-book-half fs-3"},null,-1),ms={class:"col d-flex align-items-center justify-content-center"},bs=e("i",{class:"bi bi-bag-check-fill fs-3"},null,-1),us={class:"container py-4"},gs={key:0,class:"row row-cols-lg-4 row-cols-2 gy-4"},ks={class:"card position-relative bg-transparent",style:{"border-radius":"0",border:"1px solid transparent"}},ps={class:"cardImg",style:{}},_s=["src"],fs={class:"card-text mb-0"},ys=e("p",{class:"detail d-none d-lg-block position-absolute fw-bold",style:{top:"35%",left:"50%",transform:"translateX(-50%)","letter-spacing":"5px"}},"查看詳細食譜",-1),xs=["onClick"],vs=e("img",{src:S},null,-1),Ms=[vs],ws=["onClick"],Bs=e("img",{src:S},null,-1),Ss=[Bs],Cs={style:{"pointer-events":"none"},class:"cardTextCategory badge rounded-pill bg-red mt-4 border-0 m-3 position-absolute start-0"},Rs={class:"d-flex justify-content-between align-items-center fw-bold"},Ls={class:"cardTextTitle"},Ts={class:"cardTextPrice d-flex align-items-lg-center align-items-end"},Ps={class:""},Is={class:"starRates mb-0 ms-auto"},js={class:"me-1"},Es=e("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),Ds={key:1,class:"row row-cols-lg-4 row-cols-2 gy-4"},Ns={class:"card position-relative bg-transparent",style:{"border-radius":"0",border:"1px solid transparent"}},Os={class:"cardImg",style:{}},Fs=["src"],As={class:"card-text mb-0"},Vs=e("p",{class:"detail d-none d-lg-block position-absolute fw-bold",style:{top:"35%",left:"50%",transform:"translateX(-50%)","letter-spacing":"5px"}},"查看商品資訊",-1),Gs=["onClick"],Us=e("img",{src:S},null,-1),Xs=[Us],$s={key:0,style:{"pointer-events":"none"},class:"d-flex flex-column align-items-center text-white p-2 bg-red position-absolute top-0 start-0"},zs=["onClick"],qs=e("img",{src:S},null,-1),Hs=[qs],Js=["disabled","onClick"],Ks=e("img",{src:X,alt:"",class:"rounded-circle shadow-sm"},null,-1),Qs=[Ks],Ws={class:"fw-bold cardTextTitle"},Ys={class:""},Zs={class:"mt-1 d-block d-lg-inline-block"},se={class:"mb-0 ms-auto starRates"},ee={class:"me-1"},te=e("i",{class:"bi bi-star-fill"},null,-1),oe={key:2,class:"py-5 d-flex flex-column align-items-center"},ae=e("img",{src:os,class:"",alt:"",style:{height:"250px"}},null,-1),ie={key:0},le={key:1};function ne(n,l,k,c,t,u){const v=C("loading"),b=C("RouterLink"),h=C("DeleteBookmarksModal");return a(),i("div",is,[x(v,{active:t.isLoading,"onUpdate:active":l[0]||(l[0]=s=>t.isLoading=s),"can-cancel":!1,"is-full-page":t.fullPage,"lock-scroll":!0},{default:p(()=>[ls]),_:1},8,["active","is-full-page"]),ns,e("section",rs,[e("ul",ds,[e("li",cs,[e("a",{href:"#",onClick:l[1]||(l[1]=T(()=>t.pageStatus="recipe",["prevent"])),class:m(["text-decoration-none d-flex align-items-center link-secondary",{"fw-bold":t.pageStatus==="recipe","link-red":t.pageStatus==="recipe"}])},[hs,e("span",{class:m(["fs-4 ms-1",{dottedStyle:t.pageStatus==="recipe"}])},"食譜收藏",2)],2)]),e("li",ms,[e("a",{href:"#",onClick:l[2]||(l[2]=T(()=>t.pageStatus="product",["prevent"])),class:m(["text-decoration-none d-flex align-items-center link-secondary",{"fw-bold":t.pageStatus==="product","link-red":t.pageStatus==="product"}])},[bs,e("span",{class:m(["fs-4 ms-1",{dottedStyle:t.pageStatus==="product"}])},"材料收藏",2)],2)])])]),e("div",us,[t.pageStatus==="recipe"&&t.bookMarks&&!t.isLoading?(a(),i("div",gs,[(a(!0),i(w,null,B(t.bookMarks,s=>(a(),i("div",{class:"col text-decoration-none",key:s.id},[e("div",ks,[e("div",ps,[x(b,{to:`/recipes/${s.id}`,class:"enlargeImg"},{default:p(()=>[e("img",{src:s.image,class:"card-img",style:{"border-radius":"0","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,_s)]),_:2},1032,["to"])]),e("h5",fs,[e("div",null,[ys,e("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>u.openDeleteModal(s.id,s)},Ms,8,xs)]),(a(!0),i(w,null,B(t.bookMarks,o=>(a(),i("div",{key:o+4567},[o===s.id?(a(),i("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>n.deleteBookmark(s.id)},Ss,8,ws)):d("",!0)]))),128)),e("span",Cs,r(s.category),1)]),x(b,{to:`/recipes/${s.id}`,class:"pt-lg-3 card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:p(()=>[e("h5",Rs,[e("span",Ls,r(s.title),1)]),e("div",Ts,[e("div",Ps,[s.total?(a(),i("del",{key:0,class:m(["me-2 text-muted d-block d-lg-inline-block",{"d-none":s.price===s.total}])},"NT$ "+r(n.numberComma(s.total)),3)):d("",!0),e("span",null,[s.price?(a(),i("span",{key:0,class:m({"text-danger":s.price!==s.total,"fw-bold":s.price!==s.total})},"NT$ "+r(n.numberComma(s.price)),3)):d("",!0),g(" / "+r(s.content),1)])]),e("h5",Is,[e("p",{class:m(["mb-0 badge rounded-pill border d-flex align-items-center",{"border-red":s.thumbs!==0,"border-lightBrownGray":s.thumbs===0,"text-red":s.thumbs!==0,"text-lightBrownGray":s.thumbs===0}])},[e("span",js,r(s.thumbs),1),Es],2)])])]),_:2},1032,["to"])])]))),128))])):t.pageStatus==="product"&&t.bookMarks&&!t.isLoading?(a(),i("div",Ds,[(a(!0),i(w,null,B(t.bookMarks,s=>(a(),i("div",{class:"col text-decoration-none",key:s.id},[e("div",Ns,[e("div",Os,[x(b,{to:`/products/${s.id}`,class:"enlargeImg border-0"},{default:p(()=>[e("img",{src:s.imgUrl,class:"card-img",height:"220",style:{"border-radius":"0","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Fs)]),_:2},1032,["to"])]),e("h5",As,[e("div",null,[Vs,e("button",{type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>u.openDeleteModal(s.id,s)},Xs,8,Gs)]),s.isCheaper?(a(),i("span",$s,r((100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))%10===0?(100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0)).toString().charAt(0):100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))+" 折 ",1)):d("",!0),(a(!0),i(w,null,B(t.bookMarks,o=>(a(),i("div",{key:o},[o===s.id?(a(),i("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>n.deleteBookmark(s.id)},Hs,8,zs)):d("",!0)]))),128)),e("button",{disabled:t.isLoading==="loading",onClick:()=>n.addCart(s),type:"button",class:"buyBtn border-0 bg-transparent me-lg-2 me-1 position-absolute end-0"},Qs,8,Js)]),x(b,{to:`/products/${s.id}`,class:"pt-lg-3 card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:p(()=>[e("h5",Ws,r(s.title),1),e("div",{class:m(["d-flex align-items-lg-center cardTextPrice",{"align-items-end":s.isCheaper,"align-items-center":!s.isCheaper}])},[e("div",Ys,[s.originalPrice?(a(),i("del",{key:0,class:m(["me-2 text-muted mt-1",{"d-none":!s.isCheaper}])},"NT$ "+r(n.numberComma(s.originalPrice)),3)):d("",!0),e("span",Zs,[s.price?(a(),i("span",{key:0,class:m({"text-danger":s.isCheaper,"fw-bold":s.isCheaper})}," NT$ "+r(n.numberComma(s.price)),3)):d("",!0),g(" / "+r(s.num)+r(s.unit),1)])]),e("h5",se,[e("div",{class:m(["badge border rounded-pill bg-white",{"text-orange":s.averageRate,"border-orange":s.averageRate,"text-lightBrownGray":!s.averageRate,"border-lightBrownGray":!s.averageRate}])},[e("span",ee,r(s.averageRate),1),te],2)])],2)]),_:2},1032,["to"])])]))),128))])):d("",!0),!t.isLoading&&!t.bookMarks?(a(),i("div",oe,[ae,e("h2",null,[g("您尚無任何"),t.pageStatus==="recipe"?(a(),i("span",ie,"食譜")):t.pageStatus==="product"?(a(),i("span",le,"材料")):d("",!0),g("收藏")]),t.pageStatus==="recipe"?(a(),L(b,{key:0,to:"/recipes",class:"link-red h5"},{default:p(()=>[g("前往瀏覽食譜")]),_:1})):t.pageStatus==="product"?(a(),L(b,{key:1,to:"/products",class:"link-red h5"},{default:p(()=>[g("前往瀏覽食譜材料")]),_:1})):d("",!0)])):d("",!0)]),x(h,{id:t.deleteId,item:t.deleteItem,"page-status":t.pageStatus,"open-delete-modal":u.openDeleteModal},null,8,["id","item","page-status","open-delete-modal"])])}const ve=I(as,[["render",ne]]);export{ve as default};
