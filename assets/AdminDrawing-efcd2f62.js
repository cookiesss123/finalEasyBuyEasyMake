import{m as x}from"./modalMixin-04fea284.js";import{l as u,k as M,v as V}from"./runtime-dom.esm-bundler-226b1721.js";import{b6 as g,aj as i,l as a,m as t,k as y,b3 as c,F as h,at as m,aJ as r,s as f,t as D,av as k}from"./_plugin-vue_export-helper-31c7975b.js";import"./_commonjsHelpers-042e6b4d.js";const{VITE_PATH:b}={VITE_PATH:"https://vue-final-dbjson-hywq4ete1-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},E={data(){return{recipes:[],tempLottery:{rules:[],prizes:[]},obj:{id:"",title:"",price:"",img:""},status:"edit",startDate:"",dueDate:""}},mixins:[x],props:["id","openModal","getLotteries"],methods:{updateLottery(){this.tempLottery.startDate=new Date(this.startDate).getTime(),this.tempLottery.dueDate=new Date(this.dueDate).getTime(),this.status==="edit"?this.$http.put(`${b}/lotteries/${this.tempLottery.id}?_expand=recipe`,this.tempLottery).then(o=>{console.log(o.data),this.getLotteries(),this.hide()}).catch(o=>{console.log(o)}):this.status==="new"&&this.$http.post(`${b}/lotteries`,this.tempLottery).then(o=>{console.log(o.data),this.getLotteries(),this.hide()}).catch(o=>{console.log(o)})},getRecipes(){this.$http.get(`${b}/recipes`).then(o=>{console.log(o),this.recipes=o.data}).catch(o=>{console.log(o)})}},mounted(){this.getRecipes()},watch:{id(){this.id!=="new"&&this.id!==""?this.$http.get(`${b}/lotteries/${this.id}?_expand=recipe`).then(o=>{this.tempLottery=o.data,this.dueDate=new Date(this.tempLottery.dueDate).toISOString().split("T")[0],this.startDate=new Date(this.tempLottery.startDate).toISOString().split("T")[0],console.log(this.tempLottery),this.show(),this.status="edit",this.openModal("")}).catch(o=>{console.log(o)}):this.id==="new"&&(this.tempLottery={rules:[],prizes:[]},this.show(),this.status="new",this.openModal(""))}}},T={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},U={class:"modal-dialog modal-xl"},C={class:"modal-content"},I={class:"modal-header bg-dark"},P={class:"modal-title text-white",id:"exampleModalLabel"},A={key:0},S={key:1},$=t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),B={class:"modal-body"},H={class:"row gy-3"},O={class:"col-2"},R=t("label",{for:"serialNumber",class:"form-label"},"編號（id）",-1),j={class:"col-4"},N=t("label",{for:"title",class:"form-label"},"優惠券名稱",-1),q={class:"col-3"},F=t("label",{for:"date",class:"form-label"},"起始日",-1),J={class:"col-3"},G=t("label",{for:"date",class:"form-label"},"到期日",-1),K={class:"col-4"},Q=t("label",{for:"date",class:"form-label"},"選擇抽獎食譜",-1),W=["value"],X={key:0},Y={class:"col-8"},Z={for:"description",class:"form-label"},z=["onUpdate:modelValue"],tt=["onClick"],et={class:"mt-3"},ot={class:"col-12"},st=t("h3",null,"獎品",-1),lt={class:"col-1"},nt=t("label",{for:"number",class:"form-label"},"序號：",-1),it=["onUpdate:modelValue"],at={class:"col-3"},dt=t("label",{for:"name",class:"form-label"},"名稱：",-1),rt=["onUpdate:modelValue"],ct={class:"col-2"},pt=t("label",{for:"price",class:"form-label"},"價格：",-1),ut=["onUpdate:modelValue"],ht={class:"col-2"},mt=t("label",{for:"people",class:"form-label"},"獲獎人數：",-1),_t=["onUpdate:modelValue"],bt={class:"col-4"},yt=t("label",{for:"img",class:"form-label"},"圖片網址：",-1),ft=["onUpdate:modelValue"],gt={class:"d-flex mt-2"},vt=["onClick"],Lt={class:"col-12"},Dt={class:"form-check"},kt=t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1),wt={class:"modal-footer"},xt=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1),Mt={key:0},Vt={key:1};function Et(o,l,v,L,s,d){return i(),a("div",T,[t("div",U,[t("div",C,[t("div",I,[t("h5",P,[s.status==="edit"?(i(),a("span",A,"編輯抽獎內容")):s.status==="new"?(i(),a("span",S,"新增抽獎內容")):y("",!0)]),$]),t("div",B,[t("div",H,[t("div",O,[R,c(t("input",{type:"text",id:"serialNumber",class:"form-control","onUpdate:modelValue":l[0]||(l[0]=e=>s.tempLottery.id=e),disabled:""},null,512),[[u,s.tempLottery.id]])]),t("div",j,[N,c(t("input",{type:"text",id:"title",class:"form-control","onUpdate:modelValue":l[1]||(l[1]=e=>s.tempLottery.name=e)},null,512),[[u,s.tempLottery.name]])]),t("div",q,[F,c(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":l[2]||(l[2]=e=>s.startDate=e)},null,512),[[u,s.startDate]])]),t("div",J,[G,c(t("input",{type:"date",id:"date",class:"form-control","onUpdate:modelValue":l[3]||(l[3]=e=>s.dueDate=e)},null,512),[[u,s.dueDate]])]),t("div",K,[Q,c(t("select",{name:"",id:"",class:"form-select","onUpdate:modelValue":l[4]||(l[4]=e=>s.tempLottery.recipeId=e)},[(i(!0),a(h,null,m(s.recipes,e=>(i(),a("option",{value:e.id,key:e.id+950},r(e.title),9,W))),128))],512),[[M,s.tempLottery.recipeId]]),s.tempLottery.recipe?(i(),a("ol",X,[(i(!0),a(h,null,m(s.tempLottery.recipe.relativeProducts,e=>(i(),a("li",{key:e+4900},r(e.title)+" ",1))),128))])):y("",!0)]),t("div",Y,[(i(!0),a(h,null,m(s.tempLottery.rules,(e,p)=>(i(),a("div",{key:e+5902},[t("label",Z,"抽獎券規則"+r(p+1),1),c(t("input",{type:"text",class:"form-control","onUpdate:modelValue":n=>s.tempLottery.rules[p]=n},null,8,z),[[u,s.tempLottery.rules[p]]]),t("button",{type:"button",class:"btn btn-danger mt-2",onClick:()=>s.tempLottery.rules.splice(p,1)},"刪除規則",8,tt)]))),128)),t("div",et,[t("button",{type:"button",class:"btn btn-primary",onClick:l[5]||(l[5]=()=>s.tempLottery.rules.push(""))},"新增規則")])]),t("div",ot,[st,(i(!0),a(h,null,m(s.tempLottery.prizes,(e,p)=>(i(),a("div",{class:"row",key:p+500},[t("h5",null,"獎品"+r(p+1),1),t("div",lt,[nt,c(t("input",{type:"text",id:"number",class:"form-control","onUpdate:modelValue":n=>e.id=n},null,8,it),[[u,e.id,void 0,{number:!0}]])]),t("div",at,[dt,c(t("input",{type:"text",id:"name",class:"form-control","onUpdate:modelValue":n=>e.title=n},null,8,rt),[[u,e.title]])]),t("div",ct,[pt,c(t("input",{type:"text",id:"price",class:"form-control","onUpdate:modelValue":n=>e.price=n},null,8,ut),[[u,e.price,void 0,{number:!0}]])]),t("div",ht,[mt,c(t("input",{type:"text",id:"people",class:"form-control","onUpdate:modelValue":n=>e.people=n},null,8,_t),[[u,e.people]])]),t("div",bt,[yt,c(t("input",{type:"text",id:"img",class:"form-control","onUpdate:modelValue":n=>e.img=n},null,8,ft),[[u,e.img]])]),t("div",gt,[t("button",{type:"button",class:"ms-auto btn btn-danger",onClick:()=>s.tempLottery.prizes.splice(p,1)},"刪除獎品",8,vt)])]))),128)),t("button",{type:"button",class:"btn btn-primary",onClick:l[6]||(l[6]=()=>s.tempLottery.prizes.push({obj:s.obj}))},"新增獎品")]),t("div",Lt,[t("div",Dt,[c(t("input",{class:"form-check-input",type:"checkbox",value:"","true-value":"1","false-value":"0",id:"is_enabled","onUpdate:modelValue":l[7]||(l[7]=e=>s.tempLottery.is_enabled=e)},null,512),[[V,s.tempLottery.is_enabled]]),kt])])])]),t("div",wt,[xt,t("button",{type:"button",class:"btn btn-primary",onClick:l[8]||(l[8]=(...e)=>d.updateLottery&&d.updateLottery(...e))},[s.status==="edit"?(i(),a("span",Mt,"確認編輯")):s.status==="new"?(i(),a("span",Vt,"確認新增")):y("",!0)])])])])],512)}const Tt=g(E,[["render",Et]]),{VITE_PATH:w}={VITE_PATH:"https://vue-final-dbjson-hywq4ete1-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},Ut={data(){return{tempLottery:{}}},mixins:[x],props:["id","openDeleteModal","getLotteries"],methods:{deleteLottery(){this.$http.delete(`${w}/lotteries/${this.tempLottery.id}`).then(o=>{console.log(o.data),this.getLotteries(),this.hide()}).catch(o=>{console.log(o)})}},watch:{id(){this.id&&(console.log(this.id,"改變了"),this.$http.get(`${w}/lotteries/${this.id}`).then(o=>{this.tempLottery=o.data,console.log(this.tempLottery),this.show(),this.openDeleteModal("")}).catch(o=>{console.log(o)}))}}},Ct={class:"modal fade",ref:"modal",tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},It={class:"modal-dialog"},Pt={class:"modal-content"},At=t("div",{class:"modal-header bg-dark"},[t("h5",{class:"modal-title text-white",id:"exampleModalLabel"}," 刪除優惠券 "),t("button",{type:"button",class:"btn-close btn-close-white","data-bs-dismiss":"modal","aria-label":"Close"})],-1),St={class:"modal-body"},$t={class:"text-danger fw-bold"},Bt={class:"modal-footer"},Ht=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"},"關閉",-1);function Ot(o,l,v,L,s,d){return i(),a("div",Ct,[t("div",It,[t("div",Pt,[At,t("div",St,[t("p",null,[f("確定要刪除優惠券 "),t("span",$t," 【"+r(s.tempLottery.name)+"】 ",1),f(" 嗎? ")])]),t("div",Bt,[Ht,t("button",{type:"button",class:"btn btn-danger",onClick:l[0]||(l[0]=(...e)=>d.deleteLottery&&d.deleteLottery(...e))}," 確認刪除 ")])])])],512)}const Rt=g(Ut,[["render",Ot]]),{VITE_PATH:jt}={VITE_PATH:"https://vue-final-dbjson-hywq4ete1-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},Nt={components:{DrawingModal:Tt,DeleteDrawingModal:Rt},data(){return{lotteries:[],lotteryId:"",lotteryDeleteId:""}},methods:{getLotteries(){this.$http.get(`${jt}/lotteries?_expand=recipe`).then(o=>{console.log(o.data),this.lotteries=o.data}).catch(o=>{console.log(o)})},openModal(o){this.lotteryId=o},openDeleteModal(o){this.lotteryDeleteId=o}},mounted(){this.getLotteries()}},qt={class:"container"},Ft={class:"d-flex my-4"},Jt={class:"table text-center",style:{"vertical-align":"middle"}},Gt=t("thead",null,[t("tr",null,[t("th",null,"編號"),t("th",null,"名稱"),t("th",null,"規則"),t("th",null,"獎品"),t("th",null,"抽獎指定食譜"),t("th",null,"起始日"),t("th",null,"到期日"),t("th",null,"是否啟用"),t("th",null,"編輯")])],-1),Kt={style:{"white-space":"nowrap",overflow:"hidden","text-overflow":"ellipsis","max-width":"300px"}},Qt={class:"btn-group"},Wt=["onClick"],Xt=["onClick"];function Yt(o,l,v,L,s,d){const e=k("DrawingModal"),p=k("DeleteDrawingModal");return i(),a("div",qt,[t("div",Ft,[t("button",{type:"button",class:"ms-auto btn btn-primary",onClick:l[0]||(l[0]=n=>d.openModal("new"))},"建立新抽獎券")]),t("table",Jt,[Gt,t("tbody",null,[(i(!0),a(h,null,m(s.lotteries,n=>(i(),a("tr",{key:n.id+4564},[t("td",null,r(n.id),1),t("td",null,r(n.name),1),t("td",Kt,r(n.rules.toString()),1),t("td",null,[(i(!0),a(h,null,m(n.prizes,_=>(i(),a(h,{key:_.id+4569},[f(r(_.title),1)],64))),128))]),t("td",null,r(n.recipe.title),1),t("td",null,r(new Date(n.startDate).toLocaleString().split(" ")[0]),1),t("td",null,r(new Date(n.dueDate).toLocaleString().split(" ")[0]),1),t("td",null,r(n.is_enabled?"是":"否"),1),t("td",null,[t("div",Qt,[t("button",{type:"button",class:"btn btn-sm btn-outline-primary",onClick:_=>d.openModal(n.id)},"編輯",8,Wt),t("button",{type:"button",class:"btn btn-sm btn-outline-danger",onClick:_=>d.openDeleteModal(n.id)},"刪除",8,Xt)])])]))),128))])]),D(e,{ref:"productModal",id:s.lotteryId,"open-modal":d.openModal,"get-lotteries":d.getLotteries},null,8,["id","open-modal","get-lotteries"]),D(p,{ref:"deleteProductModal",id:s.lotteryDeleteId,"get-lotteries":d.getLotteries,"open-delete-modal":d.openDeleteModal},null,8,["id","get-lotteries","open-delete-modal"])])}const oe=g(Nt,[["render",Yt]]);export{oe as default};
