import{R as B}from"./vue-router-2c21c692.js";import{m as N,a as V}from"./index-17d9ec8c.js";import{c as O}from"./carts-1342d558.js";import{n as M}from"./numberCommaMixin-e0aac39c.js";import{P as T}from"./PaginationComponent-c75be064.js";import{C,_ as j}from"./icon-searchMobile-657ef2e6.js";import{r as g,b as y,o as q,d as m,s as U,c as F,a as I}from"./db-143b9a4b.js";import{L as E}from"./LoadingComponent-8a5de011.js";import{v as G,d as D,w as H,e as _}from"./runtime-dom.esm-bundler-54ced388.js";import{_ as A}from"./image5-4fc2427e.js";import{_ as K}from"./image4-1806383b.js";import{_ as z}from"./icon-cart-6dfbd1c6.js";import{_ as W}from"./undraw_Page_not_found_re_e9o6-de2ef5f7.js";import{_ as X,U as n,V as e,a4 as h,Y as u,a0 as c,$ as f,a1 as R,a2 as S,Z as b,c as Y,W as w,r as P,o as l,X as x}from"./_plugin-vue_export-helper-03b40388.js";import"./_commonjsHelpers-042e6b4d.js";import"./base-component-5a126788.js";import"./loadingLogo-3bb466c0.js";const Z={components:{RouterLink:B,PaginationComponent:T,LoadingComponent:E},data(){return{loading:!0,priceOrRateCollapse:{},highOrLowCollapse:{},products:[],priceOrRate:"價格",highOrLow:"不拘",productSearchName:"",filterProducts:[],myCollapse:{},bookMarks:[],recipes:[],pageStatus:"全部",selectPage:"全部",search:!1,uid:""}},mixins:[M],methods:{...N(O,["addCart","toastMessage"]),getProducts(){const r=g(m,"products/");y(r,o=>{this.products=o.val(),this.products=Object.entries(this.products).map(d=>(d[1].id=d[0],d[1]));const k=g(m,"productRates/");y(k,d=>{let t=d.val();t=Object.values(t).map((a,i)=>(a.id=Object.keys(t)[i],a)),console.log(t,this.products,"全部產品的評價還未分類產品"),this.products.forEach((a,i)=>{t.forEach(p=>{a.id===p.productId&&!this.products[i].scores?(this.products[i].scores=p.score,this.products[i].ratePeople=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1))):a.id===p.productId&&this.products[i].scores&&(this.products[i].scores+=p.score,this.products[i].ratePeople+=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1)))})}),this.products.forEach((a,i)=>{a.averageRate||(this.products[i].scores=0,this.products[i].ratePeople=0,this.products[i].averageRate=0)}),console.log(this.products,"加了評分的產品"),this.filterProducts=this.products,this.loading=!1,!this.$route.query.pageStatus&&this.$route.fullPath==="/products"?this.$refs.pagination.renderPage(1,this.filterProducts):this.$route.query.pageStatus&&this.searchProducts()})})},searchProducts(){this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(r=>r.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(r=>r.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(r=>r.isCheaper===!0)),this.priceOrRate==="價格"&&this.highOrLow!=="不拘"?this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((r,o)=>r.price-o.price):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((r,o)=>o.price-r.price)):this.priceOrRate==="評價"&&this.highOrLow!=="不拘"&&(this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((r,o)=>r.averageRate!==o.averageRate?r.averageRate-o.averageRate:r.scores-o.scores):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((r,o)=>r.averageRate!==o.averageRate?o.averageRate-r.averageRate:o.scores-r.scores))),this.filterProducts=this.filterProducts.filter(r=>r.title.match(this.productSearchName)),console.log(this.filterProducts,"是什麼???"),this.search=!0,this.$refs.pagination.renderPage(1,this.filterProducts)},getBookmarks(){q(I,r=>{if(r){this.uid=r.uid,console.log(this.uid,"使用者已登入取得 uid");const o=g(m,"users/"+r.uid);y(o,k=>{this.user=k.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場");const d=g(m,`productBookmarks/${this.uid}`);y(d,t=>{this.bookMarks=t.val(),this.bookMarks&&(this.bookMarks=Object.keys(this.bookMarks)),console.log(this.bookMarks,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(r){if(!this.uid){this.toastMessage("登入才可使用收藏功能","error");return}const o=g(m,`productBookmarks/${this.uid}/${r.id}`);U(o,r),this.toastMessage("收藏成功")},deleteBookmark(r){F(g(m,`productBookmarks/${this.uid}/${r}`)),this.toastMessage("刪除收藏")}},mounted(){this.loading=!0,this.priceOrRateCollapse=new C(this.$refs.priceOrRateCollapse,{toggle:!1,parent:"#myGroup"}),this.highOrLowCollapse=new C(this.$refs.highOrLowCollapse,{toggle:!1,parent:"#myGroup"}),(this.$route.query.pageStatus||this.$route.query.searchName||this.$route.query.valueHighOrLow||this.$route.query.valuePriceOrRate)&&(this.pageStatus=this.$route.query.pageStatus,this.priceOrRate=this.$route.query.valuePriceOrRate,this.highOrLow=this.$route.query.valueHighOrLow,this.productSearchName=this.$route.query.searchName,console.log("存入了",this.pageStatus,this.priceOrRate,this.highOrLow,this.productSearchName)),this.getProducts(),this.getBookmarks()},watch:{selectPage(){this.pageStatus=this.selectPage,this.productSearchName="",this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(r=>r.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(r=>r.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(r=>r.isCheaper===!0)),this.$refs.pagination.renderPage(1,this.filterProducts)},priceOrRate(){this.priceOrRateCollapse.hide()},highOrLow(){this.highOrLowCollapse.hide()},filterProducts(){this.priceOrRateCollapse.hide(),this.highOrLowCollapse.hide()}},computed:{...V(O,["loadingItem"])}},J={class:"my-7"},Q={class:"bg-lightPink mb-4 py-4 px-lg-5",style:{"overflow-x":"hidden"}},$={class:"container"},ee=e("h3",{class:"text-center fw-bold py-3 text-red"},"材料種類",-1),te={class:"categorySelector mx-lg-10 list-unstyled d-flex justify-content-evenly"},se=e("span",{class:"material-icons-outlined fs-1 mb-lg-2 mb-1 mt-1 mt-lg-0"},"apps",-1),oe=e("i",{class:"bi bi-bag-check-fill fs-3 mb-lg-2"},null,-1),re=e("i",{class:"bi bi-fire fs-3 mb-lg-2"},null,-1),ie=e("i",{class:"bi bi-percent fs-3 mb-lg-2"},null,-1),ae={class:"d-none d-lg-block container selectProduct pt-4"},le={class:"input-group"},ne=e("i",{class:"bi bi-caret-down-fill"},null,-1),ce={class:"ms-2 fw-bold"},de=e("i",{class:"bi bi-caret-down-fill"},null,-1),he={class:"ms-2 fw-bold"},ue=e("img",{src:j,style:{height:"25px"},alt:""},null,-1),pe=[ue],ge={class:"row g-0",id:"myGroup"},me={class:"col-2"},fe={ref:"priceOrRateCollapse",class:"collapse"},be={class:"card card-body border-0",style:{border:"0px !important"}},_e={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},ke=e("label",{class:"btn btn-outline-red",for:"selectprice"},"價格",-1),ye=e("label",{class:"btn btn-outline-red",for:"selectRate"},"評價",-1),we={class:"col-2"},Pe={ref:"highOrLowCollapse",class:"collapse"},ve={class:"card card-body border-0",style:{border:"0px !important"}},Oe={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},Ce=e("label",{class:"btn btn-outline-red",for:"noDifference"},"不拘",-1),Re=e("label",{class:"btn btn-outline-red",for:"highToLow"},"高到低",-1),Se=e("label",{class:"btn btn-outline-red",for:"lowToHigh"},"低到高",-1),xe={class:"container mt-4"},Le={key:0,class:"row row-cols-lg-4 row-cols-2 gy-4"},Be={class:"card position-relative bg-transparent",style:{border:"1px solid transparent","border-radius":"0"}},Ne={class:"cardImg"},Ve=["src"],Me={class:"card-text mb-0"},Te=["onClick"],je=e("img",{src:A},null,-1),qe=[je],Ue={key:0,style:{"pointer-events":"none"},class:"d-flex flex-column align-items-center text-white p-2 bg-red position-absolute top-0 start-0"},Fe=["onClick"],Ie=e("img",{src:K},null,-1),Ee=[Ie],Ge=["disabled","onClick"],De=e("img",{src:z,alt:"",class:"rounded-circle shadow-sm"},null,-1),He=[De],Ae={class:"fw-bold cardTextTitle"},Ke={class:""},ze={class:"mt-1 d-block d-lg-inline-block"},We={class:"mb-0 ms-auto starRates"},Xe={class:"me-1"},Ye=e("i",{class:"bi bi-star-fill"},null,-1),Ze={key:2,class:"py-10"},Je=e("img",{src:W,class:"mb-3",alt:"",style:{height:"250px",display:"block",margin:"auto"}},null,-1),Qe=e("h2",{class:"text-center"},"查無商品，請您重新查詢",-1),$e=[Je,Qe];function et(r,o,k,d,t,a){const i=P("RouterLink"),p=P("LoadingComponent"),L=P("PaginationComponent");return l(),n("div",J,[e("section",Q,[e("div",$,[ee,e("div",te,[e("button",{style:{"background-color":"white"},class:h(["text-red rounded-circle d-flex flex-column align-items-center justify-content-center border border-red",{"text-white":t.pageStatus==="全部","fw-bold":t.pageStatus==="全部","border-red":t.pageStatus==="全部","bg-red":t.pageStatus==="全部"}]),type:"button",onClick:o[0]||(o[0]=()=>t.selectPage="全部")},[se,u("全部")],2),e("button",{style:{"background-color":"white"},class:h(["text-red rounded-circle d-flex flex-column align-items-center justify-content-center border border-red",{"text-white":t.pageStatus==="食材組合包","fw-bold":t.pageStatus==="食材組合包","border-red":t.pageStatus==="食材組合包","bg-red":t.pageStatus==="食材組合包"}]),type:"button",onClick:o[1]||(o[1]=()=>t.selectPage="食材組合包")},[oe,u(" 食材組合包")],2),e("button",{style:{"background-color":"white"},class:h(["text-red rounded-circle d-flex flex-column align-items-center justify-content-center border border-red",{"text-white":t.pageStatus==="熱銷單品","fw-bold":t.pageStatus==="熱銷單品","border-red":t.pageStatus==="熱銷單品","bg-red":t.pageStatus==="熱銷單品"}]),type:"button",onClick:o[2]||(o[2]=()=>t.selectPage="熱銷單品")},[re,u(" 熱銷單品")],2),e("button",{style:{"background-color":"white"},class:h(["text-red rounded-circle d-flex flex-column align-items-center justify-content-center border border-red",{"text-white":t.pageStatus==="特價商品","fw-bold":t.pageStatus==="特價商品","border-red":t.pageStatus==="特價商品","bg-red":t.pageStatus==="特價商品"}]),type:"button",onClick:o[3]||(o[3]=()=>t.selectPage="特價商品")},[ie,u(" 特價商品")],2)])])]),e("div",ae,[e("div",le,[e("a",{class:"btn btn-outline-red px-5",onClick:o[4]||(o[4]=()=>this.priceOrRateCollapse.toggle())},[u("篩選對象 "),ne,e("span",ce,c(t.priceOrRate),1)]),e("button",{class:"btn btn-outline-red px-5",type:"button",onClick:o[5]||(o[5]=()=>this.highOrLowCollapse.toggle())},[u("篩選值 "),de,e("span",he,c(t.highOrLow),1)]),f(e("input",{type:"search",class:"form-control border-red border-end-0",placeholder:"請輸入食材名稱","aria-label":"Example text with two button addons","onUpdate:modelValue":o[6]||(o[6]=s=>t.productSearchName=s),onKeyup:o[7]||(o[7]=D((...s)=>a.searchProducts&&a.searchProducts(...s),["enter"]))},null,544),[[G,t.productSearchName]]),e("button",{type:"submit",class:"btn border border-red border-start-0 bg-transparent",onClick:o[8]||(o[8]=H((...s)=>a.searchProducts&&a.searchProducts(...s),["prevent"]))},pe)]),e("div",ge,[e("div",me,[e("div",fe,[e("div",be,[e("div",_e,[f(e("input",{type:"radio",class:"btn-check",value:"價格",name:"priceOrRate",id:"selectprice",autocomplete:"off","onUpdate:modelValue":o[9]||(o[9]=s=>t.priceOrRate=s)},null,512),[[_,t.priceOrRate]]),ke,f(e("input",{type:"radio",class:"btn-check",value:"評價",name:"priceOrRate",id:"selectRate",autocomplete:"off","onUpdate:modelValue":o[10]||(o[10]=s=>t.priceOrRate=s)},null,512),[[_,t.priceOrRate]]),ye])])],512)]),e("div",we,[e("div",Pe,[e("div",ve,[e("div",Oe,[f(e("input",{type:"radio",class:"btn-check",value:"不拘",name:"highOrLow",id:"noDifference",autocomplete:"off",checked:"","onUpdate:modelValue":o[11]||(o[11]=s=>t.highOrLow=s)},null,512),[[_,t.highOrLow]]),Ce,f(e("input",{type:"radio",class:"btn-check",value:"高到低",name:"highOrLow",id:"highToLow",autocomplete:"off","onUpdate:modelValue":o[12]||(o[12]=s=>t.highOrLow=s)},null,512),[[_,t.highOrLow]]),Re,f(e("input",{type:"radio",class:"btn-check",value:"低到高",name:"highOrLow",id:"lowToHigh",autocomplete:"off","onUpdate:modelValue":o[13]||(o[13]=s=>t.highOrLow=s)},null,512),[[_,t.highOrLow]]),Se])])],512)])])]),e("div",xe,[t.filterProducts.length&&!t.loading?(l(),n("div",Le,[(l(!0),n(R,null,S(this.$refs.pagination.pageProducts,s=>(l(),n("div",{class:"col text-decoration-none",key:s.id},[e("div",Be,[e("div",Ne,[w(i,{to:`/products/${s.id}`,class:"enlargeImg border-0"},{default:x(()=>[e("img",{src:s.imgUrl,class:"card-img",height:"220",style:{"object-fit":"cover","max-width":"100%","max-height":"100%","border-radius":"0"},alt:""},null,8,Ve)]),_:2},1032,["to"])]),e("h5",Me,[e("button",{type:"button",class:"position-absolute bookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.addBookmark(s)},qe,8,Te),s.isCheaper?(l(),n("span",Ue,c((100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))%10===0?(100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0)).toString().charAt(0):100-((s.originalPrice-s.price)/s.originalPrice*100).toFixed(0))+" 折 ",1)):b("",!0),(l(!0),n(R,null,S(t.bookMarks,v=>(l(),n("div",{key:v},[v===s.id?(l(),n("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-lg-3 m-2",onClick:()=>a.deleteBookmark(s.id)},Ee,8,Fe)):b("",!0)]))),128)),e("button",{disabled:r.loadingItem==="loading",onClick:()=>r.addCart(s),type:"button",class:"buyBtn border-0 bg-transparent me-lg-2 me-1 position-absolute end-0"},He,8,Ge)]),w(i,{to:`/products/${s.id}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown pt-lg-3"},{default:x(()=>[e("h5",Ae,c(s.title),1),e("div",{class:h(["d-flex align-items-lg-center cardTextPrice",{"align-items-end":s.isCheaper,"align-items-center":!s.isCheaper}])},[e("div",Ke,[s.originalPrice?(l(),n("del",{key:0,class:h(["me-2 text-muted mt-1",{"d-none":!s.isCheaper}])},"NT$ "+c(r.numberComma(s.originalPrice)),3)):b("",!0),e("span",ze,[s.price?(l(),n("span",{key:0,class:h({"text-danger":s.isCheaper,"fw-bold":s.isCheaper})}," NT$ "+c(r.numberComma(s.price)),3)):b("",!0),u(" / "+c(s.num)+c(s.unit),1)])]),e("h5",We,[e("div",{class:h(["badge border rounded-pill bg-white",{"text-orange":s.averageRate,"border-orange":s.averageRate,"text-lightBrownGray":!s.averageRate,"border-lightBrownGray":!s.averageRate}])},[e("span",Xe,c(s.averageRate),1),Ye],2)])],2)]),_:2},1032,["to"])])]))),128))])):b("",!0),t.loading?(l(),Y(p,{key:1})):!t.filterProducts.length&&t.search&&!t.loading?(l(),n("div",Ze,$e)):b("",!0)]),w(L,{ref:"pagination","price-or-rate":t.priceOrRate,"filter-products":t.filterProducts},null,8,["price-or-rate","filter-products"])])}const _t=X(Z,[["render",et]]);export{_t as default};
