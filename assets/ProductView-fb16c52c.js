import{S as M,a as C,N as I,P as B}from"./pagination.min-677aecec.js";import{k as P,n as V,j as m,l as U}from"./runtime-dom.esm-bundler-226b1721.js";import{m as E,b as N}from"./axios-174aada3.js";import{c as S}from"./carts-f5125435.js";import{b6 as j,l as h,m as t,t as p,b1 as u,aJ as i,a3 as c,k,s as f,b3 as d,F as b,at as v,j as R,av as x,aj as a}from"./_plugin-vue_export-helper-31c7975b.js";import"./vue-router-495964e8.js";import"./_commonjsHelpers-042e6b4d.js";const{VITE_PATH:g}={VITE_PATH:"https://vue-final-dbjson-3nukrua10-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},z={components:{Swiper:M,SwiperSlide:C},data(){return{product:{},recipes:[],relevantRecipesInfo:[],fullStar:"./src/assets/images/icon-star-filled.png",star:"./src/assets/images/icon-star.png",score:"",productRates:[],rateMessage:"",averageRate:0,modules:[I,B],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",bookMark:[],qty:1}},methods:{...E(S,["addCart","handleKeyDown","toastMessage"]),getProduct(){const{id:o}=this.$route.params;console.log("我是id",o),this.$http.get(`${g}/products/${o}`).then(s=>{console.log(s.data),this.product=s.data,this.mainImg=this.product.imgUrl,this.getRecipes()}).catch(s=>{console.log(s)})},getRecipes(){this.$http.get(`${g}/recipes`).then(o=>{console.log(o.data),this.recipes=o.data,this.recipes.forEach(s=>{this.product.relevantRecipes.forEach(n=>{s.title===n&&this.relevantRecipesInfo.push(s)})})}).catch(o=>{console.log(o)})},mouseoverStar(o){o===1&&!this.score?this.$refs.rate1.src=this.fullStar:o===2&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar):o===3&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar):o===4&&!this.score?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar):o===5&&!this.score&&(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.fullStar)},mouseoutStar(o){o===1&&!this.score?this.$refs.rate1.src=this.star:o===2&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star):o===3&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star):o===4&&!this.score?(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star):o===5&&!this.score&&(this.$refs.rate1.src=this.star,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star)},getProductRates(){const{id:o}=this.$route.params;this.$http.get(`${g}/product/${o}/productRates?_expand=user`).then(s=>{console.log(s.data),this.productRates=s.data,this.averageRate=0,this.productRates.forEach(n=>{this.averageRate+=n.score}),this.averageRate=Number((this.averageRate/this.productRates.length).toFixed(1))}).catch(s=>{console.log(s)})},addProductRate(){if(!this.score){this.toastMessage("您尚未給予星級評價","error");return}const{id:o}=this.$route.params;this.$http.post(`${g}/600/product/${o}/productRates`,{userId:this.userId,productId:o,message:this.rateMessage,createAt:new Date().getTime(),score:Number(this.score)},{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{console.log(s.data),this.getProductRates(),this.score=null,this.rateMessage="",this.$refs.form.reset(),this.toastMessage("評價成功")}).catch(s=>{console.log(s),alert("驗證過期，請重新登入"),this.$router.push("/loginSignup/login")})},getBookmark(){if(!this.token)return;const{id:o}=this.$route.params,s=`${g}/600/users/${this.userId}/productBookmarks?productId=${o}&_expand=product`;this.$http.get(s,{headers:{authorization:`Bearer ${this.token}`}}).then(n=>{console.log(n.data),this.bookMark=n.data}).catch(n=>{console.log(n)})},addBookmark(o){if(!this.token){this.toastMessage("登入才可使用收藏功能","error");return}const s={userId:this.userId,productId:o};this.$http.post(`${g}/600/users/${this.userId}/productBookmarks?_expand=product`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(n=>{console.log(n.data),this.getBookmark(),this.toastMessage("收藏成功")}).catch(n=>{console.log(n)})},deleteBookmark(){let o="";this.bookMark.forEach(s=>{o=s.id}),this.$http.delete(`${g}/600/productBookmarks/${Number(o)}`,{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{console.log(s.data),this.getBookmark(),this.toastMessage("刪除收藏")}).catch(s=>{console.log(s)})}},mounted(){this.getProduct(),this.getProductRates(),this.getBookmark()},watch:{score(){this.score==="1"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.star,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="2"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.star,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="3"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.star,this.$refs.rate5.src=this.star):this.score==="4"?(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.star):this.score==="5"&&(this.$refs.rate1.src=this.fullStar,this.$refs.rate2.src=this.fullStar,this.$refs.rate3.src=this.fullStar,this.$refs.rate4.src=this.fullStar,this.$refs.rate5.src=this.fullStar)}},computed:{...N(S,["token","userId","nickName"])}},G={class:"py-100-sm-40"},D={class:"container"},T={"aria-label":"breadcrumb"},A={class:"breadcrumb"},q={class:"breadcrumb-item fs-5"},F={class:"breadcrumb-item active fs-5 d-none d-lg-block","aria-current":"page"},L={class:"container d-flex justify-content-center mt-5"},H={class:"col-10"},O={class:"row gy-3 row-cols-lg-2 row-cols-1"},J={class:"col"},K={class:"row"},Y={class:"col-12 d-flex productMainImg"},Q=["src"],W={class:"col d-flex flex-column"},X={class:"d-flex flex-column flex-lg-row align-items-lg-center"},Z={class:""},$={class:"h3 mb-0 mt-3 mt-lg-0"},ee={class:"ms-auto"},te=t("i",{class:"bi bi-heart"},null,-1),se=[te],re=t("i",{class:"bi bi-heart-fill"},null,-1),oe=[re],ie={class:"mb-5"},le={class:"row row-cols-1 row-cols-lg-2 align-items-center mt-auto mb-2"},ae={class:"col h5 mb-0"},ce=t("br",null,null,-1),ne={class:"col d-flex align-items-center mt-4"},he=["value"],ue={class:"col productSwiper d-flex d-none d-lg-block"},fe=["src"],de=["src"],ge={class:"col productMobileSwiper d-flex d-lg-none"},me=["src"],pe=["src"],be={class:"bg-lightYellow my-5"},ve={class:"container py-5"},_e=t("h3",null,[t("span",{class:"material-icons-outlined fs-3"},"menu_book"),f(" 相關食譜 ")],-1),ke={class:"row row-cols-2 row-cols-lg-6 my-5"},Re=["src"],ye={class:"fw-bold mt-2"},xe={class:"container py-5"},we=t("i",{class:"bi bi-stars"},null,-1),Se={class:"mx-2"},Me={class:"my-5"},Ce={class:"mb-0 fw-bold d-flex align-items-center"},Ie=t("i",{class:"bi bi-person-circle fs-1 me-3"},null,-1),Be={class:"d-flex rates mb-3"},Pe={class:"form-check px-1"},Ve=["src"],Ue={class:"form-check px-1"},Ee=["src"],Ne={class:"form-check px-1"},je=["src"],ze={class:"form-check px-1"},Ge=["src"],De={class:"form-check px-1"},Te=["src"],Ae=t("div",{class:"d-flex"},[t("button",{type:"submit",class:"ms-auto btn btn-brown mt-3"},"送出")],-1),qe={class:"row gy-5"},Fe={class:"mb-0 fw-bold d-flex align-items-center"},Le=t("i",{class:"bi bi-person-circle fs-1 me-3"},null,-1),He={class:"mb-0"};function Oe(o,s,n,Je,e,l){const y=x("RouterLink"),_=x("swiper-slide"),w=x("swiper");return a(),h("div",G,[t("div",D,[t("nav",T,[t("ol",A,[t("li",q,[p(y,{to:"/products",class:"link-orange d-none d-lg-block"},{default:u(()=>[f("材料購買")]),_:1})]),t("li",F,i(e.product.title),1)])])]),t("section",L,[t("div",H,[t("div",O,[t("div",J,[t("div",K,[t("div",Y,[t("img",{src:e.mainImg,style:{"object-fit":"cover"},class:"mx-auto img-fluid",alt:"",width:"400",height:"300"},null,8,Q)])])]),t("div",W,[t("div",X,[t("div",Z,[e.product.isCheaper?(a(),h("span",{key:0,style:{"pointer-events":"none","font-size":"14px"},class:c(["badge rounded-pill text-orange px-3 py-2 bg-brown border-0",{"me-3":e.product.isCheaper}])},i((100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0))%10===0?(100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0)).toString().charAt(0):100-((e.product.originalPrice-e.product.price)/e.product.originalPrice*100).toFixed(0))+" 折 ",3)):k("",!0)]),t("h1",$,i(e.product.title),1),t("div",ee,[e.bookMark.length===0?(a(),h("button",{key:0,type:"button",class:"border-0 bg-transparent text-brown fs-4",onClick:s[0]||(s[0]=()=>l.addBookmark(e.product.id))},se)):e.bookMark.length!==0?(a(),h("button",{key:1,type:"button",class:"border-0 bg-transparent fs-4",onClick:s[1]||(s[1]=(...r)=>l.deleteBookmark&&l.deleteBookmark(...r)),style:{color:"#fa6e42"}},oe)):k("",!0)])]),t("p",ie,i(e.product.description),1),t("div",le,[t("p",ae,[t("del",{class:c(["me-2 text-muted",{"d-none":!e.product.isCheaper}])},"NT$ "+i(e.product.originalPrice),3),ce,t("span",null,[t("span",{class:c({"text-danger":e.product.isCheaper,"fw-bold":e.product.isCheaper})},"NT$ "+i(e.product.price),3),f(" / "+i(e.product.num)+i(e.product.unit),1)])]),t("div",ne,[t("button",{class:c(["btn btn-sm btn-brown rounded-circle",{disabled:e.qty===1}]),style:{width:"30px",height:"30px"},type:"button",id:"button-addon2",onClick:s[2]||(s[2]=()=>e.qty-=1)},"-",2),d(t("select",{name:"",id:"",class:"form-select border-0 text-center","onUpdate:modelValue":s[3]||(s[3]=r=>e.qty=r),style:{width:"70px"}},[(a(),h(b,null,v(30,r=>t("option",{value:r,key:r+4596945},i(r),9,he)),64))],512),[[P,e.qty]]),t("button",{class:"btn btn-sm btn-brown rounded-circle",style:{width:"30px",height:"30px"},type:"button",id:"button-addon2",onClick:s[4]||(s[4]=()=>e.qty+=1)},"+"),t("button",{class:"ms-4 btn btn-brown",type:"button",id:"button-addon2",onClick:s[5]||(s[5]=()=>o.addCart(e.product,e.qty))},"購買")])])]),t("div",ue,[p(w,{"slides-per-view":3,"space-between":15,modules:e.modules,navigation:"",pagination:{clickable:!0}},{default:u(()=>[p(_,{style:{cursor:"pointer"},onClick:s[6]||(s[6]=()=>e.mainImg=e.product.imgUrl)},{default:u(()=>[t("img",{src:e.product.imgUrl,alt:"",style:{"object-fit":"cover"}},null,8,fe)]),_:1}),(a(!0),h(b,null,v(e.product.imgsUrl,r=>(a(),R(_,{key:r+45345,style:{cursor:"pointer"},onClick:()=>e.mainImg=r},{default:u(()=>[t("img",{src:r,alt:"",style:{"object-fit":"cover"}},null,8,de)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])]),t("div",ge,[p(w,{"slides-per-view":3,"space-between":15,modules:e.modules,navigation:"",pagination:{clickable:!0}},{default:u(()=>[p(_,{style:{cursor:"pointer"},onClick:s[7]||(s[7]=()=>e.mainImg=e.product.imgUrl)},{default:u(()=>[t("img",{src:e.product.imgUrl,alt:"",style:{"object-fit":"cover"}},null,8,me)]),_:1}),(a(!0),h(b,null,v(e.product.imgsUrl,r=>(a(),R(_,{key:r+45345,style:{cursor:"pointer"},onClick:()=>e.mainImg=r},{default:u(()=>[t("img",{src:r,alt:"",style:{"object-fit":"cover"}},null,8,pe)]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])])])])]),t("section",be,[t("div",ve,[_e,t("div",ke,[(a(!0),h(b,null,v(e.relevantRecipesInfo,r=>(a(),R(y,{to:`/recipes/${r.id}`,class:"col link-brown",key:r.id+456456},{default:u(()=>[t("img",{src:r.image,alt:"",width:"160",height:"100",style:{"object-fit":"cover"}},null,8,Re),t("p",ye,i(r.title),1)]),_:2},1032,["to"]))),128))])])]),t("section",xe,[t("h3",null,[we,f(" 顧客評價（"+i(e.productRates.length)+" 則） ",1),this.token?k("",!0):(a(),R(y,{key:0,to:"/loginSignup/login",class:"ms-3 btn btn-brown"},{default:u(()=>[f("我要登入寫評價")]),_:1}))]),t("p",null,[f("平均評價 "),t("span",Se,i(`${e.averageRate?e.averageRate:"尚未評分"}`),1),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===0&&e.averageRate!==0,"text-orange":e.averageRate>1||Math.floor(e.averageRate)===0&&e.averageRate!==0||e.averageRate===1,"text-lightGray":e.averageRate<1&&Math.floor(e.averageRate)<0||!e.averageRate||e.averageRate===0}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===1&&e.averageRate!==1,"text-orange":e.averageRate>2||Math.floor(e.averageRate)===1&&e.averageRate!==1||e.averageRate===2,"text-lightGray":e.averageRate<2&&Math.floor(e.averageRate)<1||!e.averageRate||e.averageRate===1}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===2&&e.averageRate!==2,"text-orange":e.averageRate>3||Math.floor(e.averageRate)===2&&e.averageRate!==2||e.averageRate===3,"text-lightGray":e.averageRate<3&&Math.floor(e.averageRate)<2||!e.averageRate||e.averageRate===2}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===3&&e.averageRate!==3,"text-orange":e.averageRate>4||Math.floor(e.averageRate)===3&&e.averageRate!==3||e.averageRate===4,"text-lightGray":e.averageRate<4&&Math.floor(e.averageRate)<3||!e.averageRate||e.averageRate===3}])},null,2),t("i",{class:c(["bi bi-star-fill fs-3 me-2",{"bi-star-half":Math.floor(e.averageRate)===4&&e.averageRate!==4,"text-orange":e.averageRate>5||Math.floor(e.averageRate)===4&&e.averageRate!==4||e.averageRate===5,"text-lightGray":e.averageRate<5&&Math.floor(e.averageRate)<4||!e.averageRate||e.averageRate===4}])},null,2)]),t("div",Me,[this.token?(a(),h("form",{key:0,ref:"form",onSubmit:s[24]||(s[24]=V((...r)=>l.addProductRate&&l.addProductRate(...r),["prevent"])),class:"mt-2"},[t("h5",Ce,[Ie,f(" "+i(o.nickName),1)]),t("div",Be,[t("div",Pe,[d(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star1",value:"1","onUpdate:modelValue":s[8]||(s[8]=r=>e.score=r)},null,512),[[m,e.score]]),t("label",{class:"form-check-label labelRate1",for:"star1",onMouseover:s[9]||(s[9]=()=>l.mouseoverStar(1)),onMouseout:s[10]||(s[10]=()=>l.mouseoutStar(1))},[t("img",{ref:"rate1",src:e.star,width:"25"},null,8,Ve)],32)]),t("div",Ue,[d(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star2",value:"2","onUpdate:modelValue":s[11]||(s[11]=r=>e.score=r)},null,512),[[m,e.score]]),t("label",{class:"form-check-label labelRate2",for:"star2",onMouseover:s[12]||(s[12]=()=>l.mouseoverStar(2)),onMouseout:s[13]||(s[13]=()=>l.mouseoutStar(2))},[t("img",{ref:"rate2",src:e.star,width:"25"},null,8,Ee)],32)]),t("div",Ne,[d(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star3",value:"3","onUpdate:modelValue":s[14]||(s[14]=r=>e.score=r)},null,512),[[m,e.score]]),t("label",{class:"form-check-label labelRate3",for:"star3",onMouseover:s[15]||(s[15]=()=>l.mouseoverStar(3)),onMouseout:s[16]||(s[16]=()=>l.mouseoutStar(3))},[t("img",{ref:"rate3",src:e.star,width:"25"},null,8,je)],32)]),t("div",ze,[d(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star4",value:"4","onUpdate:modelValue":s[17]||(s[17]=r=>e.score=r)},null,512),[[m,e.score]]),t("label",{class:"form-check-label labelRate4",for:"star4",onMouseover:s[18]||(s[18]=()=>l.mouseoverStar(4)),onMouseout:s[19]||(s[19]=()=>l.mouseoutStar(4))},[t("img",{ref:"rate4",src:e.star,width:"25"},null,8,Ge)],32)]),t("div",De,[d(t("input",{class:"form-check-input d-none",style:{"font-size":"1px"},type:"radio",name:"rate",id:"star5",value:"5","onUpdate:modelValue":s[20]||(s[20]=r=>e.score=r)},null,512),[[m,e.score]]),t("label",{class:"form-check-label labelRate5",for:"star5",onMouseover:s[21]||(s[21]=()=>l.mouseoverStar(5)),onMouseout:s[22]||(s[22]=()=>l.mouseoutStar(5))},[t("img",{ref:"rate5",src:e.star,width:"25"},null,8,Te)],32)])]),d(t("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":s[23]||(s[23]=r=>e.rateMessage=r)},null,512),[[U,e.rateMessage]]),Ae],544)):k("",!0),t("div",qe,[(a(!0),h(b,null,v(e.productRates,r=>(a(),h("div",{class:"col-12 border-bottom",key:r.id},[t("h5",Fe,[Le,f(" "+i(r.user.nickName),1)]),t("p",He,i(`${new Date(r.createAt).toLocaleDateString()}`),1),t("p",null,[t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=1,"text-lightGray":r.score<1}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=2,"text-lightGray":r.score<2}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=3,"text-lightGray":r.score<3}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=4,"text-lightGray":r.score<4}])},null,2),t("i",{class:c(["bi bi-star-fill me-1",{"text-orange":r.score>=5,"text-lightGray":r.score<5}])},null,2)]),t("p",null,i(r.message),1)]))),128))])])])])}const et=j(z,[["render",Oe]]);export{et as default};
