import{S as j,a as V,N as A,P as L}from"./pagination.min-cc566d53.js";import{b as U,v as z,w as D}from"./runtime-dom.esm-bundler-54ced388.js";import{m as q}from"./index-6c7632a6.js";import{c as E}from"./carts-e672eb99.js";import{n as Y}from"./numberCommaMixin-e0aac39c.js";import{L as G}from"./LoadingModal-16ab9486.js";import{g as M,r as a,o as f,d as m,s as v,a as I,p as O,e as N}from"./db-6192b564.js";import{_ as F,U as r,W as k,V as e,X as p,a0 as n,Z as b,a1 as _,a2 as g,Y as u,$ as B,a4 as T,c as w,r as x,o as i}from"./_plugin-vue_export-helper-03b40388.js";import"./vue-router-2c21c692.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";import"./loadingLogo-3bb466c0.js";const W={components:{Swiper:j,SwiperSlide:V,LoadingModal:G},mixins:[Y],data(){return{recipe:{},modules:[A,L],navigation:{nextEl:".swiper-button-next",prevEl:".swiper-button-prev"},pagination:{el:".swiper-pagination",bulletClass:"my-bullet-class",bulletActiveClass:"my-bullet-active-class"},mainImg:"",bookMark:{},allThumbNum:0,myThumb:{},recipeComments:[],recipeMessage:"",qty:1,groupProduct:{},user:{},uid:""}},methods:{...q(E,["addCart","toastMessage"]),getMyThumb(){M(N,l=>{if(l){this.uid=l.uid;const{id:o}=this.$route.params,h=a(m,`recipePersonalThumbs/${this.uid}/${o}`);f(h,d=>{this.myThumb=d.val(),console.log(this.myThumb,"個人按讚")})}else console.log("並未登入"),this.uid=null,this.user={}})},getAllThumbs(){const{id:l}=this.$route.params,o=a(m,`recipeThumbs/${l}`);f(o,h=>{this.allThumbNum=h.val(),this.allThumbNum?this.allThumbNum=this.allThumbNum.thumbs:this.allThumbNum=0,console.log(this.allThumbNum,!this.allThumbNum,"所有讚")})},addThumb(){const l=a(m,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`);v(l,this.recipe);const o=a(m,`recipeThumbs/${this.recipe.id}`);v(o,{thumbs:this.allThumbNum+1}),this.toastMessage("按讚成功")},deleteThumb(){I(a(m,`recipePersonalThumbs/${this.uid}/${this.recipe.id}`));const l=a(m,`recipeThumbs/${this.recipe.id}`);v(l,{thumbs:this.allThumbNum-1}),this.toastMessage("取消按讚")},getRecipe(){const{id:l}=this.$route.params,o=a(m,`recipes/${l}`);f(o,h=>{this.recipe=h.val(),this.recipe.id=l,console.log(this.recipe,"讀取的資料"),this.mainImg=this.recipe.image,this.groupProduct=this.recipe.relativeProducts.filter(d=>d.category==="組合包"),this.groupProduct=this.groupProduct[0]})},getAllComments(){const{id:l}=this.$route.params,o=a(m,"recipeComments/");f(o,h=>{let d=h.val();d=Object.values(d).map((s,c)=>(s.id=Object.keys(s)[c],s)),console.log(d,"全部食譜的留言"),this.recipeComments=d.filter(s=>s.recipeId===l),console.log(this.recipeComments,"個別留言")})},addComments(){const l=a(m,"recipeComments"),o=O(l);v(o,{recipeId:this.recipe.id,createAt:new Date().getTime(),message:this.recipeMessage,username:this.user.nickName,userImg:this.user.headshotImg}),this.recipeMessage=""},getBookmark(){M(N,l=>{if(l){this.uid=l.uid,console.log(this.uid,"使用者已登入取得 uid");const o=a(m,"users/"+l.uid);f(o,h=>{this.user=h.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場"),console.log(this.uid,"存在嗎?");const{id:d}=this.$route.params,s=a(m,`recipeBookmarks/${this.uid}/${d}`);f(s,c=>{this.bookMark=c.val(),console.log(this.bookMark,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(){this.uid||this.toastMessage("登入才可使用收藏功能","error");const l=a(m,`recipeBookmarks/${this.uid}/${this.recipe.id}`);v(l,this.recipe),this.toastMessage("收藏成功")},deleteBookmark(){I(a(m,`recipeBookmarks/${this.uid}/${this.recipe.id}`)),this.toastMessage("刪除收藏")}},mounted(){this.loading=!0,this.getAllThumbs(),this.getMyThumb(),this.getBookmark(),this.getRecipe(),this.getAllComments()}},X={class:"mt-10",style:{"overflow-x":"hidden"}},Z={class:"container"},H={"aria-label":"breadcrumb"},J={class:"breadcrumb"},K={class:"breadcrumb-item"},Q={class:"breadcrumb-item active","aria-current":"page"},$={class:"container mt-lg-5"},ee={class:"row row-cols-lg-2 row-cols-1 gx-5"},se={class:"col"},te={class:"d-flex recipeMainImg mb-4"},oe=["src"],ie={class:"recipeSwiper position-relative"},le=["src"],re=["src"],ne={class:"col d-flex flex-column"},ce={class:"d-flex align-items-center mb-3"},ae={class:"me-2 mb-0"},me={class:"badge rounded-pill bg-brown"},de={class:"mb-0 mainTitle"},ue={class:"d-flex align-items-center ms-auto"},he=e("i",{class:"bi bi-heart"},null,-1),be=[he],pe=e("i",{class:"bi bi-heart-fill"},null,-1),_e=[pe],ge={class:"mb-0 ms-3"},fe=e("i",{class:"bi bi-hand-thumbs-up"},null,-1),ye=[fe],ve=e("i",{class:"bi bi-hand-thumbs-up-fill"},null,-1),we=[ve],ke={class:"mb-3"},xe={class:"mb-3"},Te={class:"mt-auto"},Ce=e("h5",null,"甜點介紹：",-1),Me={class:"mb-5"},Ie={class:"bg-lightYellow my-5",style:{"overflow-x":"hidden"}},Ne={class:"container py-5"},Be={class:"row row-cols-lg-2 row-cols-1 g-5"},Pe={class:"col"},Re=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons"},"egg"),u(" 準備材料")],-1),Se={class:"me-3"},je={class:"row mb-6"},Ve=e("h3",{class:"mb-3 fw-bold"},[e("span",{class:"material-icons-outlined"},"soup_kitchen"),u(" 製作步驟")],-1),Ae={key:0},Le=e("h3",{class:"mt-6 mb-3 fw-bold"},[e("i",{class:"bi bi-youtube"}),u(" 教學影片")],-1),Ue=["src"],ze={class:"col"},De=e("h3",{class:"mb-4 fw-bold"},[e("i",{class:"bi bi-bag-check-fill"}),u(" 相關產品")],-1),qe={class:"row"},Ee={class:"col-12 relativeProducts"},Ye={class:"enlargeImg",style:{width:"50% !important"}},Ge=["src"],Oe={class:"fw-bold mt-2"},Fe={class:"d-flex justify-content-between align-items-end"},We={class:"h5 mb-0 d-flex flex-column"},Xe={class:"text-secondary me-3",style:{"font-size":"16px"}},Ze={class:"text-danger fw-bold"},He=e("span",{class:"text-darkBrown"}," / 組",-1),Je={class:"input-group w-50"},Ke=["value"],Qe={class:"row mt-5 row-cols-lg-3 row-cols-2 relativeProducts"},$e={class:"enlargeImg"},es=["src"],ss={class:"fw-bold mt-2"},ts={class:"container py-5"},os={class:"d-flex align-items-center"},is=e("i",{class:"bi bi-stars"},null,-1),ls={class:"d-flex"},rs={class:"my-5"},ns={key:0,action:""},cs={class:"mb-3 fw-bold d-flex align-items-center"},as=["src"],ms={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},ds={class:"d-flex"},us={class:"row gy-5"},hs={class:"mb-2 fw-bold d-flex align-items-center"},bs=["src"],ps={key:1,class:"bi bi-person-circle me-3",style:{"font-size":"45px"}},_s={class:"mb-0"};function gs(l,o,h,d,s,c){const P=x("LoadingModal"),y=x("RouterLink"),C=x("swiper-slide"),R=x("swiper");return i(),r("div",X,[k(P,{ref:"loadingModal"},null,512),e("div",Z,[e("nav",H,[e("ol",J,[e("li",K,[k(y,{to:"/recipes",class:"link-redBrown"},{default:p(()=>[u("甜點食譜")]),_:1})]),e("li",Q,n(s.recipe.title),1)])])]),e("section",$,[e("div",ee,[e("div",se,[e("div",te,[e("img",{src:s.mainImg,style:{"object-fit":"cover","max-height":"300px"},class:"w-100",alt:""},null,8,oe)]),e("div",ie,[k(R,{"slides-per-view":3,"space-between":15,modules:s.modules,navigation:"",style:{height:"160px"},class:"w-100"},{default:p(()=>[k(C,{style:{cursor:"pointer"},onClick:o[0]||(o[0]=()=>s.mainImg=s.recipe.image)},{default:p(()=>[e("div",null,[e("img",{src:s.recipe.image,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:T({border:s.mainImg===s.recipe.image,"border-3":s.mainImg===s.recipe.image,"border-brown":s.mainImg===s.recipe.image})},null,10,le)])]),_:1}),(i(!0),r(_,null,g(s.recipe.imgsUrl,t=>(i(),w(C,{key:t+45345,style:{cursor:"pointer"},onClick:()=>s.mainImg=t},{default:p(()=>[e("div",null,[e("img",{src:t,alt:"",style:{"object-fit":"cover",height:"100px !important"},class:T({border:s.mainImg===t,"border-3":s.mainImg===t,"border-brown":s.mainImg===t})},null,10,re)])]),_:2},1032,["onClick"]))),128))]),_:1},8,["modules"])])]),e("div",ne,[e("div",ce,[e("h5",ae,[e("span",me,n(s.recipe.category),1)]),e("h1",de,n(s.recipe.title),1),e("div",ue,[s.bookMark?s.bookMark?(i(),r("button",{key:1,type:"button",class:"border-0 bg-transparent fs-4",onClick:o[2]||(o[2]=(...t)=>c.deleteBookmark&&c.deleteBookmark(...t)),style:{color:"#fa6e42"}},_e)):b("",!0):(i(),r("button",{key:0,type:"button",class:"border-0 bg-transparent text-brown fs-4",onClick:o[1]||(o[1]=()=>c.addBookmark(s.recipe.id))},be)),e("span",ge,n(s.allThumbNum),1),s.myThumb?s.myThumb?(i(),r("button",{key:3,type:"button",class:"border-0 bg-transparent text-brown fs-4",onClick:o[4]||(o[4]=(...t)=>c.deleteThumb&&c.deleteThumb(...t))},we)):b("",!0):(i(),r("button",{key:2,type:"button",class:"border-0 bg-transparent text-brown fs-4",onClick:o[3]||(o[3]=(...t)=>c.addThumb&&c.addThumb(...t))},ye))])]),e("h5",ke,"食譜作者："+n(s.recipe.author),1),e("h5",xe,"份量："+n(s.recipe.content),1),e("div",Te,[Ce,e("p",Me,n(s.recipe.description),1)])])])]),e("section",Ie,[e("div",Ne,[e("div",Be,[e("div",Pe,[Re,e("h5",Se,"成本：NT$ "+n(s.recipe.total),1),e("div",je,[(i(!0),r(_,null,g(s.recipe.ingredients,(t,S)=>(i(),r("div",{class:"col-12",key:t+367657},n(S+1)+". "+n(t.name)+" "+n(t.num)+" "+n(t.unit),1))),128))]),Ve,s.recipe.instructions?(i(),r("div",Ae,[(i(!0),r(_,null,g(s.recipe.instructions.split("/"),t=>(i(),r("p",{class:"me-3",key:t+346346},n(t),1))),128))])):b("",!0),Le,e("iframe",{width:"560",height:"315",src:s.recipe.video,title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:""},null,8,Ue)]),e("div",ze,[De,e("div",qe,[e("div",Ee,[(i(!0),r(_,null,g(s.recipe.relativeProducts,t=>(i(),r("div",{key:t.id+456496},[t.category==="組合包"?(i(),w(y,{key:0,to:`/products/${t.id}`,class:"link-brown d-flex flex-column align-items-center cardImg"},{default:p(()=>[e("div",Ye,[e("img",{src:t.imgUrl,alt:"",class:"w-100",height:"150",style:{"object-fit":"cover"}},null,8,Ge)]),e("p",Oe,n(t.title),1)]),_:2},1032,["to"])):b("",!0)]))),128))])]),e("div",Fe,[e("p",We,[e("del",Xe,"NT$ "+n(l.numberComma(s.recipe.total)),1),e("span",Ze,[u("NT$ "+n(l.numberComma(s.recipe.price))+" ",1),He])]),e("div",Je,[B(e("select",{name:"",id:"",class:"form-select text-center","onUpdate:modelValue":o[5]||(o[5]=t=>s.qty=t),style:{width:"70px"}},[(i(),r(_,null,g(30,t=>e("option",{value:t,key:t+4596945},n(t),9,Ke)),64))],512),[[U,s.qty]]),e("button",{class:"btn btn-brown",type:"button",id:"button-addon2",onClick:o[6]||(o[6]=()=>l.addCart(s.groupProduct,s.qty))},"一鍵買齊")])]),e("div",Qe,[(i(!0),r(_,null,g(s.recipe.relativeProducts,t=>(i(),r("div",{class:"col",key:t.id+456496},[t.category==="單一產品"?(i(),w(y,{key:0,to:`/products/${t.id}`,class:"link-brown d-flex flex-column align-items-center cardImg"},{default:p(()=>[e("div",$e,[e("img",{src:t.imgUrl,alt:"",height:"150",style:{"object-fit":"cover"},class:"w-100"},null,8,es)]),e("p",ss,n(t.title),1)]),_:2},1032,["to"])):b("",!0)]))),128))])])])])]),e("section",ts,[e("h3",os,[is,u(" 顧客評價 "),e("div",{class:T(["ms-2 badge border rounded-pill bg-white",{"text-orange":s.recipeComments.length,"text-lightBrownGray":!s.recipeComments.length,"border-orange":s.recipeComments.length,"border-lightBrownGray":!s.recipeComments.length}]),style:{"font-size":"16px"}},n(s.recipeComments.length)+" 則 ",3),s.uid?b("",!0):(i(),w(y,{key:0,to:"/loginSignup/login",class:"ms-3 btn btn-brown d-none d-lg-block"},{default:p(()=>[u("我要登入寫評價")]),_:1}))]),e("div",ls,[s.uid?b("",!0):(i(),w(y,{key:0,to:"/loginSignup/login",class:"btn btn-brown d-lg-none ms-auto"},{default:p(()=>[u("我要登入寫評價")]),_:1}))]),e("div",rs,[s.uid?(i(),r("form",ns,[e("h5",cs,[s.user.headshotImg?(i(),r("img",{key:0,src:s.user.headshotImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,as)):s.user.headshotImg?b("",!0):(i(),r("i",ms)),u(" "+n(s.user.nickName),1)]),B(e("textarea",{class:"form-control",name:"",id:"",cols:"30",rows:"10","onUpdate:modelValue":o[7]||(o[7]=t=>s.recipeMessage=t)},null,512),[[z,s.recipeMessage]]),e("div",ds,[e("button",{type:"submit",class:"ms-auto btn btn-brown mt-3",onClick:o[8]||(o[8]=D((...t)=>c.addComments&&c.addComments(...t),["prevent"]))},"送出")])])):b("",!0),e("div",us,[(i(!0),r(_,null,g(s.recipeComments,t=>(i(),r("div",{class:"col-12 border-bottom",key:t+3657},[e("h5",hs,[t.userImg?(i(),r("img",{key:0,src:t.userImg,alt:"",width:"50",height:"50",style:{"object-fit":"cover"},class:"rounded-circle me-3"},null,8,bs)):t.userImg?b("",!0):(i(),r("i",ps)),u(" "+n(t.username),1)]),e("p",_s,n(`${new Date(t.createAt).toLocaleDateString()}`),1),e("p",null,n(t.message),1)]))),128))])])])])}const Ps=F(W,[["render",gs]]);export{Ps as default};
