import{m as C,b as P}from"./axios-77a7bf34.js";import{c as f}from"./carts-7b352231.js";import{P as U}from"./PaginationComponent-678fab5e.js";import{L as A}from"./LoadingModal-344ca87b.js";import{v as w}from"./runtime-dom.esm-bundler-bb3e8e23.js";import{_ as M,U as i,W as g,V as t,Z as d,a0 as a,Y as b,a4 as n,$ as k,a1 as y,a2 as v,r as p,o as l,X as O}from"./_plugin-vue_export-helper-cbb9d8af.js";import"./vue-router-1aba70ec.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-838a1639.js";import"./base-component-5a126788.js";const{VITE_PATH:u}={VITE_PATH:"https://vue-final-dbjson-1aoj4rvyf-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},B={components:{PaginationComponent:U,LoadingModal:A},data(){return{user:{},orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",nickName:"",pageOrders:[]}},methods:{...C(f,["checkLogin","toastMessage"]),getUserInfo(){this.$http.get(`${u}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("使用者資料",o.data),this.user=o.data,localStorage.setItem("nickName",this.user.nickName),this.nickName=localStorage.getItem("nickName"),this.checkLogin(),this.newNickName=this.user.nickName}).catch(o=>{console.log(o)})},getOrders(){this.$http.get(`${u}/600/users/${this.userId}/orders`,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("訂單",o.data),this.orders=o.data,this.filterOrders=o.data,this.orderArrived=this.orders.filter(s=>s.deliveryStatus==="待取貨"),this.$refs.pagination.renderPage(1,this.filterOrders)}).catch(o=>{console.log(o)})},updateUserInfo(o){let s={nickName:this.newNickName};if(o==="nickNameEdit"){if(console.log(this.newNickName.length),this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.$swal({icon:"error",title:"暱稱不得是空字串",showConfirmButton:!1,timer:1500});return}}else if(o==="passwordEdit"){if(this.newPassword.length<4||this.newPassword===""){this.toastMessage("新密碼不得少於4個字元","error");return}s={password:this.newPassword}}this.$http.patch(`${u}/600/users/${this.userId}`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(c=>{console.log(c.data),o==="nickNameEdit"?(this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")):o==="passwordEdit"&&(this.passwordEdit=!0,this.toastMessage("密碼修改成功")),this.getUserInfo()}).catch(c=>{console.log(c)})},async selectFile(){const{value:o}=await this.$swal({title:"選擇圖片",input:"file",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){const s=new FileReader;s.onload=c=>{this.$swal({title:"圖片上傳成功!",imageUrl:c.target.result,imageAlt:"The uploaded picture",imageHeight:300}),console.log(c.target.result,"印出什麼");const _={headshotImg:c.target.result};this.$http.patch(`${u}/600/users/${this.userId}`,_,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{console.log(e.data),this.getUserInfo()}).catch(e=>{console.log(e)})},s.readAsDataURL(o)}},async selectImgUrl(){const{value:o}=await this.$swal({title:"選擇圖片",input:"text",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){console.log(o,"檔案"),this.$swal({title:"圖片上傳成功",imageUrl:o,imageHeight:300,imageAlt:"Custom image"});const s={headshotImg:o};this.$http.patch(`${u}/600/users/${this.userId}`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(c=>{console.log(c.data),this.getUserInfo()}).catch(c=>{console.log(c)})}},async executeAsyncFunctions(){try{const s=[this.checkLogin,this.getUserInfo,this.getOrders].map(c=>c.call(this));await Promise.all(s),setTimeout(()=>{this.$refs.loadingModal.hide()},500)}catch(o){console.error(o,"什麼錯誤???")}}},mounted(){if(!this.token){this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/loginSignup/login");return}this.$refs.loadingModal.show(),this.executeAsyncFunctions()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(o=>o.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)}},computed:{...P(f,["token","userId"])}},S={class:"mt-10 container"},L=t("ul",{class:"nav nav-tabs",id:"myTab",role:"tablist"},[t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link active",id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true"},"會員資料")]),t("li",{class:"nav-item",role:"presentation"},[t("button",{class:"nav-link",id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false"},"訂單狀況")])],-1),T={class:"tab-content",id:"myTabContent"},z={class:"tab-pane fade show active text-brown",id:"home",role:"tabpanel","aria-labelledby":"home-tab"},V={class:"row py-5 align-items-center"},j={class:"col-6 d-flex flex-column align-items-center"},D={key:0,class:"bi bi-person-circle",style:{"font-size":"90px"}},F=["src"],R={class:""},H={class:"col-6 tabletable-borderless"},q={height:"50",class:"border-bottom"},W=t("th",{width:"100"},"暱稱",-1),X={width:"300"},Y={width:"100"},Z=t("i",{class:"bi bi-pencil"},null,-1),G={height:"50",class:"border-bottom"},J=t("td",null,"信箱",-1),K=t("td",null,null,-1),Q={height:"50",class:"border-bottom"},$=t("td",null,"密碼",-1),tt=t("td",null,"****************",-1),et=t("i",{class:"bi bi-pencil"},null,-1),st={height:"50",class:"border-bottom"},ot=t("td",null,"我的抽獎券",-1),it=t("td",null,[t("button",{type:"button",class:"btn btn-orange"},"立即抽獎")],-1),nt={class:"tab-pane fade",id:"profile",role:"tabpanel","aria-labelledby":"profile-tab"},lt={class:"selectOrderStatus py-3 d-flex justify-content-between justify-content-lg-start"},rt={class:"d-lg-none"},ct={key:0,class:"text-white ms-2"},at={class:"d-lg-none"},dt={key:0,class:"text-white ms-2"},ht={class:"d-lg-none"},ut={key:0,class:"text-white ms-2"},mt={key:0,class:"badge bg-danger",style:{"font-size":"12px"}},bt={class:"d-lg-none"},gt={key:0,class:"text-white ms-2"},pt={key:1,class:"badge bg-danger ms-2",style:{"font-size":"12px"}},_t={class:"d-lg-none"},ft={key:0,class:"text-white ms-2"},wt={class:"row row-cols-1 text-brown py-3"},kt={class:"mb-3"},yt={key:0},vt={class:"ms-4"},It={class:"row row-cols-lg-6 row-cols-2 align-items-center mt-2 position-relative"},xt={key:0},Nt=["src"],Et={class:"mb-0"},Ct={class:"mb-0"},Pt={key:0,class:"col position-absolute",style:{bottom:"20px",right:"200px"}},Ut=t("p",{class:"fw-bold",style:{"font-size":"100px"}},". . .",-1),At=[Ut],Mt={class:"d-flex"},Ot={class:"ms-auto d-flex align-items-center"},Bt={class:"me-3 fw-bold"},St=t("hr",null,null,-1);function Lt(o,s,c,_,e,h){const I=p("LoadingModal"),x=p("RouterLink"),N=p("PaginationComponent");return l(),i("div",S,[g(I,{ref:"loadingModal"},null,512),L,t("div",T,[t("div",z,[t("div",V,[t("div",j,[e.user.headshotImg?e.user.headshotImg?(l(),i("img",{key:1,src:e.user.headshotImg,width:"300",height:"300",style:{"object-fit":"cover",border:"5px solid #C0AB8E"},class:"mb-4",alt:""},null,8,F)):d("",!0):(l(),i("i",D)),t("div",R,[t("button",{type:"button",class:"btn btn-orangeBrown text-white me-4",onClick:s[0]||(s[0]=(...r)=>h.selectImgUrl&&h.selectImgUrl(...r))},"上傳圖片網址"),t("button",{type:"button",class:"btn btn-brown",onClick:s[1]||(s[1]=(...r)=>h.selectFile&&h.selectFile(...r))},"上傳本地圖片")])]),t("table",H,[t("thead",q,[t("tr",null,[W,t("th",X,a(e.nickName),1),t("th",Y,[t("button",{type:"button",class:"btn btn-sm btn-orange",onClick:s[2]||(s[2]=()=>e.nickNameEdit=!e.nickNameEdit)},[Z,b(" 修改暱稱 ")])]),t("th",null,[t("div",{class:n(["input-group",{"d-none":e.nickNameEdit}])},[k(t("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱","onUpdate:modelValue":s[3]||(s[3]=r=>e.newNickName=r)},null,512),[[w,e.newNickName]]),t("button",{onClick:s[4]||(s[4]=()=>h.updateUserInfo("nickNameEdit")),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},"確定")],2)])])]),t("tbody",null,[t("tr",G,[J,t("td",null,a(e.user.email),1),K]),t("tr",Q,[$,tt,t("td",null,[t("button",{type:"button",class:"btn btn-sm btn-orange",onClick:s[5]||(s[5]=()=>e.passwordEdit=!e.passwordEdit)},[et,b(" 變更密碼 ")])]),t("td",null,[t("div",{class:n(["input-group",{"d-none":e.passwordEdit}])},[k(t("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼","onUpdate:modelValue":s[6]||(s[6]=r=>e.newPassword=r)},null,512),[[w,e.newPassword]]),t("button",{onClick:s[7]||(s[7]=()=>h.updateUserInfo("passwordEdit")),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},"確定")],2)])]),t("tr",st,[ot,t("td",null,a(e.user.lotteryTicket)+" 張",1),it])])])])]),t("div",nt,[t("div",lt,[t("button",{type:"button",class:n(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="全部"}]),onClick:s[8]||(s[8]=()=>e.selectItem="全部")},[t("span",{class:n(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="全部","fw-bold":e.selectItem==="全部"}])}," 全部 ",2),t("div",rt,[t("i",{class:n(["bi bi-border-all",{"text-white":e.selectItem==="全部","fw-bold":e.selectItem==="全部"}])},null,2),e.selectItem==="全部"?(l(),i("span",ct,"全部")):d("",!0)])],2),t("button",{type:"button",class:n(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="待出貨"}]),onClick:s[9]||(s[9]=()=>e.selectItem="待出貨")},[t("span",{class:n(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="待出貨","fw-bold":e.selectItem==="待出貨"}])},"待出貨",2),t("div",at,[t("i",{class:n(["bi bi-box-seam",{"text-white":e.selectItem==="待出貨","fw-bold":e.selectItem==="待出貨"}])},null,2),e.selectItem==="待出貨"?(l(),i("span",dt,"待出貨")):d("",!0)])],2),t("button",{type:"button",class:n(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="運送中"}]),onClick:s[10]||(s[10]=()=>e.selectItem="運送中")},[t("span",{class:n(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="運送中","fw-bold":e.selectItem==="運送中"}])},"運送中",2),t("div",ht,[t("i",{class:n(["bi bi-truck",{"text-white":e.selectItem==="運送中","fw-bold":e.selectItem==="運送中"}])},null,2),e.selectItem==="運送中"?(l(),i("span",ut,"運送中")):d("",!0)])],2),t("button",{type:"button",class:n(["btn border-0 me-lg-5 position-relative hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="待取貨"}]),onClick:s[11]||(s[11]=()=>e.selectItem="待取貨")},[t("span",{class:n(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="待取貨","fw-bold":e.selectItem==="待取貨"}])},[b("待取貨 "),e.orderArrived.length?(l(),i("span",mt,a(e.orderArrived.length),1)):d("",!0)],2),t("div",bt,[t("i",{class:n(["bi bi-house-check",{"text-white":e.selectItem==="待取貨","fw-bold":e.selectItem==="待取貨"}])},null,2),e.selectItem==="待取貨"?(l(),i("span",gt,"待取貨")):d("",!0),e.orderArrived.length?(l(),i("span",pt,a(e.orderArrived.length),1)):d("",!0)])],2),t("button",{type:"button",class:n(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="訂單完成"}]),onClick:s[12]||(s[12]=()=>e.selectItem="訂單完成")},[t("span",{class:n(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="訂單完成","fw-bold":e.selectItem==="訂單完成"}])},"訂單完成",2),t("div",_t,[t("i",{class:n(["bi bi-clipboard-check",{"text-white":e.selectItem==="訂單完成","fw-bold":e.selectItem==="訂單完成"}])},null,2),e.selectItem==="訂單完成"?(l(),i("span",ft,"訂單完成")):d("",!0)])],2)]),t("div",wt,[t("h4",kt," 總共有 "+a(e.filterOrders.length)+" 筆 ",1),e.filterOrders.length?(l(),i("div",yt,[(l(!0),i(y,null,v(this.$refs.pagination.pageProducts,r=>(l(),i("div",{class:"col",key:r.id+54359},[t("span",null,"訂單建立時間："+a(new Date(r.creatAt).toLocaleDateString()),1),t("span",vt,"訂單編號："+a(r.id),1),t("div",It,[(l(!0),i(y,null,v(r.cart.items,(m,E)=>(l(),i("div",{class:"col",key:m+6603},[E<4?(l(),i("div",xt,[t("img",{src:m.product.imgUrl,alt:"",height:"100",width:"150",style:{"object-fit":"cover"}},null,8,Nt),t("p",Et,a(m.product.title),1),t("p",Ct,"x "+a(m.qty),1)])):d("",!0)]))),128)),r.cart.items.length>4?(l(),i("div",Pt,At)):d("",!0)]),t("div",Mt,[t("div",Ot,[t("span",Bt,"運送狀態："+a(r.deliveryStatus),1),t("span",null,"總付款金額：NT$ "+a(r.cart.finalTotal),1),g(x,{to:`/orders/${r.id}`,class:"btn btn-brown ms-3"},{default:O(()=>[b("查看詳細訂單狀況")]),_:2},1032,["to"])])]),St]))),128))])):d("",!0)]),g(N,{ref:"pagination","filter-orders":e.filterOrders},null,8,["filter-orders"])])])])}const Xt=M(B,[["render",Lt]]);export{Xt as default};
