import{m as C,b as P}from"./axios-bfb5b7ba.js";import{c as f}from"./carts-1385fab3.js";import{P as U}from"./PaginationComponent-ed452a28.js";import{L as A}from"./LoadingModal-344ca87b.js";import{v as w}from"./runtime-dom.esm-bundler-bb3e8e23.js";import{_ as L,U as n,W as b,V as t,Z as c,a0 as d,Y as g,a4 as r,$ as k,a1 as y,a2 as I,r as p,o as i,X as M}from"./_plugin-vue_export-helper-cbb9d8af.js";import"./vue-router-1aba70ec.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-838a1639.js";import"./base-component-5a126788.js";const{VITE_PATH:u}={VITE_PATH:"https://vue-final-dbjson-1aoj4rvyf-cookiesss123.vercel.app",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},O={components:{PaginationComponent:U,LoadingModal:A},data(){return{user:{},orders:[],filterOrders:[],selectItem:"全部",orderArrived:[],nickNameEdit:!0,passwordEdit:!0,newNickName:"",newPassword:"",nickName:"",pageOrders:[]}},methods:{...C(f,["checkLogin","toastMessage"]),getUserInfo(){this.$http.get(`${u}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("使用者資料",o.data),this.user=o.data,localStorage.setItem("nickName",this.user.nickName),this.nickName=localStorage.getItem("nickName"),this.checkLogin(),this.newNickName=this.user.nickName}).catch(o=>{console.log(o)})},getOrders(){this.$http.get(`${u}/600/users/${this.userId}/orders`,{headers:{authorization:`Bearer ${this.token}`}}).then(o=>{console.log("訂單",o.data),this.orders=o.data,this.filterOrders=o.data,this.orderArrived=this.orders.filter(s=>s.deliveryStatus==="待取貨"),this.$refs.pagination.renderPage(1,this.filterOrders)}).catch(o=>{console.log(o)})},updateUserInfo(o){let s={nickName:this.newNickName};if(o==="nickNameEdit"){if(console.log(this.newNickName.length),this.newNickName.length>10){this.toastMessage("暱稱不得超過10個字元","error");return}else if(this.newNickName===""){this.$swal({icon:"error",title:"暱稱不得是空字串",showConfirmButton:!1,timer:1500});return}}else if(o==="passwordEdit"){if(this.newPassword.length<4||this.newPassword===""){this.toastMessage("新密碼不得少於4個字元","error");return}s={password:this.newPassword}}this.$http.patch(`${u}/600/users/${this.userId}`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(a=>{console.log(a.data),o==="nickNameEdit"?(this.nickNameEdit=!0,this.toastMessage("暱稱修改成功")):o==="passwordEdit"&&(this.passwordEdit=!0,this.toastMessage("密碼修改成功")),this.getUserInfo()}).catch(a=>{console.log(a)})},linkToLottery(){this.$router.push({name:"discountsView",query:{tabName:"抽獎回饋"}})},async selectFile(){const{value:o}=await this.$swal({title:"選擇圖片",input:"file",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){const s=new FileReader;s.onload=a=>{this.$swal({title:"圖片上傳成功!",imageUrl:a.target.result,imageAlt:"The uploaded picture",imageHeight:300}),console.log(a.target.result,"印出什麼");const _={headshotImg:a.target.result};this.$http.patch(`${u}/600/users/${this.userId}`,_,{headers:{authorization:`Bearer ${this.token}`}}).then(e=>{console.log(e.data),this.getUserInfo()}).catch(e=>{console.log(e)})},s.readAsDataURL(o)}},async selectImgUrl(){const{value:o}=await this.$swal({title:"選擇圖片",input:"text",inputAttributes:{accept:"image/*","aria-label":"Upload your profile picture"}});if(o){console.log(o,"檔案"),this.$swal({title:"圖片上傳成功",imageUrl:o,imageHeight:300,imageAlt:"Custom image"});const s={headshotImg:o};this.$http.patch(`${u}/600/users/${this.userId}`,s,{headers:{authorization:`Bearer ${this.token}`}}).then(a=>{console.log(a.data),this.getUserInfo()}).catch(a=>{console.log(a)})}},async executeAsyncFunctions(){try{const s=[this.checkLogin,this.getUserInfo,this.getOrders].map(a=>a.call(this));if(await Promise.all(s),!this.token){this.$swal({icon:"error",title:"請先登入",showConfirmButton:!1,timer:1500}),this.$router.push("/loginSignup/login");return}setTimeout(()=>{this.$refs.loadingModal.hide()},500)}catch(o){console.error(o,"什麼錯誤???")}}},mounted(){this.$refs.loadingModal.show(),this.executeAsyncFunctions()},watch:{selectItem(){this.selectItem==="全部"?this.filterOrders=this.orders:this.selectItem!=="全部"&&(this.filterOrders=this.orders.filter(o=>o.deliveryStatus===this.selectItem)),this.$refs.pagination.renderPage(1,this.filterOrders)}},computed:{...P(f,["token","userId"])}},B={class:"mt-10 container"},S=t("h2",{class:"h3 fw-bold"},"會員資料",-1),T={class:"row gy-5 row-cols-1 row-cols-lg-2 align-items-center m-4"},V={class:"col d-flex flex-column align-items-center"},z={key:0,class:"bi bi-person-circle",style:{"font-size":"90px"}},j=["src"],D={class:""},F={class:"col tabletable-borderless"},R={height:"50",class:"border-bottom"},H=t("th",null,"暱稱",-1),q={key:0},W={width:"200"},X=t("i",{class:"bi bi-pencil"},null,-1),Y={height:"50",class:"border-bottom"},Z=t("td",null,"信箱",-1),G=t("td",null,null,-1),J={height:"50",class:"border-bottom"},K=t("td",null,"密碼",-1),Q={key:0},$=t("i",{class:"bi bi-pencil"},null,-1),tt={height:"50",class:"border-bottom"},et=t("td",null,"我的抽獎券",-1),st={class:"py-5"},ot=t("h2",{class:"h3 fw-bold"},"訂單狀況",-1),nt={class:"selectOrderStatus py-3 d-flex justify-content-between justify-content-lg-start"},it={class:"d-lg-none"},lt={key:0,class:"text-white ms-2"},rt={class:"d-lg-none"},ct={key:0,class:"text-white ms-2"},at={class:"d-lg-none"},dt={key:0,class:"text-white ms-2"},ht={key:0,class:"badge bg-danger",style:{"font-size":"12px"}},ut={class:"d-lg-none"},mt={key:0,class:"text-white ms-2"},gt={key:1,class:"badge bg-danger ms-2",style:{"font-size":"12px"}},bt={class:"d-lg-none"},pt={key:0,class:"text-white ms-2"},_t={class:"row row-cols-1 text-brown py-3"},ft={class:"mb-3"},wt={key:0},kt={class:"ms-4"},yt={class:"row row-cols-lg-6 row-cols-2 align-items-center mt-2 position-relative"},It={key:0},vt=["src"],xt={class:"mb-0"},Nt={class:"mb-0"},Et={key:0,class:"col position-absolute",style:{bottom:"20px",right:"200px"}},Ct=t("p",{class:"fw-bold",style:{"font-size":"100px"}},". . .",-1),Pt=[Ct],Ut={class:"d-flex"},At={class:"ms-auto d-flex align-items-center"},Lt={class:"me-3 fw-bold"},Mt=t("hr",null,null,-1);function Ot(o,s,a,_,e,h){const v=p("LoadingModal"),x=p("RouterLink"),N=p("PaginationComponent");return i(),n("div",B,[b(v,{ref:"loadingModal"},null,512),t("section",null,[S,t("div",T,[t("div",V,[e.user.headshotImg?e.user.headshotImg?(i(),n("img",{key:1,src:e.user.headshotImg,width:"300",height:"300",style:{"object-fit":"cover",border:"5px solid #C0AB8E"},class:"mb-4",alt:""},null,8,j)):c("",!0):(i(),n("i",z)),t("div",D,[t("button",{type:"button",class:"btn btn-orangeBrown text-white me-4",onClick:s[0]||(s[0]=(...l)=>h.selectImgUrl&&h.selectImgUrl(...l))},"上傳圖片網址"),t("button",{type:"button",class:"btn btn-brown",onClick:s[1]||(s[1]=(...l)=>h.selectFile&&h.selectFile(...l))},"上傳本地圖片")])]),t("table",F,[t("thead",R,[t("tr",null,[H,e.nickNameEdit?(i(),n("th",q,d(e.nickName),1)):c("",!0),t("th",W,[e.nickNameEdit?(i(),n("button",{key:0,type:"button",class:"btn btn-sm btn-orange",onClick:s[2]||(s[2]=()=>e.nickNameEdit=!e.nickNameEdit)},[X,g(" 修改暱稱 ")])):c("",!0),t("div",{class:r(["input-group",{"d-none":e.nickNameEdit}])},[k(t("input",{type:"text",class:"form-control",placeholder:"請輸入新暱稱","onUpdate:modelValue":s[3]||(s[3]=l=>e.newNickName=l)},null,512),[[w,e.newNickName]]),t("button",{onClick:s[4]||(s[4]=()=>e.nickNameEdit=!0),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:s[5]||(s[5]=()=>h.updateUserInfo("nickNameEdit")),class:"btn btn-outline-danger",type:"button",id:"button-addon2"},"確定")],2)])])]),t("tbody",null,[t("tr",Y,[Z,t("td",null,d(e.user.email),1),G]),t("tr",J,[K,e.passwordEdit?(i(),n("td",Q,"****************")):c("",!0),t("td",null,[e.passwordEdit?(i(),n("button",{key:0,type:"button",class:"btn btn-sm btn-orange",onClick:s[6]||(s[6]=()=>e.passwordEdit=!e.passwordEdit)},[$,g(" 變更密碼 ")])):c("",!0),t("div",{class:r(["input-group",{"d-none":e.passwordEdit}])},[k(t("input",{type:"password",class:"form-control",placeholder:"請輸入新密碼","onUpdate:modelValue":s[7]||(s[7]=l=>e.newPassword=l)},null,512),[[w,e.newPassword]]),t("button",{onClick:s[8]||(s[8]=()=>e.passwordEdit=!0),class:"btn btn-outline-secondary",type:"button",id:"button-addon2"},"取消"),t("button",{onClick:s[9]||(s[9]=()=>h.updateUserInfo("passwordEdit")),class:"btn btn-outline-danger",type:"button",id:"button-addon2"},"確定")],2)])]),t("tr",tt,[et,t("td",null,d(e.user.lotteryTicket)+" 張",1),t("td",null,[t("button",{type:"button",class:"btn btn-orange",onClick:s[10]||(s[10]=(...l)=>h.linkToLottery&&h.linkToLottery(...l))},"立即抽獎")])])])])])]),t("section",st,[ot,t("div",nt,[t("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="全部"}]),onClick:s[11]||(s[11]=()=>e.selectItem="全部")},[t("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="全部","fw-bold":e.selectItem==="全部"}])}," 全部 ",2),t("div",it,[t("i",{class:r(["bi bi-border-all",{"text-white":e.selectItem==="全部","fw-bold":e.selectItem==="全部"}])},null,2),e.selectItem==="全部"?(i(),n("span",lt,"全部")):c("",!0)])],2),t("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="待出貨"}]),onClick:s[12]||(s[12]=()=>e.selectItem="待出貨")},[t("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="待出貨","fw-bold":e.selectItem==="待出貨"}])},"待出貨",2),t("div",rt,[t("i",{class:r(["bi bi-box-seam",{"text-white":e.selectItem==="待出貨","fw-bold":e.selectItem==="待出貨"}])},null,2),e.selectItem==="待出貨"?(i(),n("span",ct,"待出貨")):c("",!0)])],2),t("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="運送中"}]),onClick:s[13]||(s[13]=()=>e.selectItem="運送中")},[t("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="運送中","fw-bold":e.selectItem==="運送中"}])},"運送中",2),t("div",at,[t("i",{class:r(["bi bi-truck",{"text-white":e.selectItem==="運送中","fw-bold":e.selectItem==="運送中"}])},null,2),e.selectItem==="運送中"?(i(),n("span",dt,"運送中")):c("",!0)])],2),t("button",{type:"button",class:r(["btn border-0 me-lg-5 position-relative hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="待取貨"}]),onClick:s[14]||(s[14]=()=>e.selectItem="待取貨")},[t("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="待取貨","fw-bold":e.selectItem==="待取貨"}])},[g("待取貨 "),e.orderArrived.length?(i(),n("span",ht,d(e.orderArrived.length),1)):c("",!0)],2),t("div",ut,[t("i",{class:r(["bi bi-house-check",{"text-white":e.selectItem==="待取貨","fw-bold":e.selectItem==="待取貨"}])},null,2),e.selectItem==="待取貨"?(i(),n("span",mt,"待取貨")):c("",!0),e.orderArrived.length?(i(),n("span",gt,d(e.orderArrived.length),1)):c("",!0)])],2),t("button",{type:"button",class:r(["btn border-0 me-lg-5 hvr-rectangle-out bg-transparent",{activePage:e.selectItem==="訂單完成"}]),onClick:s[15]||(s[15]=()=>e.selectItem="訂單完成")},[t("span",{class:r(["text-secondary d-none d-lg-block",{"text-white":e.selectItem==="訂單完成","fw-bold":e.selectItem==="訂單完成"}])},"訂單完成",2),t("div",bt,[t("i",{class:r(["bi bi-clipboard-check",{"text-white":e.selectItem==="訂單完成","fw-bold":e.selectItem==="訂單完成"}])},null,2),e.selectItem==="訂單完成"?(i(),n("span",pt,"訂單完成")):c("",!0)])],2)]),t("div",_t,[t("h4",ft," 總共有 "+d(e.filterOrders.length)+" 筆 ",1),e.filterOrders.length?(i(),n("div",wt,[(i(!0),n(y,null,I(this.$refs.pagination.pageProducts,l=>(i(),n("div",{class:"col",key:l.id+54359},[t("span",null,"訂單建立時間："+d(new Date(l.creatAt).toLocaleDateString()),1),t("span",kt,"訂單編號："+d(l.id),1),t("div",yt,[(i(!0),n(y,null,I(l.cart.items,(m,E)=>(i(),n("div",{class:"col",key:m+6603},[E<4?(i(),n("div",It,[t("img",{src:m.product.imgUrl,alt:"",height:"100",width:"150",style:{"object-fit":"cover"}},null,8,vt),t("p",xt,d(m.product.title),1),t("p",Nt,"x "+d(m.qty),1)])):c("",!0)]))),128)),l.cart.items.length>4?(i(),n("div",Et,Pt)):c("",!0)]),t("div",Ut,[t("div",At,[t("span",Lt,"運送狀態："+d(l.deliveryStatus),1),t("span",null,"總付款金額：NT$ "+d(l.cart.finalTotal),1),b(x,{to:`/orders/${l.id}`,class:"btn btn-brown ms-3"},{default:M(()=>[g("查看詳細訂單狀況")]),_:2},1032,["to"])])]),Mt]))),128))])):c("",!0)]),b(N,{ref:"pagination","filter-orders":e.filterOrders},null,8,["filter-orders"])])])}const qt=L(O,[["render",Ot]]);export{qt as default};
