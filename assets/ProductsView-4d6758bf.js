import{R as B}from"./vue-router-2c21c692.js";import{m as M,a as N}from"./index-6c7632a6.js";import{c as O}from"./carts-e672eb99.js";import{n as V}from"./numberCommaMixin-e0aac39c.js";import{P as q}from"./PaginationComponent-8d29b0f7.js";import{L as T}from"./LoadingModal-16ab9486.js";import{C as R,_ as U}from"./icon-searchMobile-02ca4854.js";import{r as p,o as k,g as j,d as g,s as F,a as I,e as E}from"./db-6192b564.js";import{v as G,d as D,w as H,e as f}from"./runtime-dom.esm-bundler-54ced388.js";import{_ as z}from"./image5-4fc2427e.js";import{_ as A}from"./image4-1806383b.js";import{_ as K}from"./icon-cart-e8411a7b.js";import{_ as W}from"./undraw_Page_not_found_re_e9o6-6d6a6f1b.js";import{_ as X,U as l,W as P,V as t,a4 as u,Y as b,a0 as c,$ as m,a1 as C,a2 as L,Z as _,r as w,o as n,X as x}from"./_plugin-vue_export-helper-03b40388.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-5929133b.js";import"./loadingLogo-3bb466c0.js";const Y={components:{RouterLink:B,PaginationComponent:q,LoadingModal:T},data(){return{priceOrRateCollapse:{},highOrLowCollapse:{},products:[],priceOrRate:"價格",highOrLow:"不拘",productSearchName:"",filterProducts:[],myCollapse:{},bookMarks:[],recipes:[],pageStatus:"全部",selectPage:"全部",search:!1,uid:""}},mixins:[V],methods:{...M(O,["addCart","toastMessage"]),getProducts(){const o=p(g,"products/");k(o,s=>{this.products=s.val(),this.products=Object.entries(this.products).map(h=>(h[1].id=h[0],h[1]));const v=p(g,"productRates/");k(v,h=>{let r=h.val();r=Object.values(r).map((a,i)=>(a.id=Object.keys(r)[i],a)),console.log(r,this.products,"全部產品的評價還未分類產品"),this.products.forEach((a,i)=>{r.forEach(d=>{a.id===d.productId&&!this.products[i].scores?(this.products[i].scores=d.score,this.products[i].ratePeople=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1))):a.id===d.productId&&this.products[i].scores&&(this.products[i].scores+=d.score,this.products[i].ratePeople+=1,this.products[i].averageRate=Number((this.products[i].scores/this.products[i].ratePeople).toFixed(1)))})}),this.products.forEach((a,i)=>{a.averageRate||(this.products[i].scores=0,this.products[i].ratePeople=0,this.products[i].averageRate=0)}),console.log(this.products,"加了評分的產品")}),this.filterProducts=this.products,!this.$route.query.pageStatus&&this.$route.fullPath==="/products"?this.$refs.pagination.renderPage(1,this.filterProducts):this.$route.query.pageStatus&&this.searchProducts()})},searchProducts(){this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.priceOrRate==="價格"&&this.highOrLow!=="不拘"?this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.price-s.price):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>s.price-o.price)):this.priceOrRate==="評價"&&this.highOrLow!=="不拘"&&(this.highOrLow==="低到高"?this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?o.averageRate-s.averageRate:o.scores-s.scores):this.highOrLow==="高到低"&&(this.filterProducts=this.filterProducts.sort((o,s)=>o.averageRate!==s.averageRate?s.averageRate-o.averageRate:s.scores-o.scores))),this.filterProducts=this.filterProducts.filter(o=>o.title.match(this.productSearchName)),console.log(this.filterProducts,"是什麼???"),this.search=!0,this.$refs.pagination.renderPage(1,this.filterProducts)},getBookmarks(){j(E,o=>{if(o){this.uid=o.uid,console.log(this.uid,"使用者已登入取得 uid");const s=p(g,"users/"+o.uid);k(s,v=>{this.user=v.val(),console.log(this.user,"讀取的資料"),this.user.admin&&console.log("管理者登場");const h=p(g,`productBookmarks/${this.uid}`);k(h,r=>{this.bookMarks=r.val(),this.bookMarks&&(this.bookMarks=Object.keys(this.bookMarks)),console.log(this.bookMarks,"書籤")})})}else console.log("並未登入"),this.uid=null,this.user={}})},addBookmark(o){this.uid||this.toastMessage("登入才可使用收藏功能","error");const s=p(g,`productBookmarks/${this.uid}/${o.id}`);F(s,o),this.toastMessage("收藏成功")},deleteBookmark(o){I(p(g,`productBookmarks/${this.uid}/${o}`)),this.toastMessage("刪除收藏")}},mounted(){this.getProducts(),this.getBookmarks(),this.priceOrRateCollapse=new R(this.$refs.priceOrRateCollapse,{toggle:!1,parent:"#myGroup"}),this.highOrLowCollapse=new R(this.$refs.highOrLowCollapse,{toggle:!1,parent:"#myGroup"}),(this.$route.query.pageStatus||this.$route.query.searchName||this.$route.query.valueHighOrLow||this.$route.query.valuePriceOrRate)&&(this.pageStatus=this.$route.query.pageStatus,this.priceOrRate=this.$route.query.valuePriceOrRate,this.highOrLow=this.$route.query.valueHighOrLow,this.productSearchName=this.$route.query.searchName,console.log("存入了",this.pageStatus,this.priceOrRate,this.highOrLow,this.productSearchName))},watch:{selectPage(){this.pageStatus=this.selectPage,this.productSearchName="",this.pageStatus==="全部"?this.filterProducts=this.products:this.pageStatus==="食材組合包"?this.filterProducts=this.products.filter(o=>o.category==="組合包"):this.pageStatus==="熱銷單品"?this.filterProducts=this.products.filter(o=>o.category==="單一產品"):this.pageStatus==="特價商品"&&(this.filterProducts=this.products.filter(o=>o.isCheaper===!0)),this.$refs.pagination.renderPage(1,this.filterProducts)},priceOrRate(){this.priceOrRateCollapse.hide()},highOrLow(){this.highOrLowCollapse.hide()},filterProducts(){this.priceOrRateCollapse.hide(),this.highOrLowCollapse.hide()}},computed:{...N(O,["loadingItem"])}},Z={class:"my-10"},J={class:"nav nav-tabs container d-flex justify-content-center justify-content-lg-start",id:"myTab",role:"tablist"},Q={class:"nav-item",role:"presentation"},$={class:"nav-item",role:"presentation"},tt=t("i",{class:"bi bi-bag-check-fill"},null,-1),et={class:"nav-item",role:"presentation"},st=t("i",{class:"bi bi-fire"},null,-1),ot={class:"nav-item",role:"presentation"},rt=t("i",{class:"bi bi-percent"},null,-1),it={class:"d-none d-lg-block container selectProduct pt-4"},at={class:"input-group"},lt=t("i",{class:"bi bi-caret-down-fill"},null,-1),nt={class:"ms-2 fw-bold"},ct=t("i",{class:"bi bi-caret-down-fill"},null,-1),ht={class:"ms-2 fw-bold"},dt=t("img",{src:U,style:{height:"25px"},alt:""},null,-1),ut=[dt],pt={class:"row g-0",id:"myGroup"},gt={class:"col-2"},bt={ref:"priceOrRateCollapse",class:"collapse"},mt={class:"card card-body border-0"},ft={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},_t=t("label",{class:"btn btn-outline-brown",for:"selectprice"},"價格",-1),vt=t("label",{class:"btn btn-outline-brown",for:"selectRate"},"評價",-1),kt={class:"col-2"},Pt={ref:"highOrLowCollapse",class:"collapse"},wt={class:"card card-body border-0"},yt={class:"btn-group-vertical",role:"group","aria-label":"Vertical radio toggle button group"},Ot=t("label",{class:"btn btn-outline-brown",for:"noDifference"},"不拘",-1),Rt=t("label",{class:"btn btn-outline-brown",for:"highToLow"},"高到低",-1),Ct=t("label",{class:"btn btn-outline-brown",for:"lowToHigh"},"低到高",-1),Lt={class:"container mt-4"},xt={key:0,class:"row row-cols-lg-4 row-cols-1 gy-4"},St={class:"card position-relative border-0 bg-transparent",style:{"border-radius":"20px"}},Bt={class:"cardImg",style:{"border-radius":"20px"}},Mt=["src"],Nt={class:"card-text"},Vt=["onClick"],qt=t("img",{src:z},null,-1),Tt=[qt],Ut={key:0,style:{"pointer-events":"none","font-size":"14px"},class:"d-flex flex-column align-items-center text-white p-2 bg-brown border me-3 position-absolute top-0 start-0 m-3 rounded"},jt=["onClick"],Ft=t("img",{src:A},null,-1),It=[Ft],Et=["disabled","onClick"],Gt=t("img",{src:K,style:{height:"48px"},alt:"",class:"rounded-circle shadow-sm"},null,-1),Dt=[Gt],Ht={class:"h5 fw-bold"},zt={class:"d-flex align-items-center"},At={class:"me-auto"},Kt={class:"mt-1"},Wt={class:"mb-0"},Xt={class:"me-1"},Yt=t("i",{class:"bi bi-star-fill"},null,-1),Zt={key:1,class:"py-10"},Jt=t("img",{src:W,class:"mb-3",alt:"",style:{height:"250px",display:"block",margin:"auto"}},null,-1),Qt=t("h2",{class:"text-center"},"查無商品，請您重新查詢",-1),$t=[Jt,Qt];function te(o,s,v,h,r,a){const i=w("LoadingModal"),d=w("RouterLink"),S=w("PaginationComponent");return n(),l("div",Z,[P(i,{ref:"loadingModal",style:{"z-index":"2001"}},null,512),t("ul",J,[t("li",Q,[t("button",{class:u(["nav-link px-1 px-lg-3",{active:r.pageStatus==="全部"}]),id:"home-tab","data-bs-toggle":"tab","data-bs-target":"#home",type:"button",role:"tab","aria-controls":"home","aria-selected":"true",onClick:s[0]||(s[0]=()=>r.selectPage="全部")},"全部",2)]),t("li",$,[t("button",{class:u(["nav-link px-1 px-lg-3",{active:r.pageStatus==="食材組合包"}]),id:"profile-tab","data-bs-toggle":"tab","data-bs-target":"#profile",type:"button",role:"tab","aria-controls":"profile","aria-selected":"false",onClick:s[1]||(s[1]=()=>r.selectPage="食材組合包")},[tt,b(" 食材組合包")],2)]),t("li",et,[t("button",{class:u(["nav-link px-1 px-lg-3",{active:r.pageStatus==="熱銷單品"}]),id:"popularProducts-tab","data-bs-toggle":"tab","data-bs-target":"#popularProducts",type:"button",role:"tab","aria-controls":"popularProducts","aria-selected":"false",onClick:s[2]||(s[2]=()=>r.selectPage="熱銷單品")},[st,b(" 熱銷單品")],2)]),t("li",ot,[t("button",{class:u(["nav-link px-1 px-lg-3",{active:r.pageStatus==="特價商品"}]),id:"contact-tab","data-bs-toggle":"tab","data-bs-target":"#contact",type:"button",role:"tab","aria-controls":"contact","aria-selected":"false",onClick:s[3]||(s[3]=()=>r.selectPage="特價商品")},[rt,b(" 特價商品")],2)])]),t("div",it,[t("div",at,[t("a",{class:"btn btn-outline-brown px-5",onClick:s[4]||(s[4]=()=>this.priceOrRateCollapse.toggle())},[b("篩選對象 "),lt,t("span",nt,c(r.priceOrRate),1)]),t("button",{class:"btn btn-outline-brown px-5",type:"button",onClick:s[5]||(s[5]=()=>this.highOrLowCollapse.toggle())},[b("篩選值 "),ct,t("span",ht,c(r.highOrLow),1)]),m(t("input",{type:"search",class:"form-control border-brown border-end-0",placeholder:"請輸入食材名稱","aria-label":"Example text with two button addons","onUpdate:modelValue":s[6]||(s[6]=e=>r.productSearchName=e),onKeyup:s[7]||(s[7]=D((...e)=>a.searchProducts&&a.searchProducts(...e),["enter"]))},null,544),[[G,r.productSearchName]]),t("button",{type:"submit",class:"btn border border-brown border-start-0 bg-transparent",onClick:s[8]||(s[8]=H((...e)=>a.searchProducts&&a.searchProducts(...e),["prevent"]))},ut)]),t("div",pt,[t("div",gt,[t("div",bt,[t("div",mt,[t("div",ft,[m(t("input",{type:"radio",class:"btn-check",value:"價格",name:"priceOrRate",id:"selectprice",autocomplete:"off","onUpdate:modelValue":s[9]||(s[9]=e=>r.priceOrRate=e)},null,512),[[f,r.priceOrRate]]),_t,m(t("input",{type:"radio",class:"btn-check",value:"評價",name:"priceOrRate",id:"selectRate",autocomplete:"off","onUpdate:modelValue":s[10]||(s[10]=e=>r.priceOrRate=e)},null,512),[[f,r.priceOrRate]]),vt])])],512)]),t("div",kt,[t("div",Pt,[t("div",wt,[t("div",yt,[m(t("input",{type:"radio",class:"btn-check",value:"不拘",name:"highOrLow",id:"noDifference",autocomplete:"off",checked:"","onUpdate:modelValue":s[11]||(s[11]=e=>r.highOrLow=e)},null,512),[[f,r.highOrLow]]),Ot,m(t("input",{type:"radio",class:"btn-check",value:"高到低",name:"highOrLow",id:"highToLow",autocomplete:"off","onUpdate:modelValue":s[12]||(s[12]=e=>r.highOrLow=e)},null,512),[[f,r.highOrLow]]),Rt,m(t("input",{type:"radio",class:"btn-check",value:"低到高",name:"highOrLow",id:"lowToHigh",autocomplete:"off","onUpdate:modelValue":s[13]||(s[13]=e=>r.highOrLow=e)},null,512),[[f,r.highOrLow]]),Ct])])],512)])])]),t("div",Lt,[r.filterProducts.length?(n(),l("div",xt,[(n(!0),l(C,null,L(this.$refs.pagination.pageProducts,e=>(n(),l("div",{class:"col text-decoration-none",key:e.id},[t("div",St,[t("div",Bt,[P(d,{to:`/products/${e.id}`,class:"enlargeImg"},{default:x(()=>[t("img",{src:e.imgUrl,class:"card-img",height:"220",style:{"border-radius":"20px","object-fit":"cover","max-width":"100%","max-height":"100%"},alt:""},null,8,Mt)]),_:2},1032,["to"])]),t("h5",Nt,[t("button",{type:"button",class:"position-absolute bookmarkBtn border-0 bg-transparent end-0 top-0 m-3",onClick:()=>a.addBookmark(e)},Tt,8,Vt),e.isCheaper?(n(),l("span",Ut,c((100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))%10===0?(100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0)).toString().charAt(0):100-((e.originalPrice-e.price)/e.originalPrice*100).toFixed(0))+" 折 ",1)):_("",!0),(n(!0),l(C,null,L(r.bookMarks,y=>(n(),l("div",{key:y},[y===e.id?(n(),l("button",{key:0,type:"button",class:"position-absolute deleteBookmarkBtn border-0 bg-transparent end-0 top-0 m-3",onClick:()=>a.deleteBookmark(e.id)},It,8,jt)):_("",!0)]))),128)),t("button",{disabled:o.loadingItem==="loading",onClick:()=>o.addCart(e),type:"button",class:"buyBtn border-0 bg-transparent me-2 position-absolute end-0",style:{top:"155px"}},Dt,8,Et)]),P(d,{to:`/products/${e.id}`,class:"card-footer bg-transparent border-0 text-decoration-none link-darkBrown"},{default:x(()=>[t("h5",Ht,c(e.title),1),t("div",zt,[t("div",At,[e.originalPrice?(n(),l("del",{key:0,class:u(["me-2 text-muted mt-1",{"d-none":!e.isCheaper}])},"NT$ "+c(o.numberComma(e.originalPrice)),3)):_("",!0),t("span",Kt,[e.price?(n(),l("span",{key:0,class:u({"text-danger":e.isCheaper,"fw-bold":e.isCheaper})}," NT$ "+c(o.numberComma(e.price)),3)):_("",!0),b(" / "+c(e.num)+c(e.unit),1)])]),t("h5",Wt,[t("div",{class:u(["badge border rounded-pill bg-white",{"text-orange":e.averageRate,"border-orange":e.averageRate,"text-lightBrownGray":!e.averageRate,"border-lightBrownGray":!e.averageRate}])},[t("span",Xt,c(e.averageRate),1),Yt],2)])])]),_:2},1032,["to"])])]))),128))])):!r.filterProducts.length&&r.search?(n(),l("div",Zt,$t)):_("",!0)]),P(S,{ref:"pagination","price-or-rate":r.priceOrRate,"filter-products":r.filterProducts},null,8,["price-or-rate","filter-products"])])}const _e=X(Y,[["render",te]]);export{_e as default};
