import{m as N,b as z}from"./axios-555da50d.js";import{c as x}from"./carts-0238063f.js";import{L as R}from"./LoadingModal-344ca87b.js";import{_ as A,U as i,W as k,V as t,a4 as y,a1 as p,a2 as _,Z as b,o as r,a0 as c,X as P,Y as f,a6 as L,r as v}from"./_plugin-vue_export-helper-cbb9d8af.js";import"./vue-router-1aba70ec.js";import"./_commonjsHelpers-042e6b4d.js";import"./modal-838a1639.js";import"./base-component-5a126788.js";const{VITE_PATH:d}={VITE_PATH:"http://localhost:3000",BASE_URL:"/finalEasyMakeEasyBuy/",MODE:"production",DEV:!1,PROD:!0},B={components:{LoadingModal:R},data(){return{coupons:[],lotteries:[],lotteryResult:[],drewArr:[],drewProducts:[],user:{},getPrizePersonNum:0,ticketNum:0,tabName:"優惠折扣"}},methods:{...N(x,["checkLogin","toastMessage"]),getCoupons(){this.$http.get(`${d}/coupons`).then(s=>{console.log("優惠券資訊",s.data),this.coupons=s.data}).catch(s=>{console.log(s)})},getLotteries(){this.$http.get(`${d}/lotteries?_expand=recipe`).then(s=>{console.log("抽獎資訊",s.data),this.lotteries=s.data,this.drewProducts=this.lotteries[0].recipe.relativeProducts.filter(l=>l.category==="單一產品")}).catch(s=>{console.log(s)})},getLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}/lotteryResults`,{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{console.log("個人抽獎結果",s.data),this.lotteryResult=s.data,this.lotteryResult.length&&(this.drewArr=this.lotteryResult[0].drewArr)}).catch(s=>{console.log(s)})},getUserInfo(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{this.user=s.data,console.log("使用者資料，抽獎券",s.data)}).catch(s=>{console.log(s)})},addtLotteryResult(){this.$http.get(`${d}/600/users/${this.userId}`,{headers:{authorization:`Bearer ${this.token}`}}).then(s=>{if(console.log("使用者資料",s.data),this.user=s.data,console.log(this.user.lotteryTicket,"張數"),this.user.lotteryTicket===0){this.$swal({icon:"error",title:"您沒有抽獎券了",html:'<p>單筆金額滿  <b>NT$2000</b> 即可獲得一張抽獎券</p><a href="/finalEasyMakeEasyBuy/#/products" class="link-orange">前往選購商品</a>',showConfirmButton:!0});return}this.ticketNum=this.user.lotteryTicket;const l={lotteryTicket:this.user.lotteryTicket-1};return this.$http.patch(`${d}/600/users/${this.userId}`,l,{headers:{authorization:`Bearer ${this.token}`}})}).then(s=>(console.log(s,"扣掉了抽獎券"),this.getUserInfo(),this.$http.get(`${d}/lotteries?_expand=recipe`))).then(s=>{if(console.log(this.ticketNum,"更新前的張數",this.user.lotteryTicket,"更新後的張數"),this.ticketNum===0)return;this.ticketNum-=1,console.log("抽獎資訊",s.data),this.lotteries=s.data;const l=Math.floor(Math.random()*this.drewProducts.length),m=this.drewArr.filter(h=>h.title===this.drewProducts[l].title);if(m.length){this.$swal({title:"抽到重複的東西囉~ 非常sorry",iconHtml:'<img src="https://images.unsplash.com/photo-1606823616058-541d59dadcb2?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=200&q=80">',customClass:{icon:"no-border"},showConfirmButton:!1});return}else m.length||(console.log(this.drewProducts[l].imgUrl,"網址"),this.drewArr.push(this.drewProducts[l]),this.$swal({title:`恭喜您抽中 ${this.drewProducts[l].title}`,iconHtml:`<img src="${this.drewProducts[l].imgUrl}" width="100">`,customClass:{icon:"no-border"},showConfirmButton:!1}));console.log("抽中的數字 1 ~ 7",l,this.drewArr);let g=`${d}/600/lotteryResults`,e="post",a={userId:this.userId,drewArr:this.drewArr};if(this.lotteryResult.length&&this.drewArr.length!==this.drewProducts.length)g=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,e="patch",a={drewArr:this.drewArr};else if(this.lotteryResult.length&&this.drewArr.length===this.drewProducts.length){this.$http.get(`${d}/lotteryResults`).then(h=>{console.log(h),this.getPrizePersonNum=h.data.filter(u=>u.getPrize===!0),console.log(this.getPrizePersonNum.length,"組合成功食譜人數"),g=`${d}/600/lotteryResults/${this.lotteryResult[0].id}`,e="patch",a={drewArr:this.drewArr,getPrize:!0,prizeNum:this.getPrizePersonNum.length+1},this.$swal({title:`恭喜您完成食譜，獲得${a.prizeNum===1?this.lotteries[0].prizes[0].title:a.prizeNum===2||a.prizeNum===3?this.lotteries[0].prizes[1].title:this.lotteries[0].prizes[2].title}`,iconHtml:`<img src="${a.prizeNum===1?this.lotteries[0].prizes[0].img:a.prizeNum===2||a.prizeNum===3?this.lotteries[0].prizes[1].img:this.lotteries[0].prizes[2].img}" width="100">`,customClass:{icon:"no-border"}}),console.log(g,e,a),this.$http[e](g,a,{headers:{authorization:`Bearer ${this.token}`}}).then(u=>{console.log("開始抽獎",u.data),this.getLotteryResult()}).catch(u=>{console.log(u)})});return}this.$http[e](g,a,{headers:{authorization:`Bearer ${this.token}`}}).then(h=>{console.log("開始抽獎",h.data),this.getLotteryResult(),console.log("有執行")}).catch(h=>{console.log(h)})}).catch(s=>{console.log(s),this.token||this.$swal({icon:"error",title:"登入即可抽獎",showConfirmButton:!1,timer:1500})})},async executeAsyncFunctions(){try{const l=[this.checkLogin,this.getUserInfo,this.getCoupons,this.getLotteries,this.getLotteryResult].map(m=>m.call(this));await Promise.all(l),setTimeout(()=>{this.$refs.loadingModal.hide()},500)}catch(s){console.error(s)}}},mounted(){this.$refs.loadingModal.show(),this.$route.query.tabName&&(this.tabName=this.$route.query.tabName),this.executeAsyncFunctions()},computed:{...z(x,["token","userId","nickName"])},watch:{}},$={class:"container my-10"},C={class:"nav nav-tabs"},T={key:0,class:"text-brown"},M={class:"row row-cols-lg-4 g-4 py-3 text-darkBrown"},E={class:"card"},D=["src"],I={class:"card-body"},S={class:"card-title h3"},V={class:"card-text text-truncate"},j={class:"d-flex"},H={key:1},U={class:""},F={key:0,class:"col-lg-6 align-self-center"},q=t("p",{class:"mb-0"},"本月指定抽獎食譜：",-1),O={class:"text-center mb-4 fw-bold"},Y={class:"row pt-4 border"},G=["src"],W={key:0,class:"position-absolute bg-notObtained d-flex"},J=t("i",{class:"bi bi-question-lg text-white fs-1 m-auto"},null,-1),X=[J],Z={class:"d-flex"},K=t("p",{class:"text-end"},"抽一次消耗一張抽獎券",-1),Q={key:1,class:"d-flex flex-column align-items-center"},tt=t("h5",{class:"h3 text-center text-orange"},"恭喜您完成食譜，獲得：",-1),et={class:"col-6"},st={class:"card position-relative border-0",style:{"border-radius":"20px"}},ot={class:"card-header h4 fw-bold text-center mb-3 bg-white border-0"},it=["src"],rt=["src"],lt=["src"],nt={class:"card-footer bg-transparent border-0"},ct={class:"fw-bold"},at={class:"text-end"},dt=t("p",null,[f("本店會透過信箱與您聯絡獎品寄送時間，請時刻關注信件，並請留下電話、地址到@EasyMakeEasyBuy.gmail.com，感謝您的支持!"),t("br"),f("下期好禮更精彩，千萬別錯過!")],-1),ht={class:"py-100-sm-40","data-aos":"zoom-in"},ut=L('<div class="container"><h2 class="display-6 fw-bold d-flex align-items-center mb-4 d-flex flex-lg-row align-items-center mb-4"><div class="d-flex align-items-center"><div class="d-lg-block d-none me-4 rounded-circle text-center pt-2 position-relative" style="background-color:#FAE8D0;width:64px;height:64px;vertical-align:middle;font-size:45px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:25px;height:5px;top:41px;right:20px;"></div></div><div class="d-lg-none me-2 rounded-circle text-center pt-1 position-relative" style="background-color:#FAE8D0;width:36px;height:36px;font-size:24px;"> 本 <div class="position-absolute" style="background-color:#F5AE4C;width:12px;height:3px;top:21px;right:12px;"></div></div><span class="recipeTitle">月獎品一覽</span></div></h2></div>',1),gt={key:0,class:"container"},pt={class:"prizes row row-cols-lg-3 row-cols-1 gy-4"},mt={class:"card position-relative border-0",style:{"border-radius":"20px"}},_t={class:"card-header border-0 h4 fw-bold text-center mb-3 bg-white"},bt=t("div",{class:"questionMark position-absolute d-flex bg-lightYellow",style:{top:"60px",width:"100%",height:"220px","border-radius":"20px",background:"linear-gradient(45deg, rgb(252, 179, 78) 20%, rgb(253,164,72), rgb(255,113,75) 90% )"}},[t("i",{class:"bi bi-question-lg mx-auto text-white",style:{"font-size":"150px"}})],-1),yt=["src"],ft={class:"card-footer bg-transparent border-0"},wt={class:"fw-bold"},xt={class:"text-end"},kt=t("h5",null,"規則：",-1);function vt(s,l,m,g,e,a){const h=v("LoadingModal"),u=v("RouterLink");return r(),i("div",$,[k(h,{ref:"loadingModal"},null,512),t("ul",C,[t("li",{class:"nav-item",onClick:l[0]||(l[0]=()=>e.tabName="優惠折扣")},[t("button",{class:y(["nav-link",{active:e.tabName==="優惠折扣","link-orange":e.tabName==="優惠折扣"}]),type:"button"},"優惠折扣",2)]),t("li",{class:"nav-item",onClick:l[1]||(l[1]=()=>e.tabName="抽獎回饋")},[t("button",{class:y(["nav-link",{active:e.tabName==="抽獎回饋","link-orange":e.tabName==="抽獎回饋"}]),type:"button"},"抽獎回饋",2)])]),e.tabName==="優惠折扣"?(r(),i("section",T,[t("div",M,[(r(!0),i(p,null,_(e.coupons,o=>(r(),i("div",{class:"col",key:o.id+3467},[t("div",E,[t("img",{src:o.img,class:"card-img-top",alt:"...",height:"200",style:{"object-fit":"cover"}},null,8,D),t("div",I,[t("h5",S,c(o.title),1),t("p",V,c(o.description),1),t("div",j,[k(u,{to:`/discounts/${o.id}`,href:"#",class:"stretched-link btn btn-brown ms-auto"},{default:P(()=>[f("查看完整優惠資訊")]),_:2},1032,["to"])])])])]))),128))])])):e.tabName==="抽獎回饋"?(r(),i("section",H,[(r(!0),i(p,null,_(e.lotteries,o=>{var w;return r(),i("div",{class:"py-3 text-darkBrown d-flex flex-column",key:o.id+9590},[t("p",U,"活動時間："+c(new Date(o.startDate).toLocaleString().split(" ")[0])+" ~ "+c(new Date(o.dueDate).toLocaleString().split(" ")[0]),1),t("p",{class:y({"text-danger":e.user.lotteryTicket===0})},"剩餘抽獎券："+c(e.user.lotteryTicket),3),!e.lotteryResult[0]||e.lotteryResult[0].drewArr.length!==e.drewProducts.length?(r(),i("div",F,[q,t("h5",O,c(o.recipe.title),1),t("div",Y,[(r(!0),i(p,null,_(o.recipe.relativeProducts,n=>(r(),i("div",{class:"col-3 d-flex flex-column align-items-center position-relative",key:n.id+95900},[n.category==="單一產品"?(r(),i(p,{key:0},[t("img",{src:n.imgUrl,alt:"",height:"100",width:"100",style:{"object-fit":"cover"}},null,8,G),t("p",null,c(n.title),1),JSON.stringify(this.drewArr).includes(n.title)?b("",!0):(r(),i("div",W,X))],64)):b("",!0)]))),128))]),t("div",Z,[t("button",{type:"button",class:"mx-auto mt-3 btn btn-brown",onClick:l[2]||(l[2]=(...n)=>a.addtLotteryResult&&a.addtLotteryResult(...n))},"立即抽獎")]),K])):e.lotteryResult[0]&&e.lotteryResult[0].drewArr.length===e.drewProducts.length?(r(),i("div",Q,[tt,t("div",et,[t("div",st,[t("div",ot,c(e.lotteryResult[0].prizeNum===1?"大獎":e.lotteryResult[0].prizeNum===2||e.lotteryResult[0].prizeNum===3?"二獎":"三獎"),1),e.lotteryResult[0].prizeNum===1?(r(),i("img",{key:0,src:o.prizes[0].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,it)):e.lotteryResult[0].prizeNum===2||e.lotteryResult[0].prizeNum===3?(r(),i("img",{key:1,src:o.prizes[1].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,rt)):(r(),i("img",{key:2,src:o.prizes[2].img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,lt)),t("div",nt,[t("h5",ct,c(e.lotteryResult[0].prizeNum===1?o.prizes[0].title:e.lotteryResult[0].prizeNum===2||e.lotteryResult[0].prizeNum===3?o.prizes[1].title:o.prizes[2].title),1),t("p",at,"價值：NT$ "+c(e.lotteryResult[0].prizeNum===1?o.prizes[0].price:e.lotteryResult[0].prizeNum===2||e.lotteryResult[0].prizeNum===3?o.prizes[1].price:o.prizes[2].price),1)])]),dt])])):b("",!0),t("section",ht,[ut,(w=e.lotteries[0])!=null&&w.prizes?(r(),i("div",gt,[t("div",pt,[(r(!0),i(p,null,_(e.lotteries[0].prizes,n=>(r(),i("div",{class:"col",key:n.id+500,"data-aos":"flip-right"},[t("div",mt,[t("div",_t,c(n.id===1?"大獎":n.id===2?"二獎":"三獎")+" / "+c(n.people),1),bt,t("img",{src:n.img,class:"card-img border",style:{"border-radius":"20px",height:"220px","object-fit":"cover"},alt:""},null,8,yt),t("div",ft,[t("h5",wt,c(n.title),1),t("p",xt,"價值：NT$ "+c(n.price),1)])])]))),128))])])):b("",!0)]),kt,t("ol",null,[(r(!0),i(p,null,_(o.rules,n=>(r(),i("li",{key:n+20},c(n),1))),128))])])}),128))])):b("",!0)])}const Ct=A(B,[["render",vt]]);export{Ct as default};
